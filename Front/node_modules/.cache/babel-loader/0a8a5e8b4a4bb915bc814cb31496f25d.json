{"ast":null,"code":"/*!\n * FilePond 4.20.1\n * Licensed under MIT, https://opensource.org/licenses/MIT/\n * Please visit https://pqina.nl/filepond/ for details.\n */\n\n/* eslint-disable */\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'], factory) : (global = global || self, factory(global.FilePond = {}));\n})(this, function (exports) {\n  'use strict';\n\n  var isNode = function isNode(value) {\n    return value instanceof HTMLElement;\n  };\n\n  var createStore = function createStore(initialState) {\n    var queries = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var actions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : []; // internal state\n\n    var state = Object.assign({}, initialState); // contains all actions for next frame, is clear when actions are requested\n\n    var actionQueue = [];\n    var dispatchQueue = []; // returns a duplicate of the current state\n\n    var getState = function getState() {\n      return Object.assign({}, state);\n    }; // returns a duplicate of the actions array and clears the actions array\n\n\n    var processActionQueue = function processActionQueue() {\n      // create copy of actions queue\n      var queue = [].concat(actionQueue); // clear actions queue (we don't want no double actions)\n\n      actionQueue.length = 0;\n      return queue;\n    }; // processes actions that might block the main UI thread\n\n\n    var processDispatchQueue = function processDispatchQueue() {\n      // create copy of actions queue\n      var queue = [].concat(dispatchQueue); // clear actions queue (we don't want no double actions)\n\n      dispatchQueue.length = 0; // now dispatch these actions\n\n      queue.forEach(function (_ref) {\n        var type = _ref.type,\n            data = _ref.data;\n        dispatch(type, data);\n      });\n    }; // adds a new action, calls its handler and\n\n\n    var dispatch = function dispatch(type, data, isBlocking) {\n      // is blocking action (should never block if document is hidden)\n      if (isBlocking && !document.hidden) {\n        dispatchQueue.push({\n          type: type,\n          data: data\n        });\n        return;\n      } // if this action has a handler, handle the action\n\n\n      if (actionHandlers[type]) {\n        actionHandlers[type](data);\n      } // now add action\n\n\n      actionQueue.push({\n        type: type,\n        data: data\n      });\n    };\n\n    var query = function query(str) {\n      var _queryHandles;\n\n      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        args[_key - 1] = arguments[_key];\n      }\n\n      return queryHandles[str] ? (_queryHandles = queryHandles)[str].apply(_queryHandles, args) : null;\n    };\n\n    var api = {\n      getState: getState,\n      processActionQueue: processActionQueue,\n      processDispatchQueue: processDispatchQueue,\n      dispatch: dispatch,\n      query: query\n    };\n    var queryHandles = {};\n    queries.forEach(function (query) {\n      queryHandles = Object.assign({}, query(state), {}, queryHandles);\n    });\n    var actionHandlers = {};\n    actions.forEach(function (action) {\n      actionHandlers = Object.assign({}, action(dispatch, query, state), {}, actionHandlers);\n    });\n    return api;\n  };\n\n  var defineProperty = function defineProperty(obj, property, definition) {\n    if (typeof definition === 'function') {\n      obj[property] = definition;\n      return;\n    }\n\n    Object.defineProperty(obj, property, Object.assign({}, definition));\n  };\n\n  var forin = function forin(obj, cb) {\n    for (var key in obj) {\n      if (!obj.hasOwnProperty(key)) {\n        continue;\n      }\n\n      cb(key, obj[key]);\n    }\n  };\n\n  var createObject = function createObject(definition) {\n    var obj = {};\n    forin(definition, function (property) {\n      defineProperty(obj, property, definition[property]);\n    });\n    return obj;\n  };\n\n  var attr = function attr(node, name) {\n    var value = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n    if (value === null) {\n      return node.getAttribute(name) || node.hasAttribute(name);\n    }\n\n    node.setAttribute(name, value);\n  };\n\n  var ns = 'http://www.w3.org/2000/svg';\n  var svgElements = ['svg', 'path']; // only svg elements used\n\n  var isSVGElement = function isSVGElement(tag) {\n    return svgElements.includes(tag);\n  };\n\n  var createElement = function createElement(tag, className) {\n    var attributes = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    if (typeof className === 'object') {\n      attributes = className;\n      className = null;\n    }\n\n    var element = isSVGElement(tag) ? document.createElementNS(ns, tag) : document.createElement(tag);\n\n    if (className) {\n      if (isSVGElement(tag)) {\n        attr(element, 'class', className);\n      } else {\n        element.className = className;\n      }\n    }\n\n    forin(attributes, function (name, value) {\n      attr(element, name, value);\n    });\n    return element;\n  };\n\n  var appendChild = function appendChild(parent) {\n    return function (child, index) {\n      if (typeof index !== 'undefined' && parent.children[index]) {\n        parent.insertBefore(child, parent.children[index]);\n      } else {\n        parent.appendChild(child);\n      }\n    };\n  };\n\n  var appendChildView = function appendChildView(parent, childViews) {\n    return function (view, index) {\n      if (typeof index !== 'undefined') {\n        childViews.splice(index, 0, view);\n      } else {\n        childViews.push(view);\n      }\n\n      return view;\n    };\n  };\n\n  var removeChildView = function removeChildView(parent, childViews) {\n    return function (view) {\n      // remove from child views\n      childViews.splice(childViews.indexOf(view), 1); // remove the element\n\n      if (view.element.parentNode) {\n        parent.removeChild(view.element);\n      }\n\n      return view;\n    };\n  };\n\n  var IS_BROWSER = function () {\n    return typeof window !== 'undefined' && typeof window.document !== 'undefined';\n  }();\n\n  var isBrowser = function isBrowser() {\n    return IS_BROWSER;\n  };\n\n  var testElement = isBrowser() ? createElement('svg') : {};\n  var getChildCount = 'children' in testElement ? function (el) {\n    return el.children.length;\n  } : function (el) {\n    return el.childNodes.length;\n  };\n\n  var getViewRect = function getViewRect(elementRect, childViews, offset, scale) {\n    var left = offset[0] || elementRect.left;\n    var top = offset[1] || elementRect.top;\n    var right = left + elementRect.width;\n    var bottom = top + elementRect.height * (scale[1] || 1);\n    var rect = {\n      // the rectangle of the element itself\n      element: Object.assign({}, elementRect),\n      // the rectangle of the element expanded to contain its children, does not include any margins\n      inner: {\n        left: elementRect.left,\n        top: elementRect.top,\n        right: elementRect.right,\n        bottom: elementRect.bottom\n      },\n      // the rectangle of the element expanded to contain its children including own margin and child margins\n      // margins will be added after we've recalculated the size\n      outer: {\n        left: left,\n        top: top,\n        right: right,\n        bottom: bottom\n      }\n    }; // expand rect to fit all child rectangles\n\n    childViews.filter(function (childView) {\n      return !childView.isRectIgnored();\n    }).map(function (childView) {\n      return childView.rect;\n    }).forEach(function (childViewRect) {\n      expandRect(rect.inner, Object.assign({}, childViewRect.inner));\n      expandRect(rect.outer, Object.assign({}, childViewRect.outer));\n    }); // calculate inner width and height\n\n    calculateRectSize(rect.inner); // append additional margin (top and left margins are included in top and left automatically)\n\n    rect.outer.bottom += rect.element.marginBottom;\n    rect.outer.right += rect.element.marginRight; // calculate outer width and height\n\n    calculateRectSize(rect.outer);\n    return rect;\n  };\n\n  var expandRect = function expandRect(parent, child) {\n    // adjust for parent offset\n    child.top += parent.top;\n    child.right += parent.left;\n    child.bottom += parent.top;\n    child.left += parent.left;\n\n    if (child.bottom > parent.bottom) {\n      parent.bottom = child.bottom;\n    }\n\n    if (child.right > parent.right) {\n      parent.right = child.right;\n    }\n  };\n\n  var calculateRectSize = function calculateRectSize(rect) {\n    rect.width = rect.right - rect.left;\n    rect.height = rect.bottom - rect.top;\n  };\n\n  var isNumber = function isNumber(value) {\n    return typeof value === 'number';\n  };\n  /**\n   * Determines if position is at destination\n   * @param position\n   * @param destination\n   * @param velocity\n   * @param errorMargin\n   * @returns {boolean}\n   */\n\n\n  var thereYet = function thereYet(position, destination, velocity) {\n    var errorMargin = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0.001;\n    return Math.abs(position - destination) < errorMargin && Math.abs(velocity) < errorMargin;\n  };\n  /**\n   * Spring animation\n   */\n\n\n  var spring = // default options\n  function spring() // method definition\n  {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref$stiffness = _ref.stiffness,\n        stiffness = _ref$stiffness === void 0 ? 0.5 : _ref$stiffness,\n        _ref$damping = _ref.damping,\n        damping = _ref$damping === void 0 ? 0.75 : _ref$damping,\n        _ref$mass = _ref.mass,\n        mass = _ref$mass === void 0 ? 10 : _ref$mass;\n\n    var target = null;\n    var position = null;\n    var velocity = 0;\n    var resting = false; // updates spring state\n\n    var interpolate = function interpolate(ts, skipToEndState) {\n      // in rest, don't animate\n      if (resting) return; // need at least a target or position to do springy things\n\n      if (!(isNumber(target) && isNumber(position))) {\n        resting = true;\n        velocity = 0;\n        return;\n      } // calculate spring force\n\n\n      var f = -(position - target) * stiffness; // update velocity by adding force based on mass\n\n      velocity += f / mass; // update position by adding velocity\n\n      position += velocity; // slow down based on amount of damping\n\n      velocity *= damping; // we've arrived if we're near target and our velocity is near zero\n\n      if (thereYet(position, target, velocity) || skipToEndState) {\n        position = target;\n        velocity = 0;\n        resting = true; // we done\n\n        api.onupdate(position);\n        api.oncomplete(position);\n      } else {\n        // progress update\n        api.onupdate(position);\n      }\n    };\n    /**\n     * Set new target value\n     * @param value\n     */\n\n\n    var setTarget = function setTarget(value) {\n      // if currently has no position, set target and position to this value\n      if (isNumber(value) && !isNumber(position)) {\n        position = value;\n      } // next target value will not be animated to\n\n\n      if (target === null) {\n        target = value;\n        position = value;\n      } // let start moving to target\n\n\n      target = value; // already at target\n\n      if (position === target || typeof target === 'undefined') {\n        // now resting as target is current position, stop moving\n        resting = true;\n        velocity = 0; // done!\n\n        api.onupdate(position);\n        api.oncomplete(position);\n        return;\n      }\n\n      resting = false;\n    }; // need 'api' to call onupdate callback\n\n\n    var api = createObject({\n      interpolate: interpolate,\n      target: {\n        set: setTarget,\n        get: function get() {\n          return target;\n        }\n      },\n      resting: {\n        get: function get() {\n          return resting;\n        }\n      },\n      onupdate: function onupdate(value) {},\n      oncomplete: function oncomplete(value) {}\n    });\n    return api;\n  };\n\n  var easeLinear = function easeLinear(t) {\n    return t;\n  };\n\n  var easeInOutQuad = function easeInOutQuad(t) {\n    return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n  };\n\n  var tween = // default values\n  function tween() // method definition\n  {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref$duration = _ref.duration,\n        duration = _ref$duration === void 0 ? 500 : _ref$duration,\n        _ref$easing = _ref.easing,\n        easing = _ref$easing === void 0 ? easeInOutQuad : _ref$easing,\n        _ref$delay = _ref.delay,\n        delay = _ref$delay === void 0 ? 0 : _ref$delay;\n\n    var start = null;\n    var t;\n    var p;\n    var resting = true;\n    var reverse = false;\n    var target = null;\n\n    var interpolate = function interpolate(ts, skipToEndState) {\n      if (resting || target === null) return;\n\n      if (start === null) {\n        start = ts;\n      }\n\n      if (ts - start < delay) return;\n      t = ts - start - delay;\n\n      if (t >= duration || skipToEndState) {\n        t = 1;\n        p = reverse ? 0 : 1;\n        api.onupdate(p * target);\n        api.oncomplete(p * target);\n        resting = true;\n      } else {\n        p = t / duration;\n        api.onupdate((t >= 0 ? easing(reverse ? 1 - p : p) : 0) * target);\n      }\n    }; // need 'api' to call onupdate callback\n\n\n    var api = createObject({\n      interpolate: interpolate,\n      target: {\n        get: function get() {\n          return reverse ? 0 : target;\n        },\n        set: function set(value) {\n          // is initial value\n          if (target === null) {\n            target = value;\n            api.onupdate(value);\n            api.oncomplete(value);\n            return;\n          } // want to tween to a smaller value and have a current value\n\n\n          if (value < target) {\n            target = 1;\n            reverse = true;\n          } else {\n            // not tweening to a smaller value\n            reverse = false;\n            target = value;\n          } // let's go!\n\n\n          resting = false;\n          start = null;\n        }\n      },\n      resting: {\n        get: function get() {\n          return resting;\n        }\n      },\n      onupdate: function onupdate(value) {},\n      oncomplete: function oncomplete(value) {}\n    });\n    return api;\n  };\n\n  var animator = {\n    spring: spring,\n    tween: tween\n  };\n  /*\n                       { type: 'spring', stiffness: .5, damping: .75, mass: 10 };\n                       { translation: { type: 'spring', ... }, ... }\n                       { translation: { x: { type: 'spring', ... } } }\n                      */\n\n  var createAnimator = function createAnimator(definition, category, property) {\n    // default is single definition\n    // we check if transform is set, if so, we check if property is set\n    var def = definition[category] && typeof definition[category][property] === 'object' ? definition[category][property] : definition[category] || definition;\n    var type = typeof def === 'string' ? def : def.type;\n    var props = typeof def === 'object' ? Object.assign({}, def) : {};\n    return animator[type] ? animator[type](props) : null;\n  };\n\n  var addGetSet = function addGetSet(keys, obj, props) {\n    var overwrite = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n    obj = Array.isArray(obj) ? obj : [obj];\n    obj.forEach(function (o) {\n      keys.forEach(function (key) {\n        var name = key;\n\n        var getter = function getter() {\n          return props[key];\n        };\n\n        var setter = function setter(value) {\n          return props[key] = value;\n        };\n\n        if (typeof key === 'object') {\n          name = key.key;\n          getter = key.getter || getter;\n          setter = key.setter || setter;\n        }\n\n        if (o[name] && !overwrite) {\n          return;\n        }\n\n        o[name] = {\n          get: getter,\n          set: setter\n        };\n      });\n    });\n  }; // add to state,\n  // add getters and setters to internal and external api (if not set)\n  // setup animators\n\n\n  var animations = function animations(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n        viewProps = _ref.viewProps,\n        viewInternalAPI = _ref.viewInternalAPI,\n        viewExternalAPI = _ref.viewExternalAPI; // initial properties\n\n    var initialProps = Object.assign({}, viewProps); // list of all active animations\n\n    var animations = []; // setup animators\n\n    forin(mixinConfig, function (property, animation) {\n      var animator = createAnimator(animation);\n\n      if (!animator) {\n        return;\n      } // when the animator updates, update the view state value\n\n\n      animator.onupdate = function (value) {\n        viewProps[property] = value;\n      }; // set animator target\n\n\n      animator.target = initialProps[property]; // when value is set, set the animator target value\n\n      var prop = {\n        key: property,\n        setter: function setter(value) {\n          // if already at target, we done!\n          if (animator.target === value) {\n            return;\n          }\n\n          animator.target = value;\n        },\n        getter: function getter() {\n          return viewProps[property];\n        }\n      }; // add getters and setters\n\n      addGetSet([prop], [viewInternalAPI, viewExternalAPI], viewProps, true); // add it to the list for easy updating from the _write method\n\n      animations.push(animator);\n    }); // expose internal write api\n\n    return {\n      write: function write(ts) {\n        var skipToEndState = document.hidden;\n        var resting = true;\n        animations.forEach(function (animation) {\n          if (!animation.resting) resting = false;\n          animation.interpolate(ts, skipToEndState);\n        });\n        return resting;\n      },\n      destroy: function destroy() {}\n    };\n  };\n\n  var addEvent = function addEvent(element) {\n    return function (type, fn) {\n      element.addEventListener(type, fn);\n    };\n  };\n\n  var removeEvent = function removeEvent(element) {\n    return function (type, fn) {\n      element.removeEventListener(type, fn);\n    };\n  }; // mixin\n\n\n  var listeners = function listeners(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n        viewProps = _ref.viewProps,\n        viewInternalAPI = _ref.viewInternalAPI,\n        viewExternalAPI = _ref.viewExternalAPI,\n        viewState = _ref.viewState,\n        view = _ref.view;\n    var events = [];\n    var add = addEvent(view.element);\n    var remove = removeEvent(view.element);\n\n    viewExternalAPI.on = function (type, fn) {\n      events.push({\n        type: type,\n        fn: fn\n      });\n      add(type, fn);\n    };\n\n    viewExternalAPI.off = function (type, fn) {\n      events.splice(events.findIndex(function (event) {\n        return event.type === type && event.fn === fn;\n      }), 1);\n      remove(type, fn);\n    };\n\n    return {\n      write: function write() {\n        // not busy\n        return true;\n      },\n      destroy: function destroy() {\n        events.forEach(function (event) {\n          remove(event.type, event.fn);\n        });\n      }\n    };\n  }; // add to external api and link to props\n\n\n  var apis = function apis(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n        viewProps = _ref.viewProps,\n        viewExternalAPI = _ref.viewExternalAPI;\n    addGetSet(mixinConfig, viewExternalAPI, viewProps);\n  };\n\n  var isDefined = function isDefined(value) {\n    return value != null;\n  }; // add to state,\n  // add getters and setters to internal and external api (if not set)\n  // set initial state based on props in viewProps\n  // apply as transforms each frame\n\n\n  var defaults = {\n    opacity: 1,\n    scaleX: 1,\n    scaleY: 1,\n    translateX: 0,\n    translateY: 0,\n    rotateX: 0,\n    rotateY: 0,\n    rotateZ: 0,\n    originX: 0,\n    originY: 0\n  };\n\n  var styles = function styles(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n        viewProps = _ref.viewProps,\n        viewInternalAPI = _ref.viewInternalAPI,\n        viewExternalAPI = _ref.viewExternalAPI,\n        view = _ref.view; // initial props\n\n    var initialProps = Object.assign({}, viewProps); // current props\n\n    var currentProps = {}; // we will add those properties to the external API and link them to the viewState\n\n    addGetSet(mixinConfig, [viewInternalAPI, viewExternalAPI], viewProps); // override rect on internal and external rect getter so it takes in account transforms\n\n    var getOffset = function getOffset() {\n      return [viewProps['translateX'] || 0, viewProps['translateY'] || 0];\n    };\n\n    var getScale = function getScale() {\n      return [viewProps['scaleX'] || 0, viewProps['scaleY'] || 0];\n    };\n\n    var getRect = function getRect() {\n      return view.rect ? getViewRect(view.rect, view.childViews, getOffset(), getScale()) : null;\n    };\n\n    viewInternalAPI.rect = {\n      get: getRect\n    };\n    viewExternalAPI.rect = {\n      get: getRect\n    }; // apply view props\n\n    mixinConfig.forEach(function (key) {\n      viewProps[key] = typeof initialProps[key] === 'undefined' ? defaults[key] : initialProps[key];\n    }); // expose api\n\n    return {\n      write: function write() {\n        // see if props have changed\n        if (!propsHaveChanged(currentProps, viewProps)) {\n          return;\n        } // moves element to correct position on screen\n\n\n        applyStyles(view.element, viewProps); // store new transforms\n\n        Object.assign(currentProps, Object.assign({}, viewProps)); // no longer busy\n\n        return true;\n      },\n      destroy: function destroy() {}\n    };\n  };\n\n  var propsHaveChanged = function propsHaveChanged(currentProps, newProps) {\n    // different amount of keys\n    if (Object.keys(currentProps).length !== Object.keys(newProps).length) {\n      return true;\n    } // lets analyze the individual props\n\n\n    for (var prop in newProps) {\n      if (newProps[prop] !== currentProps[prop]) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var applyStyles = function applyStyles(element, _ref2) {\n    var opacity = _ref2.opacity,\n        perspective = _ref2.perspective,\n        translateX = _ref2.translateX,\n        translateY = _ref2.translateY,\n        scaleX = _ref2.scaleX,\n        scaleY = _ref2.scaleY,\n        rotateX = _ref2.rotateX,\n        rotateY = _ref2.rotateY,\n        rotateZ = _ref2.rotateZ,\n        originX = _ref2.originX,\n        originY = _ref2.originY,\n        width = _ref2.width,\n        height = _ref2.height;\n    var transforms = '';\n    var styles = ''; // handle transform origin\n\n    if (isDefined(originX) || isDefined(originY)) {\n      styles += 'transform-origin: ' + (originX || 0) + 'px ' + (originY || 0) + 'px;';\n    } // transform order is relevant\n    // 0. perspective\n\n\n    if (isDefined(perspective)) {\n      transforms += 'perspective(' + perspective + 'px) ';\n    } // 1. translate\n\n\n    if (isDefined(translateX) || isDefined(translateY)) {\n      transforms += 'translate3d(' + (translateX || 0) + 'px, ' + (translateY || 0) + 'px, 0) ';\n    } // 2. scale\n\n\n    if (isDefined(scaleX) || isDefined(scaleY)) {\n      transforms += 'scale3d(' + (isDefined(scaleX) ? scaleX : 1) + ', ' + (isDefined(scaleY) ? scaleY : 1) + ', 1) ';\n    } // 3. rotate\n\n\n    if (isDefined(rotateZ)) {\n      transforms += 'rotateZ(' + rotateZ + 'rad) ';\n    }\n\n    if (isDefined(rotateX)) {\n      transforms += 'rotateX(' + rotateX + 'rad) ';\n    }\n\n    if (isDefined(rotateY)) {\n      transforms += 'rotateY(' + rotateY + 'rad) ';\n    } // add transforms\n\n\n    if (transforms.length) {\n      styles += 'transform:' + transforms + ';';\n    } // add opacity\n\n\n    if (isDefined(opacity)) {\n      styles += 'opacity:' + opacity + ';'; // if we reach zero, we make the element inaccessible\n\n      if (opacity === 0) {\n        styles += 'visibility:hidden;';\n      } // if we're below 100% opacity this element can't be clicked\n\n\n      if (opacity < 1) {\n        styles += 'pointer-events:none;';\n      }\n    } // add height\n\n\n    if (isDefined(height)) {\n      styles += 'height:' + height + 'px;';\n    } // add width\n\n\n    if (isDefined(width)) {\n      styles += 'width:' + width + 'px;';\n    } // apply styles\n\n\n    var elementCurrentStyle = element.elementCurrentStyle || ''; // if new styles does not match current styles, lets update!\n\n    if (styles.length !== elementCurrentStyle.length || styles !== elementCurrentStyle) {\n      element.style.cssText = styles; // store current styles so we can compare them to new styles later on\n      // _not_ getting the style value is faster\n\n      element.elementCurrentStyle = styles;\n    }\n  };\n\n  var Mixins = {\n    styles: styles,\n    listeners: listeners,\n    animations: animations,\n    apis: apis\n  };\n\n  var updateRect = function updateRect() {\n    var rect = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var element = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var style = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    if (!element.layoutCalculated) {\n      rect.paddingTop = parseInt(style.paddingTop, 10) || 0;\n      rect.marginTop = parseInt(style.marginTop, 10) || 0;\n      rect.marginRight = parseInt(style.marginRight, 10) || 0;\n      rect.marginBottom = parseInt(style.marginBottom, 10) || 0;\n      rect.marginLeft = parseInt(style.marginLeft, 10) || 0;\n      element.layoutCalculated = true;\n    }\n\n    rect.left = element.offsetLeft || 0;\n    rect.top = element.offsetTop || 0;\n    rect.width = element.offsetWidth || 0;\n    rect.height = element.offsetHeight || 0;\n    rect.right = rect.left + rect.width;\n    rect.bottom = rect.top + rect.height;\n    rect.scrollTop = element.scrollTop;\n    rect.hidden = element.offsetParent === null;\n    return rect;\n  };\n\n  var createView = // default view definition\n  function createView() {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref$tag = _ref.tag,\n        tag = _ref$tag === void 0 ? 'div' : _ref$tag,\n        _ref$name = _ref.name,\n        name = _ref$name === void 0 ? null : _ref$name,\n        _ref$attributes = _ref.attributes,\n        attributes = _ref$attributes === void 0 ? {} : _ref$attributes,\n        _ref$read = _ref.read,\n        read = _ref$read === void 0 ? function () {} : _ref$read,\n        _ref$write = _ref.write,\n        write = _ref$write === void 0 ? function () {} : _ref$write,\n        _ref$create = _ref.create,\n        create = _ref$create === void 0 ? function () {} : _ref$create,\n        _ref$destroy = _ref.destroy,\n        destroy = _ref$destroy === void 0 ? function () {} : _ref$destroy,\n        _ref$filterFrameActio = _ref.filterFrameActionsForChild,\n        filterFrameActionsForChild = _ref$filterFrameActio === void 0 ? function (child, actions) {\n      return actions;\n    } : _ref$filterFrameActio,\n        _ref$didCreateView = _ref.didCreateView,\n        didCreateView = _ref$didCreateView === void 0 ? function () {} : _ref$didCreateView,\n        _ref$didWriteView = _ref.didWriteView,\n        didWriteView = _ref$didWriteView === void 0 ? function () {} : _ref$didWriteView,\n        _ref$ignoreRect = _ref.ignoreRect,\n        ignoreRect = _ref$ignoreRect === void 0 ? false : _ref$ignoreRect,\n        _ref$ignoreRectUpdate = _ref.ignoreRectUpdate,\n        ignoreRectUpdate = _ref$ignoreRectUpdate === void 0 ? false : _ref$ignoreRectUpdate,\n        _ref$mixins = _ref.mixins,\n        mixins = _ref$mixins === void 0 ? [] : _ref$mixins;\n\n    return function ( // each view requires reference to store\n    store) {\n      var props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {}; // root element should not be changed\n\n      var element = createElement(tag, 'filepond--' + name, attributes); // style reference should also not be changed\n\n      var style = window.getComputedStyle(element, null); // element rectangle\n\n      var rect = updateRect();\n      var frameRect = null; // rest state\n\n      var isResting = false; // pretty self explanatory\n\n      var childViews = []; // loaded mixins\n\n      var activeMixins = []; // references to created children\n\n      var ref = {}; // state used for each instance\n\n      var state = {}; // list of writers that will be called to update this view\n\n      var writers = [write // default writer\n      ];\n      var readers = [read // default reader\n      ];\n      var destroyers = [destroy // default destroy\n      ]; // core view methods\n\n      var getElement = function getElement() {\n        return element;\n      };\n\n      var getChildViews = function getChildViews() {\n        return childViews.concat();\n      };\n\n      var getReference = function getReference() {\n        return ref;\n      };\n\n      var createChildView = function createChildView(store) {\n        return function (view, props) {\n          return view(store, props);\n        };\n      };\n\n      var getRect = function getRect() {\n        if (frameRect) {\n          return frameRect;\n        }\n\n        frameRect = getViewRect(rect, childViews, [0, 0], [1, 1]);\n        return frameRect;\n      };\n\n      var getStyle = function getStyle() {\n        return style;\n      };\n      /**\n       * Read data from DOM\n       * @private\n       */\n\n\n      var _read = function _read() {\n        frameRect = null; // read child views\n\n        childViews.forEach(function (child) {\n          return child._read();\n        });\n        var shouldUpdate = !(ignoreRectUpdate && rect.width && rect.height);\n\n        if (shouldUpdate) {\n          updateRect(rect, element, style);\n        } // readers\n\n\n        var api = {\n          root: internalAPI,\n          props: props,\n          rect: rect\n        };\n        readers.forEach(function (reader) {\n          return reader(api);\n        });\n      };\n      /**\n       * Write data to DOM\n       * @private\n       */\n\n\n      var _write = function _write(ts, frameActions, shouldOptimize) {\n        // if no actions, we assume that the view is resting\n        var resting = frameActions.length === 0; // writers\n\n        writers.forEach(function (writer) {\n          var writerResting = writer({\n            props: props,\n            root: internalAPI,\n            actions: frameActions,\n            timestamp: ts,\n            shouldOptimize: shouldOptimize\n          });\n\n          if (writerResting === false) {\n            resting = false;\n          }\n        }); // run mixins\n\n        activeMixins.forEach(function (mixin) {\n          // if one of the mixins is still busy after write operation, we are not resting\n          var mixinResting = mixin.write(ts);\n\n          if (mixinResting === false) {\n            resting = false;\n          }\n        }); // updates child views that are currently attached to the DOM\n\n        childViews.filter(function (child) {\n          return !!child.element.parentNode;\n        }).forEach(function (child) {\n          // if a child view is not resting, we are not resting\n          var childResting = child._write(ts, filterFrameActionsForChild(child, frameActions), shouldOptimize);\n\n          if (!childResting) {\n            resting = false;\n          }\n        }); // append new elements to DOM and update those\n\n        childViews //.filter(child => !child.element.parentNode)\n        .forEach(function (child, index) {\n          // skip\n          if (child.element.parentNode) {\n            return;\n          } // append to DOM\n\n\n          internalAPI.appendChild(child.element, index); // call read (need to know the size of these elements)\n\n          child._read(); // re-call write\n\n\n          child._write(ts, filterFrameActionsForChild(child, frameActions), shouldOptimize); // we just added somthing to the dom, no rest\n\n\n          resting = false;\n        }); // update resting state\n\n        isResting = resting;\n        didWriteView({\n          props: props,\n          root: internalAPI,\n          actions: frameActions,\n          timestamp: ts\n        }); // let parent know if we are resting\n\n        return resting;\n      };\n\n      var _destroy = function _destroy() {\n        activeMixins.forEach(function (mixin) {\n          return mixin.destroy();\n        });\n        destroyers.forEach(function (destroyer) {\n          destroyer({\n            root: internalAPI,\n            props: props\n          });\n        });\n        childViews.forEach(function (child) {\n          return child._destroy();\n        });\n      }; // sharedAPI\n\n\n      var sharedAPIDefinition = {\n        element: {\n          get: getElement\n        },\n        style: {\n          get: getStyle\n        },\n        childViews: {\n          get: getChildViews\n        }\n      }; // private API definition\n\n      var internalAPIDefinition = Object.assign({}, sharedAPIDefinition, {\n        rect: {\n          get: getRect\n        },\n        // access to custom children references\n        ref: {\n          get: getReference\n        },\n        // dom modifiers\n        is: function is(needle) {\n          return name === needle;\n        },\n        appendChild: appendChild(element),\n        createChildView: createChildView(store),\n        linkView: function linkView(view) {\n          childViews.push(view);\n          return view;\n        },\n        unlinkView: function unlinkView(view) {\n          childViews.splice(childViews.indexOf(view), 1);\n        },\n        appendChildView: appendChildView(element, childViews),\n        removeChildView: removeChildView(element, childViews),\n        registerWriter: function registerWriter(writer) {\n          return writers.push(writer);\n        },\n        registerReader: function registerReader(reader) {\n          return readers.push(reader);\n        },\n        registerDestroyer: function registerDestroyer(destroyer) {\n          return destroyers.push(destroyer);\n        },\n        invalidateLayout: function invalidateLayout() {\n          return element.layoutCalculated = false;\n        },\n        // access to data store\n        dispatch: store.dispatch,\n        query: store.query\n      }); // public view API methods\n\n      var externalAPIDefinition = {\n        element: {\n          get: getElement\n        },\n        childViews: {\n          get: getChildViews\n        },\n        rect: {\n          get: getRect\n        },\n        resting: {\n          get: function get() {\n            return isResting;\n          }\n        },\n        isRectIgnored: function isRectIgnored() {\n          return ignoreRect;\n        },\n        _read: _read,\n        _write: _write,\n        _destroy: _destroy\n      }; // mixin API methods\n\n      var mixinAPIDefinition = Object.assign({}, sharedAPIDefinition, {\n        rect: {\n          get: function get() {\n            return rect;\n          }\n        }\n      }); // add mixin functionality\n\n      Object.keys(mixins).sort(function (a, b) {\n        // move styles to the back of the mixin list (so adjustments of other mixins are applied to the props correctly)\n        if (a === 'styles') {\n          return 1;\n        } else if (b === 'styles') {\n          return -1;\n        }\n\n        return 0;\n      }).forEach(function (key) {\n        var mixinAPI = Mixins[key]({\n          mixinConfig: mixins[key],\n          viewProps: props,\n          viewState: state,\n          viewInternalAPI: internalAPIDefinition,\n          viewExternalAPI: externalAPIDefinition,\n          view: createObject(mixinAPIDefinition)\n        });\n\n        if (mixinAPI) {\n          activeMixins.push(mixinAPI);\n        }\n      }); // construct private api\n\n      var internalAPI = createObject(internalAPIDefinition); // create the view\n\n      create({\n        root: internalAPI,\n        props: props\n      }); // append created child views to root node\n\n      var childCount = getChildCount(element); // need to know the current child count so appending happens in correct order\n\n      childViews.forEach(function (child, index) {\n        internalAPI.appendChild(child.element, childCount + index);\n      }); // call did create\n\n      didCreateView(internalAPI); // expose public api\n\n      return createObject(externalAPIDefinition);\n    };\n  };\n\n  var createPainter = function createPainter(read, write) {\n    var fps = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 60;\n    var name = '__framePainter'; // set global painter\n\n    if (window[name]) {\n      window[name].readers.push(read);\n      window[name].writers.push(write);\n      return;\n    }\n\n    window[name] = {\n      readers: [read],\n      writers: [write]\n    };\n    var painter = window[name];\n    var interval = 1000 / fps;\n    var last = null;\n    var id = null;\n    var requestTick = null;\n    var cancelTick = null;\n\n    var setTimerType = function setTimerType() {\n      if (document.hidden) {\n        requestTick = function requestTick() {\n          return window.setTimeout(function () {\n            return tick(performance.now());\n          }, interval);\n        };\n\n        cancelTick = function cancelTick() {\n          return window.clearTimeout(id);\n        };\n      } else {\n        requestTick = function requestTick() {\n          return window.requestAnimationFrame(tick);\n        };\n\n        cancelTick = function cancelTick() {\n          return window.cancelAnimationFrame(id);\n        };\n      }\n    };\n\n    document.addEventListener('visibilitychange', function () {\n      if (cancelTick) cancelTick();\n      setTimerType();\n      tick(performance.now());\n    });\n\n    var tick = function tick(ts) {\n      // queue next tick\n      id = requestTick(tick); // limit fps\n\n      if (!last) {\n        last = ts;\n      }\n\n      var delta = ts - last;\n\n      if (delta <= interval) {\n        // skip frame\n        return;\n      } // align next frame\n\n\n      last = ts - delta % interval; // update view\n\n      painter.readers.forEach(function (read) {\n        return read();\n      });\n      painter.writers.forEach(function (write) {\n        return write(ts);\n      });\n    };\n\n    setTimerType();\n    tick(performance.now());\n    return {\n      pause: function pause() {\n        cancelTick(id);\n      }\n    };\n  };\n\n  var createRoute = function createRoute(routes, fn) {\n    return function (_ref) {\n      var root = _ref.root,\n          props = _ref.props,\n          _ref$actions = _ref.actions,\n          actions = _ref$actions === void 0 ? [] : _ref$actions,\n          timestamp = _ref.timestamp,\n          shouldOptimize = _ref.shouldOptimize;\n      actions.filter(function (action) {\n        return routes[action.type];\n      }).forEach(function (action) {\n        return routes[action.type]({\n          root: root,\n          props: props,\n          action: action.data,\n          timestamp: timestamp,\n          shouldOptimize: shouldOptimize\n        });\n      });\n\n      if (fn) {\n        fn({\n          root: root,\n          props: props,\n          actions: actions,\n          timestamp: timestamp,\n          shouldOptimize: shouldOptimize\n        });\n      }\n    };\n  };\n\n  var insertBefore = function insertBefore(newNode, referenceNode) {\n    return referenceNode.parentNode.insertBefore(newNode, referenceNode);\n  };\n\n  var insertAfter = function insertAfter(newNode, referenceNode) {\n    return referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n  };\n\n  var isArray = function isArray(value) {\n    return Array.isArray(value);\n  };\n\n  var isEmpty = function isEmpty(value) {\n    return value == null;\n  };\n\n  var trim = function trim(str) {\n    return str.trim();\n  };\n\n  var toString = function toString(value) {\n    return '' + value;\n  };\n\n  var toArray = function toArray(value) {\n    var splitter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ',';\n\n    if (isEmpty(value)) {\n      return [];\n    }\n\n    if (isArray(value)) {\n      return value;\n    }\n\n    return toString(value).split(splitter).map(trim).filter(function (str) {\n      return str.length;\n    });\n  };\n\n  var isBoolean = function isBoolean(value) {\n    return typeof value === 'boolean';\n  };\n\n  var toBoolean = function toBoolean(value) {\n    return isBoolean(value) ? value : value === 'true';\n  };\n\n  var isString = function isString(value) {\n    return typeof value === 'string';\n  };\n\n  var toNumber = function toNumber(value) {\n    return isNumber(value) ? value : isString(value) ? toString(value).replace(/[a-z]+/gi, '') : 0;\n  };\n\n  var toInt = function toInt(value) {\n    return parseInt(toNumber(value), 10);\n  };\n\n  var toFloat = function toFloat(value) {\n    return parseFloat(toNumber(value));\n  };\n\n  var isInt = function isInt(value) {\n    return isNumber(value) && isFinite(value) && Math.floor(value) === value;\n  };\n\n  var toBytes = function toBytes(value) {\n    // is in bytes\n    if (isInt(value)) {\n      return value;\n    } // is natural file size\n\n\n    var naturalFileSize = toString(value).trim(); // if is value in megabytes\n\n    if (/MB$/i.test(naturalFileSize)) {\n      naturalFileSize = naturalFileSize.replace(/MB$i/, '').trim();\n      return toInt(naturalFileSize) * 1000 * 1000;\n    } // if is value in kilobytes\n\n\n    if (/KB/i.test(naturalFileSize)) {\n      naturalFileSize = naturalFileSize.replace(/KB$i/, '').trim();\n      return toInt(naturalFileSize) * 1000;\n    }\n\n    return toInt(naturalFileSize);\n  };\n\n  var isFunction = function isFunction(value) {\n    return typeof value === 'function';\n  };\n\n  var toFunctionReference = function toFunctionReference(string) {\n    var ref = self;\n    var levels = string.split('.');\n    var level = null;\n\n    while (level = levels.shift()) {\n      ref = ref[level];\n\n      if (!ref) {\n        return null;\n      }\n    }\n\n    return ref;\n  };\n\n  var methods = {\n    process: 'POST',\n    patch: 'PATCH',\n    revert: 'DELETE',\n    fetch: 'GET',\n    restore: 'GET',\n    load: 'GET'\n  };\n\n  var createServerAPI = function createServerAPI(outline) {\n    var api = {};\n    api.url = isString(outline) ? outline : outline.url || '';\n    api.timeout = outline.timeout ? parseInt(outline.timeout, 10) : 0;\n    api.headers = outline.headers ? outline.headers : {};\n    forin(methods, function (key) {\n      api[key] = createAction(key, outline[key], methods[key], api.timeout, api.headers);\n    }); // special treatment for remove\n\n    api.remove = outline.remove || null; // remove generic headers from api object\n\n    delete api.headers;\n    return api;\n  };\n\n  var createAction = function createAction(name, outline, method, timeout, headers) {\n    // is explicitely set to null so disable\n    if (outline === null) {\n      return null;\n    } // if is custom function, done! Dev handles everything.\n\n\n    if (typeof outline === 'function') {\n      return outline;\n    } // build action object\n\n\n    var action = {\n      url: method === 'GET' || method === 'PATCH' ? '?' + name + '=' : '',\n      method: method,\n      headers: headers,\n      withCredentials: false,\n      timeout: timeout,\n      onload: null,\n      ondata: null,\n      onerror: null\n    }; // is a single url\n\n    if (isString(outline)) {\n      action.url = outline;\n      return action;\n    } // overwrite\n\n\n    Object.assign(action, outline); // see if should reformat headers;\n\n    if (isString(action.headers)) {\n      var parts = action.headers.split(/:(.+)/);\n      action.headers = {\n        header: parts[0],\n        value: parts[1]\n      };\n    } // if is bool withCredentials\n\n\n    action.withCredentials = toBoolean(action.withCredentials);\n    return action;\n  };\n\n  var toServerAPI = function toServerAPI(value) {\n    return createServerAPI(value);\n  };\n\n  var isNull = function isNull(value) {\n    return value === null;\n  };\n\n  var isObject = function isObject(value) {\n    return typeof value === 'object' && value !== null;\n  };\n\n  var isAPI = function isAPI(value) {\n    return isObject(value) && isString(value.url) && isObject(value.process) && isObject(value.revert) && isObject(value.restore) && isObject(value.fetch);\n  };\n\n  var getType = function getType(value) {\n    if (isArray(value)) {\n      return 'array';\n    }\n\n    if (isNull(value)) {\n      return 'null';\n    }\n\n    if (isInt(value)) {\n      return 'int';\n    }\n\n    if (/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(value)) {\n      return 'bytes';\n    }\n\n    if (isAPI(value)) {\n      return 'api';\n    }\n\n    return typeof value;\n  };\n\n  var replaceSingleQuotes = function replaceSingleQuotes(str) {\n    return str.replace(/{\\s*'/g, '{\"').replace(/'\\s*}/g, '\"}').replace(/'\\s*:/g, '\":').replace(/:\\s*'/g, ':\"').replace(/,\\s*'/g, ',\"').replace(/'\\s*,/g, '\",');\n  };\n\n  var conversionTable = {\n    array: toArray,\n    boolean: toBoolean,\n    int: function int(value) {\n      return getType(value) === 'bytes' ? toBytes(value) : toInt(value);\n    },\n    number: toFloat,\n    float: toFloat,\n    bytes: toBytes,\n    string: function string(value) {\n      return isFunction(value) ? value : toString(value);\n    },\n    function: function _function(value) {\n      return toFunctionReference(value);\n    },\n    serverapi: toServerAPI,\n    object: function object(value) {\n      try {\n        return JSON.parse(replaceSingleQuotes(value));\n      } catch (e) {\n        return null;\n      }\n    }\n  };\n\n  var convertTo = function convertTo(value, type) {\n    return conversionTable[type](value);\n  };\n\n  var getValueByType = function getValueByType(newValue, defaultValue, valueType) {\n    // can always assign default value\n    if (newValue === defaultValue) {\n      return newValue;\n    } // get the type of the new value\n\n\n    var newValueType = getType(newValue); // is valid type?\n\n    if (newValueType !== valueType) {\n      // is string input, let's attempt to convert\n      var convertedValue = convertTo(newValue, valueType); // what is the type now\n\n      newValueType = getType(convertedValue); // no valid conversions found\n\n      if (convertedValue === null) {\n        throw 'Trying to assign value with incorrect type to \"' + option + '\", allowed type: \"' + valueType + '\"';\n      } else {\n        newValue = convertedValue;\n      }\n    } // assign new value\n\n\n    return newValue;\n  };\n\n  var createOption = function createOption(defaultValue, valueType) {\n    var currentValue = defaultValue;\n    return {\n      enumerable: true,\n      get: function get() {\n        return currentValue;\n      },\n      set: function set(newValue) {\n        currentValue = getValueByType(newValue, defaultValue, valueType);\n      }\n    };\n  };\n\n  var createOptions = function createOptions(options) {\n    var obj = {};\n    forin(options, function (prop) {\n      var optionDefinition = options[prop];\n      obj[prop] = createOption(optionDefinition[0], optionDefinition[1]);\n    });\n    return createObject(obj);\n  };\n\n  var createInitialState = function createInitialState(options) {\n    return {\n      // model\n      items: [],\n      // timeout used for calling update items\n      listUpdateTimeout: null,\n      // timeout used for stacking metadata updates\n      itemUpdateTimeout: null,\n      // queue of items waiting to be processed\n      processingQueue: [],\n      // options\n      options: createOptions(options)\n    };\n  };\n\n  var fromCamels = function fromCamels(string) {\n    var separator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '-';\n    return string.split(/(?=[A-Z])/).map(function (part) {\n      return part.toLowerCase();\n    }).join(separator);\n  };\n\n  var createOptionAPI = function createOptionAPI(store, options) {\n    var obj = {};\n    forin(options, function (key) {\n      obj[key] = {\n        get: function get() {\n          return store.getState().options[key];\n        },\n        set: function set(value) {\n          store.dispatch('SET_' + fromCamels(key, '_').toUpperCase(), {\n            value: value\n          });\n        }\n      };\n    });\n    return obj;\n  };\n\n  var createOptionActions = function createOptionActions(options) {\n    return function (dispatch, query, state) {\n      var obj = {};\n      forin(options, function (key) {\n        var name = fromCamels(key, '_').toUpperCase();\n\n        obj['SET_' + name] = function (action) {\n          try {\n            state.options[key] = action.value;\n          } catch (e) {} // nope, failed\n          // we successfully set the value of this option\n\n\n          dispatch('DID_SET_' + name, {\n            value: state.options[key]\n          });\n        };\n      });\n      return obj;\n    };\n  };\n\n  var createOptionQueries = function createOptionQueries(options) {\n    return function (state) {\n      var obj = {};\n      forin(options, function (key) {\n        obj['GET_' + fromCamels(key, '_').toUpperCase()] = function (action) {\n          return state.options[key];\n        };\n      });\n      return obj;\n    };\n  };\n\n  var InteractionMethod = {\n    API: 1,\n    DROP: 2,\n    BROWSE: 3,\n    PASTE: 4,\n    NONE: 5\n  };\n\n  var getUniqueId = function getUniqueId() {\n    return Math.random().toString(36).substr(2, 9);\n  };\n\n  function _typeof(obj) {\n    if (typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol') {\n      _typeof = function (obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function (obj) {\n        return obj && typeof Symbol === 'function' && obj.constructor === Symbol && obj !== Symbol.prototype ? 'symbol' : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  var REACT_ELEMENT_TYPE;\n\n  function _jsx(type, props, key, children) {\n    if (!REACT_ELEMENT_TYPE) {\n      REACT_ELEMENT_TYPE = typeof Symbol === 'function' && Symbol['for'] && Symbol['for']('react.element') || 0xeac7;\n    }\n\n    var defaultProps = type && type.defaultProps;\n    var childrenLength = arguments.length - 3;\n\n    if (!props && childrenLength !== 0) {\n      props = {\n        children: void 0\n      };\n    }\n\n    if (props && defaultProps) {\n      for (var propName in defaultProps) {\n        if (props[propName] === void 0) {\n          props[propName] = defaultProps[propName];\n        }\n      }\n    } else if (!props) {\n      props = defaultProps || {};\n    }\n\n    if (childrenLength === 1) {\n      props.children = children;\n    } else if (childrenLength > 1) {\n      var childArray = new Array(childrenLength);\n\n      for (var i = 0; i < childrenLength; i++) {\n        childArray[i] = arguments[i + 3];\n      }\n\n      props.children = childArray;\n    }\n\n    return {\n      $$typeof: REACT_ELEMENT_TYPE,\n      type: type,\n      key: key === undefined ? null : '' + key,\n      ref: null,\n      props: props,\n      _owner: null\n    };\n  }\n\n  function _asyncIterator(iterable) {\n    var method;\n\n    if (typeof Symbol !== 'undefined') {\n      if (Symbol.asyncIterator) {\n        method = iterable[Symbol.asyncIterator];\n        if (method != null) return method.call(iterable);\n      }\n\n      if (Symbol.iterator) {\n        method = iterable[Symbol.iterator];\n        if (method != null) return method.call(iterable);\n      }\n    }\n\n    throw new TypeError('Object is not async iterable');\n  }\n\n  function _AwaitValue(value) {\n    this.wrapped = value;\n  }\n\n  function _AsyncGenerator(gen) {\n    var front, back;\n\n    function send(key, arg) {\n      return new Promise(function (resolve, reject) {\n        var request = {\n          key: key,\n          arg: arg,\n          resolve: resolve,\n          reject: reject,\n          next: null\n        };\n\n        if (back) {\n          back = back.next = request;\n        } else {\n          front = back = request;\n          resume(key, arg);\n        }\n      });\n    }\n\n    function resume(key, arg) {\n      try {\n        var result = gen[key](arg);\n        var value = result.value;\n        var wrappedAwait = value instanceof _AwaitValue;\n        Promise.resolve(wrappedAwait ? value.wrapped : value).then(function (arg) {\n          if (wrappedAwait) {\n            resume('next', arg);\n            return;\n          }\n\n          settle(result.done ? 'return' : 'normal', arg);\n        }, function (err) {\n          resume('throw', err);\n        });\n      } catch (err) {\n        settle('throw', err);\n      }\n    }\n\n    function settle(type, value) {\n      switch (type) {\n        case 'return':\n          front.resolve({\n            value: value,\n            done: true\n          });\n          break;\n\n        case 'throw':\n          front.reject(value);\n          break;\n\n        default:\n          front.resolve({\n            value: value,\n            done: false\n          });\n          break;\n      }\n\n      front = front.next;\n\n      if (front) {\n        resume(front.key, front.arg);\n      } else {\n        back = null;\n      }\n    }\n\n    this._invoke = send;\n\n    if (typeof gen.return !== 'function') {\n      this.return = undefined;\n    }\n  }\n\n  if (typeof Symbol === 'function' && Symbol.asyncIterator) {\n    _AsyncGenerator.prototype[Symbol.asyncIterator] = function () {\n      return this;\n    };\n  }\n\n  _AsyncGenerator.prototype.next = function (arg) {\n    return this._invoke('next', arg);\n  };\n\n  _AsyncGenerator.prototype.throw = function (arg) {\n    return this._invoke('throw', arg);\n  };\n\n  _AsyncGenerator.prototype.return = function (arg) {\n    return this._invoke('return', arg);\n  };\n\n  function _wrapAsyncGenerator(fn) {\n    return function () {\n      return new _AsyncGenerator(fn.apply(this, arguments));\n    };\n  }\n\n  function _awaitAsyncGenerator(value) {\n    return new _AwaitValue(value);\n  }\n\n  function _asyncGeneratorDelegate(inner, awaitWrap) {\n    var iter = {},\n        waiting = false;\n\n    function pump(key, value) {\n      waiting = true;\n      value = new Promise(function (resolve) {\n        resolve(inner[key](value));\n      });\n      return {\n        done: false,\n        value: awaitWrap(value)\n      };\n    }\n\n    if (typeof Symbol === 'function' && Symbol.iterator) {\n      iter[Symbol.iterator] = function () {\n        return this;\n      };\n    }\n\n    iter.next = function (value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump('next', value);\n    };\n\n    if (typeof inner.throw === 'function') {\n      iter.throw = function (value) {\n        if (waiting) {\n          waiting = false;\n          throw value;\n        }\n\n        return pump('throw', value);\n      };\n    }\n\n    if (typeof inner.return === 'function') {\n      iter.return = function (value) {\n        return pump('return', value);\n      };\n    }\n\n    return iter;\n  }\n\n  function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n      var info = gen[key](arg);\n      var value = info.value;\n    } catch (error) {\n      reject(error);\n      return;\n    }\n\n    if (info.done) {\n      resolve(value);\n    } else {\n      Promise.resolve(value).then(_next, _throw);\n    }\n  }\n\n  function _asyncToGenerator(fn) {\n    return function () {\n      var self = this,\n          args = arguments;\n      return new Promise(function (resolve, reject) {\n        var gen = fn.apply(self, args);\n\n        function _next(value) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'next', value);\n        }\n\n        function _throw(err) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'throw', err);\n        }\n\n        _next(undefined);\n      });\n    };\n  }\n\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError('Cannot call a class as a function');\n    }\n  }\n\n  function _defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if ('value' in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  function _createClass(Constructor, protoProps, staticProps) {\n    if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) _defineProperties(Constructor, staticProps);\n    return Constructor;\n  }\n\n  function _defineEnumerableProperties(obj, descs) {\n    for (var key in descs) {\n      var desc = descs[key];\n      desc.configurable = desc.enumerable = true;\n      if ('value' in desc) desc.writable = true;\n      Object.defineProperty(obj, key, desc);\n    }\n\n    if (Object.getOwnPropertySymbols) {\n      var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n      for (var i = 0; i < objectSymbols.length; i++) {\n        var sym = objectSymbols[i];\n        var desc = descs[sym];\n        desc.configurable = desc.enumerable = true;\n        if ('value' in desc) desc.writable = true;\n        Object.defineProperty(obj, sym, desc);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defaults(obj, defaults) {\n    var keys = Object.getOwnPropertyNames(defaults);\n\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n      var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n      if (value && value.configurable && obj[key] === undefined) {\n        Object.defineProperty(obj, key, value);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defineProperty(obj, key, value) {\n    if (key in obj) {\n      Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n      });\n    } else {\n      obj[key] = value;\n    }\n\n    return obj;\n  }\n\n  function _extends() {\n    _extends = Object.assign || function (target) {\n      for (var i = 1; i < arguments.length; i++) {\n        var source = arguments[i];\n\n        for (var key in source) {\n          if (Object.prototype.hasOwnProperty.call(source, key)) {\n            target[key] = source[key];\n          }\n        }\n      }\n\n      return target;\n    };\n\n    return _extends.apply(this, arguments);\n  }\n\n  function _objectSpread(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n      var ownKeys = Object.keys(source);\n\n      if (typeof Object.getOwnPropertySymbols === 'function') {\n        ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n          return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n      }\n\n      ownKeys.forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    }\n\n    return target;\n  }\n\n  function ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n\n    if (Object.getOwnPropertySymbols) {\n      var symbols = Object.getOwnPropertySymbols(object);\n      if (enumerableOnly) symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n      keys.push.apply(keys, symbols);\n    }\n\n    return keys;\n  }\n\n  function _objectSpread2(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n\n      if (i % 2) {\n        ownKeys(source, true).forEach(function (key) {\n          _defineProperty(target, key, source[key]);\n        });\n      } else if (Object.getOwnPropertyDescriptors) {\n        Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n      } else {\n        ownKeys(source).forEach(function (key) {\n          Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n        });\n      }\n    }\n\n    return target;\n  }\n\n  function _inherits(subClass, superClass) {\n    if (typeof superClass !== 'function' && superClass !== null) {\n      throw new TypeError('Super expression must either be null or a function');\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) _setPrototypeOf(subClass, superClass);\n  }\n\n  function _inheritsLoose(subClass, superClass) {\n    subClass.prototype = Object.create(superClass.prototype);\n    subClass.prototype.constructor = subClass;\n    subClass.__proto__ = superClass;\n  }\n\n  function _getPrototypeOf(o) {\n    _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n      return o.__proto__ || Object.getPrototypeOf(o);\n    };\n    return _getPrototypeOf(o);\n  }\n\n  function _setPrototypeOf(o, p) {\n    _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n      o.__proto__ = p;\n      return o;\n    };\n\n    return _setPrototypeOf(o, p);\n  }\n\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === 'undefined' || !Reflect.construct) return false;\n    if (Reflect.construct.sham) return false;\n    if (typeof Proxy === 'function') return true;\n\n    try {\n      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  function _construct(Parent, args, Class) {\n    if (isNativeReflectConstruct()) {\n      _construct = Reflect.construct;\n    } else {\n      _construct = function _construct(Parent, args, Class) {\n        var a = [null];\n        a.push.apply(a, args);\n        var Constructor = Function.bind.apply(Parent, a);\n        var instance = new Constructor();\n        if (Class) _setPrototypeOf(instance, Class.prototype);\n        return instance;\n      };\n    }\n\n    return _construct.apply(null, arguments);\n  }\n\n  function _isNativeFunction(fn) {\n    return Function.toString.call(fn).indexOf('[native code]') !== -1;\n  }\n\n  function _wrapNativeSuper(Class) {\n    var _cache = typeof Map === 'function' ? new Map() : undefined;\n\n    _wrapNativeSuper = function _wrapNativeSuper(Class) {\n      if (Class === null || !_isNativeFunction(Class)) return Class;\n\n      if (typeof Class !== 'function') {\n        throw new TypeError('Super expression must either be null or a function');\n      }\n\n      if (typeof _cache !== 'undefined') {\n        if (_cache.has(Class)) return _cache.get(Class);\n\n        _cache.set(Class, Wrapper);\n      }\n\n      function Wrapper() {\n        return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n      }\n\n      Wrapper.prototype = Object.create(Class.prototype, {\n        constructor: {\n          value: Wrapper,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n      return _setPrototypeOf(Wrapper, Class);\n    };\n\n    return _wrapNativeSuper(Class);\n  }\n\n  function _instanceof(left, right) {\n    if (right != null && typeof Symbol !== 'undefined' && right[Symbol.hasInstance]) {\n      return !!right[Symbol.hasInstance](left);\n    } else {\n      return left instanceof right;\n    }\n  }\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : {\n      default: obj\n    };\n  }\n\n  function _interopRequireWildcard(obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};\n\n            if (desc.get || desc.set) {\n              Object.defineProperty(newObj, key, desc);\n            } else {\n              newObj[key] = obj[key];\n            }\n          }\n        }\n      }\n\n      newObj.default = obj;\n      return newObj;\n    }\n  }\n\n  function _newArrowCheck(innerThis, boundThis) {\n    if (innerThis !== boundThis) {\n      throw new TypeError('Cannot instantiate an arrow function');\n    }\n  }\n\n  function _objectDestructuringEmpty(obj) {\n    if (obj == null) throw new TypeError('Cannot destructure undefined');\n  }\n\n  function _objectWithoutPropertiesLoose(source, excluded) {\n    if (source == null) return {};\n    var target = {};\n    var sourceKeys = Object.keys(source);\n    var key, i;\n\n    for (i = 0; i < sourceKeys.length; i++) {\n      key = sourceKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      target[key] = source[key];\n    }\n\n    return target;\n  }\n\n  function _objectWithoutProperties(source, excluded) {\n    if (source == null) return {};\n\n    var target = _objectWithoutPropertiesLoose(source, excluded);\n\n    var key, i;\n\n    if (Object.getOwnPropertySymbols) {\n      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n      for (i = 0; i < sourceSymbolKeys.length; i++) {\n        key = sourceSymbolKeys[i];\n        if (excluded.indexOf(key) >= 0) continue;\n        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n        target[key] = source[key];\n      }\n    }\n\n    return target;\n  }\n\n  function _assertThisInitialized(self) {\n    if (self === void 0) {\n      throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    }\n\n    return self;\n  }\n\n  function _possibleConstructorReturn(self, call) {\n    if (call && (typeof call === 'object' || typeof call === 'function')) {\n      return call;\n    }\n\n    return _assertThisInitialized(self);\n  }\n\n  function _superPropBase(object, property) {\n    while (!Object.prototype.hasOwnProperty.call(object, property)) {\n      object = _getPrototypeOf(object);\n      if (object === null) break;\n    }\n\n    return object;\n  }\n\n  function _get(target, property, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.get) {\n      _get = Reflect.get;\n    } else {\n      _get = function _get(target, property, receiver) {\n        var base = _superPropBase(target, property);\n\n        if (!base) return;\n        var desc = Object.getOwnPropertyDescriptor(base, property);\n\n        if (desc.get) {\n          return desc.get.call(receiver);\n        }\n\n        return desc.value;\n      };\n    }\n\n    return _get(target, property, receiver || target);\n  }\n\n  function set(target, property, value, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.set) {\n      set = Reflect.set;\n    } else {\n      set = function set(target, property, value, receiver) {\n        var base = _superPropBase(target, property);\n\n        var desc;\n\n        if (base) {\n          desc = Object.getOwnPropertyDescriptor(base, property);\n\n          if (desc.set) {\n            desc.set.call(receiver, value);\n            return true;\n          } else if (!desc.writable) {\n            return false;\n          }\n        }\n\n        desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n        if (desc) {\n          if (!desc.writable) {\n            return false;\n          }\n\n          desc.value = value;\n          Object.defineProperty(receiver, property, desc);\n        } else {\n          _defineProperty(receiver, property, value);\n        }\n\n        return true;\n      };\n    }\n\n    return set(target, property, value, receiver);\n  }\n\n  function _set(target, property, value, receiver, isStrict) {\n    var s = set(target, property, value, receiver || target);\n\n    if (!s && isStrict) {\n      throw new Error('failed to set property');\n    }\n\n    return value;\n  }\n\n  function _taggedTemplateLiteral(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    return Object.freeze(Object.defineProperties(strings, {\n      raw: {\n        value: Object.freeze(raw)\n      }\n    }));\n  }\n\n  function _taggedTemplateLiteralLoose(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    strings.raw = raw;\n    return strings;\n  }\n\n  function _temporalRef(val, name) {\n    if (val === _temporalUndefined) {\n      throw new ReferenceError(name + ' is not defined - temporal dead zone');\n    } else {\n      return val;\n    }\n  }\n\n  function _readOnlyError(name) {\n    throw new Error('\"' + name + '\" is read-only');\n  }\n\n  function _classNameTDZError(name) {\n    throw new Error('Class \"' + name + '\" cannot be referenced in computed property keys.');\n  }\n\n  var _temporalUndefined = {};\n\n  function _slicedToArray(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n  }\n\n  function _slicedToArrayLoose(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimitLoose(arr, i) || _nonIterableRest();\n  }\n\n  function _toArray(arr) {\n    return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n  }\n\n  function _toConsumableArray(arr) {\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n  }\n\n  function _arrayWithoutHoles(arr) {\n    if (Array.isArray(arr)) {\n      for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n      return arr2;\n    }\n  }\n\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n\n  function _iterableToArray(iter) {\n    if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === '[object Arguments]') return Array.from(iter);\n  }\n\n  function _iterableToArrayLimit(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i['return'] != null) _i['return']();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  function _iterableToArrayLimitLoose(arr, i) {\n    var _arr = [];\n\n    for (var _iterator = arr[Symbol.iterator](), _step; !(_step = _iterator.next()).done;) {\n      _arr.push(_step.value);\n\n      if (i && _arr.length === i) break;\n    }\n\n    return _arr;\n  }\n\n  function _nonIterableSpread() {\n    throw new TypeError('Invalid attempt to spread non-iterable instance');\n  }\n\n  function _nonIterableRest() {\n    throw new TypeError('Invalid attempt to destructure non-iterable instance');\n  }\n\n  function _skipFirstGeneratorNext(fn) {\n    return function () {\n      var it = fn.apply(this, arguments);\n      it.next();\n      return it;\n    };\n  }\n\n  function _toPrimitive(input, hint) {\n    if (typeof input !== 'object' || input === null) return input;\n    var prim = input[Symbol.toPrimitive];\n\n    if (prim !== undefined) {\n      var res = prim.call(input, hint || 'default');\n      if (typeof res !== 'object') return res;\n      throw new TypeError('@@toPrimitive must return a primitive value.');\n    }\n\n    return (hint === 'string' ? String : Number)(input);\n  }\n\n  function _toPropertyKey(arg) {\n    var key = _toPrimitive(arg, 'string');\n\n    return typeof key === 'symbol' ? key : String(key);\n  }\n\n  function _initializerWarningHelper(descriptor, context) {\n    throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and set to use loose mode. ' + 'To use proposal-class-properties in spec mode with decorators, wait for ' + 'the next major version of decorators in stage 2.');\n  }\n\n  function _initializerDefineProperty(target, property, descriptor, context) {\n    if (!descriptor) return;\n    Object.defineProperty(target, property, {\n      enumerable: descriptor.enumerable,\n      configurable: descriptor.configurable,\n      writable: descriptor.writable,\n      value: descriptor.initializer ? descriptor.initializer.call(context) : void 0\n    });\n  }\n\n  function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n    var desc = {};\n    Object.keys(descriptor).forEach(function (key) {\n      desc[key] = descriptor[key];\n    });\n    desc.enumerable = !!desc.enumerable;\n    desc.configurable = !!desc.configurable;\n\n    if ('value' in desc || desc.initializer) {\n      desc.writable = true;\n    }\n\n    desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n      return decorator(target, property, desc) || desc;\n    }, desc);\n\n    if (context && desc.initializer !== void 0) {\n      desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n      desc.initializer = undefined;\n    }\n\n    if (desc.initializer === void 0) {\n      Object.defineProperty(target, property, desc);\n      desc = null;\n    }\n\n    return desc;\n  }\n\n  var id = 0;\n\n  function _classPrivateFieldLooseKey(name) {\n    return '__private_' + id++ + '_' + name;\n  }\n\n  function _classPrivateFieldLooseBase(receiver, privateKey) {\n    if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n      throw new TypeError('attempted to use private field on non-instance');\n    }\n\n    return receiver;\n  }\n\n  function _classPrivateFieldGet(receiver, privateMap) {\n    var descriptor = privateMap.get(receiver);\n\n    if (!descriptor) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    if (descriptor.get) {\n      return descriptor.get.call(receiver);\n    }\n\n    return descriptor.value;\n  }\n\n  function _classPrivateFieldSet(receiver, privateMap, value) {\n    var descriptor = privateMap.get(receiver);\n\n    if (!descriptor) {\n      throw new TypeError('attempted to set private field on non-instance');\n    }\n\n    if (descriptor.set) {\n      descriptor.set.call(receiver, value);\n    } else {\n      if (!descriptor.writable) {\n        throw new TypeError('attempted to set read only private field');\n      }\n\n      descriptor.value = value;\n    }\n\n    return value;\n  }\n\n  function _classPrivateFieldDestructureSet(receiver, privateMap) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to set private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.set) {\n      if (!('__destrObj' in descriptor)) {\n        descriptor.__destrObj = {\n          set value(v) {\n            descriptor.set.call(receiver, v);\n          }\n\n        };\n      }\n\n      return descriptor.__destrObj;\n    } else {\n      if (!descriptor.writable) {\n        throw new TypeError('attempted to set read only private field');\n      }\n\n      return descriptor;\n    }\n  }\n\n  function _classStaticPrivateFieldSpecGet(receiver, classConstructor, descriptor) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return descriptor.value;\n  }\n\n  function _classStaticPrivateFieldSpecSet(receiver, classConstructor, descriptor, value) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    if (!descriptor.writable) {\n      throw new TypeError('attempted to set read only private field');\n    }\n\n    descriptor.value = value;\n    return value;\n  }\n\n  function _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return method;\n  }\n\n  function _classStaticPrivateMethodSet() {\n    throw new TypeError('attempted to set read only static private field');\n  }\n\n  function _decorate(decorators, factory, superClass, mixins) {\n    var api = _getDecoratorsApi();\n\n    if (mixins) {\n      for (var i = 0; i < mixins.length; i++) {\n        api = mixins[i](api);\n      }\n    }\n\n    var r = factory(function initialize(O) {\n      api.initializeInstanceElements(O, decorated.elements);\n    }, superClass);\n    var decorated = api.decorateClass(_coalesceClassElements(r.d.map(_createElementDescriptor)), decorators);\n    api.initializeClassElements(r.F, decorated.elements);\n    return api.runClassFinishers(r.F, decorated.finishers);\n  }\n\n  function _getDecoratorsApi() {\n    _getDecoratorsApi = function () {\n      return api;\n    };\n\n    var api = {\n      elementsDefinitionOrder: [['method'], ['field']],\n      initializeInstanceElements: function (O, elements) {\n        ['method', 'field'].forEach(function (kind) {\n          elements.forEach(function (element) {\n            if (element.kind === kind && element.placement === 'own') {\n              this.defineClassElement(O, element);\n            }\n          }, this);\n        }, this);\n      },\n      initializeClassElements: function (F, elements) {\n        var proto = F.prototype;\n        ['method', 'field'].forEach(function (kind) {\n          elements.forEach(function (element) {\n            var placement = element.placement;\n\n            if (element.kind === kind && (placement === 'static' || placement === 'prototype')) {\n              var receiver = placement === 'static' ? F : proto;\n              this.defineClassElement(receiver, element);\n            }\n          }, this);\n        }, this);\n      },\n      defineClassElement: function (receiver, element) {\n        var descriptor = element.descriptor;\n\n        if (element.kind === 'field') {\n          var initializer = element.initializer;\n          descriptor = {\n            enumerable: descriptor.enumerable,\n            writable: descriptor.writable,\n            configurable: descriptor.configurable,\n            value: initializer === void 0 ? void 0 : initializer.call(receiver)\n          };\n        }\n\n        Object.defineProperty(receiver, element.key, descriptor);\n      },\n      decorateClass: function (elements, decorators) {\n        var newElements = [];\n        var finishers = [];\n        var placements = {\n          static: [],\n          prototype: [],\n          own: []\n        };\n        elements.forEach(function (element) {\n          this.addElementPlacement(element, placements);\n        }, this);\n        elements.forEach(function (element) {\n          if (!_hasDecorators(element)) return newElements.push(element);\n          var elementFinishersExtras = this.decorateElement(element, placements);\n          newElements.push(elementFinishersExtras.element);\n          newElements.push.apply(newElements, elementFinishersExtras.extras);\n          finishers.push.apply(finishers, elementFinishersExtras.finishers);\n        }, this);\n\n        if (!decorators) {\n          return {\n            elements: newElements,\n            finishers: finishers\n          };\n        }\n\n        var result = this.decorateConstructor(newElements, decorators);\n        finishers.push.apply(finishers, result.finishers);\n        result.finishers = finishers;\n        return result;\n      },\n      addElementPlacement: function (element, placements, silent) {\n        var keys = placements[element.placement];\n\n        if (!silent && keys.indexOf(element.key) !== -1) {\n          throw new TypeError('Duplicated element (' + element.key + ')');\n        }\n\n        keys.push(element.key);\n      },\n      decorateElement: function (element, placements) {\n        var extras = [];\n        var finishers = [];\n\n        for (var decorators = element.decorators, i = decorators.length - 1; i >= 0; i--) {\n          var keys = placements[element.placement];\n          keys.splice(keys.indexOf(element.key), 1);\n          var elementObject = this.fromElementDescriptor(element);\n          var elementFinisherExtras = this.toElementFinisherExtras((0, decorators[i])(elementObject) || elementObject);\n          element = elementFinisherExtras.element;\n          this.addElementPlacement(element, placements);\n\n          if (elementFinisherExtras.finisher) {\n            finishers.push(elementFinisherExtras.finisher);\n          }\n\n          var newExtras = elementFinisherExtras.extras;\n\n          if (newExtras) {\n            for (var j = 0; j < newExtras.length; j++) {\n              this.addElementPlacement(newExtras[j], placements);\n            }\n\n            extras.push.apply(extras, newExtras);\n          }\n        }\n\n        return {\n          element: element,\n          finishers: finishers,\n          extras: extras\n        };\n      },\n      decorateConstructor: function (elements, decorators) {\n        var finishers = [];\n\n        for (var i = decorators.length - 1; i >= 0; i--) {\n          var obj = this.fromClassDescriptor(elements);\n          var elementsAndFinisher = this.toClassDescriptor((0, decorators[i])(obj) || obj);\n\n          if (elementsAndFinisher.finisher !== undefined) {\n            finishers.push(elementsAndFinisher.finisher);\n          }\n\n          if (elementsAndFinisher.elements !== undefined) {\n            elements = elementsAndFinisher.elements;\n\n            for (var j = 0; j < elements.length - 1; j++) {\n              for (var k = j + 1; k < elements.length; k++) {\n                if (elements[j].key === elements[k].key && elements[j].placement === elements[k].placement) {\n                  throw new TypeError('Duplicated element (' + elements[j].key + ')');\n                }\n              }\n            }\n          }\n        }\n\n        return {\n          elements: elements,\n          finishers: finishers\n        };\n      },\n      fromElementDescriptor: function (element) {\n        var obj = {\n          kind: element.kind,\n          key: element.key,\n          placement: element.placement,\n          descriptor: element.descriptor\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        if (element.kind === 'field') obj.initializer = element.initializer;\n        return obj;\n      },\n      toElementDescriptors: function (elementObjects) {\n        if (elementObjects === undefined) return;\n        return _toArray(elementObjects).map(function (elementObject) {\n          var element = this.toElementDescriptor(elementObject);\n          this.disallowProperty(elementObject, 'finisher', 'An element descriptor');\n          this.disallowProperty(elementObject, 'extras', 'An element descriptor');\n          return element;\n        }, this);\n      },\n      toElementDescriptor: function (elementObject) {\n        var kind = String(elementObject.kind);\n\n        if (kind !== 'method' && kind !== 'field') {\n          throw new TypeError('An element descriptor\\'s .kind property must be either \"method\" or' + ' \"field\", but a decorator created an element descriptor with' + ' .kind \"' + kind + '\"');\n        }\n\n        var key = _toPropertyKey(elementObject.key);\n\n        var placement = String(elementObject.placement);\n\n        if (placement !== 'static' && placement !== 'prototype' && placement !== 'own') {\n          throw new TypeError('An element descriptor\\'s .placement property must be one of \"static\",' + ' \"prototype\" or \"own\", but a decorator created an element descriptor' + ' with .placement \"' + placement + '\"');\n        }\n\n        var descriptor = elementObject.descriptor;\n        this.disallowProperty(elementObject, 'elements', 'An element descriptor');\n        var element = {\n          kind: kind,\n          key: key,\n          placement: placement,\n          descriptor: Object.assign({}, descriptor)\n        };\n\n        if (kind !== 'field') {\n          this.disallowProperty(elementObject, 'initializer', 'A method descriptor');\n        } else {\n          this.disallowProperty(descriptor, 'get', 'The property descriptor of a field descriptor');\n          this.disallowProperty(descriptor, 'set', 'The property descriptor of a field descriptor');\n          this.disallowProperty(descriptor, 'value', 'The property descriptor of a field descriptor');\n          element.initializer = elementObject.initializer;\n        }\n\n        return element;\n      },\n      toElementFinisherExtras: function (elementObject) {\n        var element = this.toElementDescriptor(elementObject);\n\n        var finisher = _optionalCallableProperty(elementObject, 'finisher');\n\n        var extras = this.toElementDescriptors(elementObject.extras);\n        return {\n          element: element,\n          finisher: finisher,\n          extras: extras\n        };\n      },\n      fromClassDescriptor: function (elements) {\n        var obj = {\n          kind: 'class',\n          elements: elements.map(this.fromElementDescriptor, this)\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        return obj;\n      },\n      toClassDescriptor: function (obj) {\n        var kind = String(obj.kind);\n\n        if (kind !== 'class') {\n          throw new TypeError('A class descriptor\\'s .kind property must be \"class\", but a decorator' + ' created a class descriptor with .kind \"' + kind + '\"');\n        }\n\n        this.disallowProperty(obj, 'key', 'A class descriptor');\n        this.disallowProperty(obj, 'placement', 'A class descriptor');\n        this.disallowProperty(obj, 'descriptor', 'A class descriptor');\n        this.disallowProperty(obj, 'initializer', 'A class descriptor');\n        this.disallowProperty(obj, 'extras', 'A class descriptor');\n\n        var finisher = _optionalCallableProperty(obj, 'finisher');\n\n        var elements = this.toElementDescriptors(obj.elements);\n        return {\n          elements: elements,\n          finisher: finisher\n        };\n      },\n      runClassFinishers: function (constructor, finishers) {\n        for (var i = 0; i < finishers.length; i++) {\n          var newConstructor = (0, finishers[i])(constructor);\n\n          if (newConstructor !== undefined) {\n            if (typeof newConstructor !== 'function') {\n              throw new TypeError('Finishers must return a constructor.');\n            }\n\n            constructor = newConstructor;\n          }\n        }\n\n        return constructor;\n      },\n      disallowProperty: function (obj, name, objectType) {\n        if (obj[name] !== undefined) {\n          throw new TypeError(objectType + \" can't have a .\" + name + ' property.');\n        }\n      }\n    };\n    return api;\n  }\n\n  function _createElementDescriptor(def) {\n    var key = _toPropertyKey(def.key);\n\n    var descriptor;\n\n    if (def.kind === 'method') {\n      descriptor = {\n        value: def.value,\n        writable: true,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'get') {\n      descriptor = {\n        get: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'set') {\n      descriptor = {\n        set: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'field') {\n      descriptor = {\n        configurable: true,\n        writable: true,\n        enumerable: true\n      };\n    }\n\n    var element = {\n      kind: def.kind === 'field' ? 'field' : 'method',\n      key: key,\n      placement: def.static ? 'static' : def.kind === 'field' ? 'own' : 'prototype',\n      descriptor: descriptor\n    };\n    if (def.decorators) element.decorators = def.decorators;\n    if (def.kind === 'field') element.initializer = def.value;\n    return element;\n  }\n\n  function _coalesceGetterSetter(element, other) {\n    if (element.descriptor.get !== undefined) {\n      other.descriptor.get = element.descriptor.get;\n    } else {\n      other.descriptor.set = element.descriptor.set;\n    }\n  }\n\n  function _coalesceClassElements(elements) {\n    var newElements = [];\n\n    var isSameElement = function (other) {\n      return other.kind === 'method' && other.key === element.key && other.placement === element.placement;\n    };\n\n    for (var i = 0; i < elements.length; i++) {\n      var element = elements[i];\n      var other;\n\n      if (element.kind === 'method' && (other = newElements.find(isSameElement))) {\n        if (_isDataDescriptor(element.descriptor) || _isDataDescriptor(other.descriptor)) {\n          if (_hasDecorators(element) || _hasDecorators(other)) {\n            throw new ReferenceError('Duplicated methods (' + element.key + \") can't be decorated.\");\n          }\n\n          other.descriptor = element.descriptor;\n        } else {\n          if (_hasDecorators(element)) {\n            if (_hasDecorators(other)) {\n              throw new ReferenceError(\"Decorators can't be placed on different accessors with for \" + 'the same property (' + element.key + ').');\n            }\n\n            other.decorators = element.decorators;\n          }\n\n          _coalesceGetterSetter(element, other);\n        }\n      } else {\n        newElements.push(element);\n      }\n    }\n\n    return newElements;\n  }\n\n  function _hasDecorators(element) {\n    return element.decorators && element.decorators.length;\n  }\n\n  function _isDataDescriptor(desc) {\n    return desc !== undefined && !(desc.value === undefined && desc.writable === undefined);\n  }\n\n  function _optionalCallableProperty(obj, name) {\n    var value = obj[name];\n\n    if (value !== undefined && typeof value !== 'function') {\n      throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n    }\n\n    return value;\n  }\n\n  function _classPrivateMethodGet(receiver, privateSet, fn) {\n    if (!privateSet.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    return fn;\n  }\n\n  function _classPrivateMethodSet() {\n    throw new TypeError('attempted to reassign private method');\n  }\n\n  function _wrapRegExp(re, groups) {\n    _wrapRegExp = function (re, groups) {\n      return new BabelRegExp(re, groups);\n    };\n\n    var _RegExp = _wrapNativeSuper(RegExp);\n\n    var _super = RegExp.prototype;\n\n    var _groups = new WeakMap();\n\n    function BabelRegExp(re, groups) {\n      var _this = _RegExp.call(this, re);\n\n      _groups.set(_this, groups);\n\n      return _this;\n    }\n\n    _inherits(BabelRegExp, _RegExp);\n\n    BabelRegExp.prototype.exec = function (str) {\n      var result = _super.exec.call(this, str);\n\n      if (result) result.groups = buildGroups(result, this);\n      return result;\n    };\n\n    BabelRegExp.prototype[Symbol.replace] = function (str, substitution) {\n      if (typeof substitution === 'string') {\n        var groups = _groups.get(this);\n\n        return _super[Symbol.replace].call(this, str, substitution.replace(/\\$<([^>]+)>/g, function (_, name) {\n          return '$' + groups[name];\n        }));\n      } else if (typeof substitution === 'function') {\n        var _this = this;\n\n        return _super[Symbol.replace].call(this, str, function () {\n          var args = [];\n          args.push.apply(args, arguments);\n\n          if (typeof args[args.length - 1] !== 'object') {\n            args.push(buildGroups(args, _this));\n          }\n\n          return substitution.apply(this, args);\n        });\n      } else {\n        return _super[Symbol.replace].call(this, str, substitution);\n      }\n    };\n\n    function buildGroups(result, re) {\n      var g = _groups.get(re);\n\n      return Object.keys(g).reduce(function (groups, name) {\n        groups[name] = result[g[name]];\n        return groups;\n      }, Object.create(null));\n    }\n\n    return _wrapRegExp.apply(this, arguments);\n  }\n\n  var arrayRemove = function arrayRemove(arr, index) {\n    return arr.splice(index, 1);\n  };\n\n  var run = function run(cb, sync) {\n    if (sync) {\n      cb();\n    } else if (document.hidden) {\n      Promise.resolve(1).then(cb);\n    } else {\n      setTimeout(cb, 0);\n    }\n  };\n\n  var on = function on() {\n    var listeners = [];\n\n    var off = function off(event, cb) {\n      arrayRemove(listeners, listeners.findIndex(function (listener) {\n        return listener.event === event && (listener.cb === cb || !cb);\n      }));\n    };\n\n    var _fire = function fire(event, args, sync) {\n      listeners.filter(function (listener) {\n        return listener.event === event;\n      }).map(function (listener) {\n        return listener.cb;\n      }).forEach(function (cb) {\n        return run(function () {\n          return cb.apply(void 0, _toConsumableArray(args));\n        }, sync);\n      });\n    };\n\n    return {\n      fireSync: function fireSync(event) {\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n\n        _fire(event, args, true);\n      },\n      fire: function fire(event) {\n        for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n\n        _fire(event, args, false);\n      },\n      on: function on(event, cb) {\n        listeners.push({\n          event: event,\n          cb: cb\n        });\n      },\n      onOnce: function onOnce(event, _cb) {\n        listeners.push({\n          event: event,\n          cb: function cb() {\n            off(event, _cb);\n\n            _cb.apply(void 0, arguments);\n          }\n        });\n      },\n      off: off\n    };\n  };\n\n  var copyObjectPropertiesToObject = function copyObjectPropertiesToObject(src, target, excluded) {\n    Object.getOwnPropertyNames(src).filter(function (property) {\n      return !excluded.includes(property);\n    }).forEach(function (key) {\n      return Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(src, key));\n    });\n  };\n\n  var PRIVATE = ['fire', 'process', 'revert', 'load', 'on', 'off', 'onOnce', 'retryLoad', 'extend', 'archive', 'archived', 'release', 'released', 'requestProcessing', 'freeze'];\n\n  var createItemAPI = function createItemAPI(item) {\n    var api = {};\n    copyObjectPropertiesToObject(item, api, PRIVATE);\n    return api;\n  };\n\n  var removeReleasedItems = function removeReleasedItems(items) {\n    items.forEach(function (item, index) {\n      if (item.released) {\n        arrayRemove(items, index);\n      }\n    });\n  };\n\n  var ItemStatus = {\n    INIT: 1,\n    IDLE: 2,\n    PROCESSING_QUEUED: 9,\n    PROCESSING: 3,\n    PROCESSING_COMPLETE: 5,\n    PROCESSING_ERROR: 6,\n    PROCESSING_REVERT_ERROR: 10,\n    LOADING: 7,\n    LOAD_ERROR: 8\n  };\n  var FileOrigin = {\n    INPUT: 1,\n    LIMBO: 2,\n    LOCAL: 3\n  };\n\n  var getNonNumeric = function getNonNumeric(str) {\n    return /[^0-9]+/.exec(str);\n  };\n\n  var getDecimalSeparator = function getDecimalSeparator() {\n    return getNonNumeric(1.1.toLocaleString())[0];\n  };\n\n  var getThousandsSeparator = function getThousandsSeparator() {\n    // Added for browsers that do not return the thousands separator (happend on native browser Android 4.4.4)\n    // We check against the normal toString output and if they're the same return a comma when decimal separator is a dot\n    var decimalSeparator = getDecimalSeparator();\n    var thousandsStringWithSeparator = 1000.0.toLocaleString();\n    var thousandsStringWithoutSeparator = 1000.0.toString();\n\n    if (thousandsStringWithSeparator !== thousandsStringWithoutSeparator) {\n      return getNonNumeric(thousandsStringWithSeparator)[0];\n    }\n\n    return decimalSeparator === '.' ? ',' : '.';\n  };\n\n  var Type = {\n    BOOLEAN: 'boolean',\n    INT: 'int',\n    NUMBER: 'number',\n    STRING: 'string',\n    ARRAY: 'array',\n    OBJECT: 'object',\n    FUNCTION: 'function',\n    ACTION: 'action',\n    SERVER_API: 'serverapi',\n    REGEX: 'regex'\n  }; // all registered filters\n\n  var filters = []; // loops over matching filters and passes options to each filter, returning the mapped results\n\n  var applyFilterChain = function applyFilterChain(key, value, utils) {\n    return new Promise(function (resolve, reject) {\n      // find matching filters for this key\n      var matchingFilters = filters.filter(function (f) {\n        return f.key === key;\n      }).map(function (f) {\n        return f.cb;\n      }); // resolve now\n\n      if (matchingFilters.length === 0) {\n        resolve(value);\n        return;\n      } // first filter to kick things of\n\n\n      var initialFilter = matchingFilters.shift(); // chain filters\n\n      matchingFilters.reduce( // loop over promises passing value to next promise\n      function (current, next) {\n        return current.then(function (value) {\n          return next(value, utils);\n        });\n      }, // call initial filter, will return a promise\n      initialFilter(value, utils) // all executed\n      ).then(function (value) {\n        return resolve(value);\n      }).catch(function (error) {\n        return reject(error);\n      });\n    });\n  };\n\n  var applyFilters = function applyFilters(key, value, utils) {\n    return filters.filter(function (f) {\n      return f.key === key;\n    }).map(function (f) {\n      return f.cb(value, utils);\n    });\n  }; // adds a new filter to the list\n\n\n  var addFilter = function addFilter(key, cb) {\n    return filters.push({\n      key: key,\n      cb: cb\n    });\n  };\n\n  var extendDefaultOptions = function extendDefaultOptions(additionalOptions) {\n    return Object.assign(defaultOptions, additionalOptions);\n  };\n\n  var getOptions = function getOptions() {\n    return Object.assign({}, defaultOptions);\n  };\n\n  var setOptions = function setOptions(opts) {\n    forin(opts, function (key, value) {\n      // key does not exist, so this option cannot be set\n      if (!defaultOptions[key]) {\n        return;\n      }\n\n      defaultOptions[key][0] = getValueByType(value, defaultOptions[key][0], defaultOptions[key][1]);\n    });\n  }; // default options on app\n\n\n  var defaultOptions = {\n    // the id to add to the root element\n    id: [null, Type.STRING],\n    // input field name to use\n    name: ['filepond', Type.STRING],\n    // disable the field\n    disabled: [false, Type.BOOLEAN],\n    // classname to put on wrapper\n    className: [null, Type.STRING],\n    // is the field required\n    required: [false, Type.BOOLEAN],\n    // Allow media capture when value is set\n    captureMethod: [null, Type.STRING],\n    // - \"camera\", \"microphone\" or \"camcorder\",\n    // - Does not work with multiple on apple devices\n    // - If set, acceptedFileTypes must be made to match with media wildcard \"image/*\", \"audio/*\" or \"video/*\"\n    // sync `acceptedFileTypes` property with `accept` attribute\n    allowSyncAcceptAttribute: [true, Type.BOOLEAN],\n    // Feature toggles\n    allowDrop: [true, Type.BOOLEAN],\n    // Allow dropping of files\n    allowBrowse: [true, Type.BOOLEAN],\n    // Allow browsing the file system\n    allowPaste: [true, Type.BOOLEAN],\n    // Allow pasting files\n    allowMultiple: [false, Type.BOOLEAN],\n    // Allow multiple files (disabled by default, as multiple attribute is also required on input to allow multiple)\n    allowReplace: [true, Type.BOOLEAN],\n    // Allow dropping a file on other file to replace it (only works when multiple is set to false)\n    allowRevert: [true, Type.BOOLEAN],\n    // Allows user to revert file upload\n    allowRemove: [true, Type.BOOLEAN],\n    // Allow user to remove a file\n    allowProcess: [true, Type.BOOLEAN],\n    // Allows user to process a file, when set to false, this removes the file upload button\n    allowReorder: [false, Type.BOOLEAN],\n    // Allow reordering of files\n    allowDirectoriesOnly: [false, Type.BOOLEAN],\n    // Allow only selecting directories with browse (no support for filtering dnd at this point)\n    // Revert mode\n    forceRevert: [false, Type.BOOLEAN],\n    // Set to 'force' to require the file to be reverted before removal\n    // Input requirements\n    maxFiles: [null, Type.INT],\n    // Max number of files\n    checkValidity: [false, Type.BOOLEAN],\n    // Enables custom validity messages\n    // Where to put file\n    itemInsertLocationFreedom: [true, Type.BOOLEAN],\n    // Set to false to always add items to begin or end of list\n    itemInsertLocation: ['before', Type.STRING],\n    // Default index in list to add items that have been dropped at the top of the list\n    itemInsertInterval: [75, Type.INT],\n    // Drag 'n Drop related\n    dropOnPage: [false, Type.BOOLEAN],\n    // Allow dropping of files anywhere on page (prevents browser from opening file if dropped outside of Up)\n    dropOnElement: [true, Type.BOOLEAN],\n    // Drop needs to happen on element (set to false to also load drops outside of Up)\n    dropValidation: [false, Type.BOOLEAN],\n    // Enable or disable validating files on drop\n    ignoredFiles: [['.ds_store', 'thumbs.db', 'desktop.ini'], Type.ARRAY],\n    // Upload related\n    instantUpload: [true, Type.BOOLEAN],\n    // Should upload files immidiately on drop\n    maxParallelUploads: [2, Type.INT],\n    // Maximum files to upload in parallel\n    // Chunks\n    chunkUploads: [false, Type.BOOLEAN],\n    // Enable chunked uploads\n    chunkForce: [false, Type.BOOLEAN],\n    // Force use of chunk uploads even for files smaller than chunk size\n    chunkSize: [5000000, Type.INT],\n    // Size of chunks (5MB default)\n    chunkRetryDelays: [[500, 1000, 3000], Type.Array],\n    // Amount of times to retry upload of a chunk when it fails\n    // The server api end points to use for uploading (see docs)\n    server: [null, Type.SERVER_API],\n    // Labels and status messages\n    labelDecimalSeparator: [getDecimalSeparator(), Type.STRING],\n    // Default is locale separator\n    labelThousandsSeparator: [getThousandsSeparator(), Type.STRING],\n    // Default is locale separator\n    labelIdle: ['Drag & Drop your files or <span class=\"filepond--label-action\">Browse</span>', Type.STRING],\n    labelInvalidField: ['Field contains invalid files', Type.STRING],\n    labelFileWaitingForSize: ['Waiting for size', Type.STRING],\n    labelFileSizeNotAvailable: ['Size not available', Type.STRING],\n    labelFileCountSingular: ['file in list', Type.STRING],\n    labelFileCountPlural: ['files in list', Type.STRING],\n    labelFileLoading: ['Loading', Type.STRING],\n    labelFileAdded: ['Added', Type.STRING],\n    // assistive only\n    labelFileLoadError: ['Error during load', Type.STRING],\n    labelFileRemoved: ['Removed', Type.STRING],\n    // assistive only\n    labelFileRemoveError: ['Error during remove', Type.STRING],\n    labelFileProcessing: ['Uploading', Type.STRING],\n    labelFileProcessingComplete: ['Upload complete', Type.STRING],\n    labelFileProcessingAborted: ['Upload cancelled', Type.STRING],\n    labelFileProcessingError: ['Error during upload', Type.STRING],\n    labelFileProcessingRevertError: ['Error during revert', Type.STRING],\n    labelTapToCancel: ['tap to cancel', Type.STRING],\n    labelTapToRetry: ['tap to retry', Type.STRING],\n    labelTapToUndo: ['tap to undo', Type.STRING],\n    labelButtonRemoveItem: ['Remove', Type.STRING],\n    labelButtonAbortItemLoad: ['Abort', Type.STRING],\n    labelButtonRetryItemLoad: ['Retry', Type.STRING],\n    labelButtonAbortItemProcessing: ['Cancel', Type.STRING],\n    labelButtonUndoItemProcessing: ['Undo', Type.STRING],\n    labelButtonRetryItemProcessing: ['Retry', Type.STRING],\n    labelButtonProcessItem: ['Upload', Type.STRING],\n    // make sure width and height plus viewpox are even numbers so icons are nicely centered\n    iconRemove: ['<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M11.586 13l-2.293 2.293a1 1 0 0 0 1.414 1.414L13 14.414l2.293 2.293a1 1 0 0 0 1.414-1.414L14.414 13l2.293-2.293a1 1 0 0 0-1.414-1.414L13 11.586l-2.293-2.293a1 1 0 0 0-1.414 1.414L11.586 13z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>', Type.STRING],\n    iconProcess: ['<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 10.414v3.585a1 1 0 0 1-2 0v-3.585l-1.293 1.293a1 1 0 0 1-1.414-1.415l3-3a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1-1.414 1.415L14 10.414zM9 18a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2H9z\" fill=\"currentColor\" fill-rule=\"evenodd\"/></svg>', Type.STRING],\n    iconRetry: ['<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10.81 9.185l-.038.02A4.997 4.997 0 0 0 8 13.683a5 5 0 0 0 5 5 5 5 0 0 0 5-5 1 1 0 0 1 2 0A7 7 0 1 1 9.722 7.496l-.842-.21a.999.999 0 1 1 .484-1.94l3.23.806c.535.133.86.675.73 1.21l-.804 3.233a.997.997 0 0 1-1.21.73.997.997 0 0 1-.73-1.21l.23-.928v-.002z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>', Type.STRING],\n    iconUndo: ['<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M9.185 10.81l.02-.038A4.997 4.997 0 0 1 13.683 8a5 5 0 0 1 5 5 5 5 0 0 1-5 5 1 1 0 0 0 0 2A7 7 0 1 0 7.496 9.722l-.21-.842a.999.999 0 1 0-1.94.484l.806 3.23c.133.535.675.86 1.21.73l3.233-.803a.997.997 0 0 0 .73-1.21.997.997 0 0 0-1.21-.73l-.928.23-.002-.001z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>', Type.STRING],\n    iconDone: ['<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M18.293 9.293a1 1 0 0 1 1.414 1.414l-7.002 7a1 1 0 0 1-1.414 0l-3.998-4a1 1 0 1 1 1.414-1.414L12 15.586l6.294-6.293z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>', Type.STRING],\n    // event handlers\n    oninit: [null, Type.FUNCTION],\n    onwarning: [null, Type.FUNCTION],\n    onerror: [null, Type.FUNCTION],\n    onactivatefile: [null, Type.FUNCTION],\n    oninitfile: [null, Type.FUNCTION],\n    onaddfilestart: [null, Type.FUNCTION],\n    onaddfileprogress: [null, Type.FUNCTION],\n    onaddfile: [null, Type.FUNCTION],\n    onprocessfilestart: [null, Type.FUNCTION],\n    onprocessfileprogress: [null, Type.FUNCTION],\n    onprocessfileabort: [null, Type.FUNCTION],\n    onprocessfilerevert: [null, Type.FUNCTION],\n    onprocessfile: [null, Type.FUNCTION],\n    onprocessfiles: [null, Type.FUNCTION],\n    onremovefile: [null, Type.FUNCTION],\n    onpreparefile: [null, Type.FUNCTION],\n    onupdatefiles: [null, Type.FUNCTION],\n    onreorderfiles: [null, Type.FUNCTION],\n    // hooks\n    beforeDropFile: [null, Type.FUNCTION],\n    beforeAddFile: [null, Type.FUNCTION],\n    beforeRemoveFile: [null, Type.FUNCTION],\n    // styles\n    stylePanelLayout: [null, Type.STRING],\n    // null 'integrated', 'compact', 'circle'\n    stylePanelAspectRatio: [null, Type.STRING],\n    // null or '3:2' or 1\n    styleItemPanelAspectRatio: [null, Type.STRING],\n    styleButtonRemoveItemPosition: ['left', Type.STRING],\n    styleButtonProcessItemPosition: ['right', Type.STRING],\n    styleLoadIndicatorPosition: ['right', Type.STRING],\n    styleProgressIndicatorPosition: ['right', Type.STRING],\n    styleButtonRemoveItemAlign: [false, Type.BOOLEAN],\n    // custom initial files array\n    files: [[], Type.ARRAY]\n  };\n\n  var getItemByQuery = function getItemByQuery(items, query) {\n    // just return first index\n    if (isEmpty(query)) {\n      return items[0] || null;\n    } // query is index\n\n\n    if (isInt(query)) {\n      return items[query] || null;\n    } // if query is item, get the id\n\n\n    if (typeof query === 'object') {\n      query = query.id;\n    } // assume query is a string and return item by id\n\n\n    return items.find(function (item) {\n      return item.id === query;\n    }) || null;\n  };\n\n  var getNumericAspectRatioFromString = function getNumericAspectRatioFromString(aspectRatio) {\n    if (isEmpty(aspectRatio)) {\n      return aspectRatio;\n    }\n\n    if (/:/.test(aspectRatio)) {\n      var parts = aspectRatio.split(':');\n      return parts[1] / parts[0];\n    }\n\n    return parseFloat(aspectRatio);\n  };\n\n  var getActiveItems = function getActiveItems(items) {\n    return items.filter(function (item) {\n      return !item.archived;\n    });\n  };\n\n  var Status = {\n    EMPTY: 0,\n    IDLE: 1,\n    // waiting\n    ERROR: 2,\n    // a file is in error state\n    BUSY: 3,\n    // busy processing or loading\n    READY: 4 // all files uploaded\n\n  };\n  var ITEM_ERROR = [ItemStatus.LOAD_ERROR, ItemStatus.PROCESSING_ERROR, ItemStatus.PROCESSING_REVERT_ERROR];\n  var ITEM_BUSY = [ItemStatus.LOADING, ItemStatus.PROCESSING, ItemStatus.PROCESSING_QUEUED, ItemStatus.INIT];\n  var ITEM_READY = [ItemStatus.PROCESSING_COMPLETE];\n\n  var isItemInErrorState = function isItemInErrorState(item) {\n    return ITEM_ERROR.includes(item.status);\n  };\n\n  var isItemInBusyState = function isItemInBusyState(item) {\n    return ITEM_BUSY.includes(item.status);\n  };\n\n  var isItemInReadyState = function isItemInReadyState(item) {\n    return ITEM_READY.includes(item.status);\n  };\n\n  var queries = function queries(state) {\n    return {\n      GET_STATUS: function GET_STATUS() {\n        var items = getActiveItems(state.items);\n        var EMPTY = Status.EMPTY,\n            ERROR = Status.ERROR,\n            BUSY = Status.BUSY,\n            IDLE = Status.IDLE,\n            READY = Status.READY;\n        if (items.length === 0) return EMPTY;\n        if (items.some(isItemInErrorState)) return ERROR;\n        if (items.some(isItemInBusyState)) return BUSY;\n        if (items.some(isItemInReadyState)) return READY;\n        return IDLE;\n      },\n      GET_ITEM: function GET_ITEM(query) {\n        return getItemByQuery(state.items, query);\n      },\n      GET_ACTIVE_ITEM: function GET_ACTIVE_ITEM(query) {\n        return getItemByQuery(getActiveItems(state.items), query);\n      },\n      GET_ACTIVE_ITEMS: function GET_ACTIVE_ITEMS() {\n        return getActiveItems(state.items);\n      },\n      GET_ITEMS: function GET_ITEMS() {\n        return state.items;\n      },\n      GET_ITEM_NAME: function GET_ITEM_NAME(query) {\n        var item = getItemByQuery(state.items, query);\n        return item ? item.filename : null;\n      },\n      GET_ITEM_SIZE: function GET_ITEM_SIZE(query) {\n        var item = getItemByQuery(state.items, query);\n        return item ? item.fileSize : null;\n      },\n      GET_STYLES: function GET_STYLES() {\n        return Object.keys(state.options).filter(function (key) {\n          return /^style/.test(key);\n        }).map(function (option) {\n          return {\n            name: option,\n            value: state.options[option]\n          };\n        });\n      },\n      GET_PANEL_ASPECT_RATIO: function GET_PANEL_ASPECT_RATIO() {\n        var isShapeCircle = /circle/.test(state.options.stylePanelLayout);\n        var aspectRatio = isShapeCircle ? 1 : getNumericAspectRatioFromString(state.options.stylePanelAspectRatio);\n        return aspectRatio;\n      },\n      GET_ITEM_PANEL_ASPECT_RATIO: function GET_ITEM_PANEL_ASPECT_RATIO() {\n        return state.options.styleItemPanelAspectRatio;\n      },\n      GET_ITEMS_BY_STATUS: function GET_ITEMS_BY_STATUS(status) {\n        return getActiveItems(state.items).filter(function (item) {\n          return item.status === status;\n        });\n      },\n      GET_TOTAL_ITEMS: function GET_TOTAL_ITEMS() {\n        return getActiveItems(state.items).length;\n      },\n      IS_ASYNC: function IS_ASYNC() {\n        return isObject(state.options.server) && (isObject(state.options.server.process) || isFunction(state.options.server.process));\n      }\n    };\n  };\n\n  var hasRoomForItem = function hasRoomForItem(state) {\n    var count = getActiveItems(state.items).length; // if cannot have multiple items, to add one item it should currently not contain items\n\n    if (!state.options.allowMultiple) {\n      return count === 0;\n    } // if allows multiple items, we check if a max item count has been set, if not, there's no limit\n\n\n    var maxFileCount = state.options.maxFiles;\n\n    if (maxFileCount === null) {\n      return true;\n    } // we check if the current count is smaller than the max count, if so, another file can still be added\n\n\n    if (count < maxFileCount) {\n      return true;\n    } // no more room for another file\n\n\n    return false;\n  };\n\n  var limit = function limit(value, min, max) {\n    return Math.max(Math.min(max, value), min);\n  };\n\n  var arrayInsert = function arrayInsert(arr, index, item) {\n    return arr.splice(index, 0, item);\n  };\n\n  var insertItem = function insertItem(items, item, index) {\n    if (isEmpty(item)) {\n      return null;\n    } // if index is undefined, append\n\n\n    if (typeof index === 'undefined') {\n      items.push(item);\n      return item;\n    } // limit the index to the size of the items array\n\n\n    index = limit(index, 0, items.length); // add item to array\n\n    arrayInsert(items, index, item); // expose\n\n    return item;\n  };\n\n  var isBase64DataURI = function isBase64DataURI(str) {\n    return /^\\s*data:([a-z]+\\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\\-._~:@\\/?%\\s]*)\\s*$/i.test(str);\n  };\n\n  var getFilenameFromURL = function getFilenameFromURL(url) {\n    return url.split('/').pop().split('?').shift();\n  };\n\n  var getExtensionFromFilename = function getExtensionFromFilename(name) {\n    return name.split('.').pop();\n  };\n\n  var guesstimateExtension = function guesstimateExtension(type) {\n    // if no extension supplied, exit here\n    if (typeof type !== 'string') {\n      return '';\n    } // get subtype\n\n\n    var subtype = type.split('/').pop(); // is svg subtype\n\n    if (/svg/.test(subtype)) {\n      return 'svg';\n    }\n\n    if (/zip|compressed/.test(subtype)) {\n      return 'zip';\n    }\n\n    if (/plain/.test(subtype)) {\n      return 'txt';\n    }\n\n    if (/msword/.test(subtype)) {\n      return 'doc';\n    } // if is valid subtype\n\n\n    if (/[a-z]+/.test(subtype)) {\n      // always use jpg extension\n      if (subtype === 'jpeg') {\n        return 'jpg';\n      } // return subtype\n\n\n      return subtype;\n    }\n\n    return '';\n  };\n\n  var leftPad = function leftPad(value) {\n    var padding = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n    return (padding + value).slice(-padding.length);\n  };\n\n  var getDateString = function getDateString() {\n    var date = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Date();\n    return date.getFullYear() + '-' + leftPad(date.getMonth() + 1, '00') + '-' + leftPad(date.getDate(), '00') + '_' + leftPad(date.getHours(), '00') + '-' + leftPad(date.getMinutes(), '00') + '-' + leftPad(date.getSeconds(), '00');\n  };\n\n  var getFileFromBlob = function getFileFromBlob(blob, filename) {\n    var type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    var extension = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n    var file = typeof type === 'string' ? blob.slice(0, blob.size, type) : blob.slice(0, blob.size, blob.type);\n    file.lastModifiedDate = new Date(); // copy relative path\n\n    if (blob._relativePath) file._relativePath = blob._relativePath; // if blob has name property, use as filename if no filename supplied\n\n    if (!isString(filename)) {\n      filename = getDateString();\n    } // if filename supplied but no extension and filename has extension\n\n\n    if (filename && extension === null && getExtensionFromFilename(filename)) {\n      file.name = filename;\n    } else {\n      extension = extension || guesstimateExtension(file.type);\n      file.name = filename + (extension ? '.' + extension : '');\n    }\n\n    return file;\n  };\n\n  var getBlobBuilder = function getBlobBuilder() {\n    return window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder;\n  };\n\n  var createBlob = function createBlob(arrayBuffer, mimeType) {\n    var BB = getBlobBuilder();\n\n    if (BB) {\n      var bb = new BB();\n      bb.append(arrayBuffer);\n      return bb.getBlob(mimeType);\n    }\n\n    return new Blob([arrayBuffer], {\n      type: mimeType\n    });\n  };\n\n  var getBlobFromByteStringWithMimeType = function getBlobFromByteStringWithMimeType(byteString, mimeType) {\n    var ab = new ArrayBuffer(byteString.length);\n    var ia = new Uint8Array(ab);\n\n    for (var i = 0; i < byteString.length; i++) {\n      ia[i] = byteString.charCodeAt(i);\n    }\n\n    return createBlob(ab, mimeType);\n  };\n\n  var getMimeTypeFromBase64DataURI = function getMimeTypeFromBase64DataURI(dataURI) {\n    return (/^data:(.+);/.exec(dataURI) || [])[1] || null;\n  };\n\n  var getBase64DataFromBase64DataURI = function getBase64DataFromBase64DataURI(dataURI) {\n    // get data part of string (remove data:image/jpeg...,)\n    var data = dataURI.split(',')[1]; // remove any whitespace as that causes InvalidCharacterError in IE\n\n    return data.replace(/\\s/g, '');\n  };\n\n  var getByteStringFromBase64DataURI = function getByteStringFromBase64DataURI(dataURI) {\n    return atob(getBase64DataFromBase64DataURI(dataURI));\n  };\n\n  var getBlobFromBase64DataURI = function getBlobFromBase64DataURI(dataURI) {\n    var mimeType = getMimeTypeFromBase64DataURI(dataURI);\n    var byteString = getByteStringFromBase64DataURI(dataURI);\n    return getBlobFromByteStringWithMimeType(byteString, mimeType);\n  };\n\n  var getFileFromBase64DataURI = function getFileFromBase64DataURI(dataURI, filename, extension) {\n    return getFileFromBlob(getBlobFromBase64DataURI(dataURI), filename, null, extension);\n  };\n\n  var getFileNameFromHeader = function getFileNameFromHeader(header) {\n    // test if is content disposition header, if not exit\n    if (!/^content-disposition:/i.test(header)) return null; // get filename parts\n\n    var matches = header.split(/filename=|filename\\*=.+''/).splice(1).map(function (name) {\n      return name.trim().replace(/^[\"']|[;\"']{0,2}$/g, '');\n    }).filter(function (name) {\n      return name.length;\n    });\n    return matches.length ? decodeURI(matches[matches.length - 1]) : null;\n  };\n\n  var getFileSizeFromHeader = function getFileSizeFromHeader(header) {\n    if (/content-length:/i.test(header)) {\n      var size = header.match(/[0-9]+/)[0];\n      return size ? parseInt(size, 10) : null;\n    }\n\n    return null;\n  };\n\n  var getTranfserIdFromHeader = function getTranfserIdFromHeader(header) {\n    if (/x-content-transfer-id:/i.test(header)) {\n      var id = (header.split(':')[1] || '').trim();\n      return id || null;\n    }\n\n    return null;\n  };\n\n  var getFileInfoFromHeaders = function getFileInfoFromHeaders(headers) {\n    var info = {\n      source: null,\n      name: null,\n      size: null\n    };\n    var rows = headers.split('\\n');\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n\n    try {\n      for (var _iterator = rows[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n        var header = _step.value;\n        var name = getFileNameFromHeader(header);\n\n        if (name) {\n          info.name = name;\n          continue;\n        }\n\n        var size = getFileSizeFromHeader(header);\n\n        if (size) {\n          info.size = size;\n          continue;\n        }\n\n        var source = getTranfserIdFromHeader(header);\n\n        if (source) {\n          info.source = source;\n          continue;\n        }\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion && _iterator.return != null) {\n          _iterator.return();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n\n    return info;\n  };\n\n  var createFileLoader = function createFileLoader(fetchFn) {\n    var state = {\n      source: null,\n      complete: false,\n      progress: 0,\n      size: null,\n      timestamp: null,\n      duration: 0,\n      request: null\n    };\n\n    var getProgress = function getProgress() {\n      return state.progress;\n    };\n\n    var abort = function abort() {\n      if (state.request && state.request.abort) {\n        state.request.abort();\n      }\n    }; // load source\n\n\n    var load = function load() {\n      // get quick reference\n      var source = state.source;\n      api.fire('init', source); // Load Files\n\n      if (source instanceof File) {\n        api.fire('load', source);\n      } else if (source instanceof Blob) {\n        // Load blobs, set default name to current date\n        api.fire('load', getFileFromBlob(source, source.name));\n      } else if (isBase64DataURI(source)) {\n        // Load base 64, set default name to current date\n        api.fire('load', getFileFromBase64DataURI(source));\n      } else {\n        // Deal as if is external URL, let's load it!\n        loadURL(source);\n      }\n    }; // loads a url\n\n\n    var loadURL = function loadURL(url) {\n      // is remote url and no fetch method supplied\n      if (!fetchFn) {\n        api.fire('error', {\n          type: 'error',\n          body: \"Can't load URL\",\n          code: 400\n        });\n        return;\n      } // set request start\n\n\n      state.timestamp = Date.now(); // load file\n\n      state.request = fetchFn(url, function (response) {\n        // update duration\n        state.duration = Date.now() - state.timestamp; // done!\n\n        state.complete = true; // turn blob response into a file\n\n        if (response instanceof Blob) {\n          response = getFileFromBlob(response, response.name || getFilenameFromURL(url));\n        }\n\n        api.fire('load', // if has received blob, we go with blob, if no response, we return null\n        response instanceof Blob ? response : response ? response.body : null);\n      }, function (error) {\n        api.fire('error', typeof error === 'string' ? {\n          type: 'error',\n          code: 0,\n          body: error\n        } : error);\n      }, function (computable, current, total) {\n        // collected some meta data already\n        if (total) {\n          state.size = total;\n        } // update duration\n\n\n        state.duration = Date.now() - state.timestamp; // if we can't compute progress, we're not going to fire progress events\n\n        if (!computable) {\n          state.progress = null;\n          return;\n        } // update progress percentage\n\n\n        state.progress = current / total; // expose\n\n        api.fire('progress', state.progress);\n      }, function () {\n        api.fire('abort');\n      }, function (response) {\n        var fileinfo = getFileInfoFromHeaders(typeof response === 'string' ? response : response.headers);\n        api.fire('meta', {\n          size: state.size || fileinfo.size,\n          filename: fileinfo.name,\n          source: fileinfo.source\n        });\n      });\n    };\n\n    var api = Object.assign({}, on(), {\n      setSource: function setSource(source) {\n        return state.source = source;\n      },\n      getProgress: getProgress,\n      // file load progress\n      abort: abort,\n      // abort file load\n      load: load // start load\n\n    });\n    return api;\n  };\n\n  var isGet = function isGet(method) {\n    return /GET|HEAD/.test(method);\n  };\n\n  var sendRequest = function sendRequest(data, url, options) {\n    var api = {\n      onheaders: function onheaders() {},\n      onprogress: function onprogress() {},\n      onload: function onload() {},\n      ontimeout: function ontimeout() {},\n      onerror: function onerror() {},\n      onabort: function onabort() {},\n      abort: function abort() {\n        aborted = true;\n        xhr.abort();\n      }\n    }; // timeout identifier, only used when timeout is defined\n\n    var aborted = false;\n    var headersReceived = false; // set default options\n\n    options = Object.assign({\n      method: 'POST',\n      headers: {},\n      withCredentials: false\n    }, options); // encode url\n\n    url = encodeURI(url); // if method is GET, add any received data to url\n\n    if (isGet(options.method) && data) {\n      url = '' + url + encodeURIComponent(typeof data === 'string' ? data : JSON.stringify(data));\n    } // create request\n\n\n    var xhr = new XMLHttpRequest(); // progress of load\n\n    var process = isGet(options.method) ? xhr : xhr.upload;\n\n    process.onprogress = function (e) {\n      // no progress event when aborted ( onprogress is called once after abort() )\n      if (aborted) {\n        return;\n      }\n\n      api.onprogress(e.lengthComputable, e.loaded, e.total);\n    }; // tries to get header info to the app as fast as possible\n\n\n    xhr.onreadystatechange = function () {\n      // not interesting in these states ('unsent' and 'openend' as they don't give us any additional info)\n      if (xhr.readyState < 2) {\n        return;\n      } // no server response\n\n\n      if (xhr.readyState === 4 && xhr.status === 0) {\n        return;\n      }\n\n      if (headersReceived) {\n        return;\n      }\n\n      headersReceived = true; // we've probably received some useful data in response headers\n\n      api.onheaders(xhr);\n    }; // load successful\n\n\n    xhr.onload = function () {\n      // is classified as valid response\n      if (xhr.status >= 200 && xhr.status < 300) {\n        api.onload(xhr);\n      } else {\n        api.onerror(xhr);\n      }\n    }; // error during load\n\n\n    xhr.onerror = function () {\n      return api.onerror(xhr);\n    }; // request aborted\n\n\n    xhr.onabort = function () {\n      aborted = true;\n      api.onabort();\n    }; // request timeout\n\n\n    xhr.ontimeout = function () {\n      return api.ontimeout(xhr);\n    }; // open up open up!\n\n\n    xhr.open(options.method, url, true); // set timeout if defined (do it after open so IE11 plays ball)\n\n    if (isInt(options.timeout)) {\n      xhr.timeout = options.timeout;\n    } // add headers\n\n\n    Object.keys(options.headers).forEach(function (key) {\n      var value = unescape(encodeURIComponent(options.headers[key]));\n      xhr.setRequestHeader(key, value);\n    }); // set type of response\n\n    if (options.responseType) {\n      xhr.responseType = options.responseType;\n    } // set credentials\n\n\n    if (options.withCredentials) {\n      xhr.withCredentials = true;\n    } // let's send our data\n\n\n    xhr.send(data);\n    return api;\n  };\n\n  var createResponse = function createResponse(type, code, body, headers) {\n    return {\n      type: type,\n      code: code,\n      body: body,\n      headers: headers\n    };\n  };\n\n  var createTimeoutResponse = function createTimeoutResponse(cb) {\n    return function (xhr) {\n      cb(createResponse('error', 0, 'Timeout', xhr.getAllResponseHeaders()));\n    };\n  };\n\n  var hasQS = function hasQS(str) {\n    return /\\?/.test(str);\n  };\n\n  var buildURL = function buildURL() {\n    var url = '';\n\n    for (var _len = arguments.length, parts = new Array(_len), _key = 0; _key < _len; _key++) {\n      parts[_key] = arguments[_key];\n    }\n\n    parts.forEach(function (part) {\n      url += hasQS(url) && hasQS(part) ? part.replace(/\\?/, '&') : part;\n    });\n    return url;\n  };\n\n  var createFetchFunction = function createFetchFunction() {\n    var apiUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var action = arguments.length > 1 ? arguments[1] : undefined; // custom handler (should also handle file, load, error, progress and abort)\n\n    if (typeof action === 'function') {\n      return action;\n    } // no action supplied\n\n\n    if (!action || !isString(action.url)) {\n      return null;\n    } // set onload hanlder\n\n\n    var onload = action.onload || function (res) {\n      return res;\n    };\n\n    var onerror = action.onerror || function (res) {\n      return null;\n    }; // internal handler\n\n\n    return function (url, load, error, progress, abort, headers) {\n      // do local or remote request based on if the url is external\n      var request = sendRequest(url, buildURL(apiUrl, action.url), Object.assign({}, action, {\n        responseType: 'blob'\n      }));\n\n      request.onload = function (xhr) {\n        // get headers\n        var headers = xhr.getAllResponseHeaders(); // get filename\n\n        var filename = getFileInfoFromHeaders(headers).name || getFilenameFromURL(url); // create response\n\n        load(createResponse('load', xhr.status, action.method === 'HEAD' ? null : getFileFromBlob(onload(xhr.response), filename), headers));\n      };\n\n      request.onerror = function (xhr) {\n        error(createResponse('error', xhr.status, onerror(xhr.response) || xhr.statusText, xhr.getAllResponseHeaders()));\n      };\n\n      request.onheaders = function (xhr) {\n        headers(createResponse('headers', xhr.status, null, xhr.getAllResponseHeaders()));\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n      request.onprogress = progress;\n      request.onabort = abort; // should return request\n\n      return request;\n    };\n  };\n\n  var ChunkStatus = {\n    QUEUED: 0,\n    COMPLETE: 1,\n    PROCESSING: 2,\n    ERROR: 3,\n    WAITING: 4\n  };\n  /*\n                                                       function signature:\n                                                         (file, metadata, load, error, progress, abort, transfer, options) => {\n                                                           return {\n                                                           abort:() => {}\n                                                         }\n                                                       }\n                                                       */\n  // apiUrl, action, name, file, metadata, load, error, progress, abort, transfer, options\n\n  var processFileChunked = function processFileChunked(apiUrl, action, name, file, metadata, load, error, progress, abort, transfer, options) {\n    // all chunks\n    var chunks = [];\n    var chunkTransferId = options.chunkTransferId,\n        chunkServer = options.chunkServer,\n        chunkSize = options.chunkSize,\n        chunkRetryDelays = options.chunkRetryDelays; // default state\n\n    var state = {\n      serverId: chunkTransferId,\n      aborted: false\n    }; // set onload handlers\n\n    var ondata = action.ondata || function (fd) {\n      return fd;\n    };\n\n    var onload = action.onload || function (xhr, method) {\n      return method === 'HEAD' ? xhr.getResponseHeader('Upload-Offset') : xhr.response;\n    };\n\n    var onerror = action.onerror || function (res) {\n      return null;\n    }; // create server hook\n\n\n    var requestTransferId = function requestTransferId(cb) {\n      var formData = new FormData(); // add metadata under same name\n\n      if (isObject(metadata)) formData.append(name, JSON.stringify(metadata));\n      var headers = typeof action.headers === 'function' ? action.headers(file, metadata) : Object.assign({}, action.headers, {\n        'Upload-Length': file.size\n      });\n      var requestParams = Object.assign({}, action, {\n        headers: headers\n      }); // send request object\n\n      var request = sendRequest(ondata(formData), buildURL(apiUrl, action.url), requestParams);\n\n      request.onload = function (xhr) {\n        return cb(onload(xhr, requestParams.method));\n      };\n\n      request.onerror = function (xhr) {\n        return error(createResponse('error', xhr.status, onerror(xhr.response) || xhr.statusText, xhr.getAllResponseHeaders()));\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n    };\n\n    var requestTransferOffset = function requestTransferOffset(cb) {\n      var requestUrl = buildURL(apiUrl, chunkServer.url, state.serverId);\n      var headers = typeof action.headers === 'function' ? action.headers(state.serverId) : Object.assign({}, action.headers);\n      var requestParams = {\n        headers: headers,\n        method: 'HEAD'\n      };\n      var request = sendRequest(null, requestUrl, requestParams);\n\n      request.onload = function (xhr) {\n        return cb(onload(xhr, requestParams.method));\n      };\n\n      request.onerror = function (xhr) {\n        return error(createResponse('error', xhr.status, onerror(xhr.response) || xhr.statusText, xhr.getAllResponseHeaders()));\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n    }; // create chunks\n\n\n    var lastChunkIndex = Math.floor(file.size / chunkSize);\n\n    for (var i = 0; i <= lastChunkIndex; i++) {\n      var offset = i * chunkSize;\n      var data = file.slice(offset, offset + chunkSize, 'application/offset+octet-stream');\n      chunks[i] = {\n        index: i,\n        size: data.size,\n        offset: offset,\n        data: data,\n        file: file,\n        progress: 0,\n        retries: _toConsumableArray(chunkRetryDelays),\n        status: ChunkStatus.QUEUED,\n        error: null,\n        request: null,\n        timeout: null\n      };\n    }\n\n    var completeProcessingChunks = function completeProcessingChunks() {\n      return load(state.serverId);\n    };\n\n    var canProcessChunk = function canProcessChunk(chunk) {\n      return chunk.status === ChunkStatus.QUEUED || chunk.status === ChunkStatus.ERROR;\n    };\n\n    var processChunk = function processChunk(chunk) {\n      // processing is paused, wait here\n      if (state.aborted) return; // get next chunk to process\n\n      chunk = chunk || chunks.find(canProcessChunk); // no more chunks to process\n\n      if (!chunk) {\n        // all done?\n        if (chunks.every(function (chunk) {\n          return chunk.status === ChunkStatus.COMPLETE;\n        })) {\n          completeProcessingChunks();\n        } // no chunk to handle\n\n\n        return;\n      } // now processing this chunk\n\n\n      chunk.status = ChunkStatus.PROCESSING;\n      chunk.progress = null; // allow parsing of formdata\n\n      var ondata = chunkServer.ondata || function (fd) {\n        return fd;\n      };\n\n      var onerror = chunkServer.onerror || function (res) {\n        return null;\n      }; // send request object\n\n\n      var requestUrl = buildURL(apiUrl, chunkServer.url, state.serverId);\n      var headers = typeof chunkServer.headers === 'function' ? chunkServer.headers(chunk) : Object.assign({}, chunkServer.headers, {\n        'Content-Type': 'application/offset+octet-stream',\n        'Upload-Offset': chunk.offset,\n        'Upload-Length': file.size,\n        'Upload-Name': file.name\n      });\n      var request = chunk.request = sendRequest(ondata(chunk.data), requestUrl, Object.assign({}, chunkServer, {\n        headers: headers\n      }));\n\n      request.onload = function () {\n        // done!\n        chunk.status = ChunkStatus.COMPLETE; // remove request reference\n\n        chunk.request = null; // start processing more chunks\n\n        processChunks();\n      };\n\n      request.onprogress = function (lengthComputable, loaded, total) {\n        chunk.progress = lengthComputable ? loaded : null;\n        updateTotalProgress();\n      };\n\n      request.onerror = function (xhr) {\n        chunk.status = ChunkStatus.ERROR;\n        chunk.request = null;\n        chunk.error = onerror(xhr.response) || xhr.statusText;\n\n        if (!retryProcessChunk(chunk)) {\n          error(createResponse('error', xhr.status, onerror(xhr.response) || xhr.statusText, xhr.getAllResponseHeaders()));\n        }\n      };\n\n      request.ontimeout = function (xhr) {\n        chunk.status = ChunkStatus.ERROR;\n        chunk.request = null;\n\n        if (!retryProcessChunk(chunk)) {\n          createTimeoutResponse(error)(xhr);\n        }\n      };\n\n      request.onabort = function () {\n        chunk.status = ChunkStatus.QUEUED;\n        chunk.request = null;\n        abort();\n      };\n    };\n\n    var retryProcessChunk = function retryProcessChunk(chunk) {\n      // no more retries left\n      if (chunk.retries.length === 0) return false; // new retry\n\n      chunk.status = ChunkStatus.WAITING;\n      clearTimeout(chunk.timeout);\n      chunk.timeout = setTimeout(function () {\n        processChunk(chunk);\n      }, chunk.retries.shift()); // we're going to retry\n\n      return true;\n    };\n\n    var updateTotalProgress = function updateTotalProgress() {\n      // calculate total progress fraction\n      var totalBytesTransfered = chunks.reduce(function (p, chunk) {\n        if (p === null || chunk.progress === null) return null;\n        return p + chunk.progress;\n      }, 0); // can't compute progress\n\n      if (totalBytesTransfered === null) return progress(false, 0, 0); // calculate progress values\n\n      var totalSize = chunks.reduce(function (total, chunk) {\n        return total + chunk.size;\n      }, 0); // can update progress indicator\n\n      progress(true, totalBytesTransfered, totalSize);\n    }; // process new chunks\n\n\n    var processChunks = function processChunks() {\n      var totalProcessing = chunks.filter(function (chunk) {\n        return chunk.status === ChunkStatus.PROCESSING;\n      }).length;\n      if (totalProcessing >= 1) return;\n      processChunk();\n    };\n\n    var abortChunks = function abortChunks() {\n      chunks.forEach(function (chunk) {\n        clearTimeout(chunk.timeout);\n\n        if (chunk.request) {\n          chunk.request.abort();\n        }\n      });\n    }; // let's go!\n\n\n    if (!state.serverId) {\n      requestTransferId(function (serverId) {\n        // stop here if aborted, might have happened in between request and callback\n        if (state.aborted) return; // pass back to item so we can use it if something goes wrong\n\n        transfer(serverId); // store internally\n\n        state.serverId = serverId;\n        processChunks();\n      });\n    } else {\n      requestTransferOffset(function (offset) {\n        // stop here if aborted, might have happened in between request and callback\n        if (state.aborted) return; // mark chunks with lower offset as complete\n\n        chunks.filter(function (chunk) {\n          return chunk.offset < offset;\n        }).forEach(function (chunk) {\n          chunk.status = ChunkStatus.COMPLETE;\n          chunk.progress = chunk.size;\n        }); // continue processing\n\n        processChunks();\n      });\n    }\n\n    return {\n      abort: function abort() {\n        state.aborted = true;\n        abortChunks();\n      }\n    };\n  };\n  /*\n                                                               function signature:\n                                                                 (file, metadata, load, error, progress, abort) => {\n                                                                   return {\n                                                                   abort:() => {}\n                                                                 }\n                                                               }\n                                                               */\n\n\n  var createFileProcessorFunction = function createFileProcessorFunction(apiUrl, action, name, options) {\n    return function (file, metadata, load, error, progress, abort, transfer) {\n      // no file received\n      if (!file) return; // if was passed a file, and we can chunk it, exit here\n\n      var canChunkUpload = options.chunkUploads;\n      var shouldChunkUpload = canChunkUpload && file.size > options.chunkSize;\n      var willChunkUpload = canChunkUpload && (shouldChunkUpload || options.chunkForce);\n      if (file instanceof Blob && willChunkUpload) return processFileChunked(apiUrl, action, name, file, metadata, load, error, progress, abort, transfer, options); // set handlers\n\n      var ondata = action.ondata || function (fd) {\n        return fd;\n      };\n\n      var onload = action.onload || function (res) {\n        return res;\n      };\n\n      var onerror = action.onerror || function (res) {\n        return null;\n      }; // create formdata object\n\n\n      var formData = new FormData(); // add metadata under same name\n\n      if (isObject(metadata)) {\n        formData.append(name, JSON.stringify(metadata));\n      } // Turn into an array of objects so no matter what the input, we can handle it the same way\n\n\n      (file instanceof Blob ? [{\n        name: null,\n        file: file\n      }] : file).forEach(function (item) {\n        formData.append(name, item.file, item.name === null ? item.file.name : '' + item.name + item.file.name);\n      }); // send request object\n\n      var request = sendRequest(ondata(formData), buildURL(apiUrl, action.url), action);\n\n      request.onload = function (xhr) {\n        load(createResponse('load', xhr.status, onload(xhr.response), xhr.getAllResponseHeaders()));\n      };\n\n      request.onerror = function (xhr) {\n        error(createResponse('error', xhr.status, onerror(xhr.response) || xhr.statusText, xhr.getAllResponseHeaders()));\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n      request.onprogress = progress;\n      request.onabort = abort; // should return request\n\n      return request;\n    };\n  };\n\n  var createProcessorFunction = function createProcessorFunction() {\n    var apiUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var action = arguments.length > 1 ? arguments[1] : undefined;\n    var name = arguments.length > 2 ? arguments[2] : undefined;\n    var options = arguments.length > 3 ? arguments[3] : undefined; // custom handler (should also handle file, load, error, progress and abort)\n\n    if (typeof action === 'function') return function () {\n      for (var _len = arguments.length, params = new Array(_len), _key = 0; _key < _len; _key++) {\n        params[_key] = arguments[_key];\n      }\n\n      return action.apply(void 0, [name].concat(params, [options]));\n    }; // no action supplied\n\n    if (!action || !isString(action.url)) return null; // internal handler\n\n    return createFileProcessorFunction(apiUrl, action, name, options);\n  };\n  /*\n                                                      function signature:\n                                                      (uniqueFileId, load, error) => { }\n                                                      */\n\n\n  var createRevertFunction = function createRevertFunction() {\n    var apiUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var action = arguments.length > 1 ? arguments[1] : undefined; // is custom implementation\n\n    if (typeof action === 'function') {\n      return action;\n    } // no action supplied, return stub function, interface will work, but file won't be removed\n\n\n    if (!action || !isString(action.url)) {\n      return function (uniqueFileId, load) {\n        return load();\n      };\n    } // set onload hanlder\n\n\n    var onload = action.onload || function (res) {\n      return res;\n    };\n\n    var onerror = action.onerror || function (res) {\n      return null;\n    }; // internal implementation\n\n\n    return function (uniqueFileId, load, error) {\n      var request = sendRequest(uniqueFileId, apiUrl + action.url, action // contains method, headers and withCredentials properties\n      );\n\n      request.onload = function (xhr) {\n        load(createResponse('load', xhr.status, onload(xhr.response), xhr.getAllResponseHeaders()));\n      };\n\n      request.onerror = function (xhr) {\n        error(createResponse('error', xhr.status, onerror(xhr.response) || xhr.statusText, xhr.getAllResponseHeaders()));\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n      return request;\n    };\n  };\n\n  var getRandomNumber = function getRandomNumber() {\n    var min = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    var max = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return min + Math.random() * (max - min);\n  };\n\n  var createPerceivedPerformanceUpdater = function createPerceivedPerformanceUpdater(cb) {\n    var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1000;\n    var offset = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var tickMin = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 25;\n    var tickMax = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 250;\n    var timeout = null;\n    var start = Date.now();\n\n    var tick = function tick() {\n      var runtime = Date.now() - start;\n      var delay = getRandomNumber(tickMin, tickMax);\n\n      if (runtime + delay > duration) {\n        delay = runtime + delay - duration;\n      }\n\n      var progress = runtime / duration;\n\n      if (progress >= 1 || document.hidden) {\n        cb(1);\n        return;\n      }\n\n      cb(progress);\n      timeout = setTimeout(tick, delay);\n    };\n\n    tick();\n    return {\n      clear: function clear() {\n        clearTimeout(timeout);\n      }\n    };\n  };\n\n  var createFileProcessor = function createFileProcessor(processFn) {\n    var state = {\n      complete: false,\n      perceivedProgress: 0,\n      perceivedPerformanceUpdater: null,\n      progress: null,\n      timestamp: null,\n      perceivedDuration: 0,\n      duration: 0,\n      request: null,\n      response: null\n    };\n\n    var process = function process(file, metadata) {\n      var progressFn = function progressFn() {\n        // we've not yet started the real download, stop here\n        // the request might not go through, for instance, there might be some server trouble\n        // if state.progress is null, the server does not allow computing progress and we show the spinner instead\n        if (state.duration === 0 || state.progress === null) return; // as we're now processing, fire the progress event\n\n        api.fire('progress', api.getProgress());\n      };\n\n      var completeFn = function completeFn() {\n        state.complete = true;\n        api.fire('load-perceived', state.response.body);\n      }; // let's start processing\n\n\n      api.fire('start'); // set request start\n\n      state.timestamp = Date.now(); // create perceived performance progress indicator\n\n      state.perceivedPerformanceUpdater = createPerceivedPerformanceUpdater(function (progress) {\n        state.perceivedProgress = progress;\n        state.perceivedDuration = Date.now() - state.timestamp;\n        progressFn(); // if fake progress is done, and a response has been received,\n        // and we've not yet called the complete method\n\n        if (state.response && state.perceivedProgress === 1 && !state.complete) {\n          // we done!\n          completeFn();\n        }\n      }, // random delay as in a list of files you start noticing\n      // files uploading at the exact same speed\n      getRandomNumber(750, 1500)); // remember request so we can abort it later\n\n      state.request = processFn( // the file to process\n      file, // the metadata to send along\n      metadata, // callbacks (load, error, progress, abort, transfer)\n      // load expects the body to be a server id if\n      // you want to make use of revert\n      function (response) {\n        // we put the response in state so we can access\n        // it outside of this method\n        state.response = isObject(response) ? response : {\n          type: 'load',\n          code: 200,\n          body: '' + response,\n          headers: {}\n        }; // update duration\n\n        state.duration = Date.now() - state.timestamp; // force progress to 1 as we're now done\n\n        state.progress = 1; // actual load is done let's share results\n\n        api.fire('load', state.response.body); // we are really done\n        // if perceived progress is 1 ( wait for perceived progress to complete )\n        // or if server does not support progress ( null )\n\n        if (state.perceivedProgress === 1) {\n          completeFn();\n        }\n      }, // error is expected to be an object with type, code, body\n      function (error) {\n        // cancel updater\n        state.perceivedPerformanceUpdater.clear(); // update others about this error\n\n        api.fire('error', isObject(error) ? error : {\n          type: 'error',\n          code: 0,\n          body: '' + error\n        });\n      }, // actual processing progress\n      function (computable, current, total) {\n        // update actual duration\n        state.duration = Date.now() - state.timestamp; // update actual progress\n\n        state.progress = computable ? current / total : null;\n        progressFn();\n      }, // abort does not expect a value\n      function () {\n        // stop updater\n        state.perceivedPerformanceUpdater.clear(); // fire the abort event so we can switch visuals\n\n        api.fire('abort', state.response ? state.response.body : null);\n      }, // register the id for this transfer\n      function (transferId) {\n        api.fire('transfer', transferId);\n      });\n    };\n\n    var abort = function abort() {\n      // no request running, can't abort\n      if (!state.request) return; // stop updater\n\n      state.perceivedPerformanceUpdater.clear(); // abort actual request\n\n      if (state.request.abort) state.request.abort(); // if has response object, we've completed the request\n\n      state.complete = true;\n    };\n\n    var reset = function reset() {\n      abort();\n      state.complete = false;\n      state.perceivedProgress = 0;\n      state.progress = 0;\n      state.timestamp = null;\n      state.perceivedDuration = 0;\n      state.duration = 0;\n      state.request = null;\n      state.response = null;\n    };\n\n    var getProgress = function getProgress() {\n      return state.progress ? Math.min(state.progress, state.perceivedProgress) : null;\n    };\n\n    var getDuration = function getDuration() {\n      return Math.min(state.duration, state.perceivedDuration);\n    };\n\n    var api = Object.assign({}, on(), {\n      process: process,\n      // start processing file\n      abort: abort,\n      // abort active process request\n      getProgress: getProgress,\n      getDuration: getDuration,\n      reset: reset\n    });\n    return api;\n  };\n\n  var getFilenameWithoutExtension = function getFilenameWithoutExtension(name) {\n    return name.substr(0, name.lastIndexOf('.')) || name;\n  };\n\n  var createFileStub = function createFileStub(source) {\n    var data = [source.name, source.size, source.type]; // is blob or base64, then we need to set the name\n\n    if (source instanceof Blob || isBase64DataURI(source)) {\n      data[0] = source.name || getDateString();\n    } else if (isBase64DataURI(source)) {\n      // if is base64 data uri we need to determine the average size and type\n      data[1] = source.length;\n      data[2] = getMimeTypeFromBase64DataURI(source);\n    } else if (isString(source)) {\n      // url\n      data[0] = getFilenameFromURL(source);\n      data[1] = 0;\n      data[2] = 'application/octet-stream';\n    }\n\n    return {\n      name: data[0],\n      size: data[1],\n      type: data[2]\n    };\n  };\n\n  var isFile = function isFile(value) {\n    return !!(value instanceof File || value instanceof Blob && value.name);\n  };\n\n  var deepCloneObject = function deepCloneObject(src) {\n    if (!isObject(src)) return src;\n    var target = isArray(src) ? [] : {};\n\n    for (var key in src) {\n      if (!src.hasOwnProperty(key)) continue;\n      var v = src[key];\n      target[key] = v && isObject(v) ? deepCloneObject(v) : v;\n    }\n\n    return target;\n  };\n\n  var createItem = function createItem() {\n    var origin = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    var serverFileReference = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    var file = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null; // unique id for this item, is used to identify the item across views\n\n    var id = getUniqueId();\n    /**\n     * Internal item state\n     */\n\n    var state = {\n      // is archived\n      archived: false,\n      // if is frozen, no longer fires events\n      frozen: false,\n      // removed from view\n      released: false,\n      // original source\n      source: null,\n      // file model reference\n      file: file,\n      // id of file on server\n      serverFileReference: serverFileReference,\n      // id of file transfer on server\n      transferId: null,\n      // is aborted\n      processingAborted: false,\n      // current item status\n      status: serverFileReference ? ItemStatus.PROCESSING_COMPLETE : ItemStatus.INIT,\n      // active processes\n      activeLoader: null,\n      activeProcessor: null\n    }; // callback used when abort processing is called to link back to the resolve method\n\n    var abortProcessingRequestComplete = null;\n    /**\n     * Externally added item metadata\n     */\n\n    var metadata = {}; // item data\n\n    var setStatus = function setStatus(status) {\n      return state.status = status;\n    }; // fire event unless the item has been archived\n\n\n    var fire = function fire(event) {\n      if (state.released || state.frozen) return;\n\n      for (var _len = arguments.length, params = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        params[_key - 1] = arguments[_key];\n      }\n\n      api.fire.apply(api, [event].concat(params));\n    }; // file data\n\n\n    var getFileExtension = function getFileExtension() {\n      return getExtensionFromFilename(state.file.name);\n    };\n\n    var getFileType = function getFileType() {\n      return state.file.type;\n    };\n\n    var getFileSize = function getFileSize() {\n      return state.file.size;\n    };\n\n    var getFile = function getFile() {\n      return state.file;\n    }; //\n    // logic to load a file\n    //\n\n\n    var load = function load(source, loader, onload) {\n      // remember the original item source\n      state.source = source; // source is known\n\n      api.fireSync('init'); // file stub is already there\n\n      if (state.file) {\n        api.fireSync('load-skip');\n        return;\n      } // set a stub file object while loading the actual data\n\n\n      state.file = createFileStub(source); // starts loading\n\n      loader.on('init', function () {\n        fire('load-init');\n      }); // we'eve received a size indication, let's update the stub\n\n      loader.on('meta', function (meta) {\n        // set size of file stub\n        state.file.size = meta.size; // set name of file stub\n\n        state.file.filename = meta.filename; // if has received source, we done\n\n        if (meta.source) {\n          origin = FileOrigin.LIMBO;\n          state.serverFileReference = meta.source;\n          state.status = ItemStatus.PROCESSING_COMPLETE;\n        } // size has been updated\n\n\n        fire('load-meta');\n      }); // the file is now loading we need to update the progress indicators\n\n      loader.on('progress', function (progress) {\n        setStatus(ItemStatus.LOADING);\n        fire('load-progress', progress);\n      }); // an error was thrown while loading the file, we need to switch to error state\n\n      loader.on('error', function (error) {\n        setStatus(ItemStatus.LOAD_ERROR);\n        fire('load-request-error', error);\n      }); // user or another process aborted the file load (cannot retry)\n\n      loader.on('abort', function () {\n        setStatus(ItemStatus.INIT);\n        fire('load-abort');\n      }); // done loading\n\n      loader.on('load', function (file) {\n        // as we've now loaded the file the loader is no longer required\n        state.activeLoader = null; // called when file has loaded succesfully\n\n        var success = function success(result) {\n          // set (possibly) transformed file\n          state.file = isFile(result) ? result : state.file; // file received\n\n          if (origin === FileOrigin.LIMBO && state.serverFileReference) {\n            setStatus(ItemStatus.PROCESSING_COMPLETE);\n          } else {\n            setStatus(ItemStatus.IDLE);\n          }\n\n          fire('load');\n        };\n\n        var error = function error(result) {\n          // set original file\n          state.file = file;\n          fire('load-meta');\n          setStatus(ItemStatus.LOAD_ERROR);\n          fire('load-file-error', result);\n        }; // if we already have a server file reference, we don't need to call the onload method\n\n\n        if (state.serverFileReference) {\n          success(file);\n          return;\n        } // no server id, let's give this file the full treatment\n\n\n        onload(file, success, error);\n      }); // set loader source data\n\n      loader.setSource(source); // set as active loader\n\n      state.activeLoader = loader; // load the source data\n\n      loader.load();\n    };\n\n    var retryLoad = function retryLoad() {\n      if (!state.activeLoader) {\n        return;\n      }\n\n      state.activeLoader.load();\n    };\n\n    var abortLoad = function abortLoad() {\n      if (state.activeLoader) {\n        state.activeLoader.abort();\n        return;\n      }\n\n      setStatus(ItemStatus.INIT);\n      fire('load-abort');\n    }; //\n    // logic to process a file\n    //\n\n\n    var process = function process(processor, onprocess) {\n      // processing was aborted\n      if (state.processingAborted) {\n        state.processingAborted = false;\n        return;\n      } // now processing\n\n\n      setStatus(ItemStatus.PROCESSING); // reset abort callback\n\n      abortProcessingRequestComplete = null; // if no file loaded we'll wait for the load event\n\n      if (!(state.file instanceof Blob)) {\n        api.on('load', function () {\n          process(processor, onprocess);\n        });\n        return;\n      } // setup processor\n\n\n      processor.on('load', function (serverFileReference) {\n        // need this id to be able to revert the upload\n        state.transferId = null;\n        state.serverFileReference = serverFileReference;\n      }); // register transfer id\n\n      processor.on('transfer', function (transferId) {\n        // need this id to be able to revert the upload\n        state.transferId = transferId;\n      });\n      processor.on('load-perceived', function (serverFileReference) {\n        // no longer required\n        state.activeProcessor = null; // need this id to be able to rever the upload\n\n        state.transferId = null;\n        state.serverFileReference = serverFileReference;\n        setStatus(ItemStatus.PROCESSING_COMPLETE);\n        fire('process-complete', serverFileReference);\n      });\n      processor.on('start', function () {\n        fire('process-start');\n      });\n      processor.on('error', function (error) {\n        state.activeProcessor = null;\n        setStatus(ItemStatus.PROCESSING_ERROR);\n        fire('process-error', error);\n      });\n      processor.on('abort', function (serverFileReference) {\n        state.activeProcessor = null; // if file was uploaded but processing was cancelled during perceived processor time store file reference\n\n        state.transferId = null;\n        state.serverFileReference = serverFileReference;\n        setStatus(ItemStatus.IDLE);\n        fire('process-abort'); // has timeout so doesn't interfere with remove action\n\n        if (abortProcessingRequestComplete) {\n          abortProcessingRequestComplete();\n        }\n      });\n      processor.on('progress', function (progress) {\n        fire('process-progress', progress);\n      }); // when successfully transformed\n\n      var success = function success(file) {\n        // if was archived in the mean time, don't process\n        if (state.archived) return; // process file!\n\n        processor.process(file, Object.assign({}, metadata));\n      }; // something went wrong during transform phase\n\n\n      var error = console.error; // start processing the file\n\n      onprocess(state.file, success, error); // set as active processor\n\n      state.activeProcessor = processor;\n    };\n\n    var requestProcessing = function requestProcessing() {\n      state.processingAborted = false;\n      setStatus(ItemStatus.PROCESSING_QUEUED);\n    };\n\n    var abortProcessing = function abortProcessing() {\n      return new Promise(function (resolve) {\n        if (!state.activeProcessor) {\n          state.processingAborted = true;\n          setStatus(ItemStatus.IDLE);\n          fire('process-abort');\n          resolve();\n          return;\n        }\n\n        abortProcessingRequestComplete = function abortProcessingRequestComplete() {\n          resolve();\n        };\n\n        state.activeProcessor.abort();\n      });\n    }; //\n    // logic to revert a processed file\n    //\n\n\n    var revert = function revert(revertFileUpload, forceRevert) {\n      return new Promise(function (resolve, reject) {\n        // cannot revert without a server id for this process\n        if (state.serverFileReference === null) {\n          resolve();\n          return;\n        } // revert the upload (fire and forget)\n\n\n        revertFileUpload(state.serverFileReference, function () {\n          // reset file server id as now it's no available on the server\n          state.serverFileReference = null;\n          resolve();\n        }, function (error) {\n          // don't set error state when reverting is optional, it will always resolve\n          if (!forceRevert) {\n            resolve();\n            return;\n          } // oh no errors\n\n\n          setStatus(ItemStatus.PROCESSING_REVERT_ERROR);\n          fire('process-revert-error');\n          reject(error);\n        }); // fire event\n\n        setStatus(ItemStatus.IDLE);\n        fire('process-revert');\n      });\n    }; // exposed methods\n\n\n    var _setMetadata = function setMetadata(key, value, silent) {\n      var keys = key.split('.');\n      var root = keys[0];\n      var last = keys.pop();\n      var data = metadata;\n      keys.forEach(function (key) {\n        return data = data[key];\n      }); // compare old value against new value, if they're the same, we're not updating\n\n      if (JSON.stringify(data[last]) === JSON.stringify(value)) return; // update value\n\n      data[last] = value; // don't fire update\n\n      if (silent) return; // fire update\n\n      fire('metadata-update', {\n        key: root,\n        value: metadata[root]\n      });\n    };\n\n    var getMetadata = function getMetadata(key) {\n      return deepCloneObject(key ? metadata[key] : metadata);\n    };\n\n    var api = Object.assign({\n      id: {\n        get: function get() {\n          return id;\n        }\n      },\n      origin: {\n        get: function get() {\n          return origin;\n        }\n      },\n      serverId: {\n        get: function get() {\n          return state.serverFileReference;\n        }\n      },\n      transferId: {\n        get: function get() {\n          return state.transferId;\n        }\n      },\n      status: {\n        get: function get() {\n          return state.status;\n        }\n      },\n      filename: {\n        get: function get() {\n          return state.file.name;\n        }\n      },\n      filenameWithoutExtension: {\n        get: function get() {\n          return getFilenameWithoutExtension(state.file.name);\n        }\n      },\n      fileExtension: {\n        get: getFileExtension\n      },\n      fileType: {\n        get: getFileType\n      },\n      fileSize: {\n        get: getFileSize\n      },\n      file: {\n        get: getFile\n      },\n      relativePath: {\n        get: function get() {\n          return state.file._relativePath;\n        }\n      },\n      source: {\n        get: function get() {\n          return state.source;\n        }\n      },\n      getMetadata: getMetadata,\n      setMetadata: function setMetadata(key, value, silent) {\n        if (isObject(key)) {\n          var data = key;\n          Object.keys(data).forEach(function (key) {\n            _setMetadata(key, data[key], value);\n          });\n          return key;\n        }\n\n        _setMetadata(key, value, silent);\n\n        return value;\n      },\n      extend: function extend(name, handler) {\n        return itemAPI[name] = handler;\n      },\n      abortLoad: abortLoad,\n      retryLoad: retryLoad,\n      requestProcessing: requestProcessing,\n      abortProcessing: abortProcessing,\n      load: load,\n      process: process,\n      revert: revert\n    }, on(), {\n      freeze: function freeze() {\n        return state.frozen = true;\n      },\n      release: function release() {\n        return state.released = true;\n      },\n      released: {\n        get: function get() {\n          return state.released;\n        }\n      },\n      archive: function archive() {\n        return state.archived = true;\n      },\n      archived: {\n        get: function get() {\n          return state.archived;\n        }\n      }\n    }); // create it here instead of returning it instantly so we can extend it later\n\n    var itemAPI = createObject(api);\n    return itemAPI;\n  };\n\n  var getItemIndexByQuery = function getItemIndexByQuery(items, query) {\n    // just return first index\n    if (isEmpty(query)) {\n      return 0;\n    } // invalid queries\n\n\n    if (!isString(query)) {\n      return -1;\n    } // return item by id (or -1 if not found)\n\n\n    return items.findIndex(function (item) {\n      return item.id === query;\n    });\n  };\n\n  var getItemById = function getItemById(items, itemId) {\n    var index = getItemIndexByQuery(items, itemId);\n\n    if (index < 0) {\n      return;\n    }\n\n    return items[index] || null;\n  };\n\n  var fetchBlob = function fetchBlob(url, load, error, progress, abort, headers) {\n    var request = sendRequest(null, url, {\n      method: 'GET',\n      responseType: 'blob'\n    });\n\n    request.onload = function (xhr) {\n      // get headers\n      var headers = xhr.getAllResponseHeaders(); // get filename\n\n      var filename = getFileInfoFromHeaders(headers).name || getFilenameFromURL(url); // create response\n\n      load(createResponse('load', xhr.status, getFileFromBlob(xhr.response, filename), headers));\n    };\n\n    request.onerror = function (xhr) {\n      error(createResponse('error', xhr.status, xhr.statusText, xhr.getAllResponseHeaders()));\n    };\n\n    request.onheaders = function (xhr) {\n      headers(createResponse('headers', xhr.status, null, xhr.getAllResponseHeaders()));\n    };\n\n    request.ontimeout = createTimeoutResponse(error);\n    request.onprogress = progress;\n    request.onabort = abort; // should return request\n\n    return request;\n  };\n\n  var getDomainFromURL = function getDomainFromURL(url) {\n    if (url.indexOf('//') === 0) {\n      url = location.protocol + url;\n    }\n\n    return url.toLowerCase().replace('blob:', '').replace(/([a-z])?:\\/\\//, '$1').split('/')[0];\n  };\n\n  var isExternalURL = function isExternalURL(url) {\n    return (url.indexOf(':') > -1 || url.indexOf('//') > -1) && getDomainFromURL(location.href) !== getDomainFromURL(url);\n  };\n\n  var dynamicLabel = function dynamicLabel(label) {\n    return function () {\n      return isFunction(label) ? label.apply(void 0, arguments) : label;\n    };\n  };\n\n  var isMockItem = function isMockItem(item) {\n    return !isFile(item.file);\n  };\n\n  var listUpdated = function listUpdated(dispatch, state) {\n    clearTimeout(state.listUpdateTimeout);\n    state.listUpdateTimeout = setTimeout(function () {\n      dispatch('DID_UPDATE_ITEMS', {\n        items: getActiveItems(state.items)\n      });\n    }, 0);\n  };\n\n  var optionalPromise = function optionalPromise(fn) {\n    for (var _len = arguments.length, params = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      params[_key - 1] = arguments[_key];\n    }\n\n    return new Promise(function (resolve) {\n      if (!fn) {\n        return resolve(true);\n      }\n\n      var result = fn.apply(void 0, params);\n\n      if (result == null) {\n        return resolve(true);\n      }\n\n      if (typeof result === 'boolean') {\n        return resolve(result);\n      }\n\n      if (typeof result.then === 'function') {\n        result.then(resolve);\n      }\n    });\n  };\n\n  var sortItems = function sortItems(state, compare) {\n    state.items.sort(function (a, b) {\n      return compare(createItemAPI(a), createItemAPI(b));\n    });\n  }; // returns item based on state\n\n\n  var getItemByQueryFromState = function getItemByQueryFromState(state, itemHandler) {\n    return function () {\n      var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      var query = _ref.query,\n          _ref$success = _ref.success,\n          success = _ref$success === void 0 ? function () {} : _ref$success,\n          _ref$failure = _ref.failure,\n          failure = _ref$failure === void 0 ? function () {} : _ref$failure,\n          options = _objectWithoutProperties(_ref, ['query', 'success', 'failure']);\n\n      var item = getItemByQuery(state.items, query);\n\n      if (!item) {\n        failure({\n          error: createResponse('error', 0, 'Item not found'),\n          file: null\n        });\n        return;\n      }\n\n      itemHandler(item, success, failure, options || {});\n    };\n  };\n\n  var actions = function actions(dispatch, query, state) {\n    return {\n      /**\n       * Aborts all ongoing processes\n       */\n      ABORT_ALL: function ABORT_ALL() {\n        getActiveItems(state.items).forEach(function (item) {\n          item.freeze();\n          item.abortLoad();\n          item.abortProcessing();\n        });\n      },\n\n      /**\n       * Sets initial files\n       */\n      DID_SET_FILES: function DID_SET_FILES(_ref2) {\n        var _ref2$value = _ref2.value,\n            value = _ref2$value === void 0 ? [] : _ref2$value; // map values to file objects\n\n        var files = value.map(function (file) {\n          return {\n            source: file.source ? file.source : file,\n            options: file.options\n          };\n        }); // loop over files, if file is in list, leave it be, if not, remove\n        // test if items should be moved\n\n        var activeItems = getActiveItems(state.items);\n        activeItems.forEach(function (item) {\n          // if item not is in new value, remove\n          if (!files.find(function (file) {\n            return file.source === item.source || file.source === item.file;\n          })) {\n            dispatch('REMOVE_ITEM', {\n              query: item,\n              remove: false\n            });\n          }\n        }); // add new files\n\n        activeItems = getActiveItems(state.items);\n        files.forEach(function (file, index) {\n          // if file is already in list\n          if (activeItems.find(function (item) {\n            return item.source === file.source || item.file === file.source;\n          })) return; // not in list, add\n\n          dispatch('ADD_ITEM', Object.assign({}, file, {\n            interactionMethod: InteractionMethod.NONE,\n            index: index\n          }));\n        });\n      },\n      DID_UPDATE_ITEM_METADATA: function DID_UPDATE_ITEM_METADATA(_ref3) {\n        var id = _ref3.id; // if is called multiple times in close succession we combined all calls together to save resources\n\n        clearTimeout(state.itemUpdateTimeout);\n        state.itemUpdateTimeout = setTimeout(function () {\n          var item = getItemById(state.items, id); // only revert and attempt to upload when we're uploading to a server\n\n          if (!query('IS_ASYNC')) {\n            // should we update the output data\n            applyFilterChain('SHOULD_PREPARE_OUTPUT', false, {\n              item: item,\n              query: query\n            }).then(function (shouldPrepareOutput) {\n              if (!shouldPrepareOutput) {\n                return;\n              }\n\n              dispatch('REQUEST_PREPARE_OUTPUT', {\n                query: id,\n                item: item,\n                success: function success(file) {\n                  dispatch('DID_PREPARE_OUTPUT', {\n                    id: id,\n                    file: file\n                  });\n                }\n              }, true);\n            });\n            return;\n          } // for async scenarios\n\n\n          var upload = function upload() {\n            // we push this forward a bit so the interface is updated correctly\n            setTimeout(function () {\n              dispatch('REQUEST_ITEM_PROCESSING', {\n                query: id\n              });\n            }, 32);\n          };\n\n          var revert = function revert(doUpload) {\n            item.revert(createRevertFunction(state.options.server.url, state.options.server.revert), query('GET_FORCE_REVERT')).then(doUpload ? upload : function () {}).catch(function () {});\n          };\n\n          var abort = function abort(doUpload) {\n            item.abortProcessing().then(doUpload ? upload : function () {});\n          }; // if we should re-upload the file immidiately\n\n\n          if (item.status === ItemStatus.PROCESSING_COMPLETE) {\n            return revert(state.options.instantUpload);\n          } // if currently uploading, cancel upload\n\n\n          if (item.status === ItemStatus.PROCESSING) {\n            return abort(state.options.instantUpload);\n          }\n\n          if (state.options.instantUpload) {\n            upload();\n          }\n        }, 0);\n      },\n      MOVE_ITEM: function MOVE_ITEM(_ref4) {\n        var query = _ref4.query,\n            index = _ref4.index;\n        var item = getItemByQuery(state.items, query);\n        if (!item) return;\n        var currentIndex = state.items.indexOf(item);\n        index = limit(index, 0, state.items.length - 1);\n        if (currentIndex === index) return;\n        state.items.splice(index, 0, state.items.splice(currentIndex, 1)[0]);\n      },\n      SORT: function SORT(_ref5) {\n        var compare = _ref5.compare;\n        sortItems(state, compare);\n        dispatch('DID_SORT_ITEMS', {\n          items: query('GET_ACTIVE_ITEMS')\n        });\n      },\n      ADD_ITEMS: function ADD_ITEMS(_ref6) {\n        var items = _ref6.items,\n            index = _ref6.index,\n            interactionMethod = _ref6.interactionMethod,\n            _ref6$success = _ref6.success,\n            success = _ref6$success === void 0 ? function () {} : _ref6$success,\n            _ref6$failure = _ref6.failure,\n            failure = _ref6$failure === void 0 ? function () {} : _ref6$failure;\n        var currentIndex = index;\n\n        if (index === -1 || typeof index === 'undefined') {\n          var insertLocation = query('GET_ITEM_INSERT_LOCATION');\n          var totalItems = query('GET_TOTAL_ITEMS');\n          currentIndex = insertLocation === 'before' ? 0 : totalItems;\n        }\n\n        var ignoredFiles = query('GET_IGNORED_FILES');\n\n        var isValidFile = function isValidFile(source) {\n          return isFile(source) ? !ignoredFiles.includes(source.name.toLowerCase()) : !isEmpty(source);\n        };\n\n        var validItems = items.filter(isValidFile);\n        var promises = validItems.map(function (source) {\n          return new Promise(function (resolve, reject) {\n            dispatch('ADD_ITEM', {\n              interactionMethod: interactionMethod,\n              source: source.source || source,\n              success: resolve,\n              failure: reject,\n              index: currentIndex++,\n              options: source.options || {}\n            });\n          });\n        });\n        Promise.all(promises).then(success).catch(failure);\n      },\n\n      /**\n       * @param source\n       * @param index\n       * @param interactionMethod\n       */\n      ADD_ITEM: function ADD_ITEM(_ref7) {\n        var source = _ref7.source,\n            _ref7$index = _ref7.index,\n            index = _ref7$index === void 0 ? -1 : _ref7$index,\n            interactionMethod = _ref7.interactionMethod,\n            _ref7$success = _ref7.success,\n            success = _ref7$success === void 0 ? function () {} : _ref7$success,\n            _ref7$failure = _ref7.failure,\n            failure = _ref7$failure === void 0 ? function () {} : _ref7$failure,\n            _ref7$options = _ref7.options,\n            options = _ref7$options === void 0 ? {} : _ref7$options; // if no source supplied\n\n        if (isEmpty(source)) {\n          failure({\n            error: createResponse('error', 0, 'No source'),\n            file: null\n          });\n          return;\n        } // filter out invalid file items, used to filter dropped directory contents\n\n\n        if (isFile(source) && state.options.ignoredFiles.includes(source.name.toLowerCase())) {\n          // fail silently\n          return;\n        } // test if there's still room in the list of files\n\n\n        if (!hasRoomForItem(state)) {\n          // if multiple allowed, we can't replace\n          // or if only a single item is allowed but we're not allowed to replace it we exit\n          if (state.options.allowMultiple || !state.options.allowMultiple && !state.options.allowReplace) {\n            var error = createResponse('warning', 0, 'Max files');\n            dispatch('DID_THROW_MAX_FILES', {\n              source: source,\n              error: error\n            });\n            failure({\n              error: error,\n              file: null\n            });\n            return;\n          } // let's replace the item\n          // id of first item we're about to remove\n\n\n          var _item = getActiveItems(state.items)[0]; // if has been processed remove it from the server as well\n\n          if (_item.status === ItemStatus.PROCESSING_COMPLETE || _item.status === ItemStatus.PROCESSING_REVERT_ERROR) {\n            var forceRevert = query('GET_FORCE_REVERT');\n\n            _item.revert(createRevertFunction(state.options.server.url, state.options.server.revert), forceRevert).then(function () {\n              if (!forceRevert) return; // try to add now\n\n              dispatch('ADD_ITEM', {\n                source: source,\n                index: index,\n                interactionMethod: interactionMethod,\n                success: success,\n                failure: failure,\n                options: options\n              });\n            }).catch(function () {}); // no need to handle this catch state for now\n\n\n            if (forceRevert) return;\n          } // remove first item as it will be replaced by this item\n\n\n          dispatch('REMOVE_ITEM', {\n            query: _item.id\n          });\n        } // where did the file originate\n\n\n        var origin = options.type === 'local' ? FileOrigin.LOCAL : options.type === 'limbo' ? FileOrigin.LIMBO : FileOrigin.INPUT; // create a new blank item\n\n        var item = createItem( // where did this file come from\n        origin, // an input file never has a server file reference\n        origin === FileOrigin.INPUT ? null : source, // file mock data, if defined\n        options.file); // set initial meta data\n\n        Object.keys(options.metadata || {}).forEach(function (key) {\n          item.setMetadata(key, options.metadata[key]);\n        }); // created the item, let plugins add methods\n\n        applyFilters('DID_CREATE_ITEM', item, {\n          query: query,\n          dispatch: dispatch\n        }); // where to insert new items\n\n        var itemInsertLocation = query('GET_ITEM_INSERT_LOCATION'); // adjust index if is not allowed to pick location\n\n        if (!state.options.itemInsertLocationFreedom) {\n          index = itemInsertLocation === 'before' ? -1 : state.items.length;\n        } // add item to list\n\n\n        insertItem(state.items, item, index); // sort items in list\n\n        if (isFunction(itemInsertLocation) && source) {\n          sortItems(state, itemInsertLocation);\n        } // get a quick reference to the item id\n\n\n        var id = item.id; // observe item events\n\n        item.on('init', function () {\n          dispatch('DID_INIT_ITEM', {\n            id: id\n          });\n        });\n        item.on('load-init', function () {\n          dispatch('DID_START_ITEM_LOAD', {\n            id: id\n          });\n        });\n        item.on('load-meta', function () {\n          dispatch('DID_UPDATE_ITEM_META', {\n            id: id\n          });\n        });\n        item.on('load-progress', function (progress) {\n          dispatch('DID_UPDATE_ITEM_LOAD_PROGRESS', {\n            id: id,\n            progress: progress\n          });\n        });\n        item.on('load-request-error', function (error) {\n          var mainStatus = dynamicLabel(state.options.labelFileLoadError)(error); // is client error, no way to recover\n\n          if (error.code >= 400 && error.code < 500) {\n            dispatch('DID_THROW_ITEM_INVALID', {\n              id: id,\n              error: error,\n              status: {\n                main: mainStatus,\n                sub: error.code + ' (' + error.body + ')'\n              }\n            }); // reject the file so can be dealt with through API\n\n            failure({\n              error: error,\n              file: createItemAPI(item)\n            });\n            return;\n          } // is possible server error, so might be possible to retry\n\n\n          dispatch('DID_THROW_ITEM_LOAD_ERROR', {\n            id: id,\n            error: error,\n            status: {\n              main: mainStatus,\n              sub: state.options.labelTapToRetry\n            }\n          });\n        });\n        item.on('load-file-error', function (error) {\n          dispatch('DID_THROW_ITEM_INVALID', {\n            id: id,\n            error: error.status,\n            status: error.status\n          });\n          failure({\n            error: error.status,\n            file: createItemAPI(item)\n          });\n        });\n        item.on('load-abort', function () {\n          dispatch('REMOVE_ITEM', {\n            query: id\n          });\n        });\n        item.on('load-skip', function () {\n          dispatch('COMPLETE_LOAD_ITEM', {\n            query: id,\n            item: item,\n            data: {\n              source: source,\n              success: success\n            }\n          });\n        });\n        item.on('load', function () {\n          var handleAdd = function handleAdd(shouldAdd) {\n            // no should not add this file\n            if (!shouldAdd) {\n              dispatch('REMOVE_ITEM', {\n                query: id\n              });\n              return;\n            } // now interested in metadata updates\n\n\n            item.on('metadata-update', function (change) {\n              dispatch('DID_UPDATE_ITEM_METADATA', {\n                id: id,\n                change: change\n              });\n            }); // let plugins decide if the output data should be prepared at this point\n            // means we'll do this and wait for idle state\n\n            applyFilterChain('SHOULD_PREPARE_OUTPUT', false, {\n              item: item,\n              query: query\n            }).then(function (shouldPrepareOutput) {\n              var loadComplete = function loadComplete() {\n                dispatch('COMPLETE_LOAD_ITEM', {\n                  query: id,\n                  item: item,\n                  data: {\n                    source: source,\n                    success: success\n                  }\n                });\n                listUpdated(dispatch, state);\n              }; // exit\n\n\n              if (shouldPrepareOutput) {\n                // wait for idle state and then run PREPARE_OUTPUT\n                dispatch('REQUEST_PREPARE_OUTPUT', {\n                  query: id,\n                  item: item,\n                  success: function success(file) {\n                    dispatch('DID_PREPARE_OUTPUT', {\n                      id: id,\n                      file: file\n                    });\n                    loadComplete();\n                  }\n                }, true);\n                return;\n              }\n\n              loadComplete();\n            });\n          }; // item loaded, allow plugins to\n          // - read data (quickly)\n          // - add metadata\n\n\n          applyFilterChain('DID_LOAD_ITEM', item, {\n            query: query,\n            dispatch: dispatch\n          }).then(function () {\n            optionalPromise(query('GET_BEFORE_ADD_FILE'), createItemAPI(item)).then(handleAdd);\n          }).catch(function () {\n            handleAdd(false);\n          });\n        });\n        item.on('process-start', function () {\n          dispatch('DID_START_ITEM_PROCESSING', {\n            id: id\n          });\n        });\n        item.on('process-progress', function (progress) {\n          dispatch('DID_UPDATE_ITEM_PROCESS_PROGRESS', {\n            id: id,\n            progress: progress\n          });\n        });\n        item.on('process-error', function (error) {\n          dispatch('DID_THROW_ITEM_PROCESSING_ERROR', {\n            id: id,\n            error: error,\n            status: {\n              main: dynamicLabel(state.options.labelFileProcessingError)(error),\n              sub: state.options.labelTapToRetry\n            }\n          });\n        });\n        item.on('process-revert-error', function (error) {\n          dispatch('DID_THROW_ITEM_PROCESSING_REVERT_ERROR', {\n            id: id,\n            error: error,\n            status: {\n              main: dynamicLabel(state.options.labelFileProcessingRevertError)(error),\n              sub: state.options.labelTapToRetry\n            }\n          });\n        });\n        item.on('process-complete', function (serverFileReference) {\n          dispatch('DID_COMPLETE_ITEM_PROCESSING', {\n            id: id,\n            error: null,\n            serverFileReference: serverFileReference\n          });\n          dispatch('DID_DEFINE_VALUE', {\n            id: id,\n            value: serverFileReference\n          });\n        });\n        item.on('process-abort', function () {\n          dispatch('DID_ABORT_ITEM_PROCESSING', {\n            id: id\n          });\n        });\n        item.on('process-revert', function () {\n          dispatch('DID_REVERT_ITEM_PROCESSING', {\n            id: id\n          });\n          dispatch('DID_DEFINE_VALUE', {\n            id: id,\n            value: null\n          });\n        }); // let view know the item has been inserted\n\n        dispatch('DID_ADD_ITEM', {\n          id: id,\n          index: index,\n          interactionMethod: interactionMethod\n        });\n        listUpdated(dispatch, state); // start loading the source\n\n        var _ref8 = state.options.server || {},\n            url = _ref8.url,\n            load = _ref8.load,\n            restore = _ref8.restore,\n            fetch = _ref8.fetch;\n\n        item.load(source, // this creates a function that loads the file based on the type of file (string, base64, blob, file) and location of file (local, remote, limbo)\n        createFileLoader(origin === FileOrigin.INPUT ? // input, if is remote, see if should use custom fetch, else use default fetchBlob\n        isString(source) && isExternalURL(source) ? fetch ? createFetchFunction(url, fetch) : fetchBlob // remote url\n        : fetchBlob // try to fetch url\n        : // limbo or local\n        origin === FileOrigin.LIMBO ? createFetchFunction(url, restore) // limbo\n        : createFetchFunction(url, load) // local\n        ), // called when the file is loaded so it can be piped through the filters\n        function (file, success, error) {\n          // let's process the file\n          applyFilterChain('LOAD_FILE', file, {\n            query: query\n          }).then(success).catch(error);\n        });\n      },\n      REQUEST_PREPARE_OUTPUT: function REQUEST_PREPARE_OUTPUT(_ref9) {\n        var item = _ref9.item,\n            success = _ref9.success,\n            _ref9$failure = _ref9.failure,\n            failure = _ref9$failure === void 0 ? function () {} : _ref9$failure; // error response if item archived\n\n        var err = {\n          error: createResponse('error', 0, 'Item not found'),\n          file: null\n        }; // don't handle archived items, an item could have been archived (load aborted) while waiting to be prepared\n\n        if (item.archived) return failure(err); // allow plugins to alter the file data\n\n        applyFilterChain('PREPARE_OUTPUT', item.file, {\n          query: query,\n          item: item\n        }).then(function (result) {\n          applyFilterChain('COMPLETE_PREPARE_OUTPUT', result, {\n            query: query,\n            item: item\n          }).then(function (result) {\n            // don't handle archived items, an item could have been archived (load aborted) while being prepared\n            if (item.archived) return failure(err); // we done!\n\n            success(result);\n          });\n        });\n      },\n      COMPLETE_LOAD_ITEM: function COMPLETE_LOAD_ITEM(_ref10) {\n        var item = _ref10.item,\n            data = _ref10.data;\n        var success = data.success,\n            source = data.source; // sort items in list\n\n        var itemInsertLocation = query('GET_ITEM_INSERT_LOCATION');\n\n        if (isFunction(itemInsertLocation) && source) {\n          sortItems(state, itemInsertLocation);\n        } // let interface know the item has loaded\n\n\n        dispatch('DID_LOAD_ITEM', {\n          id: item.id,\n          error: null,\n          serverFileReference: item.origin === FileOrigin.INPUT ? null : source\n        }); // item has been successfully loaded and added to the\n        // list of items so can now be safely returned for use\n\n        success(createItemAPI(item)); // if this is a local server file we need to show a different state\n\n        if (item.origin === FileOrigin.LOCAL) {\n          dispatch('DID_LOAD_LOCAL_ITEM', {\n            id: item.id\n          });\n          return;\n        } // if is a temp server file we prevent async upload call here (as the file is already on the server)\n\n\n        if (item.origin === FileOrigin.LIMBO) {\n          dispatch('DID_COMPLETE_ITEM_PROCESSING', {\n            id: item.id,\n            error: null,\n            serverFileReference: source\n          });\n          dispatch('DID_DEFINE_VALUE', {\n            id: item.id,\n            value: source\n          });\n          return;\n        } // id we are allowed to upload the file immidiately, lets do it\n\n\n        if (query('IS_ASYNC') && state.options.instantUpload) {\n          dispatch('REQUEST_ITEM_PROCESSING', {\n            query: item.id\n          });\n        }\n      },\n      RETRY_ITEM_LOAD: getItemByQueryFromState(state, function (item) {\n        // try loading the source one more time\n        item.retryLoad();\n      }),\n      REQUEST_ITEM_PREPARE: getItemByQueryFromState(state, function (item, _success, failure) {\n        dispatch('REQUEST_PREPARE_OUTPUT', {\n          query: item.id,\n          item: item,\n          success: function success(file) {\n            dispatch('DID_PREPARE_OUTPUT', {\n              id: item.id,\n              file: file\n            });\n\n            _success({\n              file: item,\n              output: file\n            });\n          },\n          failure: failure\n        }, true);\n      }),\n      REQUEST_ITEM_PROCESSING: getItemByQueryFromState(state, function (item, success, failure) {\n        // cannot be queued (or is already queued)\n        var itemCanBeQueuedForProcessing = // waiting for something\n        item.status === ItemStatus.IDLE || // processing went wrong earlier\n        item.status === ItemStatus.PROCESSING_ERROR; // not ready to be processed\n\n        if (!itemCanBeQueuedForProcessing) {\n          var processNow = function processNow() {\n            return dispatch('REQUEST_ITEM_PROCESSING', {\n              query: item,\n              success: success,\n              failure: failure\n            });\n          };\n\n          var process = function process() {\n            return document.hidden ? processNow() : setTimeout(processNow, 32);\n          }; // if already done processing or tried to revert but didn't work, try again\n\n\n          if (item.status === ItemStatus.PROCESSING_COMPLETE || item.status === ItemStatus.PROCESSING_REVERT_ERROR) {\n            item.revert(createRevertFunction(state.options.server.url, state.options.server.revert), query('GET_FORCE_REVERT')).then(process).catch(function () {}); // don't continue with processing if something went wrong\n          } else if (item.status === ItemStatus.PROCESSING) {\n            item.abortProcessing().then(process);\n          }\n\n          return;\n        } // already queued for processing\n\n\n        if (item.status === ItemStatus.PROCESSING_QUEUED) return;\n        item.requestProcessing();\n        dispatch('DID_REQUEST_ITEM_PROCESSING', {\n          id: item.id\n        });\n        dispatch('PROCESS_ITEM', {\n          query: item,\n          success: success,\n          failure: failure\n        }, true);\n      }),\n      PROCESS_ITEM: getItemByQueryFromState(state, function (item, success, failure) {\n        var maxParallelUploads = query('GET_MAX_PARALLEL_UPLOADS');\n        var totalCurrentUploads = query('GET_ITEMS_BY_STATUS', ItemStatus.PROCESSING).length; // queue and wait till queue is freed up\n\n        if (totalCurrentUploads === maxParallelUploads) {\n          // queue for later processing\n          state.processingQueue.push({\n            id: item.id,\n            success: success,\n            failure: failure\n          }); // stop it!\n\n          return;\n        } // if was not queued or is already processing exit here\n\n\n        if (item.status === ItemStatus.PROCESSING) return;\n\n        var processNext = function processNext() {\n          // process queueud items\n          var queueEntry = state.processingQueue.shift(); // no items left\n\n          if (!queueEntry) return; // get item reference\n\n          var id = queueEntry.id,\n              success = queueEntry.success,\n              failure = queueEntry.failure;\n          var itemReference = getItemByQuery(state.items, id); // if item was archived while in queue, jump to next\n\n          if (!itemReference || itemReference.archived) {\n            processNext();\n            return;\n          } // process queued item\n\n\n          dispatch('PROCESS_ITEM', {\n            query: id,\n            success: success,\n            failure: failure\n          }, true);\n        }; // we done function\n\n\n        item.onOnce('process-complete', function () {\n          success(createItemAPI(item));\n          processNext(); // All items processed? No errors?\n\n          var allItemsProcessed = query('GET_ITEMS_BY_STATUS', ItemStatus.PROCESSING_COMPLETE).length === state.items.length;\n\n          if (allItemsProcessed) {\n            dispatch('DID_COMPLETE_ITEM_PROCESSING_ALL');\n          }\n        }); // we error function\n\n        item.onOnce('process-error', function (error) {\n          failure({\n            error: error,\n            file: createItemAPI(item)\n          });\n          processNext();\n        }); // start file processing\n\n        var options = state.options;\n        item.process(createFileProcessor(createProcessorFunction(options.server.url, options.server.process, options.name, {\n          chunkTransferId: item.transferId,\n          chunkServer: options.server.patch,\n          chunkUploads: options.chunkUploads,\n          chunkForce: options.chunkForce,\n          chunkSize: options.chunkSize,\n          chunkRetryDelays: options.chunkRetryDelays\n        })), // called when the file is about to be processed so it can be piped through the transform filters\n        function (file, success, error) {\n          // allow plugins to alter the file data\n          applyFilterChain('PREPARE_OUTPUT', file, {\n            query: query,\n            item: item\n          }).then(function (file) {\n            dispatch('DID_PREPARE_OUTPUT', {\n              id: item.id,\n              file: file\n            });\n            success(file);\n          }).catch(error);\n        });\n      }),\n      RETRY_ITEM_PROCESSING: getItemByQueryFromState(state, function (item) {\n        dispatch('REQUEST_ITEM_PROCESSING', {\n          query: item\n        });\n      }),\n      REQUEST_REMOVE_ITEM: getItemByQueryFromState(state, function (item) {\n        optionalPromise(query('GET_BEFORE_REMOVE_FILE'), createItemAPI(item)).then(function (shouldRemove) {\n          if (!shouldRemove) {\n            return;\n          }\n\n          dispatch('REMOVE_ITEM', {\n            query: item\n          });\n        });\n      }),\n      RELEASE_ITEM: getItemByQueryFromState(state, function (item) {\n        item.release();\n      }),\n      REMOVE_ITEM: getItemByQueryFromState(state, function (item, success, failure, options) {\n        var removeFromView = function removeFromView() {\n          // get id reference\n          var id = item.id; // archive the item, this does not remove it from the list\n\n          getItemById(state.items, id).archive(); // tell the view the item has been removed\n\n          dispatch('DID_REMOVE_ITEM', {\n            error: null,\n            id: id,\n            item: item\n          }); // now the list has been modified\n\n          listUpdated(dispatch, state); // correctly removed\n\n          success(createItemAPI(item));\n        }; // if this is a local file and the server.remove function has been configured, send source there so dev can remove file from server\n\n\n        var server = state.options.server;\n\n        if (item.origin === FileOrigin.LOCAL && server && isFunction(server.remove) && options.remove !== false) {\n          dispatch('DID_START_ITEM_REMOVE', {\n            id: item.id\n          });\n          server.remove(item.source, function () {\n            return removeFromView();\n          }, function (status) {\n            dispatch('DID_THROW_ITEM_REMOVE_ERROR', {\n              id: item.id,\n              error: createResponse('error', 0, status, null),\n              status: {\n                main: dynamicLabel(state.options.labelFileRemoveError)(status),\n                sub: state.options.labelTapToRetry\n              }\n            });\n          });\n        } else {\n          // if is requesting revert and can revert need to call revert handler (not calling request_ because that would also trigger beforeRemoveHook)\n          if (options.revert && item.origin !== FileOrigin.LOCAL && item.serverId !== null) {\n            item.revert(createRevertFunction(state.options.server.url, state.options.server.revert), query('GET_FORCE_REVERT'));\n          } // can now safely remove from view\n\n\n          removeFromView();\n        }\n      }),\n      ABORT_ITEM_LOAD: getItemByQueryFromState(state, function (item) {\n        item.abortLoad();\n      }),\n      ABORT_ITEM_PROCESSING: getItemByQueryFromState(state, function (item) {\n        // test if is already processed\n        if (item.serverId) {\n          dispatch('REVERT_ITEM_PROCESSING', {\n            id: item.id\n          });\n          return;\n        } // abort\n\n\n        item.abortProcessing().then(function () {\n          var shouldRemove = state.options.instantUpload;\n\n          if (shouldRemove) {\n            dispatch('REMOVE_ITEM', {\n              query: item.id\n            });\n          }\n        });\n      }),\n      REQUEST_REVERT_ITEM_PROCESSING: getItemByQueryFromState(state, function (item) {\n        // not instant uploading, revert immidiately\n        if (!state.options.instantUpload) {\n          dispatch('REVERT_ITEM_PROCESSING', {\n            query: item\n          });\n          return;\n        } // if we're instant uploading the file will also be removed if we revert,\n        // so if a before remove file hook is defined we need to run it now\n\n\n        var handleRevert = function handleRevert(shouldRevert) {\n          if (!shouldRevert) return;\n          dispatch('REVERT_ITEM_PROCESSING', {\n            query: item\n          });\n        };\n\n        var fn = query('GET_BEFORE_REMOVE_FILE');\n\n        if (!fn) {\n          return handleRevert(true);\n        }\n\n        var requestRemoveResult = fn(createItemAPI(item));\n\n        if (requestRemoveResult == null) {\n          // undefined or null\n          return handleRevert(true);\n        }\n\n        if (typeof requestRemoveResult === 'boolean') {\n          return handleRevert(requestRemoveResult);\n        }\n\n        if (typeof requestRemoveResult.then === 'function') {\n          requestRemoveResult.then(handleRevert);\n        }\n      }),\n      REVERT_ITEM_PROCESSING: getItemByQueryFromState(state, function (item) {\n        item.revert(createRevertFunction(state.options.server.url, state.options.server.revert), query('GET_FORCE_REVERT')).then(function () {\n          var shouldRemove = state.options.instantUpload || isMockItem(item);\n\n          if (shouldRemove) {\n            dispatch('REMOVE_ITEM', {\n              query: item.id\n            });\n          }\n        }).catch(function () {});\n      }),\n      SET_OPTIONS: function SET_OPTIONS(_ref11) {\n        var options = _ref11.options;\n        forin(options, function (key, value) {\n          dispatch('SET_' + fromCamels(key, '_').toUpperCase(), {\n            value: value\n          });\n        });\n      }\n    };\n  };\n\n  var formatFilename = function formatFilename(name) {\n    return name;\n  };\n\n  var createElement$1 = function createElement(tagName) {\n    return document.createElement(tagName);\n  };\n\n  var text = function text(node, value) {\n    var textNode = node.childNodes[0];\n\n    if (!textNode) {\n      textNode = document.createTextNode(value);\n      node.appendChild(textNode);\n    } else if (value !== textNode.nodeValue) {\n      textNode.nodeValue = value;\n    }\n  };\n\n  var polarToCartesian = function polarToCartesian(centerX, centerY, radius, angleInDegrees) {\n    var angleInRadians = (angleInDegrees % 360 - 90) * Math.PI / 180.0;\n    return {\n      x: centerX + radius * Math.cos(angleInRadians),\n      y: centerY + radius * Math.sin(angleInRadians)\n    };\n  };\n\n  var describeArc = function describeArc(x, y, radius, startAngle, endAngle, arcSweep) {\n    var start = polarToCartesian(x, y, radius, endAngle);\n    var end = polarToCartesian(x, y, radius, startAngle);\n    return ['M', start.x, start.y, 'A', radius, radius, 0, arcSweep, 0, end.x, end.y].join(' ');\n  };\n\n  var percentageArc = function percentageArc(x, y, radius, from, to) {\n    var arcSweep = 1;\n\n    if (to > from && to - from <= 0.5) {\n      arcSweep = 0;\n    }\n\n    if (from > to && from - to >= 0.5) {\n      arcSweep = 0;\n    }\n\n    return describeArc(x, y, radius, Math.min(0.9999, from) * 360, Math.min(0.9999, to) * 360, arcSweep);\n  };\n\n  var create = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // start at 0\n\n    props.spin = false;\n    props.progress = 0;\n    props.opacity = 0; // svg\n\n    var svg = createElement('svg');\n    root.ref.path = createElement('path', {\n      'stroke-width': 2,\n      'stroke-linecap': 'round'\n    });\n    svg.appendChild(root.ref.path);\n    root.ref.svg = svg;\n    root.appendChild(svg);\n  };\n\n  var write = function write(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props;\n\n    if (props.opacity === 0) {\n      return;\n    }\n\n    if (props.align) {\n      root.element.dataset.align = props.align;\n    } // get width of stroke\n\n\n    var ringStrokeWidth = parseInt(attr(root.ref.path, 'stroke-width'), 10); // calculate size of ring\n\n    var size = root.rect.element.width * 0.5; // ring state\n\n    var ringFrom = 0;\n    var ringTo = 0; // now in busy mode\n\n    if (props.spin) {\n      ringFrom = 0;\n      ringTo = 0.5;\n    } else {\n      ringFrom = 0;\n      ringTo = props.progress;\n    } // get arc path\n\n\n    var coordinates = percentageArc(size, size, size - ringStrokeWidth, ringFrom, ringTo); // update progress bar\n\n    attr(root.ref.path, 'd', coordinates); // hide while contains 0 value\n\n    attr(root.ref.path, 'stroke-opacity', props.spin || props.progress > 0 ? 1 : 0);\n  };\n\n  var progressIndicator = createView({\n    tag: 'div',\n    name: 'progress-indicator',\n    ignoreRectUpdate: true,\n    ignoreRect: true,\n    create: create,\n    write: write,\n    mixins: {\n      apis: ['progress', 'spin', 'align'],\n      styles: ['opacity'],\n      animations: {\n        opacity: {\n          type: 'tween',\n          duration: 500\n        },\n        progress: {\n          type: 'spring',\n          stiffness: 0.95,\n          damping: 0.65,\n          mass: 10\n        }\n      }\n    }\n  });\n\n  var create$1 = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props;\n    root.element.innerHTML = (props.icon || '') + ('<span>' + props.label + '</span>');\n    props.isDisabled = false;\n  };\n\n  var write$1 = function write(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props;\n    var isDisabled = props.isDisabled;\n    var shouldDisable = root.query('GET_DISABLED') || props.opacity === 0;\n\n    if (shouldDisable && !isDisabled) {\n      props.isDisabled = true;\n      attr(root.element, 'disabled', 'disabled');\n    } else if (!shouldDisable && isDisabled) {\n      props.isDisabled = false;\n      root.element.removeAttribute('disabled');\n    }\n  };\n\n  var fileActionButton = createView({\n    tag: 'button',\n    attributes: {\n      type: 'button'\n    },\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    name: 'file-action-button',\n    mixins: {\n      apis: ['label'],\n      styles: ['translateX', 'translateY', 'scaleX', 'scaleY', 'opacity'],\n      animations: {\n        scaleX: 'spring',\n        scaleY: 'spring',\n        translateX: 'spring',\n        translateY: 'spring',\n        opacity: {\n          type: 'tween',\n          duration: 250\n        }\n      },\n      listeners: true\n    },\n    create: create$1,\n    write: write$1\n  });\n\n  var toNaturalFileSize = function toNaturalFileSize(bytes) {\n    var decimalSeparator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '.'; // nope, no negative byte sizes\n\n    bytes = Math.round(Math.abs(bytes)); // just bytes\n\n    if (bytes < 1000) {\n      return bytes + ' bytes';\n    } // kilobytes\n\n\n    if (bytes < MB) {\n      return Math.floor(bytes / KB) + ' KB';\n    } // megabytes\n\n\n    if (bytes < GB) {\n      return removeDecimalsWhenZero(bytes / MB, 1, decimalSeparator) + ' MB';\n    } // gigabytes\n\n\n    return removeDecimalsWhenZero(bytes / GB, 2, decimalSeparator) + ' GB';\n  };\n\n  var KB = 1000;\n  var MB = 1000000;\n  var GB = 1000000000;\n\n  var removeDecimalsWhenZero = function removeDecimalsWhenZero(value, decimalCount, separator) {\n    return value.toFixed(decimalCount).split('.').filter(function (part) {\n      return part !== '0';\n    }).join(separator);\n  };\n\n  var create$2 = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // filename\n\n    var fileName = createElement$1('span');\n    fileName.className = 'filepond--file-info-main'; // hide for screenreaders\n    // the file is contained in a fieldset with legend that contains the filename\n    // no need to read it twice\n\n    attr(fileName, 'aria-hidden', 'true');\n    root.appendChild(fileName);\n    root.ref.fileName = fileName; // filesize\n\n    var fileSize = createElement$1('span');\n    fileSize.className = 'filepond--file-info-sub';\n    root.appendChild(fileSize);\n    root.ref.fileSize = fileSize; // set initial values\n\n    text(fileSize, root.query('GET_LABEL_FILE_WAITING_FOR_SIZE'));\n    text(fileName, formatFilename(root.query('GET_ITEM_NAME', props.id)));\n  };\n\n  var updateFile = function updateFile(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props;\n    text(root.ref.fileSize, toNaturalFileSize(root.query('GET_ITEM_SIZE', props.id)));\n    text(root.ref.fileName, formatFilename(root.query('GET_ITEM_NAME', props.id)));\n  };\n\n  var updateFileSizeOnError = function updateFileSizeOnError(_ref3) {\n    var root = _ref3.root,\n        props = _ref3.props; // if size is available don't fallback to unknown size message\n\n    if (isInt(root.query('GET_ITEM_SIZE', props.id))) {\n      return;\n    }\n\n    text(root.ref.fileSize, root.query('GET_LABEL_FILE_SIZE_NOT_AVAILABLE'));\n  };\n\n  var fileInfo = createView({\n    name: 'file-info',\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    write: createRoute({\n      DID_LOAD_ITEM: updateFile,\n      DID_UPDATE_ITEM_META: updateFile,\n      DID_THROW_ITEM_LOAD_ERROR: updateFileSizeOnError,\n      DID_THROW_ITEM_INVALID: updateFileSizeOnError\n    }),\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, {\n        view: root\n      }));\n    },\n    create: create$2,\n    mixins: {\n      styles: ['translateX', 'translateY'],\n      animations: {\n        translateX: 'spring',\n        translateY: 'spring'\n      }\n    }\n  });\n\n  var toPercentage = function toPercentage(value) {\n    return Math.round(value * 100);\n  };\n\n  var create$3 = function create(_ref) {\n    var root = _ref.root; // main status\n\n    var main = createElement$1('span');\n    main.className = 'filepond--file-status-main';\n    root.appendChild(main);\n    root.ref.main = main; // sub status\n\n    var sub = createElement$1('span');\n    sub.className = 'filepond--file-status-sub';\n    root.appendChild(sub);\n    root.ref.sub = sub;\n    didSetItemLoadProgress({\n      root: root,\n      action: {\n        progress: null\n      }\n    });\n  };\n\n  var didSetItemLoadProgress = function didSetItemLoadProgress(_ref2) {\n    var root = _ref2.root,\n        action = _ref2.action;\n    var title = action.progress === null ? root.query('GET_LABEL_FILE_LOADING') : root.query('GET_LABEL_FILE_LOADING') + ' ' + toPercentage(action.progress) + '%';\n    text(root.ref.main, title);\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));\n  };\n\n  var didSetItemProcessProgress = function didSetItemProcessProgress(_ref3) {\n    var root = _ref3.root,\n        action = _ref3.action;\n    var title = action.progress === null ? root.query('GET_LABEL_FILE_PROCESSING') : root.query('GET_LABEL_FILE_PROCESSING') + ' ' + toPercentage(action.progress) + '%';\n    text(root.ref.main, title);\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));\n  };\n\n  var didRequestItemProcessing = function didRequestItemProcessing(_ref4) {\n    var root = _ref4.root;\n    text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING'));\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));\n  };\n\n  var didAbortItemProcessing = function didAbortItemProcessing(_ref5) {\n    var root = _ref5.root;\n    text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING_ABORTED'));\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_RETRY'));\n  };\n\n  var didCompleteItemProcessing = function didCompleteItemProcessing(_ref6) {\n    var root = _ref6.root;\n    text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING_COMPLETE'));\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_UNDO'));\n  };\n\n  var clear = function clear(_ref7) {\n    var root = _ref7.root;\n    text(root.ref.main, '');\n    text(root.ref.sub, '');\n  };\n\n  var error = function error(_ref8) {\n    var root = _ref8.root,\n        action = _ref8.action;\n    text(root.ref.main, action.status.main);\n    text(root.ref.sub, action.status.sub);\n  };\n\n  var fileStatus = createView({\n    name: 'file-status',\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    write: createRoute({\n      DID_LOAD_ITEM: clear,\n      DID_REVERT_ITEM_PROCESSING: clear,\n      DID_REQUEST_ITEM_PROCESSING: didRequestItemProcessing,\n      DID_ABORT_ITEM_PROCESSING: didAbortItemProcessing,\n      DID_COMPLETE_ITEM_PROCESSING: didCompleteItemProcessing,\n      DID_UPDATE_ITEM_PROCESS_PROGRESS: didSetItemProcessProgress,\n      DID_UPDATE_ITEM_LOAD_PROGRESS: didSetItemLoadProgress,\n      DID_THROW_ITEM_LOAD_ERROR: error,\n      DID_THROW_ITEM_INVALID: error,\n      DID_THROW_ITEM_PROCESSING_ERROR: error,\n      DID_THROW_ITEM_PROCESSING_REVERT_ERROR: error,\n      DID_THROW_ITEM_REMOVE_ERROR: error\n    }),\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, {\n        view: root\n      }));\n    },\n    create: create$3,\n    mixins: {\n      styles: ['translateX', 'translateY', 'opacity'],\n      animations: {\n        opacity: {\n          type: 'tween',\n          duration: 250\n        },\n        translateX: 'spring',\n        translateY: 'spring'\n      }\n    }\n  });\n  /**\n   * Button definitions for the file view\n   */\n\n  var Buttons = {\n    AbortItemLoad: {\n      label: 'GET_LABEL_BUTTON_ABORT_ITEM_LOAD',\n      action: 'ABORT_ITEM_LOAD',\n      className: 'filepond--action-abort-item-load',\n      align: 'LOAD_INDICATOR_POSITION' // right\n\n    },\n    RetryItemLoad: {\n      label: 'GET_LABEL_BUTTON_RETRY_ITEM_LOAD',\n      action: 'RETRY_ITEM_LOAD',\n      icon: 'GET_ICON_RETRY',\n      className: 'filepond--action-retry-item-load',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n\n    },\n    RemoveItem: {\n      label: 'GET_LABEL_BUTTON_REMOVE_ITEM',\n      action: 'REQUEST_REMOVE_ITEM',\n      icon: 'GET_ICON_REMOVE',\n      className: 'filepond--action-remove-item',\n      align: 'BUTTON_REMOVE_ITEM_POSITION' // left\n\n    },\n    ProcessItem: {\n      label: 'GET_LABEL_BUTTON_PROCESS_ITEM',\n      action: 'REQUEST_ITEM_PROCESSING',\n      icon: 'GET_ICON_PROCESS',\n      className: 'filepond--action-process-item',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n\n    },\n    AbortItemProcessing: {\n      label: 'GET_LABEL_BUTTON_ABORT_ITEM_PROCESSING',\n      action: 'ABORT_ITEM_PROCESSING',\n      className: 'filepond--action-abort-item-processing',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n\n    },\n    RetryItemProcessing: {\n      label: 'GET_LABEL_BUTTON_RETRY_ITEM_PROCESSING',\n      action: 'RETRY_ITEM_PROCESSING',\n      icon: 'GET_ICON_RETRY',\n      className: 'filepond--action-retry-item-processing',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n\n    },\n    RevertItemProcessing: {\n      label: 'GET_LABEL_BUTTON_UNDO_ITEM_PROCESSING',\n      action: 'REQUEST_REVERT_ITEM_PROCESSING',\n      icon: 'GET_ICON_UNDO',\n      className: 'filepond--action-revert-item-processing',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n\n    }\n  }; // make a list of buttons, we can then remove buttons from this list if they're disabled\n\n  var ButtonKeys = [];\n  forin(Buttons, function (key) {\n    ButtonKeys.push(key);\n  });\n\n  var calculateFileInfoOffset = function calculateFileInfoOffset(root) {\n    var buttonRect = root.ref.buttonRemoveItem.rect.element;\n    return buttonRect.hidden ? null : buttonRect.width + buttonRect.left;\n  };\n\n  var calculateButtonWidth = function calculateButtonWidth(root) {\n    var buttonRect = root.ref.buttonAbortItemLoad.rect.element;\n    return buttonRect.width;\n  }; // Force on full pixels so text stays crips\n\n\n  var calculateFileVerticalCenterOffset = function calculateFileVerticalCenterOffset(root) {\n    return Math.floor(root.ref.buttonRemoveItem.rect.element.height / 4);\n  };\n\n  var calculateFileHorizontalCenterOffset = function calculateFileHorizontalCenterOffset(root) {\n    return Math.floor(root.ref.buttonRemoveItem.rect.element.left / 2);\n  };\n\n  var getLoadIndicatorAlignment = function getLoadIndicatorAlignment(root) {\n    return root.query('GET_STYLE_LOAD_INDICATOR_POSITION');\n  };\n\n  var getProcessIndicatorAlignment = function getProcessIndicatorAlignment(root) {\n    return root.query('GET_STYLE_PROGRESS_INDICATOR_POSITION');\n  };\n\n  var getRemoveIndicatorAligment = function getRemoveIndicatorAligment(root) {\n    return root.query('GET_STYLE_BUTTON_REMOVE_ITEM_POSITION');\n  };\n\n  var DefaultStyle = {\n    buttonAbortItemLoad: {\n      opacity: 0\n    },\n    buttonRetryItemLoad: {\n      opacity: 0\n    },\n    buttonRemoveItem: {\n      opacity: 0\n    },\n    buttonProcessItem: {\n      opacity: 0\n    },\n    buttonAbortItemProcessing: {\n      opacity: 0\n    },\n    buttonRetryItemProcessing: {\n      opacity: 0\n    },\n    buttonRevertItemProcessing: {\n      opacity: 0\n    },\n    loadProgressIndicator: {\n      opacity: 0,\n      align: getLoadIndicatorAlignment\n    },\n    processProgressIndicator: {\n      opacity: 0,\n      align: getProcessIndicatorAlignment\n    },\n    processingCompleteIndicator: {\n      opacity: 0,\n      scaleX: 0.75,\n      scaleY: 0.75\n    },\n    info: {\n      translateX: 0,\n      translateY: 0,\n      opacity: 0\n    },\n    status: {\n      translateX: 0,\n      translateY: 0,\n      opacity: 0\n    }\n  };\n  var IdleStyle = {\n    buttonRemoveItem: {\n      opacity: 1\n    },\n    buttonProcessItem: {\n      opacity: 1\n    },\n    info: {\n      translateX: calculateFileInfoOffset\n    },\n    status: {\n      translateX: calculateFileInfoOffset\n    }\n  };\n  var ProcessingStyle = {\n    buttonAbortItemProcessing: {\n      opacity: 1\n    },\n    processProgressIndicator: {\n      opacity: 1\n    },\n    status: {\n      opacity: 1\n    }\n  };\n  var StyleMap = {\n    DID_THROW_ITEM_INVALID: {\n      buttonRemoveItem: {\n        opacity: 1\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      },\n      status: {\n        translateX: calculateFileInfoOffset,\n        opacity: 1\n      }\n    },\n    DID_START_ITEM_LOAD: {\n      buttonAbortItemLoad: {\n        opacity: 1\n      },\n      loadProgressIndicator: {\n        opacity: 1\n      },\n      status: {\n        opacity: 1\n      }\n    },\n    DID_THROW_ITEM_LOAD_ERROR: {\n      buttonRetryItemLoad: {\n        opacity: 1\n      },\n      buttonRemoveItem: {\n        opacity: 1\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      },\n      status: {\n        opacity: 1\n      }\n    },\n    DID_START_ITEM_REMOVE: {\n      processProgressIndicator: {\n        opacity: 1,\n        align: getRemoveIndicatorAligment\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      },\n      status: {\n        opacity: 0\n      }\n    },\n    DID_THROW_ITEM_REMOVE_ERROR: {\n      processProgressIndicator: {\n        opacity: 0,\n        align: getRemoveIndicatorAligment\n      },\n      buttonRemoveItem: {\n        opacity: 1\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      },\n      status: {\n        opacity: 1,\n        translateX: calculateFileInfoOffset\n      }\n    },\n    DID_LOAD_ITEM: IdleStyle,\n    DID_LOAD_LOCAL_ITEM: {\n      buttonRemoveItem: {\n        opacity: 1\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      },\n      status: {\n        translateX: calculateFileInfoOffset\n      }\n    },\n    DID_START_ITEM_PROCESSING: ProcessingStyle,\n    DID_REQUEST_ITEM_PROCESSING: ProcessingStyle,\n    DID_UPDATE_ITEM_PROCESS_PROGRESS: ProcessingStyle,\n    DID_COMPLETE_ITEM_PROCESSING: {\n      buttonRevertItemProcessing: {\n        opacity: 1\n      },\n      info: {\n        opacity: 1\n      },\n      status: {\n        opacity: 1\n      }\n    },\n    DID_THROW_ITEM_PROCESSING_ERROR: {\n      buttonRemoveItem: {\n        opacity: 1\n      },\n      buttonRetryItemProcessing: {\n        opacity: 1\n      },\n      status: {\n        opacity: 1\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      }\n    },\n    DID_THROW_ITEM_PROCESSING_REVERT_ERROR: {\n      buttonRevertItemProcessing: {\n        opacity: 1\n      },\n      status: {\n        opacity: 1\n      },\n      info: {\n        opacity: 1\n      }\n    },\n    DID_ABORT_ITEM_PROCESSING: {\n      buttonRemoveItem: {\n        opacity: 1\n      },\n      buttonProcessItem: {\n        opacity: 1\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      },\n      status: {\n        opacity: 1\n      }\n    },\n    DID_REVERT_ITEM_PROCESSING: IdleStyle\n  }; // complete indicator view\n\n  var processingCompleteIndicatorView = createView({\n    create: function create(_ref) {\n      var root = _ref.root;\n      root.element.innerHTML = root.query('GET_ICON_DONE');\n    },\n    name: 'processing-complete-indicator',\n    ignoreRect: true,\n    mixins: {\n      styles: ['scaleX', 'scaleY', 'opacity'],\n      animations: {\n        scaleX: 'spring',\n        scaleY: 'spring',\n        opacity: {\n          type: 'tween',\n          duration: 250\n        }\n      }\n    }\n  });\n  /**\n   * Creates the file view\n   */\n\n  var create$4 = function create(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props;\n    var id = props.id; // allow reverting upload\n\n    var allowRevert = root.query('GET_ALLOW_REVERT'); // allow remove file\n\n    var allowRemove = root.query('GET_ALLOW_REMOVE'); // allow processing upload\n\n    var allowProcess = root.query('GET_ALLOW_PROCESS'); // is instant uploading, need this to determine the icon of the undo button\n\n    var instantUpload = root.query('GET_INSTANT_UPLOAD'); // is async set up\n\n    var isAsync = root.query('IS_ASYNC'); // should align remove item buttons\n\n    var alignRemoveItemButton = root.query('GET_STYLE_BUTTON_REMOVE_ITEM_ALIGN'); // enabled buttons array\n\n    var buttonFilter;\n\n    if (isAsync) {\n      if (allowProcess && !allowRevert) {\n        // only remove revert button\n        buttonFilter = function buttonFilter(key) {\n          return !/RevertItemProcessing/.test(key);\n        };\n      } else if (!allowProcess && allowRevert) {\n        // only remove process button\n        buttonFilter = function buttonFilter(key) {\n          return !/ProcessItem|RetryItemProcessing|AbortItemProcessing/.test(key);\n        };\n      } else if (!allowProcess && !allowRevert) {\n        // remove all process buttons\n        buttonFilter = function buttonFilter(key) {\n          return !/Process/.test(key);\n        };\n      }\n    } else {\n      // no process controls available\n      buttonFilter = function buttonFilter(key) {\n        return !/Process/.test(key);\n      };\n    }\n\n    var enabledButtons = buttonFilter ? ButtonKeys.filter(buttonFilter) : ButtonKeys.concat(); // update icon and label for revert button when instant uploading\n\n    if (instantUpload && allowRevert) {\n      Buttons['RevertItemProcessing'].label = 'GET_LABEL_BUTTON_REMOVE_ITEM';\n      Buttons['RevertItemProcessing'].icon = 'GET_ICON_REMOVE';\n    } // remove last button (revert) if not allowed\n\n\n    if (isAsync && !allowRevert) {\n      var map = StyleMap['DID_COMPLETE_ITEM_PROCESSING'];\n      map.info.translateX = calculateFileHorizontalCenterOffset;\n      map.info.translateY = calculateFileVerticalCenterOffset;\n      map.status.translateY = calculateFileVerticalCenterOffset;\n      map.processingCompleteIndicator = {\n        opacity: 1,\n        scaleX: 1,\n        scaleY: 1\n      };\n    } // should align center\n\n\n    if (isAsync && !allowProcess) {\n      ['DID_START_ITEM_PROCESSING', 'DID_REQUEST_ITEM_PROCESSING', 'DID_UPDATE_ITEM_PROCESS_PROGRESS', 'DID_THROW_ITEM_PROCESSING_ERROR'].forEach(function (key) {\n        StyleMap[key].status.translateY = calculateFileVerticalCenterOffset;\n      });\n      StyleMap['DID_THROW_ITEM_PROCESSING_ERROR'].status.translateX = calculateButtonWidth;\n    } // move remove button to right\n\n\n    if (alignRemoveItemButton && allowRevert) {\n      Buttons['RevertItemProcessing'].align = 'BUTTON_REMOVE_ITEM_POSITION';\n      var _map = StyleMap['DID_COMPLETE_ITEM_PROCESSING'];\n      _map.info.translateX = calculateFileInfoOffset;\n      _map.status.translateY = calculateFileVerticalCenterOffset;\n      _map.processingCompleteIndicator = {\n        opacity: 1,\n        scaleX: 1,\n        scaleY: 1\n      };\n    }\n\n    if (!allowRemove) {\n      Buttons['RemoveItem'].disabled = true;\n    } // create the button views\n\n\n    forin(Buttons, function (key, definition) {\n      // create button\n      var buttonView = root.createChildView(fileActionButton, {\n        label: root.query(definition.label),\n        icon: root.query(definition.icon),\n        opacity: 0\n      }); // should be appended?\n\n      if (enabledButtons.includes(key)) {\n        root.appendChildView(buttonView);\n      } // toggle\n\n\n      if (definition.disabled) {\n        buttonView.element.setAttribute('disabled', 'disabled');\n        buttonView.element.setAttribute('hidden', 'hidden');\n      } // add position attribute\n\n\n      buttonView.element.dataset.align = root.query('GET_STYLE_' + definition.align); // add class\n\n      buttonView.element.classList.add(definition.className); // handle interactions\n\n      buttonView.on('click', function (e) {\n        e.stopPropagation();\n        if (definition.disabled) return;\n        root.dispatch(definition.action, {\n          query: id\n        });\n      }); // set reference\n\n      root.ref['button' + key] = buttonView;\n    }); // checkmark\n\n    root.ref.processingCompleteIndicator = root.appendChildView(root.createChildView(processingCompleteIndicatorView));\n    root.ref.processingCompleteIndicator.element.dataset.align = root.query('GET_STYLE_BUTTON_PROCESS_ITEM_POSITION'); // create file info view\n\n    root.ref.info = root.appendChildView(root.createChildView(fileInfo, {\n      id: id\n    })); // create file status view\n\n    root.ref.status = root.appendChildView(root.createChildView(fileStatus, {\n      id: id\n    })); // add progress indicators\n\n    var loadIndicatorView = root.appendChildView(root.createChildView(progressIndicator, {\n      opacity: 0,\n      align: root.query('GET_STYLE_LOAD_INDICATOR_POSITION')\n    }));\n    loadIndicatorView.element.classList.add('filepond--load-indicator');\n    root.ref.loadProgressIndicator = loadIndicatorView;\n    var progressIndicatorView = root.appendChildView(root.createChildView(progressIndicator, {\n      opacity: 0,\n      align: root.query('GET_STYLE_PROGRESS_INDICATOR_POSITION')\n    }));\n    progressIndicatorView.element.classList.add('filepond--process-indicator');\n    root.ref.processProgressIndicator = progressIndicatorView; // current active styles\n\n    root.ref.activeStyles = [];\n  };\n\n  var write$2 = function write(_ref3) {\n    var root = _ref3.root,\n        actions = _ref3.actions,\n        props = _ref3.props; // route actions\n\n    route({\n      root: root,\n      actions: actions,\n      props: props\n    }); // select last state change action\n\n    var action = actions.concat().filter(function (action) {\n      return /^DID_/.test(action.type);\n    }).reverse().find(function (action) {\n      return StyleMap[action.type];\n    }); // a new action happened, let's get the matching styles\n\n    if (action) {\n      // define new active styles\n      root.ref.activeStyles = [];\n      var stylesToApply = StyleMap[action.type];\n      forin(DefaultStyle, function (name, defaultStyles) {\n        // get reference to control\n        var control = root.ref[name]; // loop over all styles for this control\n\n        forin(defaultStyles, function (key, defaultValue) {\n          var value = stylesToApply[name] && typeof stylesToApply[name][key] !== 'undefined' ? stylesToApply[name][key] : defaultValue;\n          root.ref.activeStyles.push({\n            control: control,\n            key: key,\n            value: value\n          });\n        });\n      });\n    } // apply active styles to element\n\n\n    root.ref.activeStyles.forEach(function (_ref4) {\n      var control = _ref4.control,\n          key = _ref4.key,\n          value = _ref4.value;\n      control[key] = typeof value === 'function' ? value(root) : value;\n    });\n  };\n\n  var route = createRoute({\n    DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING: function DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING(_ref5) {\n      var root = _ref5.root,\n          action = _ref5.action;\n      root.ref.buttonAbortItemProcessing.label = action.value;\n    },\n    DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD: function DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD(_ref6) {\n      var root = _ref6.root,\n          action = _ref6.action;\n      root.ref.buttonAbortItemLoad.label = action.value;\n    },\n    DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL: function DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL(_ref7) {\n      var root = _ref7.root,\n          action = _ref7.action;\n      root.ref.buttonAbortItemRemoval.label = action.value;\n    },\n    DID_REQUEST_ITEM_PROCESSING: function DID_REQUEST_ITEM_PROCESSING(_ref8) {\n      var root = _ref8.root;\n      root.ref.processProgressIndicator.spin = true;\n      root.ref.processProgressIndicator.progress = 0;\n    },\n    DID_START_ITEM_LOAD: function DID_START_ITEM_LOAD(_ref9) {\n      var root = _ref9.root;\n      root.ref.loadProgressIndicator.spin = true;\n      root.ref.loadProgressIndicator.progress = 0;\n    },\n    DID_START_ITEM_REMOVE: function DID_START_ITEM_REMOVE(_ref10) {\n      var root = _ref10.root;\n      root.ref.processProgressIndicator.spin = true;\n      root.ref.processProgressIndicator.progress = 0;\n    },\n    DID_UPDATE_ITEM_LOAD_PROGRESS: function DID_UPDATE_ITEM_LOAD_PROGRESS(_ref11) {\n      var root = _ref11.root,\n          action = _ref11.action;\n      root.ref.loadProgressIndicator.spin = false;\n      root.ref.loadProgressIndicator.progress = action.progress;\n    },\n    DID_UPDATE_ITEM_PROCESS_PROGRESS: function DID_UPDATE_ITEM_PROCESS_PROGRESS(_ref12) {\n      var root = _ref12.root,\n          action = _ref12.action;\n      root.ref.processProgressIndicator.spin = false;\n      root.ref.processProgressIndicator.progress = action.progress;\n    }\n  });\n  var file = createView({\n    create: create$4,\n    write: write$2,\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, {\n        view: root\n      }));\n    },\n    name: 'file'\n  });\n  /**\n   * Creates the file view\n   */\n\n  var create$5 = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // filename\n\n    root.ref.fileName = createElement$1('legend');\n    root.appendChild(root.ref.fileName); // file appended\n\n    root.ref.file = root.appendChildView(root.createChildView(file, {\n      id: props.id\n    })); // data has moved to data.js\n\n    root.ref.data = false;\n  };\n  /**\n   * Data storage\n   */\n\n\n  var didLoadItem = function didLoadItem(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props; // updates the legend of the fieldset so screenreaders can better group buttons\n\n    text(root.ref.fileName, formatFilename(root.query('GET_ITEM_NAME', props.id)));\n  };\n\n  var fileWrapper = createView({\n    create: create$5,\n    ignoreRect: true,\n    write: createRoute({\n      DID_LOAD_ITEM: didLoadItem\n    }),\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, {\n        view: root\n      }));\n    },\n    tag: 'fieldset',\n    name: 'file-wrapper'\n  });\n  var PANEL_SPRING_PROPS = {\n    type: 'spring',\n    damping: 0.6,\n    mass: 7\n  };\n\n  var create$6 = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props;\n    [{\n      name: 'top'\n    }, {\n      name: 'center',\n      props: {\n        translateY: null,\n        scaleY: null\n      },\n      mixins: {\n        animations: {\n          scaleY: PANEL_SPRING_PROPS\n        },\n        styles: ['translateY', 'scaleY']\n      }\n    }, {\n      name: 'bottom',\n      props: {\n        translateY: null\n      },\n      mixins: {\n        animations: {\n          translateY: PANEL_SPRING_PROPS\n        },\n        styles: ['translateY']\n      }\n    }].forEach(function (section) {\n      createSection(root, section, props.name);\n    });\n    root.element.classList.add('filepond--' + props.name);\n    root.ref.scalable = null;\n  };\n\n  var createSection = function createSection(root, section, className) {\n    var viewConstructor = createView({\n      name: 'panel-' + section.name + ' filepond--' + className,\n      mixins: section.mixins,\n      ignoreRectUpdate: true\n    });\n    var view = root.createChildView(viewConstructor, section.props);\n    root.ref[section.name] = root.appendChildView(view);\n  };\n\n  var write$3 = function write(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props; // update scalable state\n\n    if (root.ref.scalable === null || props.scalable !== root.ref.scalable) {\n      root.ref.scalable = isBoolean(props.scalable) ? props.scalable : true;\n      root.element.dataset.scalable = root.ref.scalable;\n    } // no height, can't set\n\n\n    if (!props.height) return; // get child rects\n\n    var topRect = root.ref.top.rect.element;\n    var bottomRect = root.ref.bottom.rect.element; // make sure height never is smaller than bottom and top seciton heights combined (will probably never happen, but who knows)\n\n    var height = Math.max(topRect.height + bottomRect.height, props.height); // offset center part\n\n    root.ref.center.translateY = topRect.height; // scale center part\n    // use math ceil to prevent transparent lines because of rounding errors\n\n    root.ref.center.scaleY = (height - topRect.height - bottomRect.height) / 100; // offset bottom part\n\n    root.ref.bottom.translateY = height - bottomRect.height;\n  };\n\n  var panel = createView({\n    name: 'panel',\n    write: write$3,\n    create: create$6,\n    ignoreRect: true,\n    mixins: {\n      apis: ['height', 'scalable']\n    }\n  });\n\n  var createDragHelper = function createDragHelper(items) {\n    var itemIds = items.map(function (item) {\n      return item.id;\n    });\n    var prevIndex = undefined;\n    return {\n      setIndex: function setIndex(index) {\n        prevIndex = index;\n      },\n      getIndex: function getIndex() {\n        return prevIndex;\n      },\n      getItemIndex: function getItemIndex(item) {\n        return itemIds.indexOf(item.id);\n      }\n    };\n  };\n\n  var ITEM_TRANSLATE_SPRING = {\n    type: 'spring',\n    stiffness: 0.75,\n    damping: 0.45,\n    mass: 10\n  };\n  var ITEM_SCALE_SPRING = 'spring';\n  var StateMap = {\n    DID_START_ITEM_LOAD: 'busy',\n    DID_UPDATE_ITEM_LOAD_PROGRESS: 'loading',\n    DID_THROW_ITEM_INVALID: 'load-invalid',\n    DID_THROW_ITEM_LOAD_ERROR: 'load-error',\n    DID_LOAD_ITEM: 'idle',\n    DID_THROW_ITEM_REMOVE_ERROR: 'remove-error',\n    DID_START_ITEM_REMOVE: 'busy',\n    DID_START_ITEM_PROCESSING: 'busy processing',\n    DID_REQUEST_ITEM_PROCESSING: 'busy processing',\n    DID_UPDATE_ITEM_PROCESS_PROGRESS: 'processing',\n    DID_COMPLETE_ITEM_PROCESSING: 'processing-complete',\n    DID_THROW_ITEM_PROCESSING_ERROR: 'processing-error',\n    DID_THROW_ITEM_PROCESSING_REVERT_ERROR: 'processing-revert-error',\n    DID_ABORT_ITEM_PROCESSING: 'cancelled',\n    DID_REVERT_ITEM_PROCESSING: 'idle'\n  };\n  /**\n   * Creates the file view\n   */\n\n  var create$7 = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // select\n\n    root.ref.handleClick = function (e) {\n      return root.dispatch('DID_ACTIVATE_ITEM', {\n        id: props.id\n      });\n    }; // set id\n\n\n    root.element.id = 'filepond--item-' + props.id;\n    root.element.addEventListener('click', root.ref.handleClick); // file view\n\n    root.ref.container = root.appendChildView(root.createChildView(fileWrapper, {\n      id: props.id\n    })); // file panel\n\n    root.ref.panel = root.appendChildView(root.createChildView(panel, {\n      name: 'item-panel'\n    })); // default start height\n\n    root.ref.panel.height = null; // by default not marked for removal\n\n    props.markedForRemoval = false; // if not allowed to reorder file items, exit here\n\n    if (!root.query('GET_ALLOW_REORDER')) return; // set to idle so shows grab cursor\n\n    root.element.dataset.dragState = 'idle';\n\n    var grab = function grab(e) {\n      if (!e.isPrimary) return;\n      var removedActivateListener = false;\n      var origin = {\n        x: e.pageX,\n        y: e.pageY\n      };\n      props.dragOrigin = {\n        x: root.translateX,\n        y: root.translateY\n      };\n      props.dragCenter = {\n        x: e.offsetX,\n        y: e.offsetY\n      };\n      var dragState = createDragHelper(root.query('GET_ACTIVE_ITEMS'));\n      root.dispatch('DID_GRAB_ITEM', {\n        id: props.id,\n        dragState: dragState\n      });\n\n      var drag = function drag(e) {\n        if (!e.isPrimary) return;\n        e.stopPropagation();\n        e.preventDefault();\n        props.dragOffset = {\n          x: e.pageX - origin.x,\n          y: e.pageY - origin.y\n        }; // if dragged stop listening to clicks, will re-add when done dragging\n\n        var dist = props.dragOffset.x * props.dragOffset.x + props.dragOffset.y * props.dragOffset.y;\n\n        if (dist > 16 && !removedActivateListener) {\n          removedActivateListener = true;\n          root.element.removeEventListener('click', root.ref.handleClick);\n        }\n\n        root.dispatch('DID_DRAG_ITEM', {\n          id: props.id,\n          dragState: dragState\n        });\n      };\n\n      var drop = function drop(e) {\n        if (!e.isPrimary) return;\n        document.removeEventListener('pointermove', drag);\n        document.removeEventListener('pointerup', drop);\n        props.dragOffset = {\n          x: e.pageX - origin.x,\n          y: e.pageY - origin.y\n        };\n        root.dispatch('DID_DROP_ITEM', {\n          id: props.id,\n          dragState: dragState\n        }); // start listening to clicks again\n\n        if (removedActivateListener) {\n          setTimeout(function () {\n            return root.element.addEventListener('click', root.ref.handleClick);\n          }, 0);\n        }\n      };\n\n      document.addEventListener('pointermove', drag);\n      document.addEventListener('pointerup', drop);\n    };\n\n    root.element.addEventListener('pointerdown', grab);\n  };\n\n  var route$1 = createRoute({\n    DID_UPDATE_PANEL_HEIGHT: function DID_UPDATE_PANEL_HEIGHT(_ref2) {\n      var root = _ref2.root,\n          action = _ref2.action;\n      root.height = action.height;\n    }\n  });\n  var write$4 = createRoute({\n    DID_GRAB_ITEM: function DID_GRAB_ITEM(_ref3) {\n      var root = _ref3.root,\n          props = _ref3.props;\n      props.dragOrigin = {\n        x: root.translateX,\n        y: root.translateY\n      };\n    },\n    DID_DRAG_ITEM: function DID_DRAG_ITEM(_ref4) {\n      var root = _ref4.root;\n      root.element.dataset.dragState = 'drag';\n    },\n    DID_DROP_ITEM: function DID_DROP_ITEM(_ref5) {\n      var root = _ref5.root,\n          props = _ref5.props;\n      props.dragOffset = null;\n      props.dragOrigin = null;\n      root.element.dataset.dragState = 'drop';\n    }\n  }, function (_ref6) {\n    var root = _ref6.root,\n        actions = _ref6.actions,\n        props = _ref6.props,\n        shouldOptimize = _ref6.shouldOptimize;\n\n    if (root.element.dataset.dragState === 'drop') {\n      if (root.scaleX <= 1) {\n        root.element.dataset.dragState = 'idle';\n      }\n    } // select last state change action\n\n\n    var action = actions.concat().filter(function (action) {\n      return /^DID_/.test(action.type);\n    }).reverse().find(function (action) {\n      return StateMap[action.type];\n    }); // no need to set same state twice\n\n    if (action && action.type !== props.currentState) {\n      // set current state\n      props.currentState = action.type; // set state\n\n      root.element.dataset.filepondItemState = StateMap[props.currentState] || '';\n    } // route actions\n\n\n    var aspectRatio = root.query('GET_ITEM_PANEL_ASPECT_RATIO') || root.query('GET_PANEL_ASPECT_RATIO');\n\n    if (!aspectRatio) {\n      route$1({\n        root: root,\n        actions: actions,\n        props: props\n      });\n\n      if (!root.height && root.ref.container.rect.element.height > 0) {\n        root.height = root.ref.container.rect.element.height;\n      }\n    } else if (!shouldOptimize) {\n      root.height = root.rect.element.width * aspectRatio;\n    } // sync panel height with item height\n\n\n    if (shouldOptimize) {\n      root.ref.panel.height = null;\n    }\n\n    root.ref.panel.height = root.height;\n  });\n  var item = createView({\n    create: create$7,\n    write: write$4,\n    destroy: function destroy(_ref7) {\n      var root = _ref7.root,\n          props = _ref7.props;\n      root.element.removeEventListener('click', root.ref.handleClick);\n      root.dispatch('RELEASE_ITEM', {\n        query: props.id\n      });\n    },\n    tag: 'li',\n    name: 'item',\n    mixins: {\n      apis: ['id', 'interactionMethod', 'markedForRemoval', 'spawnDate', 'dragCenter', 'dragOrigin', 'dragOffset'],\n      styles: ['translateX', 'translateY', 'scaleX', 'scaleY', 'opacity', 'height'],\n      animations: {\n        scaleX: ITEM_SCALE_SPRING,\n        scaleY: ITEM_SCALE_SPRING,\n        translateX: ITEM_TRANSLATE_SPRING,\n        translateY: ITEM_TRANSLATE_SPRING,\n        opacity: {\n          type: 'tween',\n          duration: 150\n        }\n      }\n    }\n  });\n\n  var getItemIndexByPosition = function getItemIndexByPosition(view, children, positionInView) {\n    if (!positionInView) return;\n    var horizontalSpace = view.rect.element.width; // const children = view.childViews;\n\n    var l = children.length;\n    var last = null; // -1, don't move items to accomodate (either add to top or bottom)\n\n    if (l === 0 || positionInView.top < children[0].rect.element.top) return -1; // let's get the item width\n\n    var item = children[0];\n    var itemRect = item.rect.element;\n    var itemHorizontalMargin = itemRect.marginLeft + itemRect.marginRight;\n    var itemWidth = itemRect.width + itemHorizontalMargin;\n    var itemsPerRow = Math.round(horizontalSpace / itemWidth); // stack\n\n    if (itemsPerRow === 1) {\n      for (var index = 0; index < l; index++) {\n        var child = children[index];\n        var childMid = child.rect.outer.top + child.rect.element.height * 0.5;\n\n        if (positionInView.top < childMid) {\n          return index;\n        }\n      }\n\n      return l;\n    } // grid\n\n\n    var itemVerticalMargin = itemRect.marginTop + itemRect.marginBottom;\n    var itemHeight = itemRect.height + itemVerticalMargin;\n\n    for (var _index = 0; _index < l; _index++) {\n      var indexX = _index % itemsPerRow;\n      var indexY = Math.floor(_index / itemsPerRow);\n      var offsetX = indexX * itemWidth;\n      var offsetY = indexY * itemHeight;\n      var itemTop = offsetY - itemRect.marginTop;\n      var itemRight = offsetX + itemWidth;\n      var itemBottom = offsetY + itemHeight + itemRect.marginBottom;\n\n      if (positionInView.top < itemBottom && positionInView.top > itemTop) {\n        if (positionInView.left < itemRight) {\n          return _index;\n        } else if (_index !== l - 1) {\n          last = _index;\n        } else {\n          last = null;\n        }\n      }\n    }\n\n    if (last !== null) {\n      return last;\n    }\n\n    return l;\n  };\n\n  var dropAreaDimensions = {\n    height: 0,\n    width: 0,\n\n    get getHeight() {\n      return this.height;\n    },\n\n    set setHeight(val) {\n      if (this.height === 0 || val === 0) this.height = val;\n    },\n\n    get getWidth() {\n      return this.width;\n    },\n\n    set setWidth(val) {\n      if (this.width === 0 || val === 0) this.width = val;\n    },\n\n    setDimensions: function setDimensions(height, width) {\n      if (this.height === 0 || height === 0) this.height = height;\n      if (this.width === 0 || width === 0) this.width = width;\n    }\n  };\n\n  var create$8 = function create(_ref) {\n    var root = _ref.root; // need to set role to list as otherwise it won't be read as a list by VoiceOver\n\n    attr(root.element, 'role', 'list');\n    root.ref.lastItemSpanwDate = Date.now();\n  };\n  /**\n   * Inserts a new item\n   * @param root\n   * @param action\n   */\n\n\n  var addItemView = function addItemView(_ref2) {\n    var root = _ref2.root,\n        action = _ref2.action;\n    var id = action.id,\n        index = action.index,\n        interactionMethod = action.interactionMethod;\n    root.ref.addIndex = index;\n    var now = Date.now();\n    var spawnDate = now;\n    var opacity = 1;\n\n    if (interactionMethod !== InteractionMethod.NONE) {\n      opacity = 0;\n      var cooldown = root.query('GET_ITEM_INSERT_INTERVAL');\n      var dist = now - root.ref.lastItemSpanwDate;\n      spawnDate = dist < cooldown ? now + (cooldown - dist) : now;\n    }\n\n    root.ref.lastItemSpanwDate = spawnDate;\n    root.appendChildView(root.createChildView( // view type\n    item, // props\n    {\n      spawnDate: spawnDate,\n      id: id,\n      opacity: opacity,\n      interactionMethod: interactionMethod\n    }), index);\n  };\n\n  var moveItem = function moveItem(item, x, y) {\n    var vx = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n    var vy = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 1; // set to null to remove animation while dragging\n\n    if (item.dragOffset) {\n      item.translateX = null;\n      item.translateY = null;\n      item.translateX = item.dragOrigin.x + item.dragOffset.x;\n      item.translateY = item.dragOrigin.y + item.dragOffset.y;\n      item.scaleX = 1.025;\n      item.scaleY = 1.025;\n    } else {\n      item.translateX = x;\n      item.translateY = y;\n\n      if (Date.now() > item.spawnDate) {\n        // reveal element\n        if (item.opacity === 0) {\n          introItemView(item, x, y, vx, vy);\n        } // make sure is default scale every frame\n\n\n        item.scaleX = 1;\n        item.scaleY = 1;\n        item.opacity = 1;\n      }\n    }\n  };\n\n  var introItemView = function introItemView(item, x, y, vx, vy) {\n    if (item.interactionMethod === InteractionMethod.NONE) {\n      item.translateX = null;\n      item.translateX = x;\n      item.translateY = null;\n      item.translateY = y;\n    } else if (item.interactionMethod === InteractionMethod.DROP) {\n      item.translateX = null;\n      item.translateX = x - vx * 20;\n      item.translateY = null;\n      item.translateY = y - vy * 10;\n      item.scaleX = 0.8;\n      item.scaleY = 0.8;\n    } else if (item.interactionMethod === InteractionMethod.BROWSE) {\n      item.translateY = null;\n      item.translateY = y - 30;\n    } else if (item.interactionMethod === InteractionMethod.API) {\n      item.translateX = null;\n      item.translateX = x - 30;\n      item.translateY = null;\n    }\n  };\n  /**\n   * Removes an existing item\n   * @param root\n   * @param action\n   */\n\n\n  var removeItemView = function removeItemView(_ref3) {\n    var root = _ref3.root,\n        action = _ref3.action;\n    var id = action.id; // get the view matching the given id\n\n    var view = root.childViews.find(function (child) {\n      return child.id === id;\n    }); // if no view found, exit\n\n    if (!view) {\n      return;\n    } // animate view out of view\n\n\n    view.scaleX = 0.9;\n    view.scaleY = 0.9;\n    view.opacity = 0; // mark for removal\n\n    view.markedForRemoval = true;\n  };\n\n  var getItemHeight = function getItemHeight(child) {\n    return child.rect.element.height + child.rect.element.marginBottom * 0.5 + child.rect.element.marginTop * 0.5;\n  };\n\n  var getItemWidth = function getItemWidth(child) {\n    return child.rect.element.width + child.rect.element.marginLeft * 0.5 + child.rect.element.marginRight * 0.5;\n  };\n\n  var dragItem = function dragItem(_ref4) {\n    var root = _ref4.root,\n        action = _ref4.action;\n    var id = action.id,\n        dragState = action.dragState; // reference to item\n\n    var item = root.query('GET_ITEM', {\n      id: id\n    }); // get the view matching the given id\n\n    var view = root.childViews.find(function (child) {\n      return child.id === id;\n    });\n    var numItems = root.childViews.length;\n    var oldIndex = dragState.getItemIndex(item); // if no view found, exit\n\n    if (!view) return;\n    var dragPosition = {\n      x: view.dragOrigin.x + view.dragOffset.x + view.dragCenter.x,\n      y: view.dragOrigin.y + view.dragOffset.y + view.dragCenter.y // get drag area dimensions\n\n    };\n    var dragHeight = getItemHeight(view);\n    var dragWidth = getItemWidth(view); // get rows and columns (There will always be at least one row and one column if a file is present)\n\n    var cols = Math.floor(root.rect.outer.width / dragWidth);\n    if (cols > numItems) cols = numItems; // rows are used to find when we have left the preview area bounding box\n\n    var rows = Math.floor(numItems / cols + 1);\n    dropAreaDimensions.setHeight = dragHeight * rows;\n    dropAreaDimensions.setWidth = dragWidth * cols; // get new index of dragged item\n\n    var location = {\n      y: Math.floor(dragPosition.y / dragHeight),\n      x: Math.floor(dragPosition.x / dragWidth),\n      getGridIndex: function getGridIndex() {\n        if (dragPosition.y > dropAreaDimensions.getHeight || dragPosition.y < 0 || dragPosition.x > dropAreaDimensions.getWidth || dragPosition.x < 0) return oldIndex;\n        return this.y * cols + this.x;\n      },\n      getColIndex: function getColIndex() {\n        var items = root.query('GET_ACTIVE_ITEMS');\n        var visibleChildren = root.childViews.filter(function (child) {\n          return child.rect.element.height;\n        });\n        var children = items.map(function (item) {\n          return visibleChildren.find(function (childView) {\n            return childView.id === item.id;\n          });\n        });\n        var currentIndex = children.findIndex(function (child) {\n          return child === view;\n        });\n        var dragHeight = getItemHeight(view);\n        var l = children.length;\n        var idx = l;\n        var childHeight = 0;\n        var childBottom = 0;\n        var childTop = 0;\n\n        for (var i = 0; i < l; i++) {\n          childHeight = getItemHeight(children[i]);\n          childTop = childBottom;\n          childBottom = childTop + childHeight;\n\n          if (dragPosition.y < childBottom) {\n            if (currentIndex > i) {\n              if (dragPosition.y < childTop + dragHeight) {\n                idx = i;\n                break;\n              }\n\n              continue;\n            }\n\n            idx = i;\n            break;\n          }\n        }\n\n        return idx;\n      } // get new index\n\n    };\n    var index = cols > 1 ? location.getGridIndex() : location.getColIndex();\n    root.dispatch('MOVE_ITEM', {\n      query: view,\n      index: index\n    }); // if the index of the item changed, dispatch reorder action\n\n    var currentIndex = dragState.getIndex();\n\n    if (currentIndex === undefined || currentIndex !== index) {\n      dragState.setIndex(index);\n      if (currentIndex === undefined) return;\n      root.dispatch('DID_REORDER_ITEMS', {\n        items: root.query('GET_ACTIVE_ITEMS'),\n        origin: oldIndex,\n        target: index\n      });\n    }\n  };\n  /**\n   * Setup action routes\n   */\n\n\n  var route$2 = createRoute({\n    DID_ADD_ITEM: addItemView,\n    DID_REMOVE_ITEM: removeItemView,\n    DID_DRAG_ITEM: dragItem\n  });\n  /**\n   * Write to view\n   * @param root\n   * @param actions\n   * @param props\n   */\n\n  var write$5 = function write(_ref5) {\n    var root = _ref5.root,\n        props = _ref5.props,\n        actions = _ref5.actions,\n        shouldOptimize = _ref5.shouldOptimize; // route actions\n\n    route$2({\n      root: root,\n      props: props,\n      actions: actions\n    });\n    var dragCoordinates = props.dragCoordinates; // available space on horizontal axis\n\n    var horizontalSpace = root.rect.element.width; // only draw children that have dimensions\n\n    var visibleChildren = root.childViews.filter(function (child) {\n      return child.rect.element.height;\n    }); // sort based on current active items\n\n    var children = root.query('GET_ACTIVE_ITEMS').map(function (item) {\n      return visibleChildren.find(function (child) {\n        return child.id === item.id;\n      });\n    }).filter(function (item) {\n      return item;\n    }); // get index\n\n    var dragIndex = dragCoordinates ? getItemIndexByPosition(root, children, dragCoordinates) : null; // add index is used to reserve the dropped/added item index till the actual item is rendered\n\n    var addIndex = root.ref.addIndex || null; // add index no longer needed till possibly next draw\n\n    root.ref.addIndex = null;\n    var dragIndexOffset = 0;\n    var removeIndexOffset = 0;\n    var addIndexOffset = 0;\n    if (children.length === 0) return;\n    var childRect = children[0].rect.element;\n    var itemVerticalMargin = childRect.marginTop + childRect.marginBottom;\n    var itemHorizontalMargin = childRect.marginLeft + childRect.marginRight;\n    var itemWidth = childRect.width + itemHorizontalMargin;\n    var itemHeight = childRect.height + itemVerticalMargin;\n    var itemsPerRow = Math.round(horizontalSpace / itemWidth); // stack\n\n    if (itemsPerRow === 1) {\n      var offsetY = 0;\n      var dragOffset = 0;\n      children.forEach(function (child, index) {\n        if (dragIndex) {\n          var dist = index - dragIndex;\n\n          if (dist === -2) {\n            dragOffset = -itemVerticalMargin * 0.25;\n          } else if (dist === -1) {\n            dragOffset = -itemVerticalMargin * 0.75;\n          } else if (dist === 0) {\n            dragOffset = itemVerticalMargin * 0.75;\n          } else if (dist === 1) {\n            dragOffset = itemVerticalMargin * 0.25;\n          } else {\n            dragOffset = 0;\n          }\n        }\n\n        if (shouldOptimize) {\n          child.translateX = null;\n          child.translateY = null;\n        }\n\n        if (!child.markedForRemoval) {\n          moveItem(child, 0, offsetY + dragOffset);\n        }\n\n        var itemHeight = child.rect.element.height + itemVerticalMargin;\n        var visualHeight = itemHeight * (child.markedForRemoval ? child.opacity : 1);\n        offsetY += visualHeight;\n      });\n    } // grid\n    else {\n        var prevX = 0;\n        var prevY = 0;\n        children.forEach(function (child, index) {\n          if (index === dragIndex) {\n            dragIndexOffset = 1;\n          }\n\n          if (index === addIndex) {\n            addIndexOffset += 1;\n          }\n\n          if (child.markedForRemoval && child.opacity < 0.5) {\n            removeIndexOffset -= 1;\n          }\n\n          var visualIndex = index + addIndexOffset + dragIndexOffset + removeIndexOffset;\n          var indexX = visualIndex % itemsPerRow;\n          var indexY = Math.floor(visualIndex / itemsPerRow);\n          var offsetX = indexX * itemWidth;\n          var offsetY = indexY * itemHeight;\n          var vectorX = Math.sign(offsetX - prevX);\n          var vectorY = Math.sign(offsetY - prevY);\n          prevX = offsetX;\n          prevY = offsetY;\n          if (child.markedForRemoval) return;\n\n          if (shouldOptimize) {\n            child.translateX = null;\n            child.translateY = null;\n          }\n\n          moveItem(child, offsetX, offsetY, vectorX, vectorY);\n        });\n      }\n  };\n  /**\n   * Filters actions that are meant specifically for a certain child of the list\n   * @param child\n   * @param actions\n   */\n\n\n  var filterSetItemActions = function filterSetItemActions(child, actions) {\n    return actions.filter(function (action) {\n      // if action has an id, filter out actions that don't have this child id\n      if (action.data && action.data.id) {\n        return child.id === action.data.id;\n      } // allow all other actions\n\n\n      return true;\n    });\n  };\n\n  var list = createView({\n    create: create$8,\n    write: write$5,\n    tag: 'ul',\n    name: 'list',\n    didWriteView: function didWriteView(_ref6) {\n      var root = _ref6.root;\n      root.childViews.filter(function (view) {\n        return view.markedForRemoval && view.opacity === 0 && view.resting;\n      }).forEach(function (view) {\n        view._destroy();\n\n        root.removeChildView(view);\n      });\n    },\n    filterFrameActionsForChild: filterSetItemActions,\n    mixins: {\n      apis: ['dragCoordinates']\n    }\n  });\n\n  var create$9 = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props;\n    root.ref.list = root.appendChildView(root.createChildView(list));\n    props.dragCoordinates = null;\n    props.overflowing = false;\n  };\n\n  var storeDragCoordinates = function storeDragCoordinates(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props,\n        action = _ref2.action;\n    if (!root.query('GET_ITEM_INSERT_LOCATION_FREEDOM')) return;\n    props.dragCoordinates = {\n      left: action.position.scopeLeft - root.ref.list.rect.element.left,\n      top: action.position.scopeTop - (root.rect.outer.top + root.rect.element.marginTop + root.rect.element.scrollTop)\n    };\n  };\n\n  var clearDragCoordinates = function clearDragCoordinates(_ref3) {\n    var props = _ref3.props;\n    props.dragCoordinates = null;\n  };\n\n  var route$3 = createRoute({\n    DID_DRAG: storeDragCoordinates,\n    DID_END_DRAG: clearDragCoordinates\n  });\n\n  var write$6 = function write(_ref4) {\n    var root = _ref4.root,\n        props = _ref4.props,\n        actions = _ref4.actions; // route actions\n\n    route$3({\n      root: root,\n      props: props,\n      actions: actions\n    }); // current drag position\n\n    root.ref.list.dragCoordinates = props.dragCoordinates; // if currently overflowing but no longer received overflow\n\n    if (props.overflowing && !props.overflow) {\n      props.overflowing = false; // reset overflow state\n\n      root.element.dataset.state = '';\n      root.height = null;\n    } // if is not overflowing currently but does receive overflow value\n\n\n    if (props.overflow) {\n      var newHeight = Math.round(props.overflow);\n\n      if (newHeight !== root.height) {\n        props.overflowing = true;\n        root.element.dataset.state = 'overflow';\n        root.height = newHeight;\n      }\n    }\n  };\n\n  var listScroller = createView({\n    create: create$9,\n    write: write$6,\n    name: 'list-scroller',\n    mixins: {\n      apis: ['overflow', 'dragCoordinates'],\n      styles: ['height', 'translateY'],\n      animations: {\n        translateY: 'spring'\n      }\n    }\n  });\n\n  var attrToggle = function attrToggle(element, name, state) {\n    var enabledValue = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '';\n\n    if (state) {\n      attr(element, name, enabledValue);\n    } else {\n      element.removeAttribute(name);\n    }\n  };\n\n  var resetFileInput = function resetFileInput(input) {\n    // no value, no need to reset\n    if (!input || input.value === '') {\n      return;\n    }\n\n    try {\n      // for modern browsers\n      input.value = '';\n    } catch (err) {} // for IE10\n\n\n    if (input.value) {\n      // quickly append input to temp form and reset form\n      var form = createElement$1('form');\n      var parentNode = input.parentNode;\n      var ref = input.nextSibling;\n      form.appendChild(input);\n      form.reset(); // re-inject input where it originally was\n\n      if (ref) {\n        parentNode.insertBefore(input, ref);\n      } else {\n        parentNode.appendChild(input);\n      }\n    }\n  };\n\n  var create$a = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // set id so can be referenced from outside labels\n\n    root.element.id = 'filepond--browser-' + props.id; // set name of element (is removed when a value is set)\n\n    attr(root.element, 'name', root.query('GET_NAME')); // we have to link this element to the status element\n\n    attr(root.element, 'aria-controls', 'filepond--assistant-' + props.id); // set label, we use labelled by as otherwise the screenreader does not read the \"browse\" text in the label (as it has tabindex: 0)\n\n    attr(root.element, 'aria-labelledby', 'filepond--drop-label-' + props.id); // set configurable props\n\n    setAcceptedFileTypes({\n      root: root,\n      action: {\n        value: root.query('GET_ACCEPTED_FILE_TYPES')\n      }\n    });\n    toggleAllowMultiple({\n      root: root,\n      action: {\n        value: root.query('GET_ALLOW_MULTIPLE')\n      }\n    });\n    toggleDirectoryFilter({\n      root: root,\n      action: {\n        value: root.query('GET_ALLOW_DIRECTORIES_ONLY')\n      }\n    });\n    toggleDisabled({\n      root: root\n    });\n    toggleRequired({\n      root: root,\n      action: {\n        value: root.query('GET_REQUIRED')\n      }\n    });\n    setCaptureMethod({\n      root: root,\n      action: {\n        value: root.query('GET_CAPTURE_METHOD')\n      }\n    }); // handle changes to the input field\n\n    root.ref.handleChange = function (e) {\n      if (!root.element.value) {\n        return;\n      } // extract files and move value of webkitRelativePath path to _relativePath\n\n\n      var files = Array.from(root.element.files).map(function (file) {\n        file._relativePath = file.webkitRelativePath;\n        return file;\n      }); // we add a little delay so the OS file select window can move out of the way before we add our file\n\n      setTimeout(function () {\n        // load files\n        props.onload(files); // reset input, it's just for exposing a method to drop files, should not retain any state\n\n        resetFileInput(root.element);\n      }, 250);\n    };\n\n    root.element.addEventListener('change', root.ref.handleChange);\n  };\n\n  var setAcceptedFileTypes = function setAcceptedFileTypes(_ref2) {\n    var root = _ref2.root,\n        action = _ref2.action;\n    if (!root.query('GET_ALLOW_SYNC_ACCEPT_ATTRIBUTE')) return;\n    attrToggle(root.element, 'accept', !!action.value, action.value ? action.value.join(',') : '');\n  };\n\n  var toggleAllowMultiple = function toggleAllowMultiple(_ref3) {\n    var root = _ref3.root,\n        action = _ref3.action;\n    attrToggle(root.element, 'multiple', action.value);\n  };\n\n  var toggleDirectoryFilter = function toggleDirectoryFilter(_ref4) {\n    var root = _ref4.root,\n        action = _ref4.action;\n    attrToggle(root.element, 'webkitdirectory', action.value);\n  };\n\n  var toggleDisabled = function toggleDisabled(_ref5) {\n    var root = _ref5.root;\n    var isDisabled = root.query('GET_DISABLED');\n    var doesAllowBrowse = root.query('GET_ALLOW_BROWSE');\n    var disableField = isDisabled || !doesAllowBrowse;\n    attrToggle(root.element, 'disabled', disableField);\n  };\n\n  var toggleRequired = function toggleRequired(_ref6) {\n    var root = _ref6.root,\n        action = _ref6.action; // want to remove required, always possible\n\n    if (!action.value) {\n      attrToggle(root.element, 'required', false);\n    } // if want to make required, only possible when zero items\n    else if (root.query('GET_TOTAL_ITEMS') === 0) {\n        attrToggle(root.element, 'required', true);\n      }\n  };\n\n  var setCaptureMethod = function setCaptureMethod(_ref7) {\n    var root = _ref7.root,\n        action = _ref7.action;\n    attrToggle(root.element, 'capture', !!action.value, action.value === true ? '' : action.value);\n  };\n\n  var updateRequiredStatus = function updateRequiredStatus(_ref8) {\n    var root = _ref8.root;\n    var element = root.element; // always remove the required attribute when more than zero items\n\n    if (root.query('GET_TOTAL_ITEMS') > 0) {\n      attrToggle(element, 'required', false);\n      attrToggle(element, 'name', false);\n    } else {\n      // add name attribute\n      attrToggle(element, 'name', true, root.query('GET_NAME')); // remove any validation messages\n\n      var shouldCheckValidity = root.query('GET_CHECK_VALIDITY');\n\n      if (shouldCheckValidity) {\n        element.setCustomValidity('');\n      } // we only add required if the field has been deemed required\n\n\n      if (root.query('GET_REQUIRED')) {\n        attrToggle(element, 'required', true);\n      }\n    }\n  };\n\n  var updateFieldValidityStatus = function updateFieldValidityStatus(_ref9) {\n    var root = _ref9.root;\n    var shouldCheckValidity = root.query('GET_CHECK_VALIDITY');\n    if (!shouldCheckValidity) return;\n    root.element.setCustomValidity(root.query('GET_LABEL_INVALID_FIELD'));\n  };\n\n  var browser = createView({\n    tag: 'input',\n    name: 'browser',\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    attributes: {\n      type: 'file'\n    },\n    create: create$a,\n    destroy: function destroy(_ref10) {\n      var root = _ref10.root;\n      root.element.removeEventListener('change', root.ref.handleChange);\n    },\n    write: createRoute({\n      DID_LOAD_ITEM: updateRequiredStatus,\n      DID_REMOVE_ITEM: updateRequiredStatus,\n      DID_THROW_ITEM_INVALID: updateFieldValidityStatus,\n      DID_SET_DISABLED: toggleDisabled,\n      DID_SET_ALLOW_BROWSE: toggleDisabled,\n      DID_SET_ALLOW_DIRECTORIES_ONLY: toggleDirectoryFilter,\n      DID_SET_ALLOW_MULTIPLE: toggleAllowMultiple,\n      DID_SET_ACCEPTED_FILE_TYPES: setAcceptedFileTypes,\n      DID_SET_CAPTURE_METHOD: setCaptureMethod,\n      DID_SET_REQUIRED: toggleRequired\n    })\n  });\n  var Key = {\n    ENTER: 13,\n    SPACE: 32\n  };\n\n  var create$b = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // create the label and link it to the file browser\n\n    var label = createElement$1('label');\n    attr(label, 'for', 'filepond--browser-' + props.id); // use for labeling file input (aria-labelledby on file input)\n\n    attr(label, 'id', 'filepond--drop-label-' + props.id); // hide the label for screenreaders, the input element will read the contents of the label when it's focussed. If we don't set aria-hidden the screenreader will also navigate the contents of the label separately from the input.\n\n    attr(label, 'aria-hidden', 'true'); // handle keys\n\n    root.ref.handleKeyDown = function (e) {\n      var isActivationKey = e.keyCode === Key.ENTER || e.keyCode === Key.SPACE;\n      if (!isActivationKey) return; // stops from triggering the element a second time\n\n      e.preventDefault(); // click link (will then in turn activate file input)\n\n      root.ref.label.click();\n    };\n\n    root.ref.handleClick = function (e) {\n      var isLabelClick = e.target === label || label.contains(e.target); // don't want to click twice\n\n      if (isLabelClick) return; // click link (will then in turn activate file input)\n\n      root.ref.label.click();\n    }; // attach events\n\n\n    label.addEventListener('keydown', root.ref.handleKeyDown);\n    root.element.addEventListener('click', root.ref.handleClick); // update\n\n    updateLabelValue(label, props.caption); // add!\n\n    root.appendChild(label);\n    root.ref.label = label;\n  };\n\n  var updateLabelValue = function updateLabelValue(label, value) {\n    label.innerHTML = value;\n    var clickable = label.querySelector('.filepond--label-action');\n\n    if (clickable) {\n      attr(clickable, 'tabindex', '0');\n    }\n\n    return value;\n  };\n\n  var dropLabel = createView({\n    name: 'drop-label',\n    ignoreRect: true,\n    create: create$b,\n    destroy: function destroy(_ref2) {\n      var root = _ref2.root;\n      root.ref.label.addEventListener('keydown', root.ref.handleKeyDown);\n      root.element.removeEventListener('click', root.ref.handleClick);\n    },\n    write: createRoute({\n      DID_SET_LABEL_IDLE: function DID_SET_LABEL_IDLE(_ref3) {\n        var root = _ref3.root,\n            action = _ref3.action;\n        updateLabelValue(root.ref.label, action.value);\n      }\n    }),\n    mixins: {\n      styles: ['opacity', 'translateX', 'translateY'],\n      animations: {\n        opacity: {\n          type: 'tween',\n          duration: 150\n        },\n        translateX: 'spring',\n        translateY: 'spring'\n      }\n    }\n  });\n  var blob = createView({\n    name: 'drip-blob',\n    ignoreRect: true,\n    mixins: {\n      styles: ['translateX', 'translateY', 'scaleX', 'scaleY', 'opacity'],\n      animations: {\n        scaleX: 'spring',\n        scaleY: 'spring',\n        translateX: 'spring',\n        translateY: 'spring',\n        opacity: {\n          type: 'tween',\n          duration: 250\n        }\n      }\n    }\n  });\n\n  var addBlob = function addBlob(_ref) {\n    var root = _ref.root;\n    var centerX = root.rect.element.width * 0.5;\n    var centerY = root.rect.element.height * 0.5;\n    root.ref.blob = root.appendChildView(root.createChildView(blob, {\n      opacity: 0,\n      scaleX: 2.5,\n      scaleY: 2.5,\n      translateX: centerX,\n      translateY: centerY\n    }));\n  };\n\n  var moveBlob = function moveBlob(_ref2) {\n    var root = _ref2.root,\n        action = _ref2.action;\n\n    if (!root.ref.blob) {\n      addBlob({\n        root: root\n      });\n      return;\n    }\n\n    root.ref.blob.translateX = action.position.scopeLeft;\n    root.ref.blob.translateY = action.position.scopeTop;\n    root.ref.blob.scaleX = 1;\n    root.ref.blob.scaleY = 1;\n    root.ref.blob.opacity = 1;\n  };\n\n  var hideBlob = function hideBlob(_ref3) {\n    var root = _ref3.root;\n\n    if (!root.ref.blob) {\n      return;\n    }\n\n    root.ref.blob.opacity = 0;\n  };\n\n  var explodeBlob = function explodeBlob(_ref4) {\n    var root = _ref4.root;\n\n    if (!root.ref.blob) {\n      return;\n    }\n\n    root.ref.blob.scaleX = 2.5;\n    root.ref.blob.scaleY = 2.5;\n    root.ref.blob.opacity = 0;\n  };\n\n  var write$7 = function write(_ref5) {\n    var root = _ref5.root,\n        props = _ref5.props,\n        actions = _ref5.actions;\n    route$4({\n      root: root,\n      props: props,\n      actions: actions\n    });\n    var blob = root.ref.blob;\n\n    if (actions.length === 0 && blob && blob.opacity === 0) {\n      root.removeChildView(blob);\n      root.ref.blob = null;\n    }\n  };\n\n  var route$4 = createRoute({\n    DID_DRAG: moveBlob,\n    DID_DROP: explodeBlob,\n    DID_END_DRAG: hideBlob\n  });\n  var drip = createView({\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    name: 'drip',\n    write: write$7\n  });\n\n  var create$c = function create(_ref) {\n    var root = _ref.root;\n    return root.ref.fields = {};\n  };\n\n  var getField = function getField(root, id) {\n    return root.ref.fields[id];\n  };\n\n  var syncFieldPositionsWithItems = function syncFieldPositionsWithItems(root) {\n    root.query('GET_ACTIVE_ITEMS').forEach(function (item) {\n      if (!root.ref.fields[item.id]) return;\n      root.element.appendChild(root.ref.fields[item.id]);\n    });\n  };\n\n  var didReorderItems = function didReorderItems(_ref2) {\n    var root = _ref2.root;\n    return syncFieldPositionsWithItems(root);\n  };\n\n  var didAddItem = function didAddItem(_ref3) {\n    var root = _ref3.root,\n        action = _ref3.action;\n    var dataContainer = createElement$1('input');\n    dataContainer.type = 'hidden';\n    dataContainer.name = root.query('GET_NAME');\n    dataContainer.disabled = root.query('GET_DISABLED');\n    root.ref.fields[action.id] = dataContainer;\n    syncFieldPositionsWithItems(root);\n  };\n\n  var didLoadItem$1 = function didLoadItem(_ref4) {\n    var root = _ref4.root,\n        action = _ref4.action;\n    var field = getField(root, action.id);\n    if (!field || action.serverFileReference === null) return;\n    field.value = action.serverFileReference;\n  };\n\n  var didSetDisabled = function didSetDisabled(_ref5) {\n    var root = _ref5.root;\n    root.element.disabled = root.query('GET_DISABLED');\n  };\n\n  var didRemoveItem = function didRemoveItem(_ref6) {\n    var root = _ref6.root,\n        action = _ref6.action;\n    var field = getField(root, action.id);\n    if (!field) return;\n    field.parentNode.removeChild(field);\n    delete root.ref.fields[action.id];\n  };\n\n  var didDefineValue = function didDefineValue(_ref7) {\n    var root = _ref7.root,\n        action = _ref7.action;\n    var field = getField(root, action.id);\n    if (!field) return;\n\n    if (action.value === null) {\n      field.removeAttribute('value');\n    } else {\n      field.value = action.value;\n    }\n\n    syncFieldPositionsWithItems(root);\n  };\n\n  var write$8 = createRoute({\n    DID_SET_DISABLED: didSetDisabled,\n    DID_ADD_ITEM: didAddItem,\n    DID_LOAD_ITEM: didLoadItem$1,\n    DID_REMOVE_ITEM: didRemoveItem,\n    DID_DEFINE_VALUE: didDefineValue,\n    DID_REORDER_ITEMS: didReorderItems,\n    DID_SORT_ITEMS: didReorderItems\n  });\n  var data = createView({\n    tag: 'fieldset',\n    name: 'data',\n    create: create$c,\n    write: write$8,\n    ignoreRect: true\n  });\n\n  var getRootNode = function getRootNode(element) {\n    return 'getRootNode' in element ? element.getRootNode() : document;\n  };\n\n  var images = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg', 'tiff'];\n  var text$1 = ['css', 'csv', 'html', 'txt'];\n  var map = {\n    zip: 'zip|compressed',\n    epub: 'application/epub+zip'\n  };\n\n  var guesstimateMimeType = function guesstimateMimeType() {\n    var extension = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    extension = extension.toLowerCase();\n\n    if (images.includes(extension)) {\n      return 'image/' + (extension === 'jpg' ? 'jpeg' : extension === 'svg' ? 'svg+xml' : extension);\n    }\n\n    if (text$1.includes(extension)) {\n      return 'text/' + extension;\n    }\n\n    return map[extension] || '';\n  };\n\n  var requestDataTransferItems = function requestDataTransferItems(dataTransfer) {\n    return new Promise(function (resolve, reject) {\n      // try to get links from transfer, if found we'll exit immidiately (unless a file is in the dataTransfer as well, this is because Firefox could represent the file as a URL and a file object at the same time)\n      var links = getLinks(dataTransfer);\n\n      if (links.length && !hasFiles(dataTransfer)) {\n        return resolve(links);\n      } // try to get files from the transfer\n\n\n      getFiles(dataTransfer).then(resolve);\n    });\n  };\n  /**\n   * Test if datatransfer has files\n   */\n\n\n  var hasFiles = function hasFiles(dataTransfer) {\n    if (dataTransfer.files) return dataTransfer.files.length > 0;\n    return false;\n  };\n  /**\n   * Extracts files from a DataTransfer object\n   */\n\n\n  var getFiles = function getFiles(dataTransfer) {\n    return new Promise(function (resolve, reject) {\n      // get the transfer items as promises\n      var promisedFiles = (dataTransfer.items ? Array.from(dataTransfer.items) : []). // only keep file system items (files and directories)\n      filter(function (item) {\n        return isFileSystemItem(item);\n      }) // map each item to promise\n      .map(function (item) {\n        return getFilesFromItem(item);\n      }); // if is empty, see if we can extract some info from the files property as a fallback\n\n      if (!promisedFiles.length) {\n        // TODO: test for directories (should not be allowed)\n        // Use FileReader, problem is that the files property gets lost in the process\n        resolve(dataTransfer.files ? Array.from(dataTransfer.files) : []);\n        return;\n      } // done!\n\n\n      Promise.all(promisedFiles).then(function (returnedFileGroups) {\n        // flatten groups\n        var files = [];\n        returnedFileGroups.forEach(function (group) {\n          files.push.apply(files, group);\n        }); // done (filter out empty files)!\n\n        resolve(files.filter(function (file) {\n          return file;\n        }).map(function (file) {\n          if (!file._relativePath) file._relativePath = file.webkitRelativePath;\n          return file;\n        }));\n      }).catch(console.error);\n    });\n  };\n\n  var isFileSystemItem = function isFileSystemItem(item) {\n    if (isEntry(item)) {\n      var entry = getAsEntry(item);\n\n      if (entry) {\n        return entry.isFile || entry.isDirectory;\n      }\n    }\n\n    return item.kind === 'file';\n  };\n\n  var getFilesFromItem = function getFilesFromItem(item) {\n    return new Promise(function (resolve, reject) {\n      if (isDirectoryEntry(item)) {\n        getFilesInDirectory(getAsEntry(item)).then(resolve).catch(reject);\n        return;\n      }\n\n      resolve([item.getAsFile()]);\n    });\n  };\n\n  var getFilesInDirectory = function getFilesInDirectory(entry) {\n    return new Promise(function (resolve, reject) {\n      var files = []; // the total entries to read\n\n      var dirCounter = 0;\n      var fileCounter = 0;\n\n      var resolveIfDone = function resolveIfDone() {\n        if (fileCounter === 0 && dirCounter === 0) {\n          resolve(files);\n        }\n      }; // the recursive function\n\n\n      var readEntries = function readEntries(dirEntry) {\n        dirCounter++;\n        var directoryReader = dirEntry.createReader(); // directories are returned in batches, we need to process all batches before we're done\n\n        var readBatch = function readBatch() {\n          directoryReader.readEntries(function (entries) {\n            if (entries.length === 0) {\n              dirCounter--;\n              resolveIfDone();\n              return;\n            }\n\n            entries.forEach(function (entry) {\n              // recursively read more directories\n              if (entry.isDirectory) {\n                readEntries(entry);\n              } else {\n                // read as file\n                fileCounter++;\n                entry.file(function (file) {\n                  var correctedFile = correctMissingFileType(file);\n                  if (entry.fullPath) correctedFile._relativePath = entry.fullPath;\n                  files.push(correctedFile);\n                  fileCounter--;\n                  resolveIfDone();\n                });\n              }\n            }); // try to get next batch of files\n\n            readBatch();\n          }, reject);\n        }; // read first batch of files\n\n\n        readBatch();\n      }; // go!\n\n\n      readEntries(entry);\n    });\n  };\n\n  var correctMissingFileType = function correctMissingFileType(file) {\n    if (file.type.length) return file;\n    var date = file.lastModifiedDate;\n    var name = file.name;\n    file = file.slice(0, file.size, guesstimateMimeType(getExtensionFromFilename(file.name)));\n    file.name = name;\n    file.lastModifiedDate = date;\n    return file;\n  };\n\n  var isDirectoryEntry = function isDirectoryEntry(item) {\n    return isEntry(item) && (getAsEntry(item) || {}).isDirectory;\n  };\n\n  var isEntry = function isEntry(item) {\n    return 'webkitGetAsEntry' in item;\n  };\n\n  var getAsEntry = function getAsEntry(item) {\n    return item.webkitGetAsEntry();\n  };\n  /**\n   * Extracts links from a DataTransfer object\n   */\n\n\n  var getLinks = function getLinks(dataTransfer) {\n    var links = [];\n\n    try {\n      // look in meta data property\n      links = getLinksFromTransferMetaData(dataTransfer);\n\n      if (links.length) {\n        return links;\n      }\n\n      links = getLinksFromTransferURLData(dataTransfer);\n    } catch (e) {// nope nope nope (probably IE trouble)\n    }\n\n    return links;\n  };\n\n  var getLinksFromTransferURLData = function getLinksFromTransferURLData(dataTransfer) {\n    var data = dataTransfer.getData('url');\n\n    if (typeof data === 'string' && data.length) {\n      return [data];\n    }\n\n    return [];\n  };\n\n  var getLinksFromTransferMetaData = function getLinksFromTransferMetaData(dataTransfer) {\n    var data = dataTransfer.getData('text/html');\n\n    if (typeof data === 'string' && data.length) {\n      var matches = data.match(/src\\s*=\\s*\"(.+?)\"/);\n\n      if (matches) {\n        return [matches[1]];\n      }\n    }\n\n    return [];\n  };\n\n  var dragNDropObservers = [];\n\n  var eventPosition = function eventPosition(e) {\n    return {\n      pageLeft: e.pageX,\n      pageTop: e.pageY,\n      scopeLeft: e.offsetX || e.layerX,\n      scopeTop: e.offsetY || e.layerY\n    };\n  };\n\n  var createDragNDropClient = function createDragNDropClient(element, scopeToObserve, filterElement) {\n    var observer = getDragNDropObserver(scopeToObserve);\n    var client = {\n      element: element,\n      filterElement: filterElement,\n      state: null,\n      ondrop: function ondrop() {},\n      onenter: function onenter() {},\n      ondrag: function ondrag() {},\n      onexit: function onexit() {},\n      onload: function onload() {},\n      allowdrop: function allowdrop() {}\n    };\n    client.destroy = observer.addListener(client);\n    return client;\n  };\n\n  var getDragNDropObserver = function getDragNDropObserver(element) {\n    // see if already exists, if so, return\n    var observer = dragNDropObservers.find(function (item) {\n      return item.element === element;\n    });\n\n    if (observer) {\n      return observer;\n    } // create new observer, does not yet exist for this element\n\n\n    var newObserver = createDragNDropObserver(element);\n    dragNDropObservers.push(newObserver);\n    return newObserver;\n  };\n\n  var createDragNDropObserver = function createDragNDropObserver(element) {\n    var clients = [];\n    var routes = {\n      dragenter: dragenter,\n      dragover: dragover,\n      dragleave: dragleave,\n      drop: drop\n    };\n    var handlers = {};\n    forin(routes, function (event, createHandler) {\n      handlers[event] = createHandler(element, clients);\n      element.addEventListener(event, handlers[event], false);\n    });\n    var observer = {\n      element: element,\n      addListener: function addListener(client) {\n        // add as client\n        clients.push(client); // return removeListener function\n\n        return function () {\n          // remove client\n          clients.splice(clients.indexOf(client), 1); // if no more clients, clean up observer\n\n          if (clients.length === 0) {\n            dragNDropObservers.splice(dragNDropObservers.indexOf(observer), 1);\n            forin(routes, function (event) {\n              element.removeEventListener(event, handlers[event], false);\n            });\n          }\n        };\n      }\n    };\n    return observer;\n  };\n\n  var elementFromPoint = function elementFromPoint(root, point) {\n    if (!('elementFromPoint' in root)) {\n      root = document;\n    }\n\n    return root.elementFromPoint(point.x, point.y);\n  };\n\n  var isEventTarget = function isEventTarget(e, target) {\n    // get root\n    var root = getRootNode(target); // get element at position\n    // if root is not actual shadow DOM and does not have elementFromPoint method, use the one on document\n\n    var elementAtPosition = elementFromPoint(root, {\n      x: e.pageX - window.pageXOffset,\n      y: e.pageY - window.pageYOffset\n    }); // test if target is the element or if one of its children is\n\n    return elementAtPosition === target || target.contains(elementAtPosition);\n  };\n\n  var initialTarget = null;\n\n  var setDropEffect = function setDropEffect(dataTransfer, effect) {\n    // is in try catch as IE11 will throw error if not\n    try {\n      dataTransfer.dropEffect = effect;\n    } catch (e) {}\n  };\n\n  var dragenter = function dragenter(root, clients) {\n    return function (e) {\n      e.preventDefault();\n      initialTarget = e.target;\n      clients.forEach(function (client) {\n        var element = client.element,\n            onenter = client.onenter;\n\n        if (isEventTarget(e, element)) {\n          client.state = 'enter'; // fire enter event\n\n          onenter(eventPosition(e));\n        }\n      });\n    };\n  };\n\n  var dragover = function dragover(root, clients) {\n    return function (e) {\n      e.preventDefault();\n      var dataTransfer = e.dataTransfer;\n      requestDataTransferItems(dataTransfer).then(function (items) {\n        var overDropTarget = false;\n        clients.some(function (client) {\n          var filterElement = client.filterElement,\n              element = client.element,\n              onenter = client.onenter,\n              onexit = client.onexit,\n              ondrag = client.ondrag,\n              allowdrop = client.allowdrop; // by default we can drop\n\n          setDropEffect(dataTransfer, 'copy'); // allow transfer of these items\n\n          var allowsTransfer = allowdrop(items); // only used when can be dropped on page\n\n          if (!allowsTransfer) {\n            setDropEffect(dataTransfer, 'none');\n            return;\n          } // targetting this client\n\n\n          if (isEventTarget(e, element)) {\n            overDropTarget = true; // had no previous state, means we are entering this client\n\n            if (client.state === null) {\n              client.state = 'enter';\n              onenter(eventPosition(e));\n              return;\n            } // now over element (no matter if it allows the drop or not)\n\n\n            client.state = 'over'; // needs to allow transfer\n\n            if (filterElement && !allowsTransfer) {\n              setDropEffect(dataTransfer, 'none');\n              return;\n            } // dragging\n\n\n            ondrag(eventPosition(e));\n          } else {\n            // should be over an element to drop\n            if (filterElement && !overDropTarget) {\n              setDropEffect(dataTransfer, 'none');\n            } // might have just left this client?\n\n\n            if (client.state) {\n              client.state = null;\n              onexit(eventPosition(e));\n            }\n          }\n        });\n      });\n    };\n  };\n\n  var drop = function drop(root, clients) {\n    return function (e) {\n      e.preventDefault();\n      var dataTransfer = e.dataTransfer;\n      requestDataTransferItems(dataTransfer).then(function (items) {\n        clients.forEach(function (client) {\n          var filterElement = client.filterElement,\n              element = client.element,\n              ondrop = client.ondrop,\n              onexit = client.onexit,\n              allowdrop = client.allowdrop;\n          client.state = null; // if we're filtering on element we need to be over the element to drop\n\n          if (filterElement && !isEventTarget(e, element)) return; // no transfer for this client\n\n          if (!allowdrop(items)) return onexit(eventPosition(e)); // we can drop these items on this client\n\n          ondrop(eventPosition(e), items);\n        });\n      });\n    };\n  };\n\n  var dragleave = function dragleave(root, clients) {\n    return function (e) {\n      if (initialTarget !== e.target) {\n        return;\n      }\n\n      clients.forEach(function (client) {\n        var onexit = client.onexit;\n        client.state = null;\n        onexit(eventPosition(e));\n      });\n    };\n  };\n\n  var createHopper = function createHopper(scope, validateItems, options) {\n    // is now hopper scope\n    scope.classList.add('filepond--hopper'); // shortcuts\n\n    var catchesDropsOnPage = options.catchesDropsOnPage,\n        requiresDropOnElement = options.requiresDropOnElement,\n        _options$filterItems = options.filterItems,\n        filterItems = _options$filterItems === void 0 ? function (items) {\n      return items;\n    } : _options$filterItems; // create a dnd client\n\n    var client = createDragNDropClient(scope, catchesDropsOnPage ? document.documentElement : scope, requiresDropOnElement); // current client state\n\n    var lastState = '';\n    var currentState = ''; // determines if a file may be dropped\n\n    client.allowdrop = function (items) {\n      // TODO: if we can, throw error to indicate the items cannot by dropped\n      return validateItems(filterItems(items));\n    };\n\n    client.ondrop = function (position, items) {\n      var filteredItems = filterItems(items);\n\n      if (!validateItems(filteredItems)) {\n        api.ondragend(position);\n        return;\n      }\n\n      currentState = 'drag-drop';\n      api.onload(filteredItems, position);\n    };\n\n    client.ondrag = function (position) {\n      api.ondrag(position);\n    };\n\n    client.onenter = function (position) {\n      currentState = 'drag-over';\n      api.ondragstart(position);\n    };\n\n    client.onexit = function (position) {\n      currentState = 'drag-exit';\n      api.ondragend(position);\n    };\n\n    var api = {\n      updateHopperState: function updateHopperState() {\n        if (lastState !== currentState) {\n          scope.dataset.hopperState = currentState;\n          lastState = currentState;\n        }\n      },\n      onload: function onload() {},\n      ondragstart: function ondragstart() {},\n      ondrag: function ondrag() {},\n      ondragend: function ondragend() {},\n      destroy: function destroy() {\n        // destroy client\n        client.destroy();\n      }\n    };\n    return api;\n  };\n\n  var listening = false;\n  var listeners$1 = [];\n\n  var handlePaste = function handlePaste(e) {\n    // if is pasting in input or textarea and the target is outside of a filepond scope, ignore\n    var activeEl = document.activeElement;\n\n    if (activeEl && /textarea|input/i.test(activeEl.nodeName)) {\n      // test textarea or input is contained in filepond root\n      var inScope = false;\n      var element = activeEl;\n\n      while (element !== document.body) {\n        if (element.classList.contains('filepond--root')) {\n          inScope = true;\n          break;\n        }\n\n        element = element.parentNode;\n      }\n\n      if (!inScope) return;\n    }\n\n    requestDataTransferItems(e.clipboardData).then(function (files) {\n      // no files received\n      if (!files.length) {\n        return;\n      } // notify listeners of received files\n\n\n      listeners$1.forEach(function (listener) {\n        return listener(files);\n      });\n    });\n  };\n\n  var listen = function listen(cb) {\n    // can't add twice\n    if (listeners$1.includes(cb)) {\n      return;\n    } // add initial listener\n\n\n    listeners$1.push(cb); // setup paste listener for entire page\n\n    if (listening) {\n      return;\n    }\n\n    listening = true;\n    document.addEventListener('paste', handlePaste);\n  };\n\n  var unlisten = function unlisten(listener) {\n    arrayRemove(listeners$1, listeners$1.indexOf(listener)); // clean up\n\n    if (listeners$1.length === 0) {\n      document.removeEventListener('paste', handlePaste);\n      listening = false;\n    }\n  };\n\n  var createPaster = function createPaster() {\n    var cb = function cb(files) {\n      api.onload(files);\n    };\n\n    var api = {\n      destroy: function destroy() {\n        unlisten(cb);\n      },\n      onload: function onload() {}\n    };\n    listen(cb);\n    return api;\n  };\n  /**\n   * Creates the file view\n   */\n\n\n  var create$d = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props;\n    root.element.id = 'filepond--assistant-' + props.id;\n    attr(root.element, 'role', 'status');\n    attr(root.element, 'aria-live', 'polite');\n    attr(root.element, 'aria-relevant', 'additions');\n  };\n\n  var addFilesNotificationTimeout = null;\n  var notificationClearTimeout = null;\n  var filenames = [];\n\n  var assist = function assist(root, message) {\n    root.element.textContent = message;\n  };\n\n  var clear$1 = function clear(root) {\n    root.element.textContent = '';\n  };\n\n  var listModified = function listModified(root, filename, label) {\n    var total = root.query('GET_TOTAL_ITEMS');\n    assist(root, label + ' ' + filename + ', ' + total + ' ' + (total === 1 ? root.query('GET_LABEL_FILE_COUNT_SINGULAR') : root.query('GET_LABEL_FILE_COUNT_PLURAL'))); // clear group after set amount of time so the status is not read twice\n\n    clearTimeout(notificationClearTimeout);\n    notificationClearTimeout = setTimeout(function () {\n      clear$1(root);\n    }, 1500);\n  };\n\n  var isUsingFilePond = function isUsingFilePond(root) {\n    return root.element.parentNode.contains(document.activeElement);\n  };\n\n  var itemAdded = function itemAdded(_ref2) {\n    var root = _ref2.root,\n        action = _ref2.action;\n\n    if (!isUsingFilePond(root)) {\n      return;\n    }\n\n    root.element.textContent = '';\n    var item = root.query('GET_ITEM', action.id);\n    filenames.push(item.filename);\n    clearTimeout(addFilesNotificationTimeout);\n    addFilesNotificationTimeout = setTimeout(function () {\n      listModified(root, filenames.join(', '), root.query('GET_LABEL_FILE_ADDED'));\n      filenames.length = 0;\n    }, 750);\n  };\n\n  var itemRemoved = function itemRemoved(_ref3) {\n    var root = _ref3.root,\n        action = _ref3.action;\n\n    if (!isUsingFilePond(root)) {\n      return;\n    }\n\n    var item = action.item;\n    listModified(root, item.filename, root.query('GET_LABEL_FILE_REMOVED'));\n  };\n\n  var itemProcessed = function itemProcessed(_ref4) {\n    var root = _ref4.root,\n        action = _ref4.action; // will also notify the user when FilePond is not being used, as the user might be occupied with other activities while uploading a file\n\n    var item = root.query('GET_ITEM', action.id);\n    var filename = item.filename;\n    var label = root.query('GET_LABEL_FILE_PROCESSING_COMPLETE');\n    assist(root, filename + ' ' + label);\n  };\n\n  var itemProcessedUndo = function itemProcessedUndo(_ref5) {\n    var root = _ref5.root,\n        action = _ref5.action;\n    var item = root.query('GET_ITEM', action.id);\n    var filename = item.filename;\n    var label = root.query('GET_LABEL_FILE_PROCESSING_ABORTED');\n    assist(root, filename + ' ' + label);\n  };\n\n  var itemError = function itemError(_ref6) {\n    var root = _ref6.root,\n        action = _ref6.action;\n    var item = root.query('GET_ITEM', action.id);\n    var filename = item.filename; // will also notify the user when FilePond is not being used, as the user might be occupied with other activities while uploading a file\n\n    assist(root, action.status.main + ' ' + filename + ' ' + action.status.sub);\n  };\n\n  var assistant = createView({\n    create: create$d,\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    write: createRoute({\n      DID_LOAD_ITEM: itemAdded,\n      DID_REMOVE_ITEM: itemRemoved,\n      DID_COMPLETE_ITEM_PROCESSING: itemProcessed,\n      DID_ABORT_ITEM_PROCESSING: itemProcessedUndo,\n      DID_REVERT_ITEM_PROCESSING: itemProcessedUndo,\n      DID_THROW_ITEM_REMOVE_ERROR: itemError,\n      DID_THROW_ITEM_LOAD_ERROR: itemError,\n      DID_THROW_ITEM_INVALID: itemError,\n      DID_THROW_ITEM_PROCESSING_ERROR: itemError\n    }),\n    tag: 'span',\n    name: 'assistant'\n  });\n\n  var toCamels = function toCamels(string) {\n    var separator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '-';\n    return string.replace(new RegExp(separator + '.', 'g'), function (sub) {\n      return sub.charAt(1).toUpperCase();\n    });\n  };\n\n  var debounce = function debounce(func) {\n    var interval = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 16;\n    var immidiateOnly = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    var last = Date.now();\n    var timeout = null;\n    return function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      clearTimeout(timeout);\n      var dist = Date.now() - last;\n\n      var fn = function fn() {\n        last = Date.now();\n        func.apply(void 0, args);\n      };\n\n      if (dist < interval) {\n        // we need to delay by the difference between interval and dist\n        // for example: if distance is 10 ms and interval is 16 ms,\n        // we need to wait an additional 6ms before calling the function)\n        if (!immidiateOnly) {\n          timeout = setTimeout(fn, interval - dist);\n        }\n      } else {\n        // go!\n        fn();\n      }\n    };\n  };\n\n  var MAX_FILES_LIMIT = 1000000;\n\n  var prevent = function prevent(e) {\n    return e.preventDefault();\n  };\n\n  var create$e = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // Add id\n\n    var id = root.query('GET_ID');\n\n    if (id) {\n      root.element.id = id;\n    } // Add className\n\n\n    var className = root.query('GET_CLASS_NAME');\n\n    if (className) {\n      className.split(' ').filter(function (name) {\n        return name.length;\n      }).forEach(function (name) {\n        root.element.classList.add(name);\n      });\n    } // Field label\n\n\n    root.ref.label = root.appendChildView(root.createChildView(dropLabel, Object.assign({}, props, {\n      translateY: null,\n      caption: root.query('GET_LABEL_IDLE')\n    }))); // List of items\n\n    root.ref.list = root.appendChildView(root.createChildView(listScroller, {\n      translateY: null\n    })); // Background panel\n\n    root.ref.panel = root.appendChildView(root.createChildView(panel, {\n      name: 'panel-root'\n    })); // Assistant notifies assistive tech when content changes\n\n    root.ref.assistant = root.appendChildView(root.createChildView(assistant, Object.assign({}, props))); // Data\n\n    root.ref.data = root.appendChildView(root.createChildView(data, Object.assign({}, props))); // Measure (tests if fixed height was set)\n    // DOCTYPE needs to be set for this to work\n\n    root.ref.measure = createElement$1('div');\n    root.ref.measure.style.height = '100%';\n    root.element.appendChild(root.ref.measure); // information on the root height or fixed height status\n\n    root.ref.bounds = null; // apply initial style properties\n\n    root.query('GET_STYLES').filter(function (style) {\n      return !isEmpty(style.value);\n    }).map(function (_ref2) {\n      var name = _ref2.name,\n          value = _ref2.value;\n      root.element.dataset[name] = value;\n    }); // determine if width changed\n\n    root.ref.widthPrevious = null;\n    root.ref.widthUpdated = debounce(function () {\n      root.ref.updateHistory = [];\n      root.dispatch('DID_RESIZE_ROOT');\n    }, 250); // history of updates\n\n    root.ref.previousAspectRatio = null;\n    root.ref.updateHistory = []; // prevent scrolling and zooming on iOS (only if supports pointer events, for then we can enable reorder)\n\n    var canHover = window.matchMedia('(pointer: fine) and (hover: hover)').matches;\n    var hasPointerEvents = ('PointerEvent' in window);\n\n    if (root.query('GET_ALLOW_REORDER') && hasPointerEvents && !canHover) {\n      root.element.addEventListener('touchmove', prevent, {\n        passive: false\n      });\n      root.element.addEventListener('gesturestart', prevent);\n    }\n  };\n\n  var write$9 = function write(_ref3) {\n    var root = _ref3.root,\n        props = _ref3.props,\n        actions = _ref3.actions; // route actions\n\n    route$5({\n      root: root,\n      props: props,\n      actions: actions\n    }); // apply style properties\n\n    actions.filter(function (action) {\n      return /^DID_SET_STYLE_/.test(action.type);\n    }).filter(function (action) {\n      return !isEmpty(action.data.value);\n    }).map(function (_ref4) {\n      var type = _ref4.type,\n          data = _ref4.data;\n      var name = toCamels(type.substr(8).toLowerCase(), '_');\n      root.element.dataset[name] = data.value;\n      root.invalidateLayout();\n    });\n    if (root.rect.element.hidden) return;\n\n    if (root.rect.element.width !== root.ref.widthPrevious) {\n      root.ref.widthPrevious = root.rect.element.width;\n      root.ref.widthUpdated();\n    } // get box bounds, we do this only once\n\n\n    var bounds = root.ref.bounds;\n\n    if (!bounds) {\n      bounds = root.ref.bounds = calculateRootBoundingBoxHeight(root); // destroy measure element\n\n      root.element.removeChild(root.ref.measure);\n      root.ref.measure = null;\n    } // get quick references to various high level parts of the upload tool\n\n\n    var _root$ref = root.ref,\n        hopper = _root$ref.hopper,\n        label = _root$ref.label,\n        list = _root$ref.list,\n        panel = _root$ref.panel; // sets correct state to hopper scope\n\n    if (hopper) {\n      hopper.updateHopperState();\n    } // bool to indicate if we're full or not\n\n\n    var aspectRatio = root.query('GET_PANEL_ASPECT_RATIO');\n    var isMultiItem = root.query('GET_ALLOW_MULTIPLE');\n    var totalItems = root.query('GET_TOTAL_ITEMS');\n    var maxItems = isMultiItem ? root.query('GET_MAX_FILES') || MAX_FILES_LIMIT : 1;\n    var atMaxCapacity = totalItems === maxItems; // action used to add item\n\n    var addAction = actions.find(function (action) {\n      return action.type === 'DID_ADD_ITEM';\n    }); // if reached max capacity and we've just reached it\n\n    if (atMaxCapacity && addAction) {\n      // get interaction type\n      var interactionMethod = addAction.data.interactionMethod; // hide label\n\n      label.opacity = 0;\n\n      if (isMultiItem) {\n        label.translateY = -40;\n      } else {\n        if (interactionMethod === InteractionMethod.API) {\n          label.translateX = 40;\n        } else if (interactionMethod === InteractionMethod.BROWSE) {\n          label.translateY = 40;\n        } else {\n          label.translateY = 30;\n        }\n      }\n    } else if (!atMaxCapacity) {\n      label.opacity = 1;\n      label.translateX = 0;\n      label.translateY = 0;\n    }\n\n    var listItemMargin = calculateListItemMargin(root);\n    var listHeight = calculateListHeight(root);\n    var labelHeight = label.rect.element.height;\n    var currentLabelHeight = !isMultiItem || atMaxCapacity ? 0 : labelHeight;\n    var listMarginTop = atMaxCapacity ? list.rect.element.marginTop : 0;\n    var listMarginBottom = totalItems === 0 ? 0 : list.rect.element.marginBottom;\n    var visualHeight = currentLabelHeight + listMarginTop + listHeight.visual + listMarginBottom;\n    var boundsHeight = currentLabelHeight + listMarginTop + listHeight.bounds + listMarginBottom; // link list to label bottom position\n\n    list.translateY = Math.max(0, currentLabelHeight - list.rect.element.marginTop) - listItemMargin.top;\n\n    if (aspectRatio) {\n      // fixed aspect ratio\n      // calculate height based on width\n      var width = root.rect.element.width;\n      var height = width * aspectRatio; // clear history if aspect ratio has changed\n\n      if (aspectRatio !== root.ref.previousAspectRatio) {\n        root.ref.previousAspectRatio = aspectRatio;\n        root.ref.updateHistory = [];\n      } // remember this width\n\n\n      var history = root.ref.updateHistory;\n      history.push(width);\n      var MAX_BOUNCES = 2;\n\n      if (history.length > MAX_BOUNCES * 2) {\n        var l = history.length;\n        var bottom = l - 10;\n        var bounces = 0;\n\n        for (var i = l; i >= bottom; i--) {\n          if (history[i] === history[i - 2]) {\n            bounces++;\n          }\n\n          if (bounces >= MAX_BOUNCES) {\n            // dont adjust height\n            return;\n          }\n        }\n      } // fix height of panel so it adheres to aspect ratio\n\n\n      panel.scalable = false;\n      panel.height = height; // available height for list\n\n      var listAvailableHeight = // the height of the panel minus the label height\n      height - currentLabelHeight - ( // the room we leave open between the end of the list and the panel bottom\n      listMarginBottom - listItemMargin.bottom) - ( // if we're full we need to leave some room between the top of the panel and the list\n      atMaxCapacity ? listMarginTop : 0);\n\n      if (listHeight.visual > listAvailableHeight) {\n        list.overflow = listAvailableHeight;\n      } else {\n        list.overflow = null;\n      } // set container bounds (so pushes siblings downwards)\n\n\n      root.height = height;\n    } else if (bounds.fixedHeight) {\n      // fixed height\n      // fix height of panel\n      panel.scalable = false; // available height for list\n\n      var _listAvailableHeight = // the height of the panel minus the label height\n      bounds.fixedHeight - currentLabelHeight - ( // the room we leave open between the end of the list and the panel bottom\n      listMarginBottom - listItemMargin.bottom) - ( // if we're full we need to leave some room between the top of the panel and the list\n      atMaxCapacity ? listMarginTop : 0); // set list height\n\n\n      if (listHeight.visual > _listAvailableHeight) {\n        list.overflow = _listAvailableHeight;\n      } else {\n        list.overflow = null;\n      } // no need to set container bounds as these are handles by CSS fixed height\n\n    } else if (bounds.cappedHeight) {\n      // max-height\n      // not a fixed height panel\n      var isCappedHeight = visualHeight >= bounds.cappedHeight;\n      var panelHeight = Math.min(bounds.cappedHeight, visualHeight);\n      panel.scalable = true;\n      panel.height = isCappedHeight ? panelHeight : panelHeight - listItemMargin.top - listItemMargin.bottom; // available height for list\n\n      var _listAvailableHeight2 = // the height of the panel minus the label height\n      panelHeight - currentLabelHeight - ( // the room we leave open between the end of the list and the panel bottom\n      listMarginBottom - listItemMargin.bottom) - ( // if we're full we need to leave some room between the top of the panel and the list\n      atMaxCapacity ? listMarginTop : 0); // set list height (if is overflowing)\n\n\n      if (visualHeight > bounds.cappedHeight && listHeight.visual > _listAvailableHeight2) {\n        list.overflow = _listAvailableHeight2;\n      } else {\n        list.overflow = null;\n      } // set container bounds (so pushes siblings downwards)\n\n\n      root.height = Math.min(bounds.cappedHeight, boundsHeight - listItemMargin.top - listItemMargin.bottom);\n    } else {\n      // flexible height\n      // not a fixed height panel\n      var itemMargin = totalItems > 0 ? listItemMargin.top + listItemMargin.bottom : 0;\n      panel.scalable = true;\n      panel.height = Math.max(labelHeight, visualHeight - itemMargin); // set container bounds (so pushes siblings downwards)\n\n      root.height = Math.max(labelHeight, boundsHeight - itemMargin);\n    }\n  };\n\n  var calculateListItemMargin = function calculateListItemMargin(root) {\n    var item = root.ref.list.childViews[0].childViews[0];\n    return item ? {\n      top: item.rect.element.marginTop,\n      bottom: item.rect.element.marginBottom\n    } : {\n      top: 0,\n      bottom: 0\n    };\n  };\n\n  var calculateListHeight = function calculateListHeight(root) {\n    var visual = 0;\n    var bounds = 0; // get file list reference\n\n    var scrollList = root.ref.list;\n    var itemList = scrollList.childViews[0];\n    var visibleChildren = itemList.childViews.filter(function (child) {\n      return child.rect.element.height;\n    });\n    var children = root.query('GET_ACTIVE_ITEMS').map(function (item) {\n      return visibleChildren.find(function (child) {\n        return child.id === item.id;\n      });\n    }).filter(function (item) {\n      return item;\n    }); // no children, done!\n\n    if (children.length === 0) return {\n      visual: visual,\n      bounds: bounds\n    };\n    var horizontalSpace = itemList.rect.element.width;\n    var dragIndex = getItemIndexByPosition(itemList, children, scrollList.dragCoordinates);\n    var childRect = children[0].rect.element;\n    var itemVerticalMargin = childRect.marginTop + childRect.marginBottom;\n    var itemHorizontalMargin = childRect.marginLeft + childRect.marginRight;\n    var itemWidth = childRect.width + itemHorizontalMargin;\n    var itemHeight = childRect.height + itemVerticalMargin;\n    var newItem = typeof dragIndex !== 'undefined' && dragIndex >= 0 ? 1 : 0;\n    var removedItem = children.find(function (child) {\n      return child.markedForRemoval && child.opacity < 0.45;\n    }) ? -1 : 0;\n    var verticalItemCount = children.length + newItem + removedItem;\n    var itemsPerRow = Math.round(horizontalSpace / itemWidth); // stack\n\n    if (itemsPerRow === 1) {\n      children.forEach(function (item) {\n        var height = item.rect.element.height + itemVerticalMargin;\n        bounds += height;\n        visual += height * item.opacity;\n      });\n    } // grid\n    else {\n        bounds = Math.ceil(verticalItemCount / itemsPerRow) * itemHeight;\n        visual = bounds;\n      }\n\n    return {\n      visual: visual,\n      bounds: bounds\n    };\n  };\n\n  var calculateRootBoundingBoxHeight = function calculateRootBoundingBoxHeight(root) {\n    var height = root.ref.measureHeight || null;\n    var cappedHeight = parseInt(root.style.maxHeight, 10) || null;\n    var fixedHeight = height === 0 ? null : height;\n    return {\n      cappedHeight: cappedHeight,\n      fixedHeight: fixedHeight\n    };\n  };\n\n  var exceedsMaxFiles = function exceedsMaxFiles(root, items) {\n    var allowReplace = root.query('GET_ALLOW_REPLACE');\n    var allowMultiple = root.query('GET_ALLOW_MULTIPLE');\n    var totalItems = root.query('GET_TOTAL_ITEMS');\n    var maxItems = root.query('GET_MAX_FILES'); // total amount of items being dragged\n\n    var totalBrowseItems = items.length; // if does not allow multiple items and dragging more than one item\n\n    if (!allowMultiple && totalBrowseItems > 1) {\n      return true;\n    } // limit max items to one if not allowed to drop multiple items\n\n\n    maxItems = allowMultiple ? maxItems : allowReplace ? maxItems : 1; // no more room?\n\n    var hasMaxItems = isInt(maxItems);\n\n    if (hasMaxItems && totalItems + totalBrowseItems > maxItems) {\n      root.dispatch('DID_THROW_MAX_FILES', {\n        source: items,\n        error: createResponse('warning', 0, 'Max files')\n      });\n      return true;\n    }\n\n    return false;\n  };\n\n  var getDragIndex = function getDragIndex(list, children, position) {\n    var itemList = list.childViews[0];\n    return getItemIndexByPosition(itemList, children, {\n      left: position.scopeLeft - itemList.rect.element.left,\n      top: position.scopeTop - (list.rect.outer.top + list.rect.element.marginTop + list.rect.element.scrollTop)\n    });\n  };\n  /**\n   * Enable or disable file drop functionality\n   */\n\n\n  var toggleDrop = function toggleDrop(root) {\n    var isAllowed = root.query('GET_ALLOW_DROP');\n    var isDisabled = root.query('GET_DISABLED');\n    var enabled = isAllowed && !isDisabled;\n\n    if (enabled && !root.ref.hopper) {\n      var hopper = createHopper(root.element, function (items) {\n        // these files don't fit so stop here\n        if (exceedsMaxFiles(root, items)) return false; // allow quick validation of dropped items\n\n        var beforeDropFile = root.query('GET_BEFORE_DROP_FILE') || function () {\n          return true;\n        }; // all items should be validated by all filters as valid\n\n\n        var dropValidation = root.query('GET_DROP_VALIDATION');\n        return dropValidation ? items.every(function (item) {\n          return applyFilters('ALLOW_HOPPER_ITEM', item, {\n            query: root.query\n          }).every(function (result) {\n            return result === true;\n          }) && beforeDropFile(item);\n        }) : true;\n      }, {\n        filterItems: function filterItems(items) {\n          var ignoredFiles = root.query('GET_IGNORED_FILES');\n          return items.filter(function (item) {\n            if (isFile(item)) {\n              return !ignoredFiles.includes(item.name.toLowerCase());\n            }\n\n            return true;\n          });\n        },\n        catchesDropsOnPage: root.query('GET_DROP_ON_PAGE'),\n        requiresDropOnElement: root.query('GET_DROP_ON_ELEMENT')\n      });\n\n      hopper.onload = function (items, position) {\n        // get item children elements and sort based on list sort\n        var list = root.ref.list.childViews[0];\n        var visibleChildren = list.childViews.filter(function (child) {\n          return child.rect.element.height;\n        });\n        var children = root.query('GET_ACTIVE_ITEMS').map(function (item) {\n          return visibleChildren.find(function (child) {\n            return child.id === item.id;\n          });\n        }).filter(function (item) {\n          return item;\n        }); // go\n\n        root.dispatch('ADD_ITEMS', {\n          items: items,\n          index: getDragIndex(root.ref.list, children, position),\n          interactionMethod: InteractionMethod.DROP\n        });\n        root.dispatch('DID_DROP', {\n          position: position\n        });\n        root.dispatch('DID_END_DRAG', {\n          position: position\n        });\n      };\n\n      hopper.ondragstart = function (position) {\n        root.dispatch('DID_START_DRAG', {\n          position: position\n        });\n      };\n\n      hopper.ondrag = debounce(function (position) {\n        root.dispatch('DID_DRAG', {\n          position: position\n        });\n      });\n\n      hopper.ondragend = function (position) {\n        root.dispatch('DID_END_DRAG', {\n          position: position\n        });\n      };\n\n      root.ref.hopper = hopper;\n      root.ref.drip = root.appendChildView(root.createChildView(drip));\n    } else if (!enabled && root.ref.hopper) {\n      root.ref.hopper.destroy();\n      root.ref.hopper = null;\n      root.removeChildView(root.ref.drip);\n    }\n  };\n  /**\n   * Enable or disable browse functionality\n   */\n\n\n  var toggleBrowse = function toggleBrowse(root, props) {\n    var isAllowed = root.query('GET_ALLOW_BROWSE');\n    var isDisabled = root.query('GET_DISABLED');\n    var enabled = isAllowed && !isDisabled;\n\n    if (enabled && !root.ref.browser) {\n      root.ref.browser = root.appendChildView(root.createChildView(browser, Object.assign({}, props, {\n        onload: function onload(items) {\n          // these files don't fit so stop here\n          if (exceedsMaxFiles(root, items)) return false; // add items!\n\n          root.dispatch('ADD_ITEMS', {\n            items: items,\n            index: -1,\n            interactionMethod: InteractionMethod.BROWSE\n          });\n        }\n      })), 0);\n    } else if (!enabled && root.ref.browser) {\n      root.removeChildView(root.ref.browser);\n      root.ref.browser = null;\n    }\n  };\n  /**\n   * Enable or disable paste functionality\n   */\n\n\n  var togglePaste = function togglePaste(root) {\n    var isAllowed = root.query('GET_ALLOW_PASTE');\n    var isDisabled = root.query('GET_DISABLED');\n    var enabled = isAllowed && !isDisabled;\n\n    if (enabled && !root.ref.paster) {\n      root.ref.paster = createPaster();\n\n      root.ref.paster.onload = function (items) {\n        root.dispatch('ADD_ITEMS', {\n          items: items,\n          index: -1,\n          interactionMethod: InteractionMethod.PASTE\n        });\n      };\n    } else if (!enabled && root.ref.paster) {\n      root.ref.paster.destroy();\n      root.ref.paster = null;\n    }\n  };\n  /**\n   * Route actions\n   */\n\n\n  var route$5 = createRoute({\n    DID_SET_ALLOW_BROWSE: function DID_SET_ALLOW_BROWSE(_ref5) {\n      var root = _ref5.root,\n          props = _ref5.props;\n      toggleBrowse(root, props);\n    },\n    DID_SET_ALLOW_DROP: function DID_SET_ALLOW_DROP(_ref6) {\n      var root = _ref6.root;\n      toggleDrop(root);\n    },\n    DID_SET_ALLOW_PASTE: function DID_SET_ALLOW_PASTE(_ref7) {\n      var root = _ref7.root;\n      togglePaste(root);\n    },\n    DID_SET_DISABLED: function DID_SET_DISABLED(_ref8) {\n      var root = _ref8.root,\n          props = _ref8.props;\n      toggleDrop(root);\n      togglePaste(root);\n      toggleBrowse(root, props);\n      var isDisabled = root.query('GET_DISABLED');\n\n      if (isDisabled) {\n        root.element.dataset.disabled = 'disabled';\n      } else {\n        // delete root.element.dataset.disabled; <= this does not work on iOS 10\n        root.element.removeAttribute('data-disabled');\n      }\n    }\n  });\n  var root = createView({\n    name: 'root',\n    read: function read(_ref9) {\n      var root = _ref9.root;\n\n      if (root.ref.measure) {\n        root.ref.measureHeight = root.ref.measure.offsetHeight;\n      }\n    },\n    create: create$e,\n    write: write$9,\n    destroy: function destroy(_ref10) {\n      var root = _ref10.root;\n\n      if (root.ref.paster) {\n        root.ref.paster.destroy();\n      }\n\n      if (root.ref.hopper) {\n        root.ref.hopper.destroy();\n      }\n\n      root.element.removeEventListener('touchmove', prevent);\n      root.element.removeEventListener('gesturestart', prevent);\n    },\n    mixins: {\n      styles: ['height']\n    }\n  }); // creates the app\n\n  var createApp = function createApp() {\n    var initialOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {}; // let element\n\n    var originalElement = null; // get default options\n\n    var defaultOptions = getOptions(); // create the data store, this will contain all our app info\n\n    var store = createStore( // initial state (should be serializable)\n    createInitialState(defaultOptions), // queries\n    [queries, createOptionQueries(defaultOptions)], // action handlers\n    [actions, createOptionActions(defaultOptions)]); // set initial options\n\n    store.dispatch('SET_OPTIONS', {\n      options: initialOptions\n    }); // kick thread if visibility changes\n\n    var visibilityHandler = function visibilityHandler() {\n      if (document.hidden) return;\n      store.dispatch('KICK');\n    };\n\n    document.addEventListener('visibilitychange', visibilityHandler); // re-render on window resize start and finish\n\n    var resizeDoneTimer = null;\n    var isResizing = false;\n    var isResizingHorizontally = false;\n    var initialWindowWidth = null;\n    var currentWindowWidth = null;\n\n    var resizeHandler = function resizeHandler() {\n      if (!isResizing) {\n        isResizing = true;\n      }\n\n      clearTimeout(resizeDoneTimer);\n      resizeDoneTimer = setTimeout(function () {\n        isResizing = false;\n        initialWindowWidth = null;\n        currentWindowWidth = null;\n\n        if (isResizingHorizontally) {\n          isResizingHorizontally = false;\n          store.dispatch('DID_STOP_RESIZE');\n        }\n      }, 500);\n    };\n\n    window.addEventListener('resize', resizeHandler); // render initial view\n\n    var view = root(store, {\n      id: getUniqueId()\n    }); //\n    // PRIVATE API -------------------------------------------------------------------------------------\n    //\n\n    var isResting = false;\n    var isHidden = false;\n    var readWriteApi = {\n      // necessary for update loop\n\n      /**\n       * Reads from dom (never call manually)\n       * @private\n       */\n      _read: function _read() {\n        // test if we're resizing horizontally\n        // TODO: see if we can optimize this by measuring root rect\n        if (isResizing) {\n          currentWindowWidth = window.innerWidth;\n\n          if (!initialWindowWidth) {\n            initialWindowWidth = currentWindowWidth;\n          }\n\n          if (!isResizingHorizontally && currentWindowWidth !== initialWindowWidth) {\n            store.dispatch('DID_START_RESIZE');\n            isResizingHorizontally = true;\n          }\n        }\n\n        if (isHidden && isResting) {\n          // test if is no longer hidden\n          isResting = view.element.offsetParent === null;\n        } // if resting, no need to read as numbers will still all be correct\n\n\n        if (isResting) return; // read view data\n\n        view._read(); // if is hidden we need to know so we exit rest mode when revealed\n\n\n        isHidden = view.rect.element.hidden;\n      },\n\n      /**\n       * Writes to dom (never call manually)\n       * @private\n       */\n      _write: function _write(ts) {\n        // get all actions from store\n        var actions = store.processActionQueue() // filter out set actions (these will automatically trigger DID_SET)\n        .filter(function (action) {\n          return !/^SET_/.test(action.type);\n        }); // if was idling and no actions stop here\n\n        if (isResting && !actions.length) return; // some actions might trigger events\n\n        routeActionsToEvents(actions); // update the view\n\n        isResting = view._write(ts, actions, isResizingHorizontally); // will clean up all archived items\n\n        removeReleasedItems(store.query('GET_ITEMS')); // now idling\n\n        if (isResting) {\n          store.processDispatchQueue();\n        }\n      }\n    }; //\n    // EXPOSE EVENTS -------------------------------------------------------------------------------------\n    //\n\n    var createEvent = function createEvent(name) {\n      return function (data) {\n        // create default event\n        var event = {\n          type: name\n        }; // no data to add\n\n        if (!data) {\n          return event;\n        } // copy relevant props\n\n\n        if (data.hasOwnProperty('error')) {\n          event.error = data.error ? Object.assign({}, data.error) : null;\n        }\n\n        if (data.status) {\n          event.status = Object.assign({}, data.status);\n        }\n\n        if (data.file) {\n          event.output = data.file;\n        } // only source is available, else add item if possible\n\n\n        if (data.source) {\n          event.file = data.source;\n        } else if (data.item || data.id) {\n          var item = data.item ? data.item : store.query('GET_ITEM', data.id);\n          event.file = item ? createItemAPI(item) : null;\n        } // map all items in a possible items array\n\n\n        if (data.items) {\n          event.items = data.items.map(createItemAPI);\n        } // if this is a progress event add the progress amount\n\n\n        if (/progress/.test(name)) {\n          event.progress = data.progress;\n        } // copy relevant props\n\n\n        if (data.hasOwnProperty('origin') && data.hasOwnProperty('target')) {\n          event.origin = data.origin;\n          event.target = data.target;\n        }\n\n        return event;\n      };\n    };\n\n    var eventRoutes = {\n      DID_DESTROY: createEvent('destroy'),\n      DID_INIT: createEvent('init'),\n      DID_THROW_MAX_FILES: createEvent('warning'),\n      DID_INIT_ITEM: createEvent('initfile'),\n      DID_START_ITEM_LOAD: createEvent('addfilestart'),\n      DID_UPDATE_ITEM_LOAD_PROGRESS: createEvent('addfileprogress'),\n      DID_LOAD_ITEM: createEvent('addfile'),\n      DID_THROW_ITEM_INVALID: [createEvent('error'), createEvent('addfile')],\n      DID_THROW_ITEM_LOAD_ERROR: [createEvent('error'), createEvent('addfile')],\n      DID_THROW_ITEM_REMOVE_ERROR: [createEvent('error'), createEvent('removefile')],\n      DID_PREPARE_OUTPUT: createEvent('preparefile'),\n      DID_START_ITEM_PROCESSING: createEvent('processfilestart'),\n      DID_UPDATE_ITEM_PROCESS_PROGRESS: createEvent('processfileprogress'),\n      DID_ABORT_ITEM_PROCESSING: createEvent('processfileabort'),\n      DID_COMPLETE_ITEM_PROCESSING: createEvent('processfile'),\n      DID_COMPLETE_ITEM_PROCESSING_ALL: createEvent('processfiles'),\n      DID_REVERT_ITEM_PROCESSING: createEvent('processfilerevert'),\n      DID_THROW_ITEM_PROCESSING_ERROR: [createEvent('error'), createEvent('processfile')],\n      DID_REMOVE_ITEM: createEvent('removefile'),\n      DID_UPDATE_ITEMS: createEvent('updatefiles'),\n      DID_ACTIVATE_ITEM: createEvent('activatefile'),\n      DID_REORDER_ITEMS: createEvent('reorderfiles')\n    };\n\n    var exposeEvent = function exposeEvent(event) {\n      // create event object to be dispatched\n      var detail = Object.assign({\n        pond: exports\n      }, event);\n      delete detail.type;\n      view.element.dispatchEvent(new CustomEvent('FilePond:' + event.type, {\n        // event info\n        detail: detail,\n        // event behaviour\n        bubbles: true,\n        cancelable: true,\n        composed: true // triggers listeners outside of shadow root\n\n      })); // event object to params used for `on()` event handlers and callbacks `oninit()`\n\n      var params = []; // if is possible error event, make it the first param\n\n      if (event.hasOwnProperty('error')) {\n        params.push(event.error);\n      } // file is always section\n\n\n      if (event.hasOwnProperty('file')) {\n        params.push(event.file);\n      } // append other props\n\n\n      var filtered = ['type', 'error', 'file'];\n      Object.keys(event).filter(function (key) {\n        return !filtered.includes(key);\n      }).forEach(function (key) {\n        return params.push(event[key]);\n      }); // on(type, () => { })\n\n      exports.fire.apply(exports, [event.type].concat(params)); // oninit = () => {}\n\n      var handler = store.query('GET_ON' + event.type.toUpperCase());\n\n      if (handler) {\n        handler.apply(void 0, params);\n      }\n    };\n\n    var routeActionsToEvents = function routeActionsToEvents(actions) {\n      if (!actions.length) return;\n      actions.filter(function (action) {\n        return eventRoutes[action.type];\n      }).forEach(function (action) {\n        var routes = eventRoutes[action.type];\n        (Array.isArray(routes) ? routes : [routes]).forEach(function (route) {\n          // this isn't fantastic, but because of the stacking of settimeouts plugins can handle the did_load before the did_init\n          if (action.type === 'DID_INIT_ITEM') {\n            exposeEvent(route(action.data));\n          } else {\n            setTimeout(function () {\n              exposeEvent(route(action.data));\n            }, 0);\n          }\n        });\n      });\n    }; //\n    // PUBLIC API -------------------------------------------------------------------------------------\n    //\n\n\n    var setOptions = function setOptions(options) {\n      return store.dispatch('SET_OPTIONS', {\n        options: options\n      });\n    };\n\n    var getFile = function getFile(query) {\n      return store.query('GET_ACTIVE_ITEM', query);\n    };\n\n    var prepareFile = function prepareFile(query) {\n      return new Promise(function (resolve, reject) {\n        store.dispatch('REQUEST_ITEM_PREPARE', {\n          query: query,\n          success: function success(item) {\n            resolve(item);\n          },\n          failure: function failure(error) {\n            reject(error);\n          }\n        });\n      });\n    };\n\n    var addFile = function addFile(source) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return new Promise(function (resolve, reject) {\n        addFiles([{\n          source: source,\n          options: options\n        }], {\n          index: options.index\n        }).then(function (items) {\n          return resolve(items && items[0]);\n        }).catch(reject);\n      });\n    };\n\n    var isFilePondFile = function isFilePondFile(obj) {\n      return obj.file && obj.id;\n    };\n\n    var removeFile = function removeFile(query, options) {\n      // if only passed options\n      if (typeof query === 'object' && !isFilePondFile(query) && !options) {\n        options = query;\n        query = undefined;\n      } // request item removal\n\n\n      store.dispatch('REMOVE_ITEM', Object.assign({}, options, {\n        query: query\n      })); // see if item has been removed\n\n      return store.query('GET_ACTIVE_ITEM', query) === null;\n    };\n\n    var addFiles = function addFiles() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return new Promise(function (resolve, reject) {\n        var sources = [];\n        var options = {}; // user passed a sources array\n\n        if (isArray(args[0])) {\n          sources.push.apply(sources, args[0]);\n          Object.assign(options, args[1] || {});\n        } else {\n          // user passed sources as arguments, last one might be options object\n          var lastArgument = args[args.length - 1];\n\n          if (typeof lastArgument === 'object' && !(lastArgument instanceof Blob)) {\n            Object.assign(options, args.pop());\n          } // add rest to sources\n\n\n          sources.push.apply(sources, args);\n        }\n\n        store.dispatch('ADD_ITEMS', {\n          items: sources,\n          index: options.index,\n          interactionMethod: InteractionMethod.API,\n          success: resolve,\n          failure: reject\n        });\n      });\n    };\n\n    var getFiles = function getFiles() {\n      return store.query('GET_ACTIVE_ITEMS');\n    };\n\n    var processFile = function processFile(query) {\n      return new Promise(function (resolve, reject) {\n        store.dispatch('REQUEST_ITEM_PROCESSING', {\n          query: query,\n          success: function success(item) {\n            resolve(item);\n          },\n          failure: function failure(error) {\n            reject(error);\n          }\n        });\n      });\n    };\n\n    var prepareFiles = function prepareFiles() {\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n\n      var queries = Array.isArray(args[0]) ? args[0] : args;\n      var items = queries.length ? queries : getFiles();\n      return Promise.all(items.map(prepareFile));\n    };\n\n    var processFiles = function processFiles() {\n      for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n        args[_key3] = arguments[_key3];\n      }\n\n      var queries = Array.isArray(args[0]) ? args[0] : args;\n\n      if (!queries.length) {\n        var files = getFiles().filter(function (item) {\n          return !(item.status === ItemStatus.IDLE && item.origin === FileOrigin.LOCAL) && item.status !== ItemStatus.PROCESSING && item.status !== ItemStatus.PROCESSING_COMPLETE && item.status !== ItemStatus.PROCESSING_REVERT_ERROR;\n        });\n        return Promise.all(files.map(processFile));\n      }\n\n      return Promise.all(queries.map(processFile));\n    };\n\n    var removeFiles = function removeFiles() {\n      for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        args[_key4] = arguments[_key4];\n      }\n\n      var queries = Array.isArray(args[0]) ? args[0] : args;\n      var options;\n\n      if (typeof queries[queries.length - 1] === 'object') {\n        options = queries.pop();\n      } else if (Array.isArray(args[0])) {\n        options = args[1];\n      }\n\n      var files = getFiles();\n      if (!queries.length) return Promise.all(files.map(function (file) {\n        return removeFile(file, options);\n      })); // when removing by index the indexes shift after each file removal so we need to convert indexes to ids\n\n      var mappedQueries = queries.map(function (query) {\n        return isNumber(query) ? files[query] ? files[query].id : null : query;\n      }).filter(function (query) {\n        return query;\n      });\n      return mappedQueries.map(function (q) {\n        return removeFile(q, options);\n      });\n    };\n\n    var exports = Object.assign({}, on(), {}, readWriteApi, {}, createOptionAPI(store, defaultOptions), {\n      /**\n       * Override options defined in options object\n       * @param options\n       */\n      setOptions: setOptions,\n\n      /**\n       * Load the given file\n       * @param source - the source of the file (either a File, base64 data uri or url)\n       * @param options - object, { index: 0 }\n       */\n      addFile: addFile,\n\n      /**\n       * Load the given files\n       * @param sources - the sources of the files to load\n       * @param options - object, { index: 0 }\n       */\n      addFiles: addFiles,\n\n      /**\n       * Returns the file objects matching the given query\n       * @param query { string, number, null }\n       */\n      getFile: getFile,\n\n      /**\n       * Upload file with given name\n       * @param query { string, number, null  }\n       */\n      processFile: processFile,\n\n      /**\n       * Request prepare output for file with given name\n       * @param query { string, number, null  }\n       */\n      prepareFile: prepareFile,\n\n      /**\n       * Removes a file by its name\n       * @param query { string, number, null  }\n       */\n      removeFile: removeFile,\n\n      /**\n       * Moves a file to a new location in the files list\n       */\n      moveFile: function moveFile(query, index) {\n        return store.dispatch('MOVE_ITEM', {\n          query: query,\n          index: index\n        });\n      },\n\n      /**\n       * Returns all files (wrapped in public api)\n       */\n      getFiles: getFiles,\n\n      /**\n       * Starts uploading all files\n       */\n      processFiles: processFiles,\n\n      /**\n       * Clears all files from the files list\n       */\n      removeFiles: removeFiles,\n\n      /**\n       * Starts preparing output of all files\n       */\n      prepareFiles: prepareFiles,\n\n      /**\n       * Sort list of files\n       */\n      sort: function sort(compare) {\n        return store.dispatch('SORT', {\n          compare: compare\n        });\n      },\n\n      /**\n       * Browse the file system for a file\n       */\n      browse: function browse() {\n        // needs to be trigger directly as user action needs to be traceable (is not traceable in requestAnimationFrame)\n        var input = view.element.querySelector('input[type=file]');\n\n        if (input) {\n          input.click();\n        }\n      },\n\n      /**\n       * Destroys the app\n       */\n      destroy: function destroy() {\n        // request destruction\n        exports.fire('destroy', view.element); // stop active processes (file uploads, fetches, stuff like that)\n        // loop over items and depending on states call abort for ongoing processes\n\n        store.dispatch('ABORT_ALL'); // destroy view\n\n        view._destroy(); // stop listening to resize\n\n\n        window.removeEventListener('resize', resizeHandler); // stop listening to the visiblitychange event\n\n        document.removeEventListener('visibilitychange', visibilityHandler); // dispatch destroy\n\n        store.dispatch('DID_DESTROY');\n      },\n\n      /**\n       * Inserts the plugin before the target element\n       */\n      insertBefore: function insertBefore$1(element) {\n        return insertBefore(view.element, element);\n      },\n\n      /**\n       * Inserts the plugin after the target element\n       */\n      insertAfter: function insertAfter$1(element) {\n        return insertAfter(view.element, element);\n      },\n\n      /**\n       * Appends the plugin to the target element\n       */\n      appendTo: function appendTo(element) {\n        return element.appendChild(view.element);\n      },\n\n      /**\n       * Replaces an element with the app\n       */\n      replaceElement: function replaceElement(element) {\n        // insert the app before the element\n        insertBefore(view.element, element); // remove the original element\n\n        element.parentNode.removeChild(element); // remember original element\n\n        originalElement = element;\n      },\n\n      /**\n       * Restores the original element\n       */\n      restoreElement: function restoreElement() {\n        if (!originalElement) {\n          return; // no element to restore\n        } // restore original element\n\n\n        insertAfter(originalElement, view.element); // remove our element\n\n        view.element.parentNode.removeChild(view.element); // remove reference\n\n        originalElement = null;\n      },\n\n      /**\n       * Returns true if the app root is attached to given element\n       * @param element\n       */\n      isAttachedTo: function isAttachedTo(element) {\n        return view.element === element || originalElement === element;\n      },\n\n      /**\n       * Returns the root element\n       */\n      element: {\n        get: function get() {\n          return view.element;\n        }\n      },\n\n      /**\n       * Returns the current pond status\n       */\n      status: {\n        get: function get() {\n          return store.query('GET_STATUS');\n        }\n      }\n    }); // Done!\n\n    store.dispatch('DID_INIT'); // create actual api object\n\n    return createObject(exports);\n  };\n\n  var createAppObject = function createAppObject() {\n    var customOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {}; // default options\n\n    var defaultOptions = {};\n    forin(getOptions(), function (key, value) {\n      defaultOptions[key] = value[0];\n    }); // set app options\n\n    var app = createApp(Object.assign({}, defaultOptions, {}, customOptions)); // return the plugin instance\n\n    return app;\n  };\n\n  var lowerCaseFirstLetter = function lowerCaseFirstLetter(string) {\n    return string.charAt(0).toLowerCase() + string.slice(1);\n  };\n\n  var attributeNameToPropertyName = function attributeNameToPropertyName(attributeName) {\n    return toCamels(attributeName.replace(/^data-/, ''));\n  };\n\n  var mapObject = function mapObject(object, propertyMap) {\n    // remove unwanted\n    forin(propertyMap, function (selector, mapping) {\n      forin(object, function (property, value) {\n        // create regexp shortcut\n        var selectorRegExp = new RegExp(selector); // tests if\n\n        var matches = selectorRegExp.test(property); // no match, skip\n\n        if (!matches) {\n          return;\n        } // if there's a mapping, the original property is always removed\n\n\n        delete object[property]; // should only remove, we done!\n\n        if (mapping === false) {\n          return;\n        } // move value to new property\n\n\n        if (isString(mapping)) {\n          object[mapping] = value;\n          return;\n        } // move to group\n\n\n        var group = mapping.group;\n\n        if (isObject(mapping) && !object[group]) {\n          object[group] = {};\n        }\n\n        object[group][lowerCaseFirstLetter(property.replace(selectorRegExp, ''))] = value;\n      }); // do submapping\n\n      if (mapping.mapping) {\n        mapObject(object[mapping.group], mapping.mapping);\n      }\n    });\n  };\n\n  var getAttributesAsObject = function getAttributesAsObject(node) {\n    var attributeMapping = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {}; // turn attributes into object\n\n    var attributes = [];\n    forin(node.attributes, function (index) {\n      attributes.push(node.attributes[index]);\n    });\n    var output = attributes.filter(function (attribute) {\n      return attribute.name;\n    }).reduce(function (obj, attribute) {\n      var value = attr(node, attribute.name);\n      obj[attributeNameToPropertyName(attribute.name)] = value === attribute.name ? true : value;\n      return obj;\n    }, {}); // do mapping of object properties\n\n    mapObject(output, attributeMapping);\n    return output;\n  };\n\n  var createAppAtElement = function createAppAtElement(element) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {}; // how attributes of the input element are mapped to the options for the plugin\n\n    var attributeMapping = {\n      // translate to other name\n      '^class$': 'className',\n      '^multiple$': 'allowMultiple',\n      '^capture$': 'captureMethod',\n      '^webkitdirectory$': 'allowDirectoriesOnly',\n      // group under single property\n      '^server': {\n        group: 'server',\n        mapping: {\n          '^process': {\n            group: 'process'\n          },\n          '^revert': {\n            group: 'revert'\n          },\n          '^fetch': {\n            group: 'fetch'\n          },\n          '^restore': {\n            group: 'restore'\n          },\n          '^load': {\n            group: 'load'\n          }\n        }\n      },\n      // don't include in object\n      '^type$': false,\n      '^files$': false\n    }; // add additional option translators\n\n    applyFilters('SET_ATTRIBUTE_TO_OPTION_MAP', attributeMapping); // create final options object by setting options object and then overriding options supplied on element\n\n    var mergedOptions = Object.assign({}, options);\n    var attributeOptions = getAttributesAsObject(element.nodeName === 'FIELDSET' ? element.querySelector('input[type=file]') : element, attributeMapping); // merge with options object\n\n    Object.keys(attributeOptions).forEach(function (key) {\n      if (isObject(attributeOptions[key])) {\n        if (!isObject(mergedOptions[key])) {\n          mergedOptions[key] = {};\n        }\n\n        Object.assign(mergedOptions[key], attributeOptions[key]);\n      } else {\n        mergedOptions[key] = attributeOptions[key];\n      }\n    }); // if parent is a fieldset, get files from parent by selecting all input fields that are not file upload fields\n    // these will then be automatically set to the initial files\n\n    mergedOptions.files = (options.files || []).concat(Array.from(element.querySelectorAll('input:not([type=file])')).map(function (input) {\n      return {\n        source: input.value,\n        options: {\n          type: input.dataset.type\n        }\n      };\n    })); // build plugin\n\n    var app = createAppObject(mergedOptions); // add already selected files\n\n    if (element.files) {\n      Array.from(element.files).forEach(function (file) {\n        app.addFile(file);\n      });\n    } // replace the target element\n\n\n    app.replaceElement(element); // expose\n\n    return app;\n  }; // if an element is passed, we create the instance at that element, if not, we just create an up object\n\n\n  var createApp$1 = function createApp() {\n    return isNode(arguments.length <= 0 ? undefined : arguments[0]) ? createAppAtElement.apply(void 0, arguments) : createAppObject.apply(void 0, arguments);\n  };\n\n  var PRIVATE_METHODS = ['fire', '_read', '_write'];\n\n  var createAppAPI = function createAppAPI(app) {\n    var api = {};\n    copyObjectPropertiesToObject(app, api, PRIVATE_METHODS);\n    return api;\n  };\n  /**\n   * Replaces placeholders in given string with replacements\n   * @param string - \"Foo {bar}\"\"\n   * @param replacements - { \"bar\": 10 }\n   */\n\n\n  var replaceInString = function replaceInString(string, replacements) {\n    return string.replace(/(?:{([a-zA-Z]+)})/g, function (match, group) {\n      return replacements[group];\n    });\n  };\n\n  var createWorker = function createWorker(fn) {\n    var workerBlob = new Blob(['(', fn.toString(), ')()'], {\n      type: 'application/javascript'\n    });\n    var workerURL = URL.createObjectURL(workerBlob);\n    var worker = new Worker(workerURL);\n    return {\n      transfer: function transfer(message, cb) {},\n      post: function post(message, cb, transferList) {\n        var id = getUniqueId();\n\n        worker.onmessage = function (e) {\n          if (e.data.id === id) {\n            cb(e.data.message);\n          }\n        };\n\n        worker.postMessage({\n          id: id,\n          message: message\n        }, transferList);\n      },\n      terminate: function terminate() {\n        worker.terminate();\n        URL.revokeObjectURL(workerURL);\n      }\n    };\n  };\n\n  var loadImage = function loadImage(url) {\n    return new Promise(function (resolve, reject) {\n      var img = new Image();\n\n      img.onload = function () {\n        resolve(img);\n      };\n\n      img.onerror = function (e) {\n        reject(e);\n      };\n\n      img.src = url;\n    });\n  };\n\n  var renameFile = function renameFile(file, name) {\n    var renamedFile = file.slice(0, file.size, file.type);\n    renamedFile.lastModifiedDate = file.lastModifiedDate;\n    renamedFile.name = name;\n    return renamedFile;\n  };\n\n  var copyFile = function copyFile(file) {\n    return renameFile(file, file.name);\n  }; // already registered plugins (can't register twice)\n\n\n  var registeredPlugins = []; // pass utils to plugin\n\n  var createAppPlugin = function createAppPlugin(plugin) {\n    // already registered\n    if (registeredPlugins.includes(plugin)) {\n      return;\n    } // remember this plugin\n\n\n    registeredPlugins.push(plugin); // setup!\n\n    var pluginOutline = plugin({\n      addFilter: addFilter,\n      utils: {\n        Type: Type,\n        forin: forin,\n        isString: isString,\n        isFile: isFile,\n        toNaturalFileSize: toNaturalFileSize,\n        replaceInString: replaceInString,\n        getExtensionFromFilename: getExtensionFromFilename,\n        getFilenameWithoutExtension: getFilenameWithoutExtension,\n        guesstimateMimeType: guesstimateMimeType,\n        getFileFromBlob: getFileFromBlob,\n        getFilenameFromURL: getFilenameFromURL,\n        createRoute: createRoute,\n        createWorker: createWorker,\n        createView: createView,\n        createItemAPI: createItemAPI,\n        loadImage: loadImage,\n        copyFile: copyFile,\n        renameFile: renameFile,\n        createBlob: createBlob,\n        applyFilterChain: applyFilterChain,\n        text: text,\n        getNumericAspectRatioFromString: getNumericAspectRatioFromString\n      },\n      views: {\n        fileActionButton: fileActionButton\n      }\n    }); // add plugin options to default options\n\n    extendDefaultOptions(pluginOutline.options);\n  }; // feature detection used by supported() method\n\n\n  var isOperaMini = function isOperaMini() {\n    return Object.prototype.toString.call(window.operamini) === '[object OperaMini]';\n  };\n\n  var hasPromises = function hasPromises() {\n    return 'Promise' in window;\n  };\n\n  var hasBlobSlice = function hasBlobSlice() {\n    return 'slice' in Blob.prototype;\n  };\n\n  var hasCreateObjectURL = function hasCreateObjectURL() {\n    return 'URL' in window && 'createObjectURL' in window.URL;\n  };\n\n  var hasVisibility = function hasVisibility() {\n    return 'visibilityState' in document;\n  };\n\n  var hasTiming = function hasTiming() {\n    return 'performance' in window;\n  }; // iOS 8.x\n\n\n  var hasCSSSupports = function hasCSSSupports() {\n    return 'supports' in (window.CSS || {});\n  }; // use to detect Safari 9+\n\n\n  var isIE11 = function isIE11() {\n    return /MSIE|Trident/.test(window.navigator.userAgent);\n  };\n\n  var supported = function () {\n    // Runs immidiately and then remembers result for subsequent calls\n    var isSupported = // Has to be a browser\n    isBrowser() && // Can't run on Opera Mini due to lack of everything\n    !isOperaMini() && // Require these APIs to feature detect a modern browser\n    hasVisibility() && hasPromises() && hasBlobSlice() && hasCreateObjectURL() && hasTiming() && ( // doesn't need CSSSupports but is a good way to detect Safari 9+ (we do want to support IE11 though)\n    hasCSSSupports() || isIE11());\n    return function () {\n      return isSupported;\n    };\n  }();\n  /**\n   * Plugin internal state (over all instances)\n   */\n\n\n  var state = {\n    // active app instances, used to redraw the apps and to find the later\n    apps: []\n  }; // plugin name\n\n  var name = 'filepond';\n  /**\n   * Public Plugin methods\n   */\n\n  var fn = function fn() {};\n\n  exports.Status = {};\n  exports.FileStatus = {};\n  exports.FileOrigin = {};\n  exports.OptionTypes = {};\n  exports.create = fn;\n  exports.destroy = fn;\n  exports.parse = fn;\n  exports.find = fn;\n  exports.registerPlugin = fn;\n  exports.getOptions = fn;\n  exports.setOptions = fn; // if not supported, no API\n\n  if (supported()) {\n    // start painter and fire load event\n    createPainter(function () {\n      state.apps.forEach(function (app) {\n        return app._read();\n      });\n    }, function (ts) {\n      state.apps.forEach(function (app) {\n        return app._write(ts);\n      });\n    }); // fire loaded event so we know when FilePond is available\n\n    var dispatch = function dispatch() {\n      // let others know we have area ready\n      document.dispatchEvent(new CustomEvent('FilePond:loaded', {\n        detail: {\n          supported: supported,\n          create: exports.create,\n          destroy: exports.destroy,\n          parse: exports.parse,\n          find: exports.find,\n          registerPlugin: exports.registerPlugin,\n          setOptions: exports.setOptions\n        }\n      })); // clean up event\n\n      document.removeEventListener('DOMContentLoaded', dispatch);\n    };\n\n    if (document.readyState !== 'loading') {\n      // move to back of execution queue, FilePond should have been exported by then\n      setTimeout(function () {\n        return dispatch();\n      }, 0);\n    } else {\n      document.addEventListener('DOMContentLoaded', dispatch);\n    } // updates the OptionTypes object based on the current options\n\n\n    var updateOptionTypes = function updateOptionTypes() {\n      return forin(getOptions(), function (key, value) {\n        exports.OptionTypes[key] = value[1];\n      });\n    };\n\n    exports.Status = Object.assign({}, Status);\n    exports.FileOrigin = Object.assign({}, FileOrigin);\n    exports.FileStatus = Object.assign({}, ItemStatus);\n    exports.OptionTypes = {};\n    updateOptionTypes(); // create method, creates apps and adds them to the app array\n\n    exports.create = function create() {\n      var app = createApp$1.apply(void 0, arguments);\n      app.on('destroy', exports.destroy);\n      state.apps.push(app);\n      return createAppAPI(app);\n    }; // destroys apps and removes them from the app array\n\n\n    exports.destroy = function destroy(hook) {\n      // returns true if the app was destroyed successfully\n      var indexToRemove = state.apps.findIndex(function (app) {\n        return app.isAttachedTo(hook);\n      });\n\n      if (indexToRemove >= 0) {\n        // remove from apps\n        var app = state.apps.splice(indexToRemove, 1)[0]; // restore original dom element\n\n        app.restoreElement();\n        return true;\n      }\n\n      return false;\n    }; // parses the given context for plugins (does not include the context element itself)\n\n\n    exports.parse = function parse(context) {\n      // get all possible hooks\n      var matchedHooks = Array.from(context.querySelectorAll('.' + name)); // filter out already active hooks\n\n      var newHooks = matchedHooks.filter(function (newHook) {\n        return !state.apps.find(function (app) {\n          return app.isAttachedTo(newHook);\n        });\n      }); // create new instance for each hook\n\n      return newHooks.map(function (hook) {\n        return exports.create(hook);\n      });\n    }; // returns an app based on the given element hook\n\n\n    exports.find = function find(hook) {\n      var app = state.apps.find(function (app) {\n        return app.isAttachedTo(hook);\n      });\n\n      if (!app) {\n        return null;\n      }\n\n      return createAppAPI(app);\n    }; // adds a plugin extension\n\n\n    exports.registerPlugin = function registerPlugin() {\n      for (var _len = arguments.length, plugins = new Array(_len), _key = 0; _key < _len; _key++) {\n        plugins[_key] = arguments[_key];\n      } // register plugins\n\n\n      plugins.forEach(createAppPlugin); // update OptionTypes, each plugin might have extended the default options\n\n      updateOptionTypes();\n    };\n\n    exports.getOptions = function getOptions$1() {\n      var opts = {};\n      forin(getOptions(), function (key, value) {\n        opts[key] = value[0];\n      });\n      return opts;\n    };\n\n    exports.setOptions = function setOptions$1(opts) {\n      if (isObject(opts)) {\n        // update existing plugins\n        state.apps.forEach(function (app) {\n          app.setOptions(opts);\n        }); // override defaults\n\n        setOptions(opts);\n      } // return new options\n\n\n      return exports.getOptions();\n    };\n  }\n\n  exports.supported = supported;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","map":{"version":3,"sources":["/home/sutirth/projects/personal/bankathon/-bank/Front/node_modules/filepond/dist/filepond.js"],"names":["global","factory","exports","module","define","amd","self","FilePond","isNode","value","HTMLElement","createStore","initialState","queries","arguments","length","undefined","actions","state","Object","assign","actionQueue","dispatchQueue","getState","processActionQueue","queue","concat","processDispatchQueue","forEach","_ref","type","data","dispatch","isBlocking","document","hidden","push","actionHandlers","query","str","_queryHandles","_len","args","Array","_key","queryHandles","apply","api","action","defineProperty","obj","property","definition","forin","cb","key","hasOwnProperty","createObject","attr","node","name","getAttribute","hasAttribute","setAttribute","ns","svgElements","isSVGElement","tag","includes","createElement","className","attributes","element","createElementNS","appendChild","parent","child","index","children","insertBefore","appendChildView","childViews","view","splice","removeChildView","indexOf","parentNode","removeChild","IS_BROWSER","window","isBrowser","testElement","getChildCount","el","childNodes","getViewRect","elementRect","offset","scale","left","top","right","width","bottom","height","rect","inner","outer","filter","childView","isRectIgnored","map","childViewRect","expandRect","calculateRectSize","marginBottom","marginRight","isNumber","thereYet","position","destination","velocity","errorMargin","Math","abs","spring","_ref$stiffness","stiffness","_ref$damping","damping","_ref$mass","mass","target","resting","interpolate","ts","skipToEndState","f","onupdate","oncomplete","setTarget","set","get","easeLinear","t","easeInOutQuad","tween","_ref$duration","duration","_ref$easing","easing","_ref$delay","delay","start","p","reverse","animator","createAnimator","category","def","props","addGetSet","keys","overwrite","isArray","o","getter","setter","animations","mixinConfig","viewProps","viewInternalAPI","viewExternalAPI","initialProps","animation","prop","write","destroy","addEvent","fn","addEventListener","removeEvent","removeEventListener","listeners","viewState","events","add","remove","on","off","findIndex","event","apis","isDefined","defaults","opacity","scaleX","scaleY","translateX","translateY","rotateX","rotateY","rotateZ","originX","originY","styles","currentProps","getOffset","getScale","getRect","propsHaveChanged","applyStyles","newProps","_ref2","perspective","transforms","elementCurrentStyle","style","cssText","Mixins","updateRect","layoutCalculated","paddingTop","parseInt","marginTop","marginLeft","offsetLeft","offsetTop","offsetWidth","offsetHeight","scrollTop","offsetParent","createView","_ref$tag","_ref$name","_ref$attributes","_ref$read","read","_ref$write","_ref$create","create","_ref$destroy","_ref$filterFrameActio","filterFrameActionsForChild","_ref$didCreateView","didCreateView","_ref$didWriteView","didWriteView","_ref$ignoreRect","ignoreRect","_ref$ignoreRectUpdate","ignoreRectUpdate","_ref$mixins","mixins","store","getComputedStyle","frameRect","isResting","activeMixins","ref","writers","readers","destroyers","getElement","getChildViews","getReference","createChildView","getStyle","_read","shouldUpdate","root","internalAPI","reader","_write","frameActions","shouldOptimize","writer","writerResting","timestamp","mixin","mixinResting","childResting","_destroy","destroyer","sharedAPIDefinition","internalAPIDefinition","is","needle","linkView","unlinkView","registerWriter","registerReader","registerDestroyer","invalidateLayout","externalAPIDefinition","mixinAPIDefinition","sort","a","b","mixinAPI","childCount","createPainter","fps","painter","interval","last","id","requestTick","cancelTick","setTimerType","setTimeout","tick","performance","now","clearTimeout","requestAnimationFrame","cancelAnimationFrame","delta","pause","createRoute","routes","_ref$actions","newNode","referenceNode","insertAfter","nextSibling","isEmpty","trim","toString","toArray","splitter","split","isBoolean","toBoolean","isString","toNumber","replace","toInt","toFloat","parseFloat","isInt","isFinite","floor","toBytes","naturalFileSize","test","isFunction","toFunctionReference","string","levels","level","shift","methods","process","patch","revert","fetch","restore","load","createServerAPI","outline","url","timeout","headers","createAction","method","withCredentials","onload","ondata","onerror","parts","header","toServerAPI","isNull","isObject","isAPI","getType","replaceSingleQuotes","conversionTable","array","boolean","int","number","float","bytes","function","_function","serverapi","object","JSON","parse","e","convertTo","getValueByType","newValue","defaultValue","valueType","newValueType","convertedValue","option","createOption","currentValue","enumerable","createOptions","options","optionDefinition","createInitialState","items","listUpdateTimeout","itemUpdateTimeout","processingQueue","fromCamels","separator","part","toLowerCase","join","createOptionAPI","toUpperCase","createOptionActions","createOptionQueries","InteractionMethod","API","DROP","BROWSE","PASTE","NONE","getUniqueId","random","substr","_typeof","Symbol","iterator","constructor","prototype","REACT_ELEMENT_TYPE","_jsx","defaultProps","childrenLength","propName","childArray","i","$$typeof","_owner","_asyncIterator","iterable","asyncIterator","call","TypeError","_AwaitValue","wrapped","_AsyncGenerator","gen","front","back","send","arg","Promise","resolve","reject","request","next","resume","result","wrappedAwait","then","settle","done","err","_invoke","return","throw","_wrapAsyncGenerator","_awaitAsyncGenerator","_asyncGeneratorDelegate","awaitWrap","iter","waiting","pump","asyncGeneratorStep","_next","_throw","info","error","_asyncToGenerator","_classCallCheck","instance","Constructor","_defineProperties","descriptor","configurable","writable","_createClass","protoProps","staticProps","_defineEnumerableProperties","descs","desc","getOwnPropertySymbols","objectSymbols","sym","_defaults","getOwnPropertyNames","getOwnPropertyDescriptor","_defineProperty","_extends","source","_objectSpread","ownKeys","enumerableOnly","symbols","_objectSpread2","getOwnPropertyDescriptors","defineProperties","_inherits","subClass","superClass","_setPrototypeOf","_inheritsLoose","__proto__","_getPrototypeOf","setPrototypeOf","getPrototypeOf","isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","_construct","Parent","Class","Function","bind","_isNativeFunction","_wrapNativeSuper","_cache","Map","has","Wrapper","_instanceof","hasInstance","_interopRequireDefault","__esModule","default","_interopRequireWildcard","newObj","_newArrowCheck","innerThis","boundThis","_objectDestructuringEmpty","_objectWithoutPropertiesLoose","excluded","sourceKeys","_objectWithoutProperties","sourceSymbolKeys","propertyIsEnumerable","_assertThisInitialized","ReferenceError","_possibleConstructorReturn","_superPropBase","_get","receiver","base","_set","isStrict","s","Error","_taggedTemplateLiteral","strings","raw","slice","freeze","_taggedTemplateLiteralLoose","_temporalRef","val","_temporalUndefined","_readOnlyError","_classNameTDZError","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","_slicedToArrayLoose","_iterableToArrayLimitLoose","_toArray","_iterableToArray","_toConsumableArray","_arrayWithoutHoles","_nonIterableSpread","arr2","from","_arr","_n","_d","_e","_i","_s","_iterator","_step","_skipFirstGeneratorNext","it","_toPrimitive","input","hint","prim","toPrimitive","res","String","Number","_toPropertyKey","_initializerWarningHelper","context","_initializerDefineProperty","initializer","_applyDecoratedDescriptor","decorators","reduce","decorator","_classPrivateFieldLooseKey","_classPrivateFieldLooseBase","privateKey","_classPrivateFieldGet","privateMap","_classPrivateFieldSet","_classPrivateFieldDestructureSet","__destrObj","v","_classStaticPrivateFieldSpecGet","classConstructor","_classStaticPrivateFieldSpecSet","_classStaticPrivateMethodGet","_classStaticPrivateMethodSet","_decorate","_getDecoratorsApi","r","initialize","O","initializeInstanceElements","decorated","elements","decorateClass","_coalesceClassElements","d","_createElementDescriptor","initializeClassElements","F","runClassFinishers","finishers","elementsDefinitionOrder","kind","placement","defineClassElement","proto","newElements","placements","static","own","addElementPlacement","_hasDecorators","elementFinishersExtras","decorateElement","extras","decorateConstructor","silent","elementObject","fromElementDescriptor","elementFinisherExtras","toElementFinisherExtras","finisher","newExtras","j","fromClassDescriptor","elementsAndFinisher","toClassDescriptor","k","toStringTag","toElementDescriptors","elementObjects","toElementDescriptor","disallowProperty","_optionalCallableProperty","newConstructor","objectType","_coalesceGetterSetter","other","isSameElement","find","_isDataDescriptor","_classPrivateMethodGet","privateSet","_classPrivateMethodSet","_wrapRegExp","re","groups","BabelRegExp","_RegExp","RegExp","_super","_groups","WeakMap","_this","exec","buildGroups","substitution","_","g","arrayRemove","run","sync","listener","_fire","fire","fireSync","_len2","_key2","onOnce","_cb","copyObjectPropertiesToObject","src","PRIVATE","createItemAPI","item","removeReleasedItems","released","ItemStatus","INIT","IDLE","PROCESSING_QUEUED","PROCESSING","PROCESSING_COMPLETE","PROCESSING_ERROR","PROCESSING_REVERT_ERROR","LOADING","LOAD_ERROR","FileOrigin","INPUT","LIMBO","LOCAL","getNonNumeric","getDecimalSeparator","toLocaleString","getThousandsSeparator","decimalSeparator","thousandsStringWithSeparator","thousandsStringWithoutSeparator","Type","BOOLEAN","INT","NUMBER","STRING","ARRAY","OBJECT","FUNCTION","ACTION","SERVER_API","REGEX","filters","applyFilterChain","utils","matchingFilters","initialFilter","current","catch","applyFilters","addFilter","extendDefaultOptions","additionalOptions","defaultOptions","getOptions","setOptions","opts","disabled","required","captureMethod","allowSyncAcceptAttribute","allowDrop","allowBrowse","allowPaste","allowMultiple","allowReplace","allowRevert","allowRemove","allowProcess","allowReorder","allowDirectoriesOnly","forceRevert","maxFiles","checkValidity","itemInsertLocationFreedom","itemInsertLocation","itemInsertInterval","dropOnPage","dropOnElement","dropValidation","ignoredFiles","instantUpload","maxParallelUploads","chunkUploads","chunkForce","chunkSize","chunkRetryDelays","server","labelDecimalSeparator","labelThousandsSeparator","labelIdle","labelInvalidField","labelFileWaitingForSize","labelFileSizeNotAvailable","labelFileCountSingular","labelFileCountPlural","labelFileLoading","labelFileAdded","labelFileLoadError","labelFileRemoved","labelFileRemoveError","labelFileProcessing","labelFileProcessingComplete","labelFileProcessingAborted","labelFileProcessingError","labelFileProcessingRevertError","labelTapToCancel","labelTapToRetry","labelTapToUndo","labelButtonRemoveItem","labelButtonAbortItemLoad","labelButtonRetryItemLoad","labelButtonAbortItemProcessing","labelButtonUndoItemProcessing","labelButtonRetryItemProcessing","labelButtonProcessItem","iconRemove","iconProcess","iconRetry","iconUndo","iconDone","oninit","onwarning","onactivatefile","oninitfile","onaddfilestart","onaddfileprogress","onaddfile","onprocessfilestart","onprocessfileprogress","onprocessfileabort","onprocessfilerevert","onprocessfile","onprocessfiles","onremovefile","onpreparefile","onupdatefiles","onreorderfiles","beforeDropFile","beforeAddFile","beforeRemoveFile","stylePanelLayout","stylePanelAspectRatio","styleItemPanelAspectRatio","styleButtonRemoveItemPosition","styleButtonProcessItemPosition","styleLoadIndicatorPosition","styleProgressIndicatorPosition","styleButtonRemoveItemAlign","files","getItemByQuery","getNumericAspectRatioFromString","aspectRatio","getActiveItems","archived","Status","EMPTY","ERROR","BUSY","READY","ITEM_ERROR","ITEM_BUSY","ITEM_READY","isItemInErrorState","status","isItemInBusyState","isItemInReadyState","GET_STATUS","some","GET_ITEM","GET_ACTIVE_ITEM","GET_ACTIVE_ITEMS","GET_ITEMS","GET_ITEM_NAME","filename","GET_ITEM_SIZE","fileSize","GET_STYLES","GET_PANEL_ASPECT_RATIO","isShapeCircle","GET_ITEM_PANEL_ASPECT_RATIO","GET_ITEMS_BY_STATUS","GET_TOTAL_ITEMS","IS_ASYNC","hasRoomForItem","count","maxFileCount","limit","min","max","arrayInsert","insertItem","isBase64DataURI","getFilenameFromURL","pop","getExtensionFromFilename","guesstimateExtension","subtype","leftPad","padding","getDateString","date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getFileFromBlob","blob","extension","file","size","lastModifiedDate","_relativePath","getBlobBuilder","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","createBlob","arrayBuffer","mimeType","BB","bb","append","getBlob","Blob","getBlobFromByteStringWithMimeType","byteString","ab","ArrayBuffer","ia","Uint8Array","charCodeAt","getMimeTypeFromBase64DataURI","dataURI","getBase64DataFromBase64DataURI","getByteStringFromBase64DataURI","atob","getBlobFromBase64DataURI","getFileFromBase64DataURI","getFileNameFromHeader","matches","decodeURI","getFileSizeFromHeader","match","getTranfserIdFromHeader","getFileInfoFromHeaders","rows","_iteratorNormalCompletion","_didIteratorError","_iteratorError","createFileLoader","fetchFn","complete","progress","getProgress","abort","File","loadURL","body","code","response","computable","total","fileinfo","setSource","isGet","sendRequest","onheaders","onprogress","ontimeout","onabort","aborted","xhr","headersReceived","encodeURI","encodeURIComponent","stringify","XMLHttpRequest","upload","lengthComputable","loaded","onreadystatechange","readyState","open","unescape","setRequestHeader","responseType","createResponse","createTimeoutResponse","getAllResponseHeaders","hasQS","buildURL","createFetchFunction","apiUrl","statusText","ChunkStatus","QUEUED","COMPLETE","WAITING","processFileChunked","metadata","transfer","chunks","chunkTransferId","chunkServer","serverId","fd","getResponseHeader","requestTransferId","formData","FormData","requestParams","requestTransferOffset","requestUrl","lastChunkIndex","retries","completeProcessingChunks","canProcessChunk","chunk","processChunk","every","processChunks","updateTotalProgress","retryProcessChunk","totalBytesTransfered","totalSize","totalProcessing","abortChunks","createFileProcessorFunction","canChunkUpload","shouldChunkUpload","willChunkUpload","createProcessorFunction","params","createRevertFunction","uniqueFileId","getRandomNumber","createPerceivedPerformanceUpdater","tickMin","tickMax","runtime","clear","createFileProcessor","processFn","perceivedProgress","perceivedPerformanceUpdater","perceivedDuration","progressFn","completeFn","transferId","reset","getDuration","getFilenameWithoutExtension","lastIndexOf","createFileStub","isFile","deepCloneObject","createItem","origin","serverFileReference","frozen","processingAborted","activeLoader","activeProcessor","abortProcessingRequestComplete","setStatus","getFileExtension","getFileType","getFileSize","getFile","loader","meta","success","retryLoad","abortLoad","processor","onprocess","console","requestProcessing","abortProcessing","revertFileUpload","_setMetadata","setMetadata","getMetadata","filenameWithoutExtension","fileExtension","fileType","relativePath","extend","handler","itemAPI","release","archive","getItemIndexByQuery","getItemById","itemId","fetchBlob","getDomainFromURL","location","protocol","isExternalURL","href","dynamicLabel","label","isMockItem","listUpdated","optionalPromise","sortItems","compare","getItemByQueryFromState","itemHandler","_ref$success","_ref$failure","failure","ABORT_ALL","DID_SET_FILES","_ref2$value","activeItems","interactionMethod","DID_UPDATE_ITEM_METADATA","_ref3","shouldPrepareOutput","doUpload","MOVE_ITEM","_ref4","currentIndex","SORT","_ref5","ADD_ITEMS","_ref6","_ref6$success","_ref6$failure","insertLocation","totalItems","isValidFile","validItems","promises","all","ADD_ITEM","_ref7","_ref7$index","_ref7$success","_ref7$failure","_ref7$options","_item","mainStatus","main","sub","handleAdd","shouldAdd","change","loadComplete","_ref8","REQUEST_PREPARE_OUTPUT","_ref9","_ref9$failure","COMPLETE_LOAD_ITEM","_ref10","RETRY_ITEM_LOAD","REQUEST_ITEM_PREPARE","_success","output","REQUEST_ITEM_PROCESSING","itemCanBeQueuedForProcessing","processNow","PROCESS_ITEM","totalCurrentUploads","processNext","queueEntry","itemReference","allItemsProcessed","RETRY_ITEM_PROCESSING","REQUEST_REMOVE_ITEM","shouldRemove","RELEASE_ITEM","REMOVE_ITEM","removeFromView","ABORT_ITEM_LOAD","ABORT_ITEM_PROCESSING","REQUEST_REVERT_ITEM_PROCESSING","handleRevert","shouldRevert","requestRemoveResult","REVERT_ITEM_PROCESSING","SET_OPTIONS","_ref11","formatFilename","createElement$1","tagName","text","textNode","createTextNode","nodeValue","polarToCartesian","centerX","centerY","radius","angleInDegrees","angleInRadians","PI","x","cos","y","sin","describeArc","startAngle","endAngle","arcSweep","end","percentageArc","to","spin","svg","path","align","dataset","ringStrokeWidth","ringFrom","ringTo","coordinates","progressIndicator","create$1","innerHTML","icon","isDisabled","write$1","shouldDisable","removeAttribute","fileActionButton","toNaturalFileSize","round","MB","KB","GB","removeDecimalsWhenZero","decimalCount","toFixed","create$2","fileName","updateFile","updateFileSizeOnError","fileInfo","DID_LOAD_ITEM","DID_UPDATE_ITEM_META","DID_THROW_ITEM_LOAD_ERROR","DID_THROW_ITEM_INVALID","toPercentage","create$3","didSetItemLoadProgress","title","didSetItemProcessProgress","didRequestItemProcessing","didAbortItemProcessing","didCompleteItemProcessing","fileStatus","DID_REVERT_ITEM_PROCESSING","DID_REQUEST_ITEM_PROCESSING","DID_ABORT_ITEM_PROCESSING","DID_COMPLETE_ITEM_PROCESSING","DID_UPDATE_ITEM_PROCESS_PROGRESS","DID_UPDATE_ITEM_LOAD_PROGRESS","DID_THROW_ITEM_PROCESSING_ERROR","DID_THROW_ITEM_PROCESSING_REVERT_ERROR","DID_THROW_ITEM_REMOVE_ERROR","Buttons","AbortItemLoad","RetryItemLoad","RemoveItem","ProcessItem","AbortItemProcessing","RetryItemProcessing","RevertItemProcessing","ButtonKeys","calculateFileInfoOffset","buttonRect","buttonRemoveItem","calculateButtonWidth","buttonAbortItemLoad","calculateFileVerticalCenterOffset","calculateFileHorizontalCenterOffset","getLoadIndicatorAlignment","getProcessIndicatorAlignment","getRemoveIndicatorAligment","DefaultStyle","buttonRetryItemLoad","buttonProcessItem","buttonAbortItemProcessing","buttonRetryItemProcessing","buttonRevertItemProcessing","loadProgressIndicator","processProgressIndicator","processingCompleteIndicator","IdleStyle","ProcessingStyle","StyleMap","DID_START_ITEM_LOAD","DID_START_ITEM_REMOVE","DID_LOAD_LOCAL_ITEM","DID_START_ITEM_PROCESSING","processingCompleteIndicatorView","create$4","isAsync","alignRemoveItemButton","buttonFilter","enabledButtons","_map","buttonView","classList","stopPropagation","loadIndicatorView","progressIndicatorView","activeStyles","write$2","route","stylesToApply","defaultStyles","control","DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING","DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD","DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL","buttonAbortItemRemoval","_ref12","create$5","didLoadItem","fileWrapper","PANEL_SPRING_PROPS","create$6","section","createSection","scalable","viewConstructor","write$3","topRect","bottomRect","center","panel","createDragHelper","itemIds","prevIndex","setIndex","getIndex","getItemIndex","ITEM_TRANSLATE_SPRING","ITEM_SCALE_SPRING","StateMap","create$7","handleClick","container","markedForRemoval","dragState","grab","isPrimary","removedActivateListener","pageX","pageY","dragOrigin","dragCenter","offsetX","offsetY","drag","preventDefault","dragOffset","dist","drop","route$1","DID_UPDATE_PANEL_HEIGHT","write$4","DID_GRAB_ITEM","DID_DRAG_ITEM","DID_DROP_ITEM","currentState","filepondItemState","getItemIndexByPosition","positionInView","horizontalSpace","l","itemRect","itemHorizontalMargin","itemWidth","itemsPerRow","childMid","itemVerticalMargin","itemHeight","_index","indexX","indexY","itemTop","itemRight","itemBottom","dropAreaDimensions","getHeight","setHeight","getWidth","setWidth","setDimensions","create$8","lastItemSpanwDate","addItemView","addIndex","spawnDate","cooldown","moveItem","vx","vy","introItemView","removeItemView","getItemHeight","getItemWidth","dragItem","numItems","oldIndex","dragPosition","dragHeight","dragWidth","cols","getGridIndex","getColIndex","visibleChildren","idx","childHeight","childBottom","childTop","route$2","DID_ADD_ITEM","DID_REMOVE_ITEM","write$5","dragCoordinates","dragIndex","dragIndexOffset","removeIndexOffset","addIndexOffset","childRect","visualHeight","prevX","prevY","visualIndex","vectorX","sign","vectorY","filterSetItemActions","list","create$9","overflowing","storeDragCoordinates","scopeLeft","scopeTop","clearDragCoordinates","route$3","DID_DRAG","DID_END_DRAG","write$6","overflow","newHeight","listScroller","attrToggle","enabledValue","resetFileInput","form","create$a","setAcceptedFileTypes","toggleAllowMultiple","toggleDirectoryFilter","toggleDisabled","toggleRequired","setCaptureMethod","handleChange","webkitRelativePath","doesAllowBrowse","disableField","updateRequiredStatus","shouldCheckValidity","setCustomValidity","updateFieldValidityStatus","browser","DID_SET_DISABLED","DID_SET_ALLOW_BROWSE","DID_SET_ALLOW_DIRECTORIES_ONLY","DID_SET_ALLOW_MULTIPLE","DID_SET_ACCEPTED_FILE_TYPES","DID_SET_CAPTURE_METHOD","DID_SET_REQUIRED","Key","ENTER","SPACE","create$b","handleKeyDown","isActivationKey","keyCode","click","isLabelClick","contains","updateLabelValue","caption","clickable","querySelector","dropLabel","DID_SET_LABEL_IDLE","addBlob","moveBlob","hideBlob","explodeBlob","write$7","route$4","DID_DROP","drip","create$c","fields","getField","syncFieldPositionsWithItems","didReorderItems","didAddItem","dataContainer","didLoadItem$1","field","didSetDisabled","didRemoveItem","didDefineValue","write$8","DID_DEFINE_VALUE","DID_REORDER_ITEMS","DID_SORT_ITEMS","getRootNode","images","text$1","zip","epub","guesstimateMimeType","requestDataTransferItems","dataTransfer","links","getLinks","hasFiles","getFiles","promisedFiles","isFileSystemItem","getFilesFromItem","returnedFileGroups","group","isEntry","entry","getAsEntry","isDirectory","isDirectoryEntry","getFilesInDirectory","getAsFile","dirCounter","fileCounter","resolveIfDone","readEntries","dirEntry","directoryReader","createReader","readBatch","entries","correctedFile","correctMissingFileType","fullPath","webkitGetAsEntry","getLinksFromTransferMetaData","getLinksFromTransferURLData","getData","dragNDropObservers","eventPosition","pageLeft","pageTop","layerX","layerY","createDragNDropClient","scopeToObserve","filterElement","observer","getDragNDropObserver","client","ondrop","onenter","ondrag","onexit","allowdrop","addListener","newObserver","createDragNDropObserver","clients","dragenter","dragover","dragleave","handlers","createHandler","elementFromPoint","point","isEventTarget","elementAtPosition","pageXOffset","pageYOffset","initialTarget","setDropEffect","effect","dropEffect","overDropTarget","allowsTransfer","createHopper","scope","validateItems","catchesDropsOnPage","requiresDropOnElement","_options$filterItems","filterItems","documentElement","lastState","filteredItems","ondragend","ondragstart","updateHopperState","hopperState","listening","listeners$1","handlePaste","activeEl","activeElement","nodeName","inScope","clipboardData","listen","unlisten","createPaster","create$d","addFilesNotificationTimeout","notificationClearTimeout","filenames","assist","message","textContent","clear$1","listModified","isUsingFilePond","itemAdded","itemRemoved","itemProcessed","itemProcessedUndo","itemError","assistant","toCamels","charAt","debounce","func","immidiateOnly","MAX_FILES_LIMIT","prevent","create$e","measure","bounds","widthPrevious","widthUpdated","updateHistory","previousAspectRatio","canHover","matchMedia","hasPointerEvents","passive","write$9","route$5","calculateRootBoundingBoxHeight","_root$ref","hopper","isMultiItem","maxItems","atMaxCapacity","addAction","listItemMargin","calculateListItemMargin","listHeight","calculateListHeight","labelHeight","currentLabelHeight","listMarginTop","listMarginBottom","visual","boundsHeight","history","MAX_BOUNCES","bounces","listAvailableHeight","fixedHeight","_listAvailableHeight","cappedHeight","isCappedHeight","panelHeight","_listAvailableHeight2","itemMargin","scrollList","itemList","newItem","removedItem","verticalItemCount","ceil","measureHeight","maxHeight","exceedsMaxFiles","totalBrowseItems","hasMaxItems","getDragIndex","toggleDrop","isAllowed","enabled","toggleBrowse","togglePaste","paster","DID_SET_ALLOW_DROP","DID_SET_ALLOW_PASTE","createApp","initialOptions","originalElement","visibilityHandler","resizeDoneTimer","isResizing","isResizingHorizontally","initialWindowWidth","currentWindowWidth","resizeHandler","isHidden","readWriteApi","innerWidth","routeActionsToEvents","createEvent","eventRoutes","DID_DESTROY","DID_INIT","DID_THROW_MAX_FILES","DID_INIT_ITEM","DID_PREPARE_OUTPUT","DID_COMPLETE_ITEM_PROCESSING_ALL","DID_UPDATE_ITEMS","DID_ACTIVATE_ITEM","exposeEvent","detail","pond","dispatchEvent","CustomEvent","bubbles","cancelable","composed","filtered","prepareFile","addFile","addFiles","isFilePondFile","removeFile","sources","lastArgument","processFile","prepareFiles","processFiles","_len3","_key3","removeFiles","_len4","_key4","mappedQueries","q","moveFile","browse","insertBefore$1","insertAfter$1","appendTo","replaceElement","restoreElement","isAttachedTo","createAppObject","customOptions","app","lowerCaseFirstLetter","attributeNameToPropertyName","attributeName","mapObject","propertyMap","selector","mapping","selectorRegExp","getAttributesAsObject","attributeMapping","attribute","createAppAtElement","mergedOptions","attributeOptions","querySelectorAll","createApp$1","PRIVATE_METHODS","createAppAPI","replaceInString","replacements","createWorker","workerBlob","workerURL","URL","createObjectURL","worker","Worker","post","transferList","onmessage","postMessage","terminate","revokeObjectURL","loadImage","img","Image","renameFile","renamedFile","copyFile","registeredPlugins","createAppPlugin","plugin","pluginOutline","views","isOperaMini","operamini","hasPromises","hasBlobSlice","hasCreateObjectURL","hasVisibility","hasTiming","hasCSSSupports","CSS","isIE11","navigator","userAgent","supported","isSupported","apps","FileStatus","OptionTypes","registerPlugin","updateOptionTypes","hook","indexToRemove","matchedHooks","newHooks","newHook","plugins","getOptions$1","setOptions$1"],"mappings":"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","sourcesContent":["/*!\n * FilePond 4.20.1\n * Licensed under MIT, https://opensource.org/licenses/MIT/\n * Please visit https://pqina.nl/filepond/ for details.\n */\n\n/* eslint-disable */\n\n(function(global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined'\n    ? factory(exports)\n    : typeof define === 'function' && define.amd\n    ? define(['exports'], factory)\n    : ((global = global || self), factory((global.FilePond = {})));\n})(this, function(exports) {\n  'use strict';\n\n  var isNode = function isNode(value) {\n    return value instanceof HTMLElement;\n  };\n\n  var createStore = function createStore(initialState) {\n    var queries =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var actions =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n    // internal state\n    var state = Object.assign({}, initialState);\n\n    // contains all actions for next frame, is clear when actions are requested\n    var actionQueue = [];\n    var dispatchQueue = [];\n\n    // returns a duplicate of the current state\n    var getState = function getState() {\n      return Object.assign({}, state);\n    };\n\n    // returns a duplicate of the actions array and clears the actions array\n    var processActionQueue = function processActionQueue() {\n      // create copy of actions queue\n      var queue = [].concat(actionQueue);\n\n      // clear actions queue (we don't want no double actions)\n      actionQueue.length = 0;\n\n      return queue;\n    };\n\n    // processes actions that might block the main UI thread\n    var processDispatchQueue = function processDispatchQueue() {\n      // create copy of actions queue\n      var queue = [].concat(dispatchQueue);\n\n      // clear actions queue (we don't want no double actions)\n      dispatchQueue.length = 0;\n\n      // now dispatch these actions\n      queue.forEach(function(_ref) {\n        var type = _ref.type,\n          data = _ref.data;\n        dispatch(type, data);\n      });\n    };\n\n    // adds a new action, calls its handler and\n    var dispatch = function dispatch(type, data, isBlocking) {\n      // is blocking action (should never block if document is hidden)\n      if (isBlocking && !document.hidden) {\n        dispatchQueue.push({ type: type, data: data });\n        return;\n      }\n\n      // if this action has a handler, handle the action\n      if (actionHandlers[type]) {\n        actionHandlers[type](data);\n      }\n\n      // now add action\n      actionQueue.push({\n        type: type,\n        data: data\n      });\n    };\n\n    var query = function query(str) {\n      var _queryHandles;\n      for (\n        var _len = arguments.length,\n          args = new Array(_len > 1 ? _len - 1 : 0),\n          _key = 1;\n        _key < _len;\n        _key++\n      ) {\n        args[_key - 1] = arguments[_key];\n      }\n      return queryHandles[str]\n        ? (_queryHandles = queryHandles)[str].apply(_queryHandles, args)\n        : null;\n    };\n\n    var api = {\n      getState: getState,\n      processActionQueue: processActionQueue,\n      processDispatchQueue: processDispatchQueue,\n      dispatch: dispatch,\n      query: query\n    };\n\n    var queryHandles = {};\n    queries.forEach(function(query) {\n      queryHandles = Object.assign({}, query(state), {}, queryHandles);\n    });\n\n    var actionHandlers = {};\n    actions.forEach(function(action) {\n      actionHandlers = Object.assign(\n        {},\n        action(dispatch, query, state),\n        {},\n        actionHandlers\n      );\n    });\n\n    return api;\n  };\n\n  var defineProperty = function defineProperty(obj, property, definition) {\n    if (typeof definition === 'function') {\n      obj[property] = definition;\n      return;\n    }\n    Object.defineProperty(obj, property, Object.assign({}, definition));\n  };\n\n  var forin = function forin(obj, cb) {\n    for (var key in obj) {\n      if (!obj.hasOwnProperty(key)) {\n        continue;\n      }\n\n      cb(key, obj[key]);\n    }\n  };\n\n  var createObject = function createObject(definition) {\n    var obj = {};\n    forin(definition, function(property) {\n      defineProperty(obj, property, definition[property]);\n    });\n    return obj;\n  };\n\n  var attr = function attr(node, name) {\n    var value =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    if (value === null) {\n      return node.getAttribute(name) || node.hasAttribute(name);\n    }\n    node.setAttribute(name, value);\n  };\n\n  var ns = 'http://www.w3.org/2000/svg';\n  var svgElements = ['svg', 'path']; // only svg elements used\n\n  var isSVGElement = function isSVGElement(tag) {\n    return svgElements.includes(tag);\n  };\n\n  var createElement = function createElement(tag, className) {\n    var attributes =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    if (typeof className === 'object') {\n      attributes = className;\n      className = null;\n    }\n    var element = isSVGElement(tag)\n      ? document.createElementNS(ns, tag)\n      : document.createElement(tag);\n    if (className) {\n      if (isSVGElement(tag)) {\n        attr(element, 'class', className);\n      } else {\n        element.className = className;\n      }\n    }\n    forin(attributes, function(name, value) {\n      attr(element, name, value);\n    });\n    return element;\n  };\n\n  var appendChild = function appendChild(parent) {\n    return function(child, index) {\n      if (typeof index !== 'undefined' && parent.children[index]) {\n        parent.insertBefore(child, parent.children[index]);\n      } else {\n        parent.appendChild(child);\n      }\n    };\n  };\n\n  var appendChildView = function appendChildView(parent, childViews) {\n    return function(view, index) {\n      if (typeof index !== 'undefined') {\n        childViews.splice(index, 0, view);\n      } else {\n        childViews.push(view);\n      }\n\n      return view;\n    };\n  };\n\n  var removeChildView = function removeChildView(parent, childViews) {\n    return function(view) {\n      // remove from child views\n      childViews.splice(childViews.indexOf(view), 1);\n\n      // remove the element\n      if (view.element.parentNode) {\n        parent.removeChild(view.element);\n      }\n\n      return view;\n    };\n  };\n\n  var IS_BROWSER = (function() {\n    return (\n      typeof window !== 'undefined' && typeof window.document !== 'undefined'\n    );\n  })();\n  var isBrowser = function isBrowser() {\n    return IS_BROWSER;\n  };\n\n  var testElement = isBrowser() ? createElement('svg') : {};\n  var getChildCount =\n    'children' in testElement\n      ? function(el) {\n          return el.children.length;\n        }\n      : function(el) {\n          return el.childNodes.length;\n        };\n\n  var getViewRect = function getViewRect(\n    elementRect,\n    childViews,\n    offset,\n    scale\n  ) {\n    var left = offset[0] || elementRect.left;\n    var top = offset[1] || elementRect.top;\n    var right = left + elementRect.width;\n    var bottom = top + elementRect.height * (scale[1] || 1);\n\n    var rect = {\n      // the rectangle of the element itself\n      element: Object.assign({}, elementRect),\n\n      // the rectangle of the element expanded to contain its children, does not include any margins\n      inner: {\n        left: elementRect.left,\n        top: elementRect.top,\n        right: elementRect.right,\n        bottom: elementRect.bottom\n      },\n\n      // the rectangle of the element expanded to contain its children including own margin and child margins\n      // margins will be added after we've recalculated the size\n      outer: {\n        left: left,\n        top: top,\n        right: right,\n        bottom: bottom\n      }\n    };\n\n    // expand rect to fit all child rectangles\n    childViews\n      .filter(function(childView) {\n        return !childView.isRectIgnored();\n      })\n      .map(function(childView) {\n        return childView.rect;\n      })\n      .forEach(function(childViewRect) {\n        expandRect(rect.inner, Object.assign({}, childViewRect.inner));\n        expandRect(rect.outer, Object.assign({}, childViewRect.outer));\n      });\n\n    // calculate inner width and height\n    calculateRectSize(rect.inner);\n\n    // append additional margin (top and left margins are included in top and left automatically)\n    rect.outer.bottom += rect.element.marginBottom;\n    rect.outer.right += rect.element.marginRight;\n\n    // calculate outer width and height\n    calculateRectSize(rect.outer);\n\n    return rect;\n  };\n\n  var expandRect = function expandRect(parent, child) {\n    // adjust for parent offset\n    child.top += parent.top;\n    child.right += parent.left;\n    child.bottom += parent.top;\n    child.left += parent.left;\n\n    if (child.bottom > parent.bottom) {\n      parent.bottom = child.bottom;\n    }\n\n    if (child.right > parent.right) {\n      parent.right = child.right;\n    }\n  };\n\n  var calculateRectSize = function calculateRectSize(rect) {\n    rect.width = rect.right - rect.left;\n    rect.height = rect.bottom - rect.top;\n  };\n\n  var isNumber = function isNumber(value) {\n    return typeof value === 'number';\n  };\n\n  /**\n   * Determines if position is at destination\n   * @param position\n   * @param destination\n   * @param velocity\n   * @param errorMargin\n   * @returns {boolean}\n   */\n  var thereYet = function thereYet(position, destination, velocity) {\n    var errorMargin =\n      arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0.001;\n    return (\n      Math.abs(position - destination) < errorMargin &&\n      Math.abs(velocity) < errorMargin\n    );\n  };\n\n  /**\n   * Spring animation\n   */\n  var spring =\n    // default options\n    function spring() // method definition\n    {\n      var _ref =\n          arguments.length > 0 && arguments[0] !== undefined\n            ? arguments[0]\n            : {},\n        _ref$stiffness = _ref.stiffness,\n        stiffness = _ref$stiffness === void 0 ? 0.5 : _ref$stiffness,\n        _ref$damping = _ref.damping,\n        damping = _ref$damping === void 0 ? 0.75 : _ref$damping,\n        _ref$mass = _ref.mass,\n        mass = _ref$mass === void 0 ? 10 : _ref$mass;\n      var target = null;\n      var position = null;\n      var velocity = 0;\n      var resting = false;\n\n      // updates spring state\n      var interpolate = function interpolate(ts, skipToEndState) {\n        // in rest, don't animate\n        if (resting) return;\n\n        // need at least a target or position to do springy things\n        if (!(isNumber(target) && isNumber(position))) {\n          resting = true;\n          velocity = 0;\n          return;\n        }\n\n        // calculate spring force\n        var f = -(position - target) * stiffness;\n\n        // update velocity by adding force based on mass\n        velocity += f / mass;\n\n        // update position by adding velocity\n        position += velocity;\n\n        // slow down based on amount of damping\n        velocity *= damping;\n\n        // we've arrived if we're near target and our velocity is near zero\n        if (thereYet(position, target, velocity) || skipToEndState) {\n          position = target;\n          velocity = 0;\n          resting = true;\n\n          // we done\n          api.onupdate(position);\n          api.oncomplete(position);\n        } else {\n          // progress update\n          api.onupdate(position);\n        }\n      };\n\n      /**\n       * Set new target value\n       * @param value\n       */\n      var setTarget = function setTarget(value) {\n        // if currently has no position, set target and position to this value\n        if (isNumber(value) && !isNumber(position)) {\n          position = value;\n        }\n\n        // next target value will not be animated to\n        if (target === null) {\n          target = value;\n          position = value;\n        }\n\n        // let start moving to target\n        target = value;\n\n        // already at target\n        if (position === target || typeof target === 'undefined') {\n          // now resting as target is current position, stop moving\n          resting = true;\n          velocity = 0;\n\n          // done!\n          api.onupdate(position);\n          api.oncomplete(position);\n\n          return;\n        }\n\n        resting = false;\n      };\n\n      // need 'api' to call onupdate callback\n      var api = createObject({\n        interpolate: interpolate,\n        target: {\n          set: setTarget,\n          get: function get() {\n            return target;\n          }\n        },\n\n        resting: {\n          get: function get() {\n            return resting;\n          }\n        },\n\n        onupdate: function onupdate(value) {},\n        oncomplete: function oncomplete(value) {}\n      });\n\n      return api;\n    };\n\n  var easeLinear = function easeLinear(t) {\n    return t;\n  };\n  var easeInOutQuad = function easeInOutQuad(t) {\n    return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n  };\n\n  var tween =\n    // default values\n    function tween() // method definition\n    {\n      var _ref =\n          arguments.length > 0 && arguments[0] !== undefined\n            ? arguments[0]\n            : {},\n        _ref$duration = _ref.duration,\n        duration = _ref$duration === void 0 ? 500 : _ref$duration,\n        _ref$easing = _ref.easing,\n        easing = _ref$easing === void 0 ? easeInOutQuad : _ref$easing,\n        _ref$delay = _ref.delay,\n        delay = _ref$delay === void 0 ? 0 : _ref$delay;\n      var start = null;\n      var t;\n      var p;\n      var resting = true;\n      var reverse = false;\n      var target = null;\n\n      var interpolate = function interpolate(ts, skipToEndState) {\n        if (resting || target === null) return;\n\n        if (start === null) {\n          start = ts;\n        }\n\n        if (ts - start < delay) return;\n\n        t = ts - start - delay;\n\n        if (t >= duration || skipToEndState) {\n          t = 1;\n          p = reverse ? 0 : 1;\n          api.onupdate(p * target);\n          api.oncomplete(p * target);\n          resting = true;\n        } else {\n          p = t / duration;\n          api.onupdate((t >= 0 ? easing(reverse ? 1 - p : p) : 0) * target);\n        }\n      };\n\n      // need 'api' to call onupdate callback\n      var api = createObject({\n        interpolate: interpolate,\n        target: {\n          get: function get() {\n            return reverse ? 0 : target;\n          },\n          set: function set(value) {\n            // is initial value\n            if (target === null) {\n              target = value;\n              api.onupdate(value);\n              api.oncomplete(value);\n              return;\n            }\n\n            // want to tween to a smaller value and have a current value\n            if (value < target) {\n              target = 1;\n              reverse = true;\n            } else {\n              // not tweening to a smaller value\n              reverse = false;\n              target = value;\n            }\n\n            // let's go!\n            resting = false;\n            start = null;\n          }\n        },\n\n        resting: {\n          get: function get() {\n            return resting;\n          }\n        },\n\n        onupdate: function onupdate(value) {},\n        oncomplete: function oncomplete(value) {}\n      });\n\n      return api;\n    };\n\n  var animator = {\n    spring: spring,\n    tween: tween\n  };\n\n  /*\n                       { type: 'spring', stiffness: .5, damping: .75, mass: 10 };\n                       { translation: { type: 'spring', ... }, ... }\n                       { translation: { x: { type: 'spring', ... } } }\n                      */\n  var createAnimator = function createAnimator(definition, category, property) {\n    // default is single definition\n    // we check if transform is set, if so, we check if property is set\n    var def =\n      definition[category] && typeof definition[category][property] === 'object'\n        ? definition[category][property]\n        : definition[category] || definition;\n\n    var type = typeof def === 'string' ? def : def.type;\n    var props = typeof def === 'object' ? Object.assign({}, def) : {};\n\n    return animator[type] ? animator[type](props) : null;\n  };\n\n  var addGetSet = function addGetSet(keys, obj, props) {\n    var overwrite =\n      arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n    obj = Array.isArray(obj) ? obj : [obj];\n    obj.forEach(function(o) {\n      keys.forEach(function(key) {\n        var name = key;\n        var getter = function getter() {\n          return props[key];\n        };\n        var setter = function setter(value) {\n          return (props[key] = value);\n        };\n\n        if (typeof key === 'object') {\n          name = key.key;\n          getter = key.getter || getter;\n          setter = key.setter || setter;\n        }\n\n        if (o[name] && !overwrite) {\n          return;\n        }\n\n        o[name] = {\n          get: getter,\n          set: setter\n        };\n      });\n    });\n  };\n\n  // add to state,\n  // add getters and setters to internal and external api (if not set)\n  // setup animators\n\n  var animations = function animations(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n      viewProps = _ref.viewProps,\n      viewInternalAPI = _ref.viewInternalAPI,\n      viewExternalAPI = _ref.viewExternalAPI;\n    // initial properties\n    var initialProps = Object.assign({}, viewProps);\n\n    // list of all active animations\n    var animations = [];\n\n    // setup animators\n    forin(mixinConfig, function(property, animation) {\n      var animator = createAnimator(animation);\n      if (!animator) {\n        return;\n      }\n\n      // when the animator updates, update the view state value\n      animator.onupdate = function(value) {\n        viewProps[property] = value;\n      };\n\n      // set animator target\n      animator.target = initialProps[property];\n\n      // when value is set, set the animator target value\n      var prop = {\n        key: property,\n        setter: function setter(value) {\n          // if already at target, we done!\n          if (animator.target === value) {\n            return;\n          }\n\n          animator.target = value;\n        },\n        getter: function getter() {\n          return viewProps[property];\n        }\n      };\n\n      // add getters and setters\n      addGetSet([prop], [viewInternalAPI, viewExternalAPI], viewProps, true);\n\n      // add it to the list for easy updating from the _write method\n      animations.push(animator);\n    });\n\n    // expose internal write api\n    return {\n      write: function write(ts) {\n        var skipToEndState = document.hidden;\n        var resting = true;\n        animations.forEach(function(animation) {\n          if (!animation.resting) resting = false;\n          animation.interpolate(ts, skipToEndState);\n        });\n        return resting;\n      },\n      destroy: function destroy() {}\n    };\n  };\n\n  var addEvent = function addEvent(element) {\n    return function(type, fn) {\n      element.addEventListener(type, fn);\n    };\n  };\n\n  var removeEvent = function removeEvent(element) {\n    return function(type, fn) {\n      element.removeEventListener(type, fn);\n    };\n  };\n\n  // mixin\n  var listeners = function listeners(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n      viewProps = _ref.viewProps,\n      viewInternalAPI = _ref.viewInternalAPI,\n      viewExternalAPI = _ref.viewExternalAPI,\n      viewState = _ref.viewState,\n      view = _ref.view;\n    var events = [];\n\n    var add = addEvent(view.element);\n    var remove = removeEvent(view.element);\n\n    viewExternalAPI.on = function(type, fn) {\n      events.push({\n        type: type,\n        fn: fn\n      });\n\n      add(type, fn);\n    };\n\n    viewExternalAPI.off = function(type, fn) {\n      events.splice(\n        events.findIndex(function(event) {\n          return event.type === type && event.fn === fn;\n        }),\n        1\n      );\n\n      remove(type, fn);\n    };\n\n    return {\n      write: function write() {\n        // not busy\n        return true;\n      },\n      destroy: function destroy() {\n        events.forEach(function(event) {\n          remove(event.type, event.fn);\n        });\n      }\n    };\n  };\n\n  // add to external api and link to props\n\n  var apis = function apis(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n      viewProps = _ref.viewProps,\n      viewExternalAPI = _ref.viewExternalAPI;\n    addGetSet(mixinConfig, viewExternalAPI, viewProps);\n  };\n\n  var isDefined = function isDefined(value) {\n    return value != null;\n  };\n\n  // add to state,\n  // add getters and setters to internal and external api (if not set)\n  // set initial state based on props in viewProps\n  // apply as transforms each frame\n\n  var defaults = {\n    opacity: 1,\n    scaleX: 1,\n    scaleY: 1,\n    translateX: 0,\n    translateY: 0,\n    rotateX: 0,\n    rotateY: 0,\n    rotateZ: 0,\n    originX: 0,\n    originY: 0\n  };\n\n  var styles = function styles(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n      viewProps = _ref.viewProps,\n      viewInternalAPI = _ref.viewInternalAPI,\n      viewExternalAPI = _ref.viewExternalAPI,\n      view = _ref.view;\n    // initial props\n    var initialProps = Object.assign({}, viewProps);\n\n    // current props\n    var currentProps = {};\n\n    // we will add those properties to the external API and link them to the viewState\n    addGetSet(mixinConfig, [viewInternalAPI, viewExternalAPI], viewProps);\n\n    // override rect on internal and external rect getter so it takes in account transforms\n    var getOffset = function getOffset() {\n      return [viewProps['translateX'] || 0, viewProps['translateY'] || 0];\n    };\n\n    var getScale = function getScale() {\n      return [viewProps['scaleX'] || 0, viewProps['scaleY'] || 0];\n    };\n    var getRect = function getRect() {\n      return view.rect\n        ? getViewRect(view.rect, view.childViews, getOffset(), getScale())\n        : null;\n    };\n    viewInternalAPI.rect = { get: getRect };\n    viewExternalAPI.rect = { get: getRect };\n\n    // apply view props\n    mixinConfig.forEach(function(key) {\n      viewProps[key] =\n        typeof initialProps[key] === 'undefined'\n          ? defaults[key]\n          : initialProps[key];\n    });\n\n    // expose api\n    return {\n      write: function write() {\n        // see if props have changed\n        if (!propsHaveChanged(currentProps, viewProps)) {\n          return;\n        }\n\n        // moves element to correct position on screen\n        applyStyles(view.element, viewProps);\n\n        // store new transforms\n        Object.assign(currentProps, Object.assign({}, viewProps));\n\n        // no longer busy\n        return true;\n      },\n      destroy: function destroy() {}\n    };\n  };\n\n  var propsHaveChanged = function propsHaveChanged(currentProps, newProps) {\n    // different amount of keys\n    if (Object.keys(currentProps).length !== Object.keys(newProps).length) {\n      return true;\n    }\n\n    // lets analyze the individual props\n    for (var prop in newProps) {\n      if (newProps[prop] !== currentProps[prop]) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var applyStyles = function applyStyles(element, _ref2) {\n    var opacity = _ref2.opacity,\n      perspective = _ref2.perspective,\n      translateX = _ref2.translateX,\n      translateY = _ref2.translateY,\n      scaleX = _ref2.scaleX,\n      scaleY = _ref2.scaleY,\n      rotateX = _ref2.rotateX,\n      rotateY = _ref2.rotateY,\n      rotateZ = _ref2.rotateZ,\n      originX = _ref2.originX,\n      originY = _ref2.originY,\n      width = _ref2.width,\n      height = _ref2.height;\n\n    var transforms = '';\n    var styles = '';\n\n    // handle transform origin\n    if (isDefined(originX) || isDefined(originY)) {\n      styles +=\n        'transform-origin: ' + (originX || 0) + 'px ' + (originY || 0) + 'px;';\n    }\n\n    // transform order is relevant\n    // 0. perspective\n    if (isDefined(perspective)) {\n      transforms += 'perspective(' + perspective + 'px) ';\n    }\n\n    // 1. translate\n    if (isDefined(translateX) || isDefined(translateY)) {\n      transforms +=\n        'translate3d(' +\n        (translateX || 0) +\n        'px, ' +\n        (translateY || 0) +\n        'px, 0) ';\n    }\n\n    // 2. scale\n    if (isDefined(scaleX) || isDefined(scaleY)) {\n      transforms +=\n        'scale3d(' +\n        (isDefined(scaleX) ? scaleX : 1) +\n        ', ' +\n        (isDefined(scaleY) ? scaleY : 1) +\n        ', 1) ';\n    }\n\n    // 3. rotate\n    if (isDefined(rotateZ)) {\n      transforms += 'rotateZ(' + rotateZ + 'rad) ';\n    }\n\n    if (isDefined(rotateX)) {\n      transforms += 'rotateX(' + rotateX + 'rad) ';\n    }\n\n    if (isDefined(rotateY)) {\n      transforms += 'rotateY(' + rotateY + 'rad) ';\n    }\n\n    // add transforms\n    if (transforms.length) {\n      styles += 'transform:' + transforms + ';';\n    }\n\n    // add opacity\n    if (isDefined(opacity)) {\n      styles += 'opacity:' + opacity + ';';\n\n      // if we reach zero, we make the element inaccessible\n      if (opacity === 0) {\n        styles += 'visibility:hidden;';\n      }\n\n      // if we're below 100% opacity this element can't be clicked\n      if (opacity < 1) {\n        styles += 'pointer-events:none;';\n      }\n    }\n\n    // add height\n    if (isDefined(height)) {\n      styles += 'height:' + height + 'px;';\n    }\n\n    // add width\n    if (isDefined(width)) {\n      styles += 'width:' + width + 'px;';\n    }\n\n    // apply styles\n    var elementCurrentStyle = element.elementCurrentStyle || '';\n\n    // if new styles does not match current styles, lets update!\n    if (\n      styles.length !== elementCurrentStyle.length ||\n      styles !== elementCurrentStyle\n    ) {\n      element.style.cssText = styles;\n      // store current styles so we can compare them to new styles later on\n      // _not_ getting the style value is faster\n      element.elementCurrentStyle = styles;\n    }\n  };\n\n  var Mixins = {\n    styles: styles,\n    listeners: listeners,\n    animations: animations,\n    apis: apis\n  };\n\n  var updateRect = function updateRect() {\n    var rect =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var element =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var style =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    if (!element.layoutCalculated) {\n      rect.paddingTop = parseInt(style.paddingTop, 10) || 0;\n      rect.marginTop = parseInt(style.marginTop, 10) || 0;\n      rect.marginRight = parseInt(style.marginRight, 10) || 0;\n      rect.marginBottom = parseInt(style.marginBottom, 10) || 0;\n      rect.marginLeft = parseInt(style.marginLeft, 10) || 0;\n      element.layoutCalculated = true;\n    }\n\n    rect.left = element.offsetLeft || 0;\n    rect.top = element.offsetTop || 0;\n    rect.width = element.offsetWidth || 0;\n    rect.height = element.offsetHeight || 0;\n\n    rect.right = rect.left + rect.width;\n    rect.bottom = rect.top + rect.height;\n\n    rect.scrollTop = element.scrollTop;\n\n    rect.hidden = element.offsetParent === null;\n\n    return rect;\n  };\n\n  var createView =\n    // default view definition\n    function createView() {\n      var _ref =\n          arguments.length > 0 && arguments[0] !== undefined\n            ? arguments[0]\n            : {},\n        _ref$tag = _ref.tag,\n        tag = _ref$tag === void 0 ? 'div' : _ref$tag,\n        _ref$name = _ref.name,\n        name = _ref$name === void 0 ? null : _ref$name,\n        _ref$attributes = _ref.attributes,\n        attributes = _ref$attributes === void 0 ? {} : _ref$attributes,\n        _ref$read = _ref.read,\n        read = _ref$read === void 0 ? function() {} : _ref$read,\n        _ref$write = _ref.write,\n        write = _ref$write === void 0 ? function() {} : _ref$write,\n        _ref$create = _ref.create,\n        create = _ref$create === void 0 ? function() {} : _ref$create,\n        _ref$destroy = _ref.destroy,\n        destroy = _ref$destroy === void 0 ? function() {} : _ref$destroy,\n        _ref$filterFrameActio = _ref.filterFrameActionsForChild,\n        filterFrameActionsForChild =\n          _ref$filterFrameActio === void 0\n            ? function(child, actions) {\n                return actions;\n              }\n            : _ref$filterFrameActio,\n        _ref$didCreateView = _ref.didCreateView,\n        didCreateView =\n          _ref$didCreateView === void 0 ? function() {} : _ref$didCreateView,\n        _ref$didWriteView = _ref.didWriteView,\n        didWriteView =\n          _ref$didWriteView === void 0 ? function() {} : _ref$didWriteView,\n        _ref$ignoreRect = _ref.ignoreRect,\n        ignoreRect = _ref$ignoreRect === void 0 ? false : _ref$ignoreRect,\n        _ref$ignoreRectUpdate = _ref.ignoreRectUpdate,\n        ignoreRectUpdate =\n          _ref$ignoreRectUpdate === void 0 ? false : _ref$ignoreRectUpdate,\n        _ref$mixins = _ref.mixins,\n        mixins = _ref$mixins === void 0 ? [] : _ref$mixins;\n      return function(\n        // each view requires reference to store\n        store\n      ) {\n        var props =\n          arguments.length > 1 && arguments[1] !== undefined\n            ? arguments[1]\n            : {};\n        // root element should not be changed\n        var element = createElement(tag, 'filepond--' + name, attributes);\n\n        // style reference should also not be changed\n        var style = window.getComputedStyle(element, null);\n\n        // element rectangle\n        var rect = updateRect();\n        var frameRect = null;\n\n        // rest state\n        var isResting = false;\n\n        // pretty self explanatory\n        var childViews = [];\n\n        // loaded mixins\n        var activeMixins = [];\n\n        // references to created children\n        var ref = {};\n\n        // state used for each instance\n        var state = {};\n\n        // list of writers that will be called to update this view\n        var writers = [\n          write // default writer\n        ];\n\n        var readers = [\n          read // default reader\n        ];\n\n        var destroyers = [\n          destroy // default destroy\n        ];\n\n        // core view methods\n        var getElement = function getElement() {\n          return element;\n        };\n        var getChildViews = function getChildViews() {\n          return childViews.concat();\n        };\n        var getReference = function getReference() {\n          return ref;\n        };\n        var createChildView = function createChildView(store) {\n          return function(view, props) {\n            return view(store, props);\n          };\n        };\n        var getRect = function getRect() {\n          if (frameRect) {\n            return frameRect;\n          }\n          frameRect = getViewRect(rect, childViews, [0, 0], [1, 1]);\n          return frameRect;\n        };\n        var getStyle = function getStyle() {\n          return style;\n        };\n\n        /**\n         * Read data from DOM\n         * @private\n         */\n        var _read = function _read() {\n          frameRect = null;\n\n          // read child views\n          childViews.forEach(function(child) {\n            return child._read();\n          });\n\n          var shouldUpdate = !(ignoreRectUpdate && rect.width && rect.height);\n          if (shouldUpdate) {\n            updateRect(rect, element, style);\n          }\n\n          // readers\n          var api = { root: internalAPI, props: props, rect: rect };\n          readers.forEach(function(reader) {\n            return reader(api);\n          });\n        };\n\n        /**\n         * Write data to DOM\n         * @private\n         */\n        var _write = function _write(ts, frameActions, shouldOptimize) {\n          // if no actions, we assume that the view is resting\n          var resting = frameActions.length === 0;\n\n          // writers\n          writers.forEach(function(writer) {\n            var writerResting = writer({\n              props: props,\n              root: internalAPI,\n              actions: frameActions,\n              timestamp: ts,\n              shouldOptimize: shouldOptimize\n            });\n\n            if (writerResting === false) {\n              resting = false;\n            }\n          });\n\n          // run mixins\n          activeMixins.forEach(function(mixin) {\n            // if one of the mixins is still busy after write operation, we are not resting\n            var mixinResting = mixin.write(ts);\n            if (mixinResting === false) {\n              resting = false;\n            }\n          });\n\n          // updates child views that are currently attached to the DOM\n          childViews\n            .filter(function(child) {\n              return !!child.element.parentNode;\n            })\n            .forEach(function(child) {\n              // if a child view is not resting, we are not resting\n              var childResting = child._write(\n                ts,\n                filterFrameActionsForChild(child, frameActions),\n                shouldOptimize\n              );\n\n              if (!childResting) {\n                resting = false;\n              }\n            });\n\n          // append new elements to DOM and update those\n          childViews\n            //.filter(child => !child.element.parentNode)\n            .forEach(function(child, index) {\n              // skip\n              if (child.element.parentNode) {\n                return;\n              }\n\n              // append to DOM\n              internalAPI.appendChild(child.element, index);\n\n              // call read (need to know the size of these elements)\n              child._read();\n\n              // re-call write\n              child._write(\n                ts,\n                filterFrameActionsForChild(child, frameActions),\n                shouldOptimize\n              );\n\n              // we just added somthing to the dom, no rest\n              resting = false;\n            });\n\n          // update resting state\n          isResting = resting;\n\n          didWriteView({\n            props: props,\n            root: internalAPI,\n            actions: frameActions,\n            timestamp: ts\n          });\n\n          // let parent know if we are resting\n          return resting;\n        };\n\n        var _destroy = function _destroy() {\n          activeMixins.forEach(function(mixin) {\n            return mixin.destroy();\n          });\n          destroyers.forEach(function(destroyer) {\n            destroyer({ root: internalAPI, props: props });\n          });\n          childViews.forEach(function(child) {\n            return child._destroy();\n          });\n        };\n\n        // sharedAPI\n        var sharedAPIDefinition = {\n          element: {\n            get: getElement\n          },\n\n          style: {\n            get: getStyle\n          },\n\n          childViews: {\n            get: getChildViews\n          }\n        };\n\n        // private API definition\n        var internalAPIDefinition = Object.assign({}, sharedAPIDefinition, {\n          rect: {\n            get: getRect\n          },\n\n          // access to custom children references\n          ref: {\n            get: getReference\n          },\n\n          // dom modifiers\n          is: function is(needle) {\n            return name === needle;\n          },\n          appendChild: appendChild(element),\n          createChildView: createChildView(store),\n          linkView: function linkView(view) {\n            childViews.push(view);\n            return view;\n          },\n          unlinkView: function unlinkView(view) {\n            childViews.splice(childViews.indexOf(view), 1);\n          },\n          appendChildView: appendChildView(element, childViews),\n          removeChildView: removeChildView(element, childViews),\n          registerWriter: function registerWriter(writer) {\n            return writers.push(writer);\n          },\n          registerReader: function registerReader(reader) {\n            return readers.push(reader);\n          },\n          registerDestroyer: function registerDestroyer(destroyer) {\n            return destroyers.push(destroyer);\n          },\n          invalidateLayout: function invalidateLayout() {\n            return (element.layoutCalculated = false);\n          },\n\n          // access to data store\n          dispatch: store.dispatch,\n          query: store.query\n        });\n\n        // public view API methods\n        var externalAPIDefinition = {\n          element: {\n            get: getElement\n          },\n\n          childViews: {\n            get: getChildViews\n          },\n\n          rect: {\n            get: getRect\n          },\n\n          resting: {\n            get: function get() {\n              return isResting;\n            }\n          },\n\n          isRectIgnored: function isRectIgnored() {\n            return ignoreRect;\n          },\n          _read: _read,\n          _write: _write,\n          _destroy: _destroy\n        };\n\n        // mixin API methods\n        var mixinAPIDefinition = Object.assign({}, sharedAPIDefinition, {\n          rect: {\n            get: function get() {\n              return rect;\n            }\n          }\n        });\n\n        // add mixin functionality\n        Object.keys(mixins)\n          .sort(function(a, b) {\n            // move styles to the back of the mixin list (so adjustments of other mixins are applied to the props correctly)\n            if (a === 'styles') {\n              return 1;\n            } else if (b === 'styles') {\n              return -1;\n            }\n            return 0;\n          })\n          .forEach(function(key) {\n            var mixinAPI = Mixins[key]({\n              mixinConfig: mixins[key],\n              viewProps: props,\n              viewState: state,\n              viewInternalAPI: internalAPIDefinition,\n              viewExternalAPI: externalAPIDefinition,\n              view: createObject(mixinAPIDefinition)\n            });\n\n            if (mixinAPI) {\n              activeMixins.push(mixinAPI);\n            }\n          });\n\n        // construct private api\n        var internalAPI = createObject(internalAPIDefinition);\n\n        // create the view\n        create({\n          root: internalAPI,\n          props: props\n        });\n\n        // append created child views to root node\n        var childCount = getChildCount(element); // need to know the current child count so appending happens in correct order\n        childViews.forEach(function(child, index) {\n          internalAPI.appendChild(child.element, childCount + index);\n        });\n\n        // call did create\n        didCreateView(internalAPI);\n\n        // expose public api\n        return createObject(externalAPIDefinition);\n      };\n    };\n\n  var createPainter = function createPainter(read, write) {\n    var fps =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 60;\n\n    var name = '__framePainter';\n\n    // set global painter\n    if (window[name]) {\n      window[name].readers.push(read);\n      window[name].writers.push(write);\n      return;\n    }\n\n    window[name] = {\n      readers: [read],\n      writers: [write]\n    };\n\n    var painter = window[name];\n\n    var interval = 1000 / fps;\n    var last = null;\n    var id = null;\n    var requestTick = null;\n    var cancelTick = null;\n\n    var setTimerType = function setTimerType() {\n      if (document.hidden) {\n        requestTick = function requestTick() {\n          return window.setTimeout(function() {\n            return tick(performance.now());\n          }, interval);\n        };\n        cancelTick = function cancelTick() {\n          return window.clearTimeout(id);\n        };\n      } else {\n        requestTick = function requestTick() {\n          return window.requestAnimationFrame(tick);\n        };\n        cancelTick = function cancelTick() {\n          return window.cancelAnimationFrame(id);\n        };\n      }\n    };\n\n    document.addEventListener('visibilitychange', function() {\n      if (cancelTick) cancelTick();\n      setTimerType();\n      tick(performance.now());\n    });\n\n    var tick = function tick(ts) {\n      // queue next tick\n      id = requestTick(tick);\n\n      // limit fps\n      if (!last) {\n        last = ts;\n      }\n\n      var delta = ts - last;\n\n      if (delta <= interval) {\n        // skip frame\n        return;\n      }\n\n      // align next frame\n      last = ts - (delta % interval);\n\n      // update view\n      painter.readers.forEach(function(read) {\n        return read();\n      });\n      painter.writers.forEach(function(write) {\n        return write(ts);\n      });\n    };\n\n    setTimerType();\n    tick(performance.now());\n\n    return {\n      pause: function pause() {\n        cancelTick(id);\n      }\n    };\n  };\n\n  var createRoute = function createRoute(routes, fn) {\n    return function(_ref) {\n      var root = _ref.root,\n        props = _ref.props,\n        _ref$actions = _ref.actions,\n        actions = _ref$actions === void 0 ? [] : _ref$actions,\n        timestamp = _ref.timestamp,\n        shouldOptimize = _ref.shouldOptimize;\n      actions\n        .filter(function(action) {\n          return routes[action.type];\n        })\n        .forEach(function(action) {\n          return routes[action.type]({\n            root: root,\n            props: props,\n            action: action.data,\n            timestamp: timestamp,\n            shouldOptimize: shouldOptimize\n          });\n        });\n\n      if (fn) {\n        fn({\n          root: root,\n          props: props,\n          actions: actions,\n          timestamp: timestamp,\n          shouldOptimize: shouldOptimize\n        });\n      }\n    };\n  };\n\n  var insertBefore = function insertBefore(newNode, referenceNode) {\n    return referenceNode.parentNode.insertBefore(newNode, referenceNode);\n  };\n\n  var insertAfter = function insertAfter(newNode, referenceNode) {\n    return referenceNode.parentNode.insertBefore(\n      newNode,\n      referenceNode.nextSibling\n    );\n  };\n\n  var isArray = function isArray(value) {\n    return Array.isArray(value);\n  };\n\n  var isEmpty = function isEmpty(value) {\n    return value == null;\n  };\n\n  var trim = function trim(str) {\n    return str.trim();\n  };\n\n  var toString = function toString(value) {\n    return '' + value;\n  };\n\n  var toArray = function toArray(value) {\n    var splitter =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ',';\n    if (isEmpty(value)) {\n      return [];\n    }\n    if (isArray(value)) {\n      return value;\n    }\n    return toString(value)\n      .split(splitter)\n      .map(trim)\n      .filter(function(str) {\n        return str.length;\n      });\n  };\n\n  var isBoolean = function isBoolean(value) {\n    return typeof value === 'boolean';\n  };\n\n  var toBoolean = function toBoolean(value) {\n    return isBoolean(value) ? value : value === 'true';\n  };\n\n  var isString = function isString(value) {\n    return typeof value === 'string';\n  };\n\n  var toNumber = function toNumber(value) {\n    return isNumber(value)\n      ? value\n      : isString(value)\n      ? toString(value).replace(/[a-z]+/gi, '')\n      : 0;\n  };\n\n  var toInt = function toInt(value) {\n    return parseInt(toNumber(value), 10);\n  };\n\n  var toFloat = function toFloat(value) {\n    return parseFloat(toNumber(value));\n  };\n\n  var isInt = function isInt(value) {\n    return isNumber(value) && isFinite(value) && Math.floor(value) === value;\n  };\n\n  var toBytes = function toBytes(value) {\n    // is in bytes\n    if (isInt(value)) {\n      return value;\n    }\n\n    // is natural file size\n    var naturalFileSize = toString(value).trim();\n\n    // if is value in megabytes\n    if (/MB$/i.test(naturalFileSize)) {\n      naturalFileSize = naturalFileSize.replace(/MB$i/, '').trim();\n      return toInt(naturalFileSize) * 1000 * 1000;\n    }\n\n    // if is value in kilobytes\n    if (/KB/i.test(naturalFileSize)) {\n      naturalFileSize = naturalFileSize.replace(/KB$i/, '').trim();\n      return toInt(naturalFileSize) * 1000;\n    }\n\n    return toInt(naturalFileSize);\n  };\n\n  var isFunction = function isFunction(value) {\n    return typeof value === 'function';\n  };\n\n  var toFunctionReference = function toFunctionReference(string) {\n    var ref = self;\n    var levels = string.split('.');\n    var level = null;\n    while ((level = levels.shift())) {\n      ref = ref[level];\n      if (!ref) {\n        return null;\n      }\n    }\n    return ref;\n  };\n\n  var methods = {\n    process: 'POST',\n    patch: 'PATCH',\n    revert: 'DELETE',\n    fetch: 'GET',\n    restore: 'GET',\n    load: 'GET'\n  };\n\n  var createServerAPI = function createServerAPI(outline) {\n    var api = {};\n\n    api.url = isString(outline) ? outline : outline.url || '';\n    api.timeout = outline.timeout ? parseInt(outline.timeout, 10) : 0;\n    api.headers = outline.headers ? outline.headers : {};\n\n    forin(methods, function(key) {\n      api[key] = createAction(\n        key,\n        outline[key],\n        methods[key],\n        api.timeout,\n        api.headers\n      );\n    });\n\n    // special treatment for remove\n    api.remove = outline.remove || null;\n\n    // remove generic headers from api object\n    delete api.headers;\n\n    return api;\n  };\n\n  var createAction = function createAction(\n    name,\n    outline,\n    method,\n    timeout,\n    headers\n  ) {\n    // is explicitely set to null so disable\n    if (outline === null) {\n      return null;\n    }\n\n    // if is custom function, done! Dev handles everything.\n    if (typeof outline === 'function') {\n      return outline;\n    }\n\n    // build action object\n    var action = {\n      url: method === 'GET' || method === 'PATCH' ? '?' + name + '=' : '',\n      method: method,\n      headers: headers,\n      withCredentials: false,\n      timeout: timeout,\n      onload: null,\n      ondata: null,\n      onerror: null\n    };\n\n    // is a single url\n    if (isString(outline)) {\n      action.url = outline;\n      return action;\n    }\n\n    // overwrite\n    Object.assign(action, outline);\n\n    // see if should reformat headers;\n    if (isString(action.headers)) {\n      var parts = action.headers.split(/:(.+)/);\n      action.headers = {\n        header: parts[0],\n        value: parts[1]\n      };\n    }\n\n    // if is bool withCredentials\n    action.withCredentials = toBoolean(action.withCredentials);\n\n    return action;\n  };\n\n  var toServerAPI = function toServerAPI(value) {\n    return createServerAPI(value);\n  };\n\n  var isNull = function isNull(value) {\n    return value === null;\n  };\n\n  var isObject = function isObject(value) {\n    return typeof value === 'object' && value !== null;\n  };\n\n  var isAPI = function isAPI(value) {\n    return (\n      isObject(value) &&\n      isString(value.url) &&\n      isObject(value.process) &&\n      isObject(value.revert) &&\n      isObject(value.restore) &&\n      isObject(value.fetch)\n    );\n  };\n\n  var getType = function getType(value) {\n    if (isArray(value)) {\n      return 'array';\n    }\n\n    if (isNull(value)) {\n      return 'null';\n    }\n\n    if (isInt(value)) {\n      return 'int';\n    }\n\n    if (/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(value)) {\n      return 'bytes';\n    }\n\n    if (isAPI(value)) {\n      return 'api';\n    }\n\n    return typeof value;\n  };\n\n  var replaceSingleQuotes = function replaceSingleQuotes(str) {\n    return str\n      .replace(/{\\s*'/g, '{\"')\n      .replace(/'\\s*}/g, '\"}')\n      .replace(/'\\s*:/g, '\":')\n      .replace(/:\\s*'/g, ':\"')\n      .replace(/,\\s*'/g, ',\"')\n      .replace(/'\\s*,/g, '\",');\n  };\n\n  var conversionTable = {\n    array: toArray,\n    boolean: toBoolean,\n    int: function int(value) {\n      return getType(value) === 'bytes' ? toBytes(value) : toInt(value);\n    },\n    number: toFloat,\n    float: toFloat,\n    bytes: toBytes,\n    string: function string(value) {\n      return isFunction(value) ? value : toString(value);\n    },\n    function: function _function(value) {\n      return toFunctionReference(value);\n    },\n    serverapi: toServerAPI,\n    object: function object(value) {\n      try {\n        return JSON.parse(replaceSingleQuotes(value));\n      } catch (e) {\n        return null;\n      }\n    }\n  };\n\n  var convertTo = function convertTo(value, type) {\n    return conversionTable[type](value);\n  };\n\n  var getValueByType = function getValueByType(\n    newValue,\n    defaultValue,\n    valueType\n  ) {\n    // can always assign default value\n    if (newValue === defaultValue) {\n      return newValue;\n    }\n\n    // get the type of the new value\n    var newValueType = getType(newValue);\n\n    // is valid type?\n    if (newValueType !== valueType) {\n      // is string input, let's attempt to convert\n      var convertedValue = convertTo(newValue, valueType);\n\n      // what is the type now\n      newValueType = getType(convertedValue);\n\n      // no valid conversions found\n      if (convertedValue === null) {\n        throw 'Trying to assign value with incorrect type to \"' +\n          option +\n          '\", allowed type: \"' +\n          valueType +\n          '\"';\n      } else {\n        newValue = convertedValue;\n      }\n    }\n\n    // assign new value\n    return newValue;\n  };\n\n  var createOption = function createOption(defaultValue, valueType) {\n    var currentValue = defaultValue;\n    return {\n      enumerable: true,\n      get: function get() {\n        return currentValue;\n      },\n      set: function set(newValue) {\n        currentValue = getValueByType(newValue, defaultValue, valueType);\n      }\n    };\n  };\n\n  var createOptions = function createOptions(options) {\n    var obj = {};\n    forin(options, function(prop) {\n      var optionDefinition = options[prop];\n      obj[prop] = createOption(optionDefinition[0], optionDefinition[1]);\n    });\n    return createObject(obj);\n  };\n\n  var createInitialState = function createInitialState(options) {\n    return {\n      // model\n      items: [],\n\n      // timeout used for calling update items\n      listUpdateTimeout: null,\n\n      // timeout used for stacking metadata updates\n      itemUpdateTimeout: null,\n\n      // queue of items waiting to be processed\n      processingQueue: [],\n\n      // options\n      options: createOptions(options)\n    };\n  };\n\n  var fromCamels = function fromCamels(string) {\n    var separator =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '-';\n    return string\n      .split(/(?=[A-Z])/)\n      .map(function(part) {\n        return part.toLowerCase();\n      })\n      .join(separator);\n  };\n\n  var createOptionAPI = function createOptionAPI(store, options) {\n    var obj = {};\n    forin(options, function(key) {\n      obj[key] = {\n        get: function get() {\n          return store.getState().options[key];\n        },\n        set: function set(value) {\n          store.dispatch('SET_' + fromCamels(key, '_').toUpperCase(), {\n            value: value\n          });\n        }\n      };\n    });\n    return obj;\n  };\n\n  var createOptionActions = function createOptionActions(options) {\n    return function(dispatch, query, state) {\n      var obj = {};\n      forin(options, function(key) {\n        var name = fromCamels(key, '_').toUpperCase();\n\n        obj['SET_' + name] = function(action) {\n          try {\n            state.options[key] = action.value;\n          } catch (e) {} // nope, failed\n\n          // we successfully set the value of this option\n          dispatch('DID_SET_' + name, { value: state.options[key] });\n        };\n      });\n      return obj;\n    };\n  };\n\n  var createOptionQueries = function createOptionQueries(options) {\n    return function(state) {\n      var obj = {};\n      forin(options, function(key) {\n        obj['GET_' + fromCamels(key, '_').toUpperCase()] = function(action) {\n          return state.options[key];\n        };\n      });\n      return obj;\n    };\n  };\n\n  var InteractionMethod = {\n    API: 1,\n    DROP: 2,\n    BROWSE: 3,\n    PASTE: 4,\n    NONE: 5\n  };\n\n  var getUniqueId = function getUniqueId() {\n    return Math.random()\n      .toString(36)\n      .substr(2, 9);\n  };\n\n  function _typeof(obj) {\n    if (typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol') {\n      _typeof = function(obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function(obj) {\n        return obj &&\n          typeof Symbol === 'function' &&\n          obj.constructor === Symbol &&\n          obj !== Symbol.prototype\n          ? 'symbol'\n          : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  var REACT_ELEMENT_TYPE;\n\n  function _jsx(type, props, key, children) {\n    if (!REACT_ELEMENT_TYPE) {\n      REACT_ELEMENT_TYPE =\n        (typeof Symbol === 'function' &&\n          Symbol['for'] &&\n          Symbol['for']('react.element')) ||\n        0xeac7;\n    }\n\n    var defaultProps = type && type.defaultProps;\n    var childrenLength = arguments.length - 3;\n\n    if (!props && childrenLength !== 0) {\n      props = {\n        children: void 0\n      };\n    }\n\n    if (props && defaultProps) {\n      for (var propName in defaultProps) {\n        if (props[propName] === void 0) {\n          props[propName] = defaultProps[propName];\n        }\n      }\n    } else if (!props) {\n      props = defaultProps || {};\n    }\n\n    if (childrenLength === 1) {\n      props.children = children;\n    } else if (childrenLength > 1) {\n      var childArray = new Array(childrenLength);\n\n      for (var i = 0; i < childrenLength; i++) {\n        childArray[i] = arguments[i + 3];\n      }\n\n      props.children = childArray;\n    }\n\n    return {\n      $$typeof: REACT_ELEMENT_TYPE,\n      type: type,\n      key: key === undefined ? null : '' + key,\n      ref: null,\n      props: props,\n      _owner: null\n    };\n  }\n\n  function _asyncIterator(iterable) {\n    var method;\n\n    if (typeof Symbol !== 'undefined') {\n      if (Symbol.asyncIterator) {\n        method = iterable[Symbol.asyncIterator];\n        if (method != null) return method.call(iterable);\n      }\n\n      if (Symbol.iterator) {\n        method = iterable[Symbol.iterator];\n        if (method != null) return method.call(iterable);\n      }\n    }\n\n    throw new TypeError('Object is not async iterable');\n  }\n\n  function _AwaitValue(value) {\n    this.wrapped = value;\n  }\n\n  function _AsyncGenerator(gen) {\n    var front, back;\n\n    function send(key, arg) {\n      return new Promise(function(resolve, reject) {\n        var request = {\n          key: key,\n          arg: arg,\n          resolve: resolve,\n          reject: reject,\n          next: null\n        };\n\n        if (back) {\n          back = back.next = request;\n        } else {\n          front = back = request;\n          resume(key, arg);\n        }\n      });\n    }\n\n    function resume(key, arg) {\n      try {\n        var result = gen[key](arg);\n        var value = result.value;\n        var wrappedAwait = value instanceof _AwaitValue;\n        Promise.resolve(wrappedAwait ? value.wrapped : value).then(\n          function(arg) {\n            if (wrappedAwait) {\n              resume('next', arg);\n              return;\n            }\n\n            settle(result.done ? 'return' : 'normal', arg);\n          },\n          function(err) {\n            resume('throw', err);\n          }\n        );\n      } catch (err) {\n        settle('throw', err);\n      }\n    }\n\n    function settle(type, value) {\n      switch (type) {\n        case 'return':\n          front.resolve({\n            value: value,\n            done: true\n          });\n          break;\n\n        case 'throw':\n          front.reject(value);\n          break;\n\n        default:\n          front.resolve({\n            value: value,\n            done: false\n          });\n          break;\n      }\n\n      front = front.next;\n\n      if (front) {\n        resume(front.key, front.arg);\n      } else {\n        back = null;\n      }\n    }\n\n    this._invoke = send;\n\n    if (typeof gen.return !== 'function') {\n      this.return = undefined;\n    }\n  }\n\n  if (typeof Symbol === 'function' && Symbol.asyncIterator) {\n    _AsyncGenerator.prototype[Symbol.asyncIterator] = function() {\n      return this;\n    };\n  }\n\n  _AsyncGenerator.prototype.next = function(arg) {\n    return this._invoke('next', arg);\n  };\n\n  _AsyncGenerator.prototype.throw = function(arg) {\n    return this._invoke('throw', arg);\n  };\n\n  _AsyncGenerator.prototype.return = function(arg) {\n    return this._invoke('return', arg);\n  };\n\n  function _wrapAsyncGenerator(fn) {\n    return function() {\n      return new _AsyncGenerator(fn.apply(this, arguments));\n    };\n  }\n\n  function _awaitAsyncGenerator(value) {\n    return new _AwaitValue(value);\n  }\n\n  function _asyncGeneratorDelegate(inner, awaitWrap) {\n    var iter = {},\n      waiting = false;\n\n    function pump(key, value) {\n      waiting = true;\n      value = new Promise(function(resolve) {\n        resolve(inner[key](value));\n      });\n      return {\n        done: false,\n        value: awaitWrap(value)\n      };\n    }\n\n    if (typeof Symbol === 'function' && Symbol.iterator) {\n      iter[Symbol.iterator] = function() {\n        return this;\n      };\n    }\n\n    iter.next = function(value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump('next', value);\n    };\n\n    if (typeof inner.throw === 'function') {\n      iter.throw = function(value) {\n        if (waiting) {\n          waiting = false;\n          throw value;\n        }\n\n        return pump('throw', value);\n      };\n    }\n\n    if (typeof inner.return === 'function') {\n      iter.return = function(value) {\n        return pump('return', value);\n      };\n    }\n\n    return iter;\n  }\n\n  function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n      var info = gen[key](arg);\n      var value = info.value;\n    } catch (error) {\n      reject(error);\n      return;\n    }\n\n    if (info.done) {\n      resolve(value);\n    } else {\n      Promise.resolve(value).then(_next, _throw);\n    }\n  }\n\n  function _asyncToGenerator(fn) {\n    return function() {\n      var self = this,\n        args = arguments;\n      return new Promise(function(resolve, reject) {\n        var gen = fn.apply(self, args);\n\n        function _next(value) {\n          asyncGeneratorStep(\n            gen,\n            resolve,\n            reject,\n            _next,\n            _throw,\n            'next',\n            value\n          );\n        }\n\n        function _throw(err) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'throw', err);\n        }\n\n        _next(undefined);\n      });\n    };\n  }\n\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError('Cannot call a class as a function');\n    }\n  }\n\n  function _defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if ('value' in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  function _createClass(Constructor, protoProps, staticProps) {\n    if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) _defineProperties(Constructor, staticProps);\n    return Constructor;\n  }\n\n  function _defineEnumerableProperties(obj, descs) {\n    for (var key in descs) {\n      var desc = descs[key];\n      desc.configurable = desc.enumerable = true;\n      if ('value' in desc) desc.writable = true;\n      Object.defineProperty(obj, key, desc);\n    }\n\n    if (Object.getOwnPropertySymbols) {\n      var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n      for (var i = 0; i < objectSymbols.length; i++) {\n        var sym = objectSymbols[i];\n        var desc = descs[sym];\n        desc.configurable = desc.enumerable = true;\n        if ('value' in desc) desc.writable = true;\n        Object.defineProperty(obj, sym, desc);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defaults(obj, defaults) {\n    var keys = Object.getOwnPropertyNames(defaults);\n\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n      var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n      if (value && value.configurable && obj[key] === undefined) {\n        Object.defineProperty(obj, key, value);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defineProperty(obj, key, value) {\n    if (key in obj) {\n      Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n      });\n    } else {\n      obj[key] = value;\n    }\n\n    return obj;\n  }\n\n  function _extends() {\n    _extends =\n      Object.assign ||\n      function(target) {\n        for (var i = 1; i < arguments.length; i++) {\n          var source = arguments[i];\n\n          for (var key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n              target[key] = source[key];\n            }\n          }\n        }\n\n        return target;\n      };\n\n    return _extends.apply(this, arguments);\n  }\n\n  function _objectSpread(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n      var ownKeys = Object.keys(source);\n\n      if (typeof Object.getOwnPropertySymbols === 'function') {\n        ownKeys = ownKeys.concat(\n          Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n          })\n        );\n      }\n\n      ownKeys.forEach(function(key) {\n        _defineProperty(target, key, source[key]);\n      });\n    }\n\n    return target;\n  }\n\n  function ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n\n    if (Object.getOwnPropertySymbols) {\n      var symbols = Object.getOwnPropertySymbols(object);\n      if (enumerableOnly)\n        symbols = symbols.filter(function(sym) {\n          return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n      keys.push.apply(keys, symbols);\n    }\n\n    return keys;\n  }\n\n  function _objectSpread2(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n\n      if (i % 2) {\n        ownKeys(source, true).forEach(function(key) {\n          _defineProperty(target, key, source[key]);\n        });\n      } else if (Object.getOwnPropertyDescriptors) {\n        Object.defineProperties(\n          target,\n          Object.getOwnPropertyDescriptors(source)\n        );\n      } else {\n        ownKeys(source).forEach(function(key) {\n          Object.defineProperty(\n            target,\n            key,\n            Object.getOwnPropertyDescriptor(source, key)\n          );\n        });\n      }\n    }\n\n    return target;\n  }\n\n  function _inherits(subClass, superClass) {\n    if (typeof superClass !== 'function' && superClass !== null) {\n      throw new TypeError('Super expression must either be null or a function');\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) _setPrototypeOf(subClass, superClass);\n  }\n\n  function _inheritsLoose(subClass, superClass) {\n    subClass.prototype = Object.create(superClass.prototype);\n    subClass.prototype.constructor = subClass;\n    subClass.__proto__ = superClass;\n  }\n\n  function _getPrototypeOf(o) {\n    _getPrototypeOf = Object.setPrototypeOf\n      ? Object.getPrototypeOf\n      : function _getPrototypeOf(o) {\n          return o.__proto__ || Object.getPrototypeOf(o);\n        };\n    return _getPrototypeOf(o);\n  }\n\n  function _setPrototypeOf(o, p) {\n    _setPrototypeOf =\n      Object.setPrototypeOf ||\n      function _setPrototypeOf(o, p) {\n        o.__proto__ = p;\n        return o;\n      };\n\n    return _setPrototypeOf(o, p);\n  }\n\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === 'undefined' || !Reflect.construct) return false;\n    if (Reflect.construct.sham) return false;\n    if (typeof Proxy === 'function') return true;\n\n    try {\n      Date.prototype.toString.call(Reflect.construct(Date, [], function() {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  function _construct(Parent, args, Class) {\n    if (isNativeReflectConstruct()) {\n      _construct = Reflect.construct;\n    } else {\n      _construct = function _construct(Parent, args, Class) {\n        var a = [null];\n        a.push.apply(a, args);\n        var Constructor = Function.bind.apply(Parent, a);\n        var instance = new Constructor();\n        if (Class) _setPrototypeOf(instance, Class.prototype);\n        return instance;\n      };\n    }\n\n    return _construct.apply(null, arguments);\n  }\n\n  function _isNativeFunction(fn) {\n    return Function.toString.call(fn).indexOf('[native code]') !== -1;\n  }\n\n  function _wrapNativeSuper(Class) {\n    var _cache = typeof Map === 'function' ? new Map() : undefined;\n\n    _wrapNativeSuper = function _wrapNativeSuper(Class) {\n      if (Class === null || !_isNativeFunction(Class)) return Class;\n\n      if (typeof Class !== 'function') {\n        throw new TypeError(\n          'Super expression must either be null or a function'\n        );\n      }\n\n      if (typeof _cache !== 'undefined') {\n        if (_cache.has(Class)) return _cache.get(Class);\n\n        _cache.set(Class, Wrapper);\n      }\n\n      function Wrapper() {\n        return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n      }\n\n      Wrapper.prototype = Object.create(Class.prototype, {\n        constructor: {\n          value: Wrapper,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n      return _setPrototypeOf(Wrapper, Class);\n    };\n\n    return _wrapNativeSuper(Class);\n  }\n\n  function _instanceof(left, right) {\n    if (\n      right != null &&\n      typeof Symbol !== 'undefined' &&\n      right[Symbol.hasInstance]\n    ) {\n      return !!right[Symbol.hasInstance](left);\n    } else {\n      return left instanceof right;\n    }\n  }\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule\n      ? obj\n      : {\n          default: obj\n        };\n  }\n\n  function _interopRequireWildcard(obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            var desc =\n              Object.defineProperty && Object.getOwnPropertyDescriptor\n                ? Object.getOwnPropertyDescriptor(obj, key)\n                : {};\n\n            if (desc.get || desc.set) {\n              Object.defineProperty(newObj, key, desc);\n            } else {\n              newObj[key] = obj[key];\n            }\n          }\n        }\n      }\n\n      newObj.default = obj;\n      return newObj;\n    }\n  }\n\n  function _newArrowCheck(innerThis, boundThis) {\n    if (innerThis !== boundThis) {\n      throw new TypeError('Cannot instantiate an arrow function');\n    }\n  }\n\n  function _objectDestructuringEmpty(obj) {\n    if (obj == null) throw new TypeError('Cannot destructure undefined');\n  }\n\n  function _objectWithoutPropertiesLoose(source, excluded) {\n    if (source == null) return {};\n    var target = {};\n    var sourceKeys = Object.keys(source);\n    var key, i;\n\n    for (i = 0; i < sourceKeys.length; i++) {\n      key = sourceKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      target[key] = source[key];\n    }\n\n    return target;\n  }\n\n  function _objectWithoutProperties(source, excluded) {\n    if (source == null) return {};\n\n    var target = _objectWithoutPropertiesLoose(source, excluded);\n\n    var key, i;\n\n    if (Object.getOwnPropertySymbols) {\n      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n      for (i = 0; i < sourceSymbolKeys.length; i++) {\n        key = sourceSymbolKeys[i];\n        if (excluded.indexOf(key) >= 0) continue;\n        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n        target[key] = source[key];\n      }\n    }\n\n    return target;\n  }\n\n  function _assertThisInitialized(self) {\n    if (self === void 0) {\n      throw new ReferenceError(\n        \"this hasn't been initialised - super() hasn't been called\"\n      );\n    }\n\n    return self;\n  }\n\n  function _possibleConstructorReturn(self, call) {\n    if (call && (typeof call === 'object' || typeof call === 'function')) {\n      return call;\n    }\n\n    return _assertThisInitialized(self);\n  }\n\n  function _superPropBase(object, property) {\n    while (!Object.prototype.hasOwnProperty.call(object, property)) {\n      object = _getPrototypeOf(object);\n      if (object === null) break;\n    }\n\n    return object;\n  }\n\n  function _get(target, property, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.get) {\n      _get = Reflect.get;\n    } else {\n      _get = function _get(target, property, receiver) {\n        var base = _superPropBase(target, property);\n\n        if (!base) return;\n        var desc = Object.getOwnPropertyDescriptor(base, property);\n\n        if (desc.get) {\n          return desc.get.call(receiver);\n        }\n\n        return desc.value;\n      };\n    }\n\n    return _get(target, property, receiver || target);\n  }\n\n  function set(target, property, value, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.set) {\n      set = Reflect.set;\n    } else {\n      set = function set(target, property, value, receiver) {\n        var base = _superPropBase(target, property);\n\n        var desc;\n\n        if (base) {\n          desc = Object.getOwnPropertyDescriptor(base, property);\n\n          if (desc.set) {\n            desc.set.call(receiver, value);\n            return true;\n          } else if (!desc.writable) {\n            return false;\n          }\n        }\n\n        desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n        if (desc) {\n          if (!desc.writable) {\n            return false;\n          }\n\n          desc.value = value;\n          Object.defineProperty(receiver, property, desc);\n        } else {\n          _defineProperty(receiver, property, value);\n        }\n\n        return true;\n      };\n    }\n\n    return set(target, property, value, receiver);\n  }\n\n  function _set(target, property, value, receiver, isStrict) {\n    var s = set(target, property, value, receiver || target);\n\n    if (!s && isStrict) {\n      throw new Error('failed to set property');\n    }\n\n    return value;\n  }\n\n  function _taggedTemplateLiteral(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    return Object.freeze(\n      Object.defineProperties(strings, {\n        raw: {\n          value: Object.freeze(raw)\n        }\n      })\n    );\n  }\n\n  function _taggedTemplateLiteralLoose(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    strings.raw = raw;\n    return strings;\n  }\n\n  function _temporalRef(val, name) {\n    if (val === _temporalUndefined) {\n      throw new ReferenceError(name + ' is not defined - temporal dead zone');\n    } else {\n      return val;\n    }\n  }\n\n  function _readOnlyError(name) {\n    throw new Error('\"' + name + '\" is read-only');\n  }\n\n  function _classNameTDZError(name) {\n    throw new Error(\n      'Class \"' + name + '\" cannot be referenced in computed property keys.'\n    );\n  }\n\n  var _temporalUndefined = {};\n\n  function _slicedToArray(arr, i) {\n    return (\n      _arrayWithHoles(arr) ||\n      _iterableToArrayLimit(arr, i) ||\n      _nonIterableRest()\n    );\n  }\n\n  function _slicedToArrayLoose(arr, i) {\n    return (\n      _arrayWithHoles(arr) ||\n      _iterableToArrayLimitLoose(arr, i) ||\n      _nonIterableRest()\n    );\n  }\n\n  function _toArray(arr) {\n    return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n  }\n\n  function _toConsumableArray(arr) {\n    return (\n      _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread()\n    );\n  }\n\n  function _arrayWithoutHoles(arr) {\n    if (Array.isArray(arr)) {\n      for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++)\n        arr2[i] = arr[i];\n\n      return arr2;\n    }\n  }\n\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n\n  function _iterableToArray(iter) {\n    if (\n      Symbol.iterator in Object(iter) ||\n      Object.prototype.toString.call(iter) === '[object Arguments]'\n    )\n      return Array.from(iter);\n  }\n\n  function _iterableToArrayLimit(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (\n        var _i = arr[Symbol.iterator](), _s;\n        !(_n = (_s = _i.next()).done);\n        _n = true\n      ) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i['return'] != null) _i['return']();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  function _iterableToArrayLimitLoose(arr, i) {\n    var _arr = [];\n\n    for (\n      var _iterator = arr[Symbol.iterator](), _step;\n      !(_step = _iterator.next()).done;\n\n    ) {\n      _arr.push(_step.value);\n\n      if (i && _arr.length === i) break;\n    }\n\n    return _arr;\n  }\n\n  function _nonIterableSpread() {\n    throw new TypeError('Invalid attempt to spread non-iterable instance');\n  }\n\n  function _nonIterableRest() {\n    throw new TypeError('Invalid attempt to destructure non-iterable instance');\n  }\n\n  function _skipFirstGeneratorNext(fn) {\n    return function() {\n      var it = fn.apply(this, arguments);\n      it.next();\n      return it;\n    };\n  }\n\n  function _toPrimitive(input, hint) {\n    if (typeof input !== 'object' || input === null) return input;\n    var prim = input[Symbol.toPrimitive];\n\n    if (prim !== undefined) {\n      var res = prim.call(input, hint || 'default');\n      if (typeof res !== 'object') return res;\n      throw new TypeError('@@toPrimitive must return a primitive value.');\n    }\n\n    return (hint === 'string' ? String : Number)(input);\n  }\n\n  function _toPropertyKey(arg) {\n    var key = _toPrimitive(arg, 'string');\n\n    return typeof key === 'symbol' ? key : String(key);\n  }\n\n  function _initializerWarningHelper(descriptor, context) {\n    throw new Error(\n      'Decorating class property failed. Please ensure that ' +\n        'proposal-class-properties is enabled and set to use loose mode. ' +\n        'To use proposal-class-properties in spec mode with decorators, wait for ' +\n        'the next major version of decorators in stage 2.'\n    );\n  }\n\n  function _initializerDefineProperty(target, property, descriptor, context) {\n    if (!descriptor) return;\n    Object.defineProperty(target, property, {\n      enumerable: descriptor.enumerable,\n      configurable: descriptor.configurable,\n      writable: descriptor.writable,\n      value: descriptor.initializer\n        ? descriptor.initializer.call(context)\n        : void 0\n    });\n  }\n\n  function _applyDecoratedDescriptor(\n    target,\n    property,\n    decorators,\n    descriptor,\n    context\n  ) {\n    var desc = {};\n    Object.keys(descriptor).forEach(function(key) {\n      desc[key] = descriptor[key];\n    });\n    desc.enumerable = !!desc.enumerable;\n    desc.configurable = !!desc.configurable;\n\n    if ('value' in desc || desc.initializer) {\n      desc.writable = true;\n    }\n\n    desc = decorators\n      .slice()\n      .reverse()\n      .reduce(function(desc, decorator) {\n        return decorator(target, property, desc) || desc;\n      }, desc);\n\n    if (context && desc.initializer !== void 0) {\n      desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n      desc.initializer = undefined;\n    }\n\n    if (desc.initializer === void 0) {\n      Object.defineProperty(target, property, desc);\n      desc = null;\n    }\n\n    return desc;\n  }\n\n  var id = 0;\n\n  function _classPrivateFieldLooseKey(name) {\n    return '__private_' + id++ + '_' + name;\n  }\n\n  function _classPrivateFieldLooseBase(receiver, privateKey) {\n    if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n      throw new TypeError('attempted to use private field on non-instance');\n    }\n\n    return receiver;\n  }\n\n  function _classPrivateFieldGet(receiver, privateMap) {\n    var descriptor = privateMap.get(receiver);\n\n    if (!descriptor) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    if (descriptor.get) {\n      return descriptor.get.call(receiver);\n    }\n\n    return descriptor.value;\n  }\n\n  function _classPrivateFieldSet(receiver, privateMap, value) {\n    var descriptor = privateMap.get(receiver);\n\n    if (!descriptor) {\n      throw new TypeError('attempted to set private field on non-instance');\n    }\n\n    if (descriptor.set) {\n      descriptor.set.call(receiver, value);\n    } else {\n      if (!descriptor.writable) {\n        throw new TypeError('attempted to set read only private field');\n      }\n\n      descriptor.value = value;\n    }\n\n    return value;\n  }\n\n  function _classPrivateFieldDestructureSet(receiver, privateMap) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to set private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.set) {\n      if (!('__destrObj' in descriptor)) {\n        descriptor.__destrObj = {\n          set value(v) {\n            descriptor.set.call(receiver, v);\n          }\n        };\n      }\n\n      return descriptor.__destrObj;\n    } else {\n      if (!descriptor.writable) {\n        throw new TypeError('attempted to set read only private field');\n      }\n\n      return descriptor;\n    }\n  }\n\n  function _classStaticPrivateFieldSpecGet(\n    receiver,\n    classConstructor,\n    descriptor\n  ) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return descriptor.value;\n  }\n\n  function _classStaticPrivateFieldSpecSet(\n    receiver,\n    classConstructor,\n    descriptor,\n    value\n  ) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    if (!descriptor.writable) {\n      throw new TypeError('attempted to set read only private field');\n    }\n\n    descriptor.value = value;\n    return value;\n  }\n\n  function _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return method;\n  }\n\n  function _classStaticPrivateMethodSet() {\n    throw new TypeError('attempted to set read only static private field');\n  }\n\n  function _decorate(decorators, factory, superClass, mixins) {\n    var api = _getDecoratorsApi();\n\n    if (mixins) {\n      for (var i = 0; i < mixins.length; i++) {\n        api = mixins[i](api);\n      }\n    }\n\n    var r = factory(function initialize(O) {\n      api.initializeInstanceElements(O, decorated.elements);\n    }, superClass);\n    var decorated = api.decorateClass(\n      _coalesceClassElements(r.d.map(_createElementDescriptor)),\n      decorators\n    );\n    api.initializeClassElements(r.F, decorated.elements);\n    return api.runClassFinishers(r.F, decorated.finishers);\n  }\n\n  function _getDecoratorsApi() {\n    _getDecoratorsApi = function() {\n      return api;\n    };\n\n    var api = {\n      elementsDefinitionOrder: [['method'], ['field']],\n      initializeInstanceElements: function(O, elements) {\n        ['method', 'field'].forEach(function(kind) {\n          elements.forEach(function(element) {\n            if (element.kind === kind && element.placement === 'own') {\n              this.defineClassElement(O, element);\n            }\n          }, this);\n        }, this);\n      },\n      initializeClassElements: function(F, elements) {\n        var proto = F.prototype;\n        ['method', 'field'].forEach(function(kind) {\n          elements.forEach(function(element) {\n            var placement = element.placement;\n\n            if (\n              element.kind === kind &&\n              (placement === 'static' || placement === 'prototype')\n            ) {\n              var receiver = placement === 'static' ? F : proto;\n              this.defineClassElement(receiver, element);\n            }\n          }, this);\n        }, this);\n      },\n      defineClassElement: function(receiver, element) {\n        var descriptor = element.descriptor;\n\n        if (element.kind === 'field') {\n          var initializer = element.initializer;\n          descriptor = {\n            enumerable: descriptor.enumerable,\n            writable: descriptor.writable,\n            configurable: descriptor.configurable,\n            value: initializer === void 0 ? void 0 : initializer.call(receiver)\n          };\n        }\n\n        Object.defineProperty(receiver, element.key, descriptor);\n      },\n      decorateClass: function(elements, decorators) {\n        var newElements = [];\n        var finishers = [];\n        var placements = {\n          static: [],\n          prototype: [],\n          own: []\n        };\n        elements.forEach(function(element) {\n          this.addElementPlacement(element, placements);\n        }, this);\n        elements.forEach(function(element) {\n          if (!_hasDecorators(element)) return newElements.push(element);\n          var elementFinishersExtras = this.decorateElement(\n            element,\n            placements\n          );\n          newElements.push(elementFinishersExtras.element);\n          newElements.push.apply(newElements, elementFinishersExtras.extras);\n          finishers.push.apply(finishers, elementFinishersExtras.finishers);\n        }, this);\n\n        if (!decorators) {\n          return {\n            elements: newElements,\n            finishers: finishers\n          };\n        }\n\n        var result = this.decorateConstructor(newElements, decorators);\n        finishers.push.apply(finishers, result.finishers);\n        result.finishers = finishers;\n        return result;\n      },\n      addElementPlacement: function(element, placements, silent) {\n        var keys = placements[element.placement];\n\n        if (!silent && keys.indexOf(element.key) !== -1) {\n          throw new TypeError('Duplicated element (' + element.key + ')');\n        }\n\n        keys.push(element.key);\n      },\n      decorateElement: function(element, placements) {\n        var extras = [];\n        var finishers = [];\n\n        for (\n          var decorators = element.decorators, i = decorators.length - 1;\n          i >= 0;\n          i--\n        ) {\n          var keys = placements[element.placement];\n          keys.splice(keys.indexOf(element.key), 1);\n          var elementObject = this.fromElementDescriptor(element);\n          var elementFinisherExtras = this.toElementFinisherExtras(\n            (0, decorators[i])(elementObject) || elementObject\n          );\n          element = elementFinisherExtras.element;\n          this.addElementPlacement(element, placements);\n\n          if (elementFinisherExtras.finisher) {\n            finishers.push(elementFinisherExtras.finisher);\n          }\n\n          var newExtras = elementFinisherExtras.extras;\n\n          if (newExtras) {\n            for (var j = 0; j < newExtras.length; j++) {\n              this.addElementPlacement(newExtras[j], placements);\n            }\n\n            extras.push.apply(extras, newExtras);\n          }\n        }\n\n        return {\n          element: element,\n          finishers: finishers,\n          extras: extras\n        };\n      },\n      decorateConstructor: function(elements, decorators) {\n        var finishers = [];\n\n        for (var i = decorators.length - 1; i >= 0; i--) {\n          var obj = this.fromClassDescriptor(elements);\n          var elementsAndFinisher = this.toClassDescriptor(\n            (0, decorators[i])(obj) || obj\n          );\n\n          if (elementsAndFinisher.finisher !== undefined) {\n            finishers.push(elementsAndFinisher.finisher);\n          }\n\n          if (elementsAndFinisher.elements !== undefined) {\n            elements = elementsAndFinisher.elements;\n\n            for (var j = 0; j < elements.length - 1; j++) {\n              for (var k = j + 1; k < elements.length; k++) {\n                if (\n                  elements[j].key === elements[k].key &&\n                  elements[j].placement === elements[k].placement\n                ) {\n                  throw new TypeError(\n                    'Duplicated element (' + elements[j].key + ')'\n                  );\n                }\n              }\n            }\n          }\n        }\n\n        return {\n          elements: elements,\n          finishers: finishers\n        };\n      },\n      fromElementDescriptor: function(element) {\n        var obj = {\n          kind: element.kind,\n          key: element.key,\n          placement: element.placement,\n          descriptor: element.descriptor\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        if (element.kind === 'field') obj.initializer = element.initializer;\n        return obj;\n      },\n      toElementDescriptors: function(elementObjects) {\n        if (elementObjects === undefined) return;\n        return _toArray(elementObjects).map(function(elementObject) {\n          var element = this.toElementDescriptor(elementObject);\n          this.disallowProperty(\n            elementObject,\n            'finisher',\n            'An element descriptor'\n          );\n          this.disallowProperty(\n            elementObject,\n            'extras',\n            'An element descriptor'\n          );\n          return element;\n        }, this);\n      },\n      toElementDescriptor: function(elementObject) {\n        var kind = String(elementObject.kind);\n\n        if (kind !== 'method' && kind !== 'field') {\n          throw new TypeError(\n            'An element descriptor\\'s .kind property must be either \"method\" or' +\n              ' \"field\", but a decorator created an element descriptor with' +\n              ' .kind \"' +\n              kind +\n              '\"'\n          );\n        }\n\n        var key = _toPropertyKey(elementObject.key);\n\n        var placement = String(elementObject.placement);\n\n        if (\n          placement !== 'static' &&\n          placement !== 'prototype' &&\n          placement !== 'own'\n        ) {\n          throw new TypeError(\n            'An element descriptor\\'s .placement property must be one of \"static\",' +\n              ' \"prototype\" or \"own\", but a decorator created an element descriptor' +\n              ' with .placement \"' +\n              placement +\n              '\"'\n          );\n        }\n\n        var descriptor = elementObject.descriptor;\n        this.disallowProperty(\n          elementObject,\n          'elements',\n          'An element descriptor'\n        );\n        var element = {\n          kind: kind,\n          key: key,\n          placement: placement,\n          descriptor: Object.assign({}, descriptor)\n        };\n\n        if (kind !== 'field') {\n          this.disallowProperty(\n            elementObject,\n            'initializer',\n            'A method descriptor'\n          );\n        } else {\n          this.disallowProperty(\n            descriptor,\n            'get',\n            'The property descriptor of a field descriptor'\n          );\n          this.disallowProperty(\n            descriptor,\n            'set',\n            'The property descriptor of a field descriptor'\n          );\n          this.disallowProperty(\n            descriptor,\n            'value',\n            'The property descriptor of a field descriptor'\n          );\n          element.initializer = elementObject.initializer;\n        }\n\n        return element;\n      },\n      toElementFinisherExtras: function(elementObject) {\n        var element = this.toElementDescriptor(elementObject);\n\n        var finisher = _optionalCallableProperty(elementObject, 'finisher');\n\n        var extras = this.toElementDescriptors(elementObject.extras);\n        return {\n          element: element,\n          finisher: finisher,\n          extras: extras\n        };\n      },\n      fromClassDescriptor: function(elements) {\n        var obj = {\n          kind: 'class',\n          elements: elements.map(this.fromElementDescriptor, this)\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        return obj;\n      },\n      toClassDescriptor: function(obj) {\n        var kind = String(obj.kind);\n\n        if (kind !== 'class') {\n          throw new TypeError(\n            'A class descriptor\\'s .kind property must be \"class\", but a decorator' +\n              ' created a class descriptor with .kind \"' +\n              kind +\n              '\"'\n          );\n        }\n\n        this.disallowProperty(obj, 'key', 'A class descriptor');\n        this.disallowProperty(obj, 'placement', 'A class descriptor');\n        this.disallowProperty(obj, 'descriptor', 'A class descriptor');\n        this.disallowProperty(obj, 'initializer', 'A class descriptor');\n        this.disallowProperty(obj, 'extras', 'A class descriptor');\n\n        var finisher = _optionalCallableProperty(obj, 'finisher');\n\n        var elements = this.toElementDescriptors(obj.elements);\n        return {\n          elements: elements,\n          finisher: finisher\n        };\n      },\n      runClassFinishers: function(constructor, finishers) {\n        for (var i = 0; i < finishers.length; i++) {\n          var newConstructor = (0, finishers[i])(constructor);\n\n          if (newConstructor !== undefined) {\n            if (typeof newConstructor !== 'function') {\n              throw new TypeError('Finishers must return a constructor.');\n            }\n\n            constructor = newConstructor;\n          }\n        }\n\n        return constructor;\n      },\n      disallowProperty: function(obj, name, objectType) {\n        if (obj[name] !== undefined) {\n          throw new TypeError(\n            objectType + \" can't have a .\" + name + ' property.'\n          );\n        }\n      }\n    };\n    return api;\n  }\n\n  function _createElementDescriptor(def) {\n    var key = _toPropertyKey(def.key);\n\n    var descriptor;\n\n    if (def.kind === 'method') {\n      descriptor = {\n        value: def.value,\n        writable: true,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'get') {\n      descriptor = {\n        get: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'set') {\n      descriptor = {\n        set: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'field') {\n      descriptor = {\n        configurable: true,\n        writable: true,\n        enumerable: true\n      };\n    }\n\n    var element = {\n      kind: def.kind === 'field' ? 'field' : 'method',\n      key: key,\n      placement: def.static\n        ? 'static'\n        : def.kind === 'field'\n        ? 'own'\n        : 'prototype',\n      descriptor: descriptor\n    };\n    if (def.decorators) element.decorators = def.decorators;\n    if (def.kind === 'field') element.initializer = def.value;\n    return element;\n  }\n\n  function _coalesceGetterSetter(element, other) {\n    if (element.descriptor.get !== undefined) {\n      other.descriptor.get = element.descriptor.get;\n    } else {\n      other.descriptor.set = element.descriptor.set;\n    }\n  }\n\n  function _coalesceClassElements(elements) {\n    var newElements = [];\n\n    var isSameElement = function(other) {\n      return (\n        other.kind === 'method' &&\n        other.key === element.key &&\n        other.placement === element.placement\n      );\n    };\n\n    for (var i = 0; i < elements.length; i++) {\n      var element = elements[i];\n      var other;\n\n      if (\n        element.kind === 'method' &&\n        (other = newElements.find(isSameElement))\n      ) {\n        if (\n          _isDataDescriptor(element.descriptor) ||\n          _isDataDescriptor(other.descriptor)\n        ) {\n          if (_hasDecorators(element) || _hasDecorators(other)) {\n            throw new ReferenceError(\n              'Duplicated methods (' + element.key + \") can't be decorated.\"\n            );\n          }\n\n          other.descriptor = element.descriptor;\n        } else {\n          if (_hasDecorators(element)) {\n            if (_hasDecorators(other)) {\n              throw new ReferenceError(\n                \"Decorators can't be placed on different accessors with for \" +\n                  'the same property (' +\n                  element.key +\n                  ').'\n              );\n            }\n\n            other.decorators = element.decorators;\n          }\n\n          _coalesceGetterSetter(element, other);\n        }\n      } else {\n        newElements.push(element);\n      }\n    }\n\n    return newElements;\n  }\n\n  function _hasDecorators(element) {\n    return element.decorators && element.decorators.length;\n  }\n\n  function _isDataDescriptor(desc) {\n    return (\n      desc !== undefined &&\n      !(desc.value === undefined && desc.writable === undefined)\n    );\n  }\n\n  function _optionalCallableProperty(obj, name) {\n    var value = obj[name];\n\n    if (value !== undefined && typeof value !== 'function') {\n      throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n    }\n\n    return value;\n  }\n\n  function _classPrivateMethodGet(receiver, privateSet, fn) {\n    if (!privateSet.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    return fn;\n  }\n\n  function _classPrivateMethodSet() {\n    throw new TypeError('attempted to reassign private method');\n  }\n\n  function _wrapRegExp(re, groups) {\n    _wrapRegExp = function(re, groups) {\n      return new BabelRegExp(re, groups);\n    };\n\n    var _RegExp = _wrapNativeSuper(RegExp);\n\n    var _super = RegExp.prototype;\n\n    var _groups = new WeakMap();\n\n    function BabelRegExp(re, groups) {\n      var _this = _RegExp.call(this, re);\n\n      _groups.set(_this, groups);\n\n      return _this;\n    }\n\n    _inherits(BabelRegExp, _RegExp);\n\n    BabelRegExp.prototype.exec = function(str) {\n      var result = _super.exec.call(this, str);\n\n      if (result) result.groups = buildGroups(result, this);\n      return result;\n    };\n\n    BabelRegExp.prototype[Symbol.replace] = function(str, substitution) {\n      if (typeof substitution === 'string') {\n        var groups = _groups.get(this);\n\n        return _super[Symbol.replace].call(\n          this,\n          str,\n          substitution.replace(/\\$<([^>]+)>/g, function(_, name) {\n            return '$' + groups[name];\n          })\n        );\n      } else if (typeof substitution === 'function') {\n        var _this = this;\n\n        return _super[Symbol.replace].call(this, str, function() {\n          var args = [];\n          args.push.apply(args, arguments);\n\n          if (typeof args[args.length - 1] !== 'object') {\n            args.push(buildGroups(args, _this));\n          }\n\n          return substitution.apply(this, args);\n        });\n      } else {\n        return _super[Symbol.replace].call(this, str, substitution);\n      }\n    };\n\n    function buildGroups(result, re) {\n      var g = _groups.get(re);\n\n      return Object.keys(g).reduce(function(groups, name) {\n        groups[name] = result[g[name]];\n        return groups;\n      }, Object.create(null));\n    }\n\n    return _wrapRegExp.apply(this, arguments);\n  }\n\n  var arrayRemove = function arrayRemove(arr, index) {\n    return arr.splice(index, 1);\n  };\n\n  var run = function run(cb, sync) {\n    if (sync) {\n      cb();\n    } else if (document.hidden) {\n      Promise.resolve(1).then(cb);\n    } else {\n      setTimeout(cb, 0);\n    }\n  };\n\n  var on = function on() {\n    var listeners = [];\n    var off = function off(event, cb) {\n      arrayRemove(\n        listeners,\n        listeners.findIndex(function(listener) {\n          return listener.event === event && (listener.cb === cb || !cb);\n        })\n      );\n    };\n    var _fire = function fire(event, args, sync) {\n      listeners\n        .filter(function(listener) {\n          return listener.event === event;\n        })\n        .map(function(listener) {\n          return listener.cb;\n        })\n        .forEach(function(cb) {\n          return run(function() {\n            return cb.apply(void 0, _toConsumableArray(args));\n          }, sync);\n        });\n    };\n    return {\n      fireSync: function fireSync(event) {\n        for (\n          var _len = arguments.length,\n            args = new Array(_len > 1 ? _len - 1 : 0),\n            _key = 1;\n          _key < _len;\n          _key++\n        ) {\n          args[_key - 1] = arguments[_key];\n        }\n        _fire(event, args, true);\n      },\n      fire: function fire(event) {\n        for (\n          var _len2 = arguments.length,\n            args = new Array(_len2 > 1 ? _len2 - 1 : 0),\n            _key2 = 1;\n          _key2 < _len2;\n          _key2++\n        ) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n        _fire(event, args, false);\n      },\n      on: function on(event, cb) {\n        listeners.push({ event: event, cb: cb });\n      },\n      onOnce: function onOnce(event, _cb) {\n        listeners.push({\n          event: event,\n          cb: function cb() {\n            off(event, _cb);\n            _cb.apply(void 0, arguments);\n          }\n        });\n      },\n      off: off\n    };\n  };\n\n  var copyObjectPropertiesToObject = function copyObjectPropertiesToObject(\n    src,\n    target,\n    excluded\n  ) {\n    Object.getOwnPropertyNames(src)\n      .filter(function(property) {\n        return !excluded.includes(property);\n      })\n      .forEach(function(key) {\n        return Object.defineProperty(\n          target,\n          key,\n          Object.getOwnPropertyDescriptor(src, key)\n        );\n      });\n  };\n\n  var PRIVATE = [\n    'fire',\n    'process',\n    'revert',\n    'load',\n    'on',\n    'off',\n    'onOnce',\n    'retryLoad',\n    'extend',\n    'archive',\n    'archived',\n    'release',\n    'released',\n    'requestProcessing',\n    'freeze'\n  ];\n\n  var createItemAPI = function createItemAPI(item) {\n    var api = {};\n    copyObjectPropertiesToObject(item, api, PRIVATE);\n    return api;\n  };\n\n  var removeReleasedItems = function removeReleasedItems(items) {\n    items.forEach(function(item, index) {\n      if (item.released) {\n        arrayRemove(items, index);\n      }\n    });\n  };\n\n  var ItemStatus = {\n    INIT: 1,\n    IDLE: 2,\n    PROCESSING_QUEUED: 9,\n    PROCESSING: 3,\n    PROCESSING_COMPLETE: 5,\n    PROCESSING_ERROR: 6,\n    PROCESSING_REVERT_ERROR: 10,\n    LOADING: 7,\n    LOAD_ERROR: 8\n  };\n\n  var FileOrigin = {\n    INPUT: 1,\n    LIMBO: 2,\n    LOCAL: 3\n  };\n\n  var getNonNumeric = function getNonNumeric(str) {\n    return /[^0-9]+/.exec(str);\n  };\n\n  var getDecimalSeparator = function getDecimalSeparator() {\n    return getNonNumeric((1.1).toLocaleString())[0];\n  };\n\n  var getThousandsSeparator = function getThousandsSeparator() {\n    // Added for browsers that do not return the thousands separator (happend on native browser Android 4.4.4)\n    // We check against the normal toString output and if they're the same return a comma when decimal separator is a dot\n    var decimalSeparator = getDecimalSeparator();\n    var thousandsStringWithSeparator = (1000.0).toLocaleString();\n    var thousandsStringWithoutSeparator = (1000.0).toString();\n    if (thousandsStringWithSeparator !== thousandsStringWithoutSeparator) {\n      return getNonNumeric(thousandsStringWithSeparator)[0];\n    }\n    return decimalSeparator === '.' ? ',' : '.';\n  };\n\n  var Type = {\n    BOOLEAN: 'boolean',\n    INT: 'int',\n    NUMBER: 'number',\n    STRING: 'string',\n    ARRAY: 'array',\n    OBJECT: 'object',\n    FUNCTION: 'function',\n    ACTION: 'action',\n    SERVER_API: 'serverapi',\n    REGEX: 'regex'\n  };\n\n  // all registered filters\n  var filters = [];\n\n  // loops over matching filters and passes options to each filter, returning the mapped results\n  var applyFilterChain = function applyFilterChain(key, value, utils) {\n    return new Promise(function(resolve, reject) {\n      // find matching filters for this key\n      var matchingFilters = filters\n        .filter(function(f) {\n          return f.key === key;\n        })\n        .map(function(f) {\n          return f.cb;\n        });\n\n      // resolve now\n      if (matchingFilters.length === 0) {\n        resolve(value);\n        return;\n      }\n\n      // first filter to kick things of\n      var initialFilter = matchingFilters.shift();\n\n      // chain filters\n      matchingFilters\n        .reduce(\n          // loop over promises passing value to next promise\n          function(current, next) {\n            return current.then(function(value) {\n              return next(value, utils);\n            });\n          },\n\n          // call initial filter, will return a promise\n          initialFilter(value, utils)\n\n          // all executed\n        )\n        .then(function(value) {\n          return resolve(value);\n        })\n        .catch(function(error) {\n          return reject(error);\n        });\n    });\n  };\n\n  var applyFilters = function applyFilters(key, value, utils) {\n    return filters\n      .filter(function(f) {\n        return f.key === key;\n      })\n      .map(function(f) {\n        return f.cb(value, utils);\n      });\n  };\n\n  // adds a new filter to the list\n  var addFilter = function addFilter(key, cb) {\n    return filters.push({ key: key, cb: cb });\n  };\n\n  var extendDefaultOptions = function extendDefaultOptions(additionalOptions) {\n    return Object.assign(defaultOptions, additionalOptions);\n  };\n\n  var getOptions = function getOptions() {\n    return Object.assign({}, defaultOptions);\n  };\n\n  var setOptions = function setOptions(opts) {\n    forin(opts, function(key, value) {\n      // key does not exist, so this option cannot be set\n      if (!defaultOptions[key]) {\n        return;\n      }\n      defaultOptions[key][0] = getValueByType(\n        value,\n        defaultOptions[key][0],\n        defaultOptions[key][1]\n      );\n    });\n  };\n\n  // default options on app\n  var defaultOptions = {\n    // the id to add to the root element\n    id: [null, Type.STRING],\n\n    // input field name to use\n    name: ['filepond', Type.STRING],\n\n    // disable the field\n    disabled: [false, Type.BOOLEAN],\n\n    // classname to put on wrapper\n    className: [null, Type.STRING],\n\n    // is the field required\n    required: [false, Type.BOOLEAN],\n\n    // Allow media capture when value is set\n    captureMethod: [null, Type.STRING],\n    // - \"camera\", \"microphone\" or \"camcorder\",\n    // - Does not work with multiple on apple devices\n    // - If set, acceptedFileTypes must be made to match with media wildcard \"image/*\", \"audio/*\" or \"video/*\"\n\n    // sync `acceptedFileTypes` property with `accept` attribute\n    allowSyncAcceptAttribute: [true, Type.BOOLEAN],\n\n    // Feature toggles\n    allowDrop: [true, Type.BOOLEAN], // Allow dropping of files\n    allowBrowse: [true, Type.BOOLEAN], // Allow browsing the file system\n    allowPaste: [true, Type.BOOLEAN], // Allow pasting files\n    allowMultiple: [false, Type.BOOLEAN], // Allow multiple files (disabled by default, as multiple attribute is also required on input to allow multiple)\n    allowReplace: [true, Type.BOOLEAN], // Allow dropping a file on other file to replace it (only works when multiple is set to false)\n    allowRevert: [true, Type.BOOLEAN], // Allows user to revert file upload\n    allowRemove: [true, Type.BOOLEAN], // Allow user to remove a file\n    allowProcess: [true, Type.BOOLEAN], // Allows user to process a file, when set to false, this removes the file upload button\n    allowReorder: [false, Type.BOOLEAN], // Allow reordering of files\n    allowDirectoriesOnly: [false, Type.BOOLEAN], // Allow only selecting directories with browse (no support for filtering dnd at this point)\n\n    // Revert mode\n    forceRevert: [false, Type.BOOLEAN], // Set to 'force' to require the file to be reverted before removal\n\n    // Input requirements\n    maxFiles: [null, Type.INT], // Max number of files\n    checkValidity: [false, Type.BOOLEAN], // Enables custom validity messages\n\n    // Where to put file\n    itemInsertLocationFreedom: [true, Type.BOOLEAN], // Set to false to always add items to begin or end of list\n    itemInsertLocation: ['before', Type.STRING], // Default index in list to add items that have been dropped at the top of the list\n    itemInsertInterval: [75, Type.INT],\n\n    // Drag 'n Drop related\n    dropOnPage: [false, Type.BOOLEAN], // Allow dropping of files anywhere on page (prevents browser from opening file if dropped outside of Up)\n    dropOnElement: [true, Type.BOOLEAN], // Drop needs to happen on element (set to false to also load drops outside of Up)\n    dropValidation: [false, Type.BOOLEAN], // Enable or disable validating files on drop\n    ignoredFiles: [['.ds_store', 'thumbs.db', 'desktop.ini'], Type.ARRAY],\n\n    // Upload related\n    instantUpload: [true, Type.BOOLEAN], // Should upload files immidiately on drop\n    maxParallelUploads: [2, Type.INT], // Maximum files to upload in parallel\n\n    // Chunks\n    chunkUploads: [false, Type.BOOLEAN], // Enable chunked uploads\n    chunkForce: [false, Type.BOOLEAN], // Force use of chunk uploads even for files smaller than chunk size\n    chunkSize: [5000000, Type.INT], // Size of chunks (5MB default)\n    chunkRetryDelays: [[500, 1000, 3000], Type.Array], // Amount of times to retry upload of a chunk when it fails\n\n    // The server api end points to use for uploading (see docs)\n    server: [null, Type.SERVER_API],\n\n    // Labels and status messages\n    labelDecimalSeparator: [getDecimalSeparator(), Type.STRING], // Default is locale separator\n    labelThousandsSeparator: [getThousandsSeparator(), Type.STRING], // Default is locale separator\n\n    labelIdle: [\n      'Drag & Drop your files or <span class=\"filepond--label-action\">Browse</span>',\n      Type.STRING\n    ],\n    labelInvalidField: ['Field contains invalid files', Type.STRING],\n    labelFileWaitingForSize: ['Waiting for size', Type.STRING],\n    labelFileSizeNotAvailable: ['Size not available', Type.STRING],\n    labelFileCountSingular: ['file in list', Type.STRING],\n    labelFileCountPlural: ['files in list', Type.STRING],\n    labelFileLoading: ['Loading', Type.STRING],\n    labelFileAdded: ['Added', Type.STRING], // assistive only\n    labelFileLoadError: ['Error during load', Type.STRING],\n    labelFileRemoved: ['Removed', Type.STRING], // assistive only\n    labelFileRemoveError: ['Error during remove', Type.STRING],\n    labelFileProcessing: ['Uploading', Type.STRING],\n    labelFileProcessingComplete: ['Upload complete', Type.STRING],\n    labelFileProcessingAborted: ['Upload cancelled', Type.STRING],\n    labelFileProcessingError: ['Error during upload', Type.STRING],\n    labelFileProcessingRevertError: ['Error during revert', Type.STRING],\n\n    labelTapToCancel: ['tap to cancel', Type.STRING],\n    labelTapToRetry: ['tap to retry', Type.STRING],\n    labelTapToUndo: ['tap to undo', Type.STRING],\n\n    labelButtonRemoveItem: ['Remove', Type.STRING],\n    labelButtonAbortItemLoad: ['Abort', Type.STRING],\n    labelButtonRetryItemLoad: ['Retry', Type.STRING],\n    labelButtonAbortItemProcessing: ['Cancel', Type.STRING],\n    labelButtonUndoItemProcessing: ['Undo', Type.STRING],\n    labelButtonRetryItemProcessing: ['Retry', Type.STRING],\n    labelButtonProcessItem: ['Upload', Type.STRING],\n\n    // make sure width and height plus viewpox are even numbers so icons are nicely centered\n    iconRemove: [\n      '<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M11.586 13l-2.293 2.293a1 1 0 0 0 1.414 1.414L13 14.414l2.293 2.293a1 1 0 0 0 1.414-1.414L14.414 13l2.293-2.293a1 1 0 0 0-1.414-1.414L13 11.586l-2.293-2.293a1 1 0 0 0-1.414 1.414L11.586 13z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>',\n      Type.STRING\n    ],\n\n    iconProcess: [\n      '<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 10.414v3.585a1 1 0 0 1-2 0v-3.585l-1.293 1.293a1 1 0 0 1-1.414-1.415l3-3a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1-1.414 1.415L14 10.414zM9 18a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2H9z\" fill=\"currentColor\" fill-rule=\"evenodd\"/></svg>',\n      Type.STRING\n    ],\n\n    iconRetry: [\n      '<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10.81 9.185l-.038.02A4.997 4.997 0 0 0 8 13.683a5 5 0 0 0 5 5 5 5 0 0 0 5-5 1 1 0 0 1 2 0A7 7 0 1 1 9.722 7.496l-.842-.21a.999.999 0 1 1 .484-1.94l3.23.806c.535.133.86.675.73 1.21l-.804 3.233a.997.997 0 0 1-1.21.73.997.997 0 0 1-.73-1.21l.23-.928v-.002z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>',\n      Type.STRING\n    ],\n\n    iconUndo: [\n      '<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M9.185 10.81l.02-.038A4.997 4.997 0 0 1 13.683 8a5 5 0 0 1 5 5 5 5 0 0 1-5 5 1 1 0 0 0 0 2A7 7 0 1 0 7.496 9.722l-.21-.842a.999.999 0 1 0-1.94.484l.806 3.23c.133.535.675.86 1.21.73l3.233-.803a.997.997 0 0 0 .73-1.21.997.997 0 0 0-1.21-.73l-.928.23-.002-.001z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>',\n      Type.STRING\n    ],\n\n    iconDone: [\n      '<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M18.293 9.293a1 1 0 0 1 1.414 1.414l-7.002 7a1 1 0 0 1-1.414 0l-3.998-4a1 1 0 1 1 1.414-1.414L12 15.586l6.294-6.293z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>',\n      Type.STRING\n    ],\n\n    // event handlers\n    oninit: [null, Type.FUNCTION],\n    onwarning: [null, Type.FUNCTION],\n    onerror: [null, Type.FUNCTION],\n    onactivatefile: [null, Type.FUNCTION],\n    oninitfile: [null, Type.FUNCTION],\n    onaddfilestart: [null, Type.FUNCTION],\n    onaddfileprogress: [null, Type.FUNCTION],\n    onaddfile: [null, Type.FUNCTION],\n    onprocessfilestart: [null, Type.FUNCTION],\n    onprocessfileprogress: [null, Type.FUNCTION],\n    onprocessfileabort: [null, Type.FUNCTION],\n    onprocessfilerevert: [null, Type.FUNCTION],\n    onprocessfile: [null, Type.FUNCTION],\n    onprocessfiles: [null, Type.FUNCTION],\n    onremovefile: [null, Type.FUNCTION],\n    onpreparefile: [null, Type.FUNCTION],\n    onupdatefiles: [null, Type.FUNCTION],\n    onreorderfiles: [null, Type.FUNCTION],\n\n    // hooks\n    beforeDropFile: [null, Type.FUNCTION],\n    beforeAddFile: [null, Type.FUNCTION],\n    beforeRemoveFile: [null, Type.FUNCTION],\n\n    // styles\n    stylePanelLayout: [null, Type.STRING], // null 'integrated', 'compact', 'circle'\n    stylePanelAspectRatio: [null, Type.STRING], // null or '3:2' or 1\n    styleItemPanelAspectRatio: [null, Type.STRING],\n    styleButtonRemoveItemPosition: ['left', Type.STRING],\n    styleButtonProcessItemPosition: ['right', Type.STRING],\n    styleLoadIndicatorPosition: ['right', Type.STRING],\n    styleProgressIndicatorPosition: ['right', Type.STRING],\n    styleButtonRemoveItemAlign: [false, Type.BOOLEAN],\n\n    // custom initial files array\n    files: [[], Type.ARRAY]\n  };\n\n  var getItemByQuery = function getItemByQuery(items, query) {\n    // just return first index\n    if (isEmpty(query)) {\n      return items[0] || null;\n    }\n\n    // query is index\n    if (isInt(query)) {\n      return items[query] || null;\n    }\n\n    // if query is item, get the id\n    if (typeof query === 'object') {\n      query = query.id;\n    }\n\n    // assume query is a string and return item by id\n    return (\n      items.find(function(item) {\n        return item.id === query;\n      }) || null\n    );\n  };\n\n  var getNumericAspectRatioFromString = function getNumericAspectRatioFromString(\n    aspectRatio\n  ) {\n    if (isEmpty(aspectRatio)) {\n      return aspectRatio;\n    }\n    if (/:/.test(aspectRatio)) {\n      var parts = aspectRatio.split(':');\n      return parts[1] / parts[0];\n    }\n    return parseFloat(aspectRatio);\n  };\n\n  var getActiveItems = function getActiveItems(items) {\n    return items.filter(function(item) {\n      return !item.archived;\n    });\n  };\n\n  var Status = {\n    EMPTY: 0,\n    IDLE: 1, // waiting\n    ERROR: 2, // a file is in error state\n    BUSY: 3, // busy processing or loading\n    READY: 4 // all files uploaded\n  };\n\n  var ITEM_ERROR = [\n    ItemStatus.LOAD_ERROR,\n    ItemStatus.PROCESSING_ERROR,\n    ItemStatus.PROCESSING_REVERT_ERROR\n  ];\n  var ITEM_BUSY = [\n    ItemStatus.LOADING,\n    ItemStatus.PROCESSING,\n    ItemStatus.PROCESSING_QUEUED,\n    ItemStatus.INIT\n  ];\n  var ITEM_READY = [ItemStatus.PROCESSING_COMPLETE];\n\n  var isItemInErrorState = function isItemInErrorState(item) {\n    return ITEM_ERROR.includes(item.status);\n  };\n  var isItemInBusyState = function isItemInBusyState(item) {\n    return ITEM_BUSY.includes(item.status);\n  };\n  var isItemInReadyState = function isItemInReadyState(item) {\n    return ITEM_READY.includes(item.status);\n  };\n\n  var queries = function queries(state) {\n    return {\n      GET_STATUS: function GET_STATUS() {\n        var items = getActiveItems(state.items);\n        var EMPTY = Status.EMPTY,\n          ERROR = Status.ERROR,\n          BUSY = Status.BUSY,\n          IDLE = Status.IDLE,\n          READY = Status.READY;\n\n        if (items.length === 0) return EMPTY;\n\n        if (items.some(isItemInErrorState)) return ERROR;\n\n        if (items.some(isItemInBusyState)) return BUSY;\n\n        if (items.some(isItemInReadyState)) return READY;\n\n        return IDLE;\n      },\n\n      GET_ITEM: function GET_ITEM(query) {\n        return getItemByQuery(state.items, query);\n      },\n\n      GET_ACTIVE_ITEM: function GET_ACTIVE_ITEM(query) {\n        return getItemByQuery(getActiveItems(state.items), query);\n      },\n\n      GET_ACTIVE_ITEMS: function GET_ACTIVE_ITEMS() {\n        return getActiveItems(state.items);\n      },\n\n      GET_ITEMS: function GET_ITEMS() {\n        return state.items;\n      },\n\n      GET_ITEM_NAME: function GET_ITEM_NAME(query) {\n        var item = getItemByQuery(state.items, query);\n        return item ? item.filename : null;\n      },\n\n      GET_ITEM_SIZE: function GET_ITEM_SIZE(query) {\n        var item = getItemByQuery(state.items, query);\n        return item ? item.fileSize : null;\n      },\n\n      GET_STYLES: function GET_STYLES() {\n        return Object.keys(state.options)\n          .filter(function(key) {\n            return /^style/.test(key);\n          })\n          .map(function(option) {\n            return {\n              name: option,\n              value: state.options[option]\n            };\n          });\n      },\n\n      GET_PANEL_ASPECT_RATIO: function GET_PANEL_ASPECT_RATIO() {\n        var isShapeCircle = /circle/.test(state.options.stylePanelLayout);\n        var aspectRatio = isShapeCircle\n          ? 1\n          : getNumericAspectRatioFromString(\n              state.options.stylePanelAspectRatio\n            );\n        return aspectRatio;\n      },\n\n      GET_ITEM_PANEL_ASPECT_RATIO: function GET_ITEM_PANEL_ASPECT_RATIO() {\n        return state.options.styleItemPanelAspectRatio;\n      },\n\n      GET_ITEMS_BY_STATUS: function GET_ITEMS_BY_STATUS(status) {\n        return getActiveItems(state.items).filter(function(item) {\n          return item.status === status;\n        });\n      },\n\n      GET_TOTAL_ITEMS: function GET_TOTAL_ITEMS() {\n        return getActiveItems(state.items).length;\n      },\n\n      IS_ASYNC: function IS_ASYNC() {\n        return (\n          isObject(state.options.server) &&\n          (isObject(state.options.server.process) ||\n            isFunction(state.options.server.process))\n        );\n      }\n    };\n  };\n\n  var hasRoomForItem = function hasRoomForItem(state) {\n    var count = getActiveItems(state.items).length;\n\n    // if cannot have multiple items, to add one item it should currently not contain items\n    if (!state.options.allowMultiple) {\n      return count === 0;\n    }\n\n    // if allows multiple items, we check if a max item count has been set, if not, there's no limit\n    var maxFileCount = state.options.maxFiles;\n    if (maxFileCount === null) {\n      return true;\n    }\n\n    // we check if the current count is smaller than the max count, if so, another file can still be added\n    if (count < maxFileCount) {\n      return true;\n    }\n\n    // no more room for another file\n    return false;\n  };\n\n  var limit = function limit(value, min, max) {\n    return Math.max(Math.min(max, value), min);\n  };\n\n  var arrayInsert = function arrayInsert(arr, index, item) {\n    return arr.splice(index, 0, item);\n  };\n\n  var insertItem = function insertItem(items, item, index) {\n    if (isEmpty(item)) {\n      return null;\n    }\n\n    // if index is undefined, append\n    if (typeof index === 'undefined') {\n      items.push(item);\n      return item;\n    }\n\n    // limit the index to the size of the items array\n    index = limit(index, 0, items.length);\n\n    // add item to array\n    arrayInsert(items, index, item);\n\n    // expose\n    return item;\n  };\n\n  var isBase64DataURI = function isBase64DataURI(str) {\n    return /^\\s*data:([a-z]+\\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\\-._~:@\\/?%\\s]*)\\s*$/i.test(\n      str\n    );\n  };\n\n  var getFilenameFromURL = function getFilenameFromURL(url) {\n    return url\n      .split('/')\n      .pop()\n      .split('?')\n      .shift();\n  };\n\n  var getExtensionFromFilename = function getExtensionFromFilename(name) {\n    return name.split('.').pop();\n  };\n\n  var guesstimateExtension = function guesstimateExtension(type) {\n    // if no extension supplied, exit here\n    if (typeof type !== 'string') {\n      return '';\n    }\n\n    // get subtype\n    var subtype = type.split('/').pop();\n\n    // is svg subtype\n    if (/svg/.test(subtype)) {\n      return 'svg';\n    }\n\n    if (/zip|compressed/.test(subtype)) {\n      return 'zip';\n    }\n\n    if (/plain/.test(subtype)) {\n      return 'txt';\n    }\n\n    if (/msword/.test(subtype)) {\n      return 'doc';\n    }\n\n    // if is valid subtype\n    if (/[a-z]+/.test(subtype)) {\n      // always use jpg extension\n      if (subtype === 'jpeg') {\n        return 'jpg';\n      }\n\n      // return subtype\n      return subtype;\n    }\n\n    return '';\n  };\n\n  var leftPad = function leftPad(value) {\n    var padding =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n    return (padding + value).slice(-padding.length);\n  };\n\n  var getDateString = function getDateString() {\n    var date =\n      arguments.length > 0 && arguments[0] !== undefined\n        ? arguments[0]\n        : new Date();\n    return (\n      date.getFullYear() +\n      '-' +\n      leftPad(date.getMonth() + 1, '00') +\n      '-' +\n      leftPad(date.getDate(), '00') +\n      '_' +\n      leftPad(date.getHours(), '00') +\n      '-' +\n      leftPad(date.getMinutes(), '00') +\n      '-' +\n      leftPad(date.getSeconds(), '00')\n    );\n  };\n\n  var getFileFromBlob = function getFileFromBlob(blob, filename) {\n    var type =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    var extension =\n      arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n    var file =\n      typeof type === 'string'\n        ? blob.slice(0, blob.size, type)\n        : blob.slice(0, blob.size, blob.type);\n    file.lastModifiedDate = new Date();\n\n    // copy relative path\n    if (blob._relativePath) file._relativePath = blob._relativePath;\n\n    // if blob has name property, use as filename if no filename supplied\n    if (!isString(filename)) {\n      filename = getDateString();\n    }\n\n    // if filename supplied but no extension and filename has extension\n    if (filename && extension === null && getExtensionFromFilename(filename)) {\n      file.name = filename;\n    } else {\n      extension = extension || guesstimateExtension(file.type);\n      file.name = filename + (extension ? '.' + extension : '');\n    }\n\n    return file;\n  };\n\n  var getBlobBuilder = function getBlobBuilder() {\n    return (window.BlobBuilder =\n      window.BlobBuilder ||\n      window.WebKitBlobBuilder ||\n      window.MozBlobBuilder ||\n      window.MSBlobBuilder);\n  };\n\n  var createBlob = function createBlob(arrayBuffer, mimeType) {\n    var BB = getBlobBuilder();\n\n    if (BB) {\n      var bb = new BB();\n      bb.append(arrayBuffer);\n      return bb.getBlob(mimeType);\n    }\n\n    return new Blob([arrayBuffer], {\n      type: mimeType\n    });\n  };\n\n  var getBlobFromByteStringWithMimeType = function getBlobFromByteStringWithMimeType(\n    byteString,\n    mimeType\n  ) {\n    var ab = new ArrayBuffer(byteString.length);\n    var ia = new Uint8Array(ab);\n\n    for (var i = 0; i < byteString.length; i++) {\n      ia[i] = byteString.charCodeAt(i);\n    }\n\n    return createBlob(ab, mimeType);\n  };\n\n  var getMimeTypeFromBase64DataURI = function getMimeTypeFromBase64DataURI(\n    dataURI\n  ) {\n    return (/^data:(.+);/.exec(dataURI) || [])[1] || null;\n  };\n\n  var getBase64DataFromBase64DataURI = function getBase64DataFromBase64DataURI(\n    dataURI\n  ) {\n    // get data part of string (remove data:image/jpeg...,)\n    var data = dataURI.split(',')[1];\n\n    // remove any whitespace as that causes InvalidCharacterError in IE\n    return data.replace(/\\s/g, '');\n  };\n\n  var getByteStringFromBase64DataURI = function getByteStringFromBase64DataURI(\n    dataURI\n  ) {\n    return atob(getBase64DataFromBase64DataURI(dataURI));\n  };\n\n  var getBlobFromBase64DataURI = function getBlobFromBase64DataURI(dataURI) {\n    var mimeType = getMimeTypeFromBase64DataURI(dataURI);\n    var byteString = getByteStringFromBase64DataURI(dataURI);\n\n    return getBlobFromByteStringWithMimeType(byteString, mimeType);\n  };\n\n  var getFileFromBase64DataURI = function getFileFromBase64DataURI(\n    dataURI,\n    filename,\n    extension\n  ) {\n    return getFileFromBlob(\n      getBlobFromBase64DataURI(dataURI),\n      filename,\n      null,\n      extension\n    );\n  };\n\n  var getFileNameFromHeader = function getFileNameFromHeader(header) {\n    // test if is content disposition header, if not exit\n    if (!/^content-disposition:/i.test(header)) return null;\n\n    // get filename parts\n    var matches = header\n      .split(/filename=|filename\\*=.+''/)\n      .splice(1)\n      .map(function(name) {\n        return name.trim().replace(/^[\"']|[;\"']{0,2}$/g, '');\n      })\n      .filter(function(name) {\n        return name.length;\n      });\n\n    return matches.length ? decodeURI(matches[matches.length - 1]) : null;\n  };\n\n  var getFileSizeFromHeader = function getFileSizeFromHeader(header) {\n    if (/content-length:/i.test(header)) {\n      var size = header.match(/[0-9]+/)[0];\n      return size ? parseInt(size, 10) : null;\n    }\n    return null;\n  };\n\n  var getTranfserIdFromHeader = function getTranfserIdFromHeader(header) {\n    if (/x-content-transfer-id:/i.test(header)) {\n      var id = (header.split(':')[1] || '').trim();\n      return id || null;\n    }\n    return null;\n  };\n\n  var getFileInfoFromHeaders = function getFileInfoFromHeaders(headers) {\n    var info = {\n      source: null,\n      name: null,\n      size: null\n    };\n\n    var rows = headers.split('\\n');\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n    try {\n      for (\n        var _iterator = rows[Symbol.iterator](), _step;\n        !(_iteratorNormalCompletion = (_step = _iterator.next()).done);\n        _iteratorNormalCompletion = true\n      ) {\n        var header = _step.value;\n\n        var name = getFileNameFromHeader(header);\n        if (name) {\n          info.name = name;\n          continue;\n        }\n\n        var size = getFileSizeFromHeader(header);\n        if (size) {\n          info.size = size;\n          continue;\n        }\n\n        var source = getTranfserIdFromHeader(header);\n        if (source) {\n          info.source = source;\n          continue;\n        }\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion && _iterator.return != null) {\n          _iterator.return();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n\n    return info;\n  };\n\n  var createFileLoader = function createFileLoader(fetchFn) {\n    var state = {\n      source: null,\n      complete: false,\n      progress: 0,\n      size: null,\n      timestamp: null,\n      duration: 0,\n      request: null\n    };\n\n    var getProgress = function getProgress() {\n      return state.progress;\n    };\n    var abort = function abort() {\n      if (state.request && state.request.abort) {\n        state.request.abort();\n      }\n    };\n\n    // load source\n    var load = function load() {\n      // get quick reference\n      var source = state.source;\n\n      api.fire('init', source);\n\n      // Load Files\n      if (source instanceof File) {\n        api.fire('load', source);\n      } else if (source instanceof Blob) {\n        // Load blobs, set default name to current date\n        api.fire('load', getFileFromBlob(source, source.name));\n      } else if (isBase64DataURI(source)) {\n        // Load base 64, set default name to current date\n        api.fire('load', getFileFromBase64DataURI(source));\n      } else {\n        // Deal as if is external URL, let's load it!\n        loadURL(source);\n      }\n    };\n\n    // loads a url\n    var loadURL = function loadURL(url) {\n      // is remote url and no fetch method supplied\n      if (!fetchFn) {\n        api.fire('error', {\n          type: 'error',\n          body: \"Can't load URL\",\n          code: 400\n        });\n\n        return;\n      }\n\n      // set request start\n      state.timestamp = Date.now();\n\n      // load file\n      state.request = fetchFn(\n        url,\n        function(response) {\n          // update duration\n          state.duration = Date.now() - state.timestamp;\n\n          // done!\n          state.complete = true;\n\n          // turn blob response into a file\n          if (response instanceof Blob) {\n            response = getFileFromBlob(\n              response,\n              response.name || getFilenameFromURL(url)\n            );\n          }\n\n          api.fire(\n            'load',\n            // if has received blob, we go with blob, if no response, we return null\n            response instanceof Blob\n              ? response\n              : response\n              ? response.body\n              : null\n          );\n        },\n        function(error) {\n          api.fire(\n            'error',\n            typeof error === 'string'\n              ? {\n                  type: 'error',\n                  code: 0,\n                  body: error\n                }\n              : error\n          );\n        },\n        function(computable, current, total) {\n          // collected some meta data already\n          if (total) {\n            state.size = total;\n          }\n\n          // update duration\n          state.duration = Date.now() - state.timestamp;\n\n          // if we can't compute progress, we're not going to fire progress events\n          if (!computable) {\n            state.progress = null;\n            return;\n          }\n\n          // update progress percentage\n          state.progress = current / total;\n\n          // expose\n          api.fire('progress', state.progress);\n        },\n        function() {\n          api.fire('abort');\n        },\n        function(response) {\n          var fileinfo = getFileInfoFromHeaders(\n            typeof response === 'string' ? response : response.headers\n          );\n          api.fire('meta', {\n            size: state.size || fileinfo.size,\n            filename: fileinfo.name,\n            source: fileinfo.source\n          });\n        }\n      );\n    };\n\n    var api = Object.assign({}, on(), {\n      setSource: function setSource(source) {\n        return (state.source = source);\n      },\n      getProgress: getProgress, // file load progress\n      abort: abort, // abort file load\n      load: load // start load\n    });\n\n    return api;\n  };\n\n  var isGet = function isGet(method) {\n    return /GET|HEAD/.test(method);\n  };\n\n  var sendRequest = function sendRequest(data, url, options) {\n    var api = {\n      onheaders: function onheaders() {},\n      onprogress: function onprogress() {},\n      onload: function onload() {},\n      ontimeout: function ontimeout() {},\n      onerror: function onerror() {},\n      onabort: function onabort() {},\n      abort: function abort() {\n        aborted = true;\n        xhr.abort();\n      }\n    };\n\n    // timeout identifier, only used when timeout is defined\n    var aborted = false;\n    var headersReceived = false;\n\n    // set default options\n    options = Object.assign(\n      {\n        method: 'POST',\n        headers: {},\n        withCredentials: false\n      },\n      options\n    );\n\n    // encode url\n    url = encodeURI(url);\n\n    // if method is GET, add any received data to url\n\n    if (isGet(options.method) && data) {\n      url =\n        '' +\n        url +\n        encodeURIComponent(\n          typeof data === 'string' ? data : JSON.stringify(data)\n        );\n    }\n\n    // create request\n    var xhr = new XMLHttpRequest();\n\n    // progress of load\n    var process = isGet(options.method) ? xhr : xhr.upload;\n    process.onprogress = function(e) {\n      // no progress event when aborted ( onprogress is called once after abort() )\n      if (aborted) {\n        return;\n      }\n\n      api.onprogress(e.lengthComputable, e.loaded, e.total);\n    };\n\n    // tries to get header info to the app as fast as possible\n    xhr.onreadystatechange = function() {\n      // not interesting in these states ('unsent' and 'openend' as they don't give us any additional info)\n      if (xhr.readyState < 2) {\n        return;\n      }\n\n      // no server response\n      if (xhr.readyState === 4 && xhr.status === 0) {\n        return;\n      }\n\n      if (headersReceived) {\n        return;\n      }\n\n      headersReceived = true;\n\n      // we've probably received some useful data in response headers\n      api.onheaders(xhr);\n    };\n\n    // load successful\n    xhr.onload = function() {\n      // is classified as valid response\n      if (xhr.status >= 200 && xhr.status < 300) {\n        api.onload(xhr);\n      } else {\n        api.onerror(xhr);\n      }\n    };\n\n    // error during load\n    xhr.onerror = function() {\n      return api.onerror(xhr);\n    };\n\n    // request aborted\n    xhr.onabort = function() {\n      aborted = true;\n      api.onabort();\n    };\n\n    // request timeout\n    xhr.ontimeout = function() {\n      return api.ontimeout(xhr);\n    };\n\n    // open up open up!\n    xhr.open(options.method, url, true);\n\n    // set timeout if defined (do it after open so IE11 plays ball)\n    if (isInt(options.timeout)) {\n      xhr.timeout = options.timeout;\n    }\n\n    // add headers\n    Object.keys(options.headers).forEach(function(key) {\n      var value = unescape(encodeURIComponent(options.headers[key]));\n      xhr.setRequestHeader(key, value);\n    });\n\n    // set type of response\n    if (options.responseType) {\n      xhr.responseType = options.responseType;\n    }\n\n    // set credentials\n    if (options.withCredentials) {\n      xhr.withCredentials = true;\n    }\n\n    // let's send our data\n    xhr.send(data);\n\n    return api;\n  };\n\n  var createResponse = function createResponse(type, code, body, headers) {\n    return {\n      type: type,\n      code: code,\n      body: body,\n      headers: headers\n    };\n  };\n\n  var createTimeoutResponse = function createTimeoutResponse(cb) {\n    return function(xhr) {\n      cb(createResponse('error', 0, 'Timeout', xhr.getAllResponseHeaders()));\n    };\n  };\n\n  var hasQS = function hasQS(str) {\n    return /\\?/.test(str);\n  };\n  var buildURL = function buildURL() {\n    var url = '';\n    for (\n      var _len = arguments.length, parts = new Array(_len), _key = 0;\n      _key < _len;\n      _key++\n    ) {\n      parts[_key] = arguments[_key];\n    }\n    parts.forEach(function(part) {\n      url += hasQS(url) && hasQS(part) ? part.replace(/\\?/, '&') : part;\n    });\n    return url;\n  };\n\n  var createFetchFunction = function createFetchFunction() {\n    var apiUrl =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var action = arguments.length > 1 ? arguments[1] : undefined;\n    // custom handler (should also handle file, load, error, progress and abort)\n    if (typeof action === 'function') {\n      return action;\n    }\n\n    // no action supplied\n    if (!action || !isString(action.url)) {\n      return null;\n    }\n\n    // set onload hanlder\n    var onload =\n      action.onload ||\n      function(res) {\n        return res;\n      };\n    var onerror =\n      action.onerror ||\n      function(res) {\n        return null;\n      };\n\n    // internal handler\n    return function(url, load, error, progress, abort, headers) {\n      // do local or remote request based on if the url is external\n      var request = sendRequest(\n        url,\n        buildURL(apiUrl, action.url),\n        Object.assign({}, action, {\n          responseType: 'blob'\n        })\n      );\n\n      request.onload = function(xhr) {\n        // get headers\n        var headers = xhr.getAllResponseHeaders();\n\n        // get filename\n        var filename =\n          getFileInfoFromHeaders(headers).name || getFilenameFromURL(url);\n\n        // create response\n        load(\n          createResponse(\n            'load',\n            xhr.status,\n            action.method === 'HEAD'\n              ? null\n              : getFileFromBlob(onload(xhr.response), filename),\n            headers\n          )\n        );\n      };\n\n      request.onerror = function(xhr) {\n        error(\n          createResponse(\n            'error',\n            xhr.status,\n            onerror(xhr.response) || xhr.statusText,\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.onheaders = function(xhr) {\n        headers(\n          createResponse(\n            'headers',\n            xhr.status,\n            null,\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n      request.onprogress = progress;\n      request.onabort = abort;\n\n      // should return request\n      return request;\n    };\n  };\n\n  var ChunkStatus = {\n    QUEUED: 0,\n    COMPLETE: 1,\n    PROCESSING: 2,\n    ERROR: 3,\n    WAITING: 4\n  };\n\n  /*\n                                                       function signature:\n                                                         (file, metadata, load, error, progress, abort, transfer, options) => {\n                                                           return {\n                                                           abort:() => {}\n                                                         }\n                                                       }\n                                                       */\n\n  // apiUrl, action, name, file, metadata, load, error, progress, abort, transfer, options\n  var processFileChunked = function processFileChunked(\n    apiUrl,\n    action,\n    name,\n    file,\n    metadata,\n    load,\n    error,\n    progress,\n    abort,\n    transfer,\n    options\n  ) {\n    // all chunks\n    var chunks = [];\n    var chunkTransferId = options.chunkTransferId,\n      chunkServer = options.chunkServer,\n      chunkSize = options.chunkSize,\n      chunkRetryDelays = options.chunkRetryDelays;\n\n    // default state\n    var state = {\n      serverId: chunkTransferId,\n      aborted: false\n    };\n\n    // set onload handlers\n    var ondata =\n      action.ondata ||\n      function(fd) {\n        return fd;\n      };\n    var onload =\n      action.onload ||\n      function(xhr, method) {\n        return method === 'HEAD'\n          ? xhr.getResponseHeader('Upload-Offset')\n          : xhr.response;\n      };\n    var onerror =\n      action.onerror ||\n      function(res) {\n        return null;\n      };\n\n    // create server hook\n    var requestTransferId = function requestTransferId(cb) {\n      var formData = new FormData();\n\n      // add metadata under same name\n      if (isObject(metadata)) formData.append(name, JSON.stringify(metadata));\n\n      var headers =\n        typeof action.headers === 'function'\n          ? action.headers(file, metadata)\n          : Object.assign({}, action.headers, {\n              'Upload-Length': file.size\n            });\n\n      var requestParams = Object.assign({}, action, {\n        headers: headers\n      });\n\n      // send request object\n      var request = sendRequest(\n        ondata(formData),\n        buildURL(apiUrl, action.url),\n        requestParams\n      );\n\n      request.onload = function(xhr) {\n        return cb(onload(xhr, requestParams.method));\n      };\n\n      request.onerror = function(xhr) {\n        return error(\n          createResponse(\n            'error',\n            xhr.status,\n            onerror(xhr.response) || xhr.statusText,\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n    };\n\n    var requestTransferOffset = function requestTransferOffset(cb) {\n      var requestUrl = buildURL(apiUrl, chunkServer.url, state.serverId);\n\n      var headers =\n        typeof action.headers === 'function'\n          ? action.headers(state.serverId)\n          : Object.assign({}, action.headers);\n\n      var requestParams = {\n        headers: headers,\n        method: 'HEAD'\n      };\n\n      var request = sendRequest(null, requestUrl, requestParams);\n\n      request.onload = function(xhr) {\n        return cb(onload(xhr, requestParams.method));\n      };\n\n      request.onerror = function(xhr) {\n        return error(\n          createResponse(\n            'error',\n            xhr.status,\n            onerror(xhr.response) || xhr.statusText,\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n    };\n\n    // create chunks\n    var lastChunkIndex = Math.floor(file.size / chunkSize);\n    for (var i = 0; i <= lastChunkIndex; i++) {\n      var offset = i * chunkSize;\n      var data = file.slice(\n        offset,\n        offset + chunkSize,\n        'application/offset+octet-stream'\n      );\n      chunks[i] = {\n        index: i,\n        size: data.size,\n        offset: offset,\n        data: data,\n        file: file,\n        progress: 0,\n        retries: _toConsumableArray(chunkRetryDelays),\n        status: ChunkStatus.QUEUED,\n        error: null,\n        request: null,\n        timeout: null\n      };\n    }\n\n    var completeProcessingChunks = function completeProcessingChunks() {\n      return load(state.serverId);\n    };\n\n    var canProcessChunk = function canProcessChunk(chunk) {\n      return (\n        chunk.status === ChunkStatus.QUEUED ||\n        chunk.status === ChunkStatus.ERROR\n      );\n    };\n\n    var processChunk = function processChunk(chunk) {\n      // processing is paused, wait here\n      if (state.aborted) return;\n\n      // get next chunk to process\n      chunk = chunk || chunks.find(canProcessChunk);\n\n      // no more chunks to process\n      if (!chunk) {\n        // all done?\n        if (\n          chunks.every(function(chunk) {\n            return chunk.status === ChunkStatus.COMPLETE;\n          })\n        ) {\n          completeProcessingChunks();\n        }\n\n        // no chunk to handle\n        return;\n      }\n\n      // now processing this chunk\n      chunk.status = ChunkStatus.PROCESSING;\n      chunk.progress = null;\n\n      // allow parsing of formdata\n      var ondata =\n        chunkServer.ondata ||\n        function(fd) {\n          return fd;\n        };\n      var onerror =\n        chunkServer.onerror ||\n        function(res) {\n          return null;\n        };\n\n      // send request object\n      var requestUrl = buildURL(apiUrl, chunkServer.url, state.serverId);\n\n      var headers =\n        typeof chunkServer.headers === 'function'\n          ? chunkServer.headers(chunk)\n          : Object.assign({}, chunkServer.headers, {\n              'Content-Type': 'application/offset+octet-stream',\n              'Upload-Offset': chunk.offset,\n              'Upload-Length': file.size,\n              'Upload-Name': file.name\n            });\n\n      var request = (chunk.request = sendRequest(\n        ondata(chunk.data),\n        requestUrl,\n        Object.assign({}, chunkServer, {\n          headers: headers\n        })\n      ));\n\n      request.onload = function() {\n        // done!\n        chunk.status = ChunkStatus.COMPLETE;\n\n        // remove request reference\n        chunk.request = null;\n\n        // start processing more chunks\n        processChunks();\n      };\n\n      request.onprogress = function(lengthComputable, loaded, total) {\n        chunk.progress = lengthComputable ? loaded : null;\n        updateTotalProgress();\n      };\n\n      request.onerror = function(xhr) {\n        chunk.status = ChunkStatus.ERROR;\n        chunk.request = null;\n        chunk.error = onerror(xhr.response) || xhr.statusText;\n        if (!retryProcessChunk(chunk)) {\n          error(\n            createResponse(\n              'error',\n              xhr.status,\n              onerror(xhr.response) || xhr.statusText,\n              xhr.getAllResponseHeaders()\n            )\n          );\n        }\n      };\n\n      request.ontimeout = function(xhr) {\n        chunk.status = ChunkStatus.ERROR;\n        chunk.request = null;\n        if (!retryProcessChunk(chunk)) {\n          createTimeoutResponse(error)(xhr);\n        }\n      };\n\n      request.onabort = function() {\n        chunk.status = ChunkStatus.QUEUED;\n        chunk.request = null;\n        abort();\n      };\n    };\n\n    var retryProcessChunk = function retryProcessChunk(chunk) {\n      // no more retries left\n      if (chunk.retries.length === 0) return false;\n\n      // new retry\n      chunk.status = ChunkStatus.WAITING;\n      clearTimeout(chunk.timeout);\n      chunk.timeout = setTimeout(function() {\n        processChunk(chunk);\n      }, chunk.retries.shift());\n\n      // we're going to retry\n      return true;\n    };\n\n    var updateTotalProgress = function updateTotalProgress() {\n      // calculate total progress fraction\n      var totalBytesTransfered = chunks.reduce(function(p, chunk) {\n        if (p === null || chunk.progress === null) return null;\n        return p + chunk.progress;\n      }, 0);\n\n      // can't compute progress\n      if (totalBytesTransfered === null) return progress(false, 0, 0);\n\n      // calculate progress values\n      var totalSize = chunks.reduce(function(total, chunk) {\n        return total + chunk.size;\n      }, 0);\n\n      // can update progress indicator\n      progress(true, totalBytesTransfered, totalSize);\n    };\n\n    // process new chunks\n    var processChunks = function processChunks() {\n      var totalProcessing = chunks.filter(function(chunk) {\n        return chunk.status === ChunkStatus.PROCESSING;\n      }).length;\n      if (totalProcessing >= 1) return;\n      processChunk();\n    };\n\n    var abortChunks = function abortChunks() {\n      chunks.forEach(function(chunk) {\n        clearTimeout(chunk.timeout);\n        if (chunk.request) {\n          chunk.request.abort();\n        }\n      });\n    };\n\n    // let's go!\n    if (!state.serverId) {\n      requestTransferId(function(serverId) {\n        // stop here if aborted, might have happened in between request and callback\n        if (state.aborted) return;\n\n        // pass back to item so we can use it if something goes wrong\n        transfer(serverId);\n\n        // store internally\n        state.serverId = serverId;\n        processChunks();\n      });\n    } else {\n      requestTransferOffset(function(offset) {\n        // stop here if aborted, might have happened in between request and callback\n        if (state.aborted) return;\n\n        // mark chunks with lower offset as complete\n        chunks\n          .filter(function(chunk) {\n            return chunk.offset < offset;\n          })\n          .forEach(function(chunk) {\n            chunk.status = ChunkStatus.COMPLETE;\n            chunk.progress = chunk.size;\n          });\n\n        // continue processing\n        processChunks();\n      });\n    }\n\n    return {\n      abort: function abort() {\n        state.aborted = true;\n        abortChunks();\n      }\n    };\n  };\n\n  /*\n                                                               function signature:\n                                                                 (file, metadata, load, error, progress, abort) => {\n                                                                   return {\n                                                                   abort:() => {}\n                                                                 }\n                                                               }\n                                                               */\n  var createFileProcessorFunction = function createFileProcessorFunction(\n    apiUrl,\n    action,\n    name,\n    options\n  ) {\n    return function(file, metadata, load, error, progress, abort, transfer) {\n      // no file received\n      if (!file) return;\n\n      // if was passed a file, and we can chunk it, exit here\n      var canChunkUpload = options.chunkUploads;\n      var shouldChunkUpload = canChunkUpload && file.size > options.chunkSize;\n      var willChunkUpload =\n        canChunkUpload && (shouldChunkUpload || options.chunkForce);\n      if (file instanceof Blob && willChunkUpload)\n        return processFileChunked(\n          apiUrl,\n          action,\n          name,\n          file,\n          metadata,\n          load,\n          error,\n          progress,\n          abort,\n          transfer,\n          options\n        );\n\n      // set handlers\n      var ondata =\n        action.ondata ||\n        function(fd) {\n          return fd;\n        };\n      var onload =\n        action.onload ||\n        function(res) {\n          return res;\n        };\n      var onerror =\n        action.onerror ||\n        function(res) {\n          return null;\n        };\n\n      // create formdata object\n      var formData = new FormData();\n\n      // add metadata under same name\n      if (isObject(metadata)) {\n        formData.append(name, JSON.stringify(metadata));\n      }\n\n      // Turn into an array of objects so no matter what the input, we can handle it the same way\n      (file instanceof Blob ? [{ name: null, file: file }] : file).forEach(\n        function(item) {\n          formData.append(\n            name,\n            item.file,\n            item.name === null\n              ? item.file.name\n              : '' + item.name + item.file.name\n          );\n        }\n      );\n\n      // send request object\n      var request = sendRequest(\n        ondata(formData),\n        buildURL(apiUrl, action.url),\n        action\n      );\n      request.onload = function(xhr) {\n        load(\n          createResponse(\n            'load',\n            xhr.status,\n            onload(xhr.response),\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.onerror = function(xhr) {\n        error(\n          createResponse(\n            'error',\n            xhr.status,\n            onerror(xhr.response) || xhr.statusText,\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n      request.onprogress = progress;\n      request.onabort = abort;\n\n      // should return request\n      return request;\n    };\n  };\n\n  var createProcessorFunction = function createProcessorFunction() {\n    var apiUrl =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var action = arguments.length > 1 ? arguments[1] : undefined;\n    var name = arguments.length > 2 ? arguments[2] : undefined;\n    var options = arguments.length > 3 ? arguments[3] : undefined;\n\n    // custom handler (should also handle file, load, error, progress and abort)\n    if (typeof action === 'function')\n      return function() {\n        for (\n          var _len = arguments.length, params = new Array(_len), _key = 0;\n          _key < _len;\n          _key++\n        ) {\n          params[_key] = arguments[_key];\n        }\n        return action.apply(void 0, [name].concat(params, [options]));\n      };\n\n    // no action supplied\n    if (!action || !isString(action.url)) return null;\n\n    // internal handler\n    return createFileProcessorFunction(apiUrl, action, name, options);\n  };\n\n  /*\n                                                      function signature:\n                                                      (uniqueFileId, load, error) => { }\n                                                      */\n  var createRevertFunction = function createRevertFunction() {\n    var apiUrl =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var action = arguments.length > 1 ? arguments[1] : undefined;\n    // is custom implementation\n    if (typeof action === 'function') {\n      return action;\n    }\n\n    // no action supplied, return stub function, interface will work, but file won't be removed\n    if (!action || !isString(action.url)) {\n      return function(uniqueFileId, load) {\n        return load();\n      };\n    }\n\n    // set onload hanlder\n    var onload =\n      action.onload ||\n      function(res) {\n        return res;\n      };\n    var onerror =\n      action.onerror ||\n      function(res) {\n        return null;\n      };\n\n    // internal implementation\n    return function(uniqueFileId, load, error) {\n      var request = sendRequest(\n        uniqueFileId,\n        apiUrl + action.url,\n        action // contains method, headers and withCredentials properties\n      );\n      request.onload = function(xhr) {\n        load(\n          createResponse(\n            'load',\n            xhr.status,\n            onload(xhr.response),\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.onerror = function(xhr) {\n        error(\n          createResponse(\n            'error',\n            xhr.status,\n            onerror(xhr.response) || xhr.statusText,\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n\n      return request;\n    };\n  };\n\n  var getRandomNumber = function getRandomNumber() {\n    var min =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    var max =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return min + Math.random() * (max - min);\n  };\n\n  var createPerceivedPerformanceUpdater = function createPerceivedPerformanceUpdater(\n    cb\n  ) {\n    var duration =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1000;\n    var offset =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var tickMin =\n      arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 25;\n    var tickMax =\n      arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 250;\n    var timeout = null;\n    var start = Date.now();\n\n    var tick = function tick() {\n      var runtime = Date.now() - start;\n      var delay = getRandomNumber(tickMin, tickMax);\n\n      if (runtime + delay > duration) {\n        delay = runtime + delay - duration;\n      }\n\n      var progress = runtime / duration;\n      if (progress >= 1 || document.hidden) {\n        cb(1);\n        return;\n      }\n\n      cb(progress);\n\n      timeout = setTimeout(tick, delay);\n    };\n\n    tick();\n\n    return {\n      clear: function clear() {\n        clearTimeout(timeout);\n      }\n    };\n  };\n\n  var createFileProcessor = function createFileProcessor(processFn) {\n    var state = {\n      complete: false,\n      perceivedProgress: 0,\n      perceivedPerformanceUpdater: null,\n      progress: null,\n      timestamp: null,\n      perceivedDuration: 0,\n      duration: 0,\n      request: null,\n      response: null\n    };\n\n    var process = function process(file, metadata) {\n      var progressFn = function progressFn() {\n        // we've not yet started the real download, stop here\n        // the request might not go through, for instance, there might be some server trouble\n        // if state.progress is null, the server does not allow computing progress and we show the spinner instead\n        if (state.duration === 0 || state.progress === null) return;\n\n        // as we're now processing, fire the progress event\n        api.fire('progress', api.getProgress());\n      };\n\n      var completeFn = function completeFn() {\n        state.complete = true;\n        api.fire('load-perceived', state.response.body);\n      };\n\n      // let's start processing\n      api.fire('start');\n\n      // set request start\n      state.timestamp = Date.now();\n\n      // create perceived performance progress indicator\n      state.perceivedPerformanceUpdater = createPerceivedPerformanceUpdater(\n        function(progress) {\n          state.perceivedProgress = progress;\n          state.perceivedDuration = Date.now() - state.timestamp;\n\n          progressFn();\n\n          // if fake progress is done, and a response has been received,\n          // and we've not yet called the complete method\n          if (\n            state.response &&\n            state.perceivedProgress === 1 &&\n            !state.complete\n          ) {\n            // we done!\n            completeFn();\n          }\n        },\n        // random delay as in a list of files you start noticing\n        // files uploading at the exact same speed\n        getRandomNumber(750, 1500)\n      );\n\n      // remember request so we can abort it later\n      state.request = processFn(\n        // the file to process\n        file,\n\n        // the metadata to send along\n        metadata,\n\n        // callbacks (load, error, progress, abort, transfer)\n        // load expects the body to be a server id if\n        // you want to make use of revert\n        function(response) {\n          // we put the response in state so we can access\n          // it outside of this method\n          state.response = isObject(response)\n            ? response\n            : {\n                type: 'load',\n                code: 200,\n                body: '' + response,\n                headers: {}\n              };\n\n          // update duration\n          state.duration = Date.now() - state.timestamp;\n\n          // force progress to 1 as we're now done\n          state.progress = 1;\n\n          // actual load is done let's share results\n          api.fire('load', state.response.body);\n\n          // we are really done\n          // if perceived progress is 1 ( wait for perceived progress to complete )\n          // or if server does not support progress ( null )\n          if (state.perceivedProgress === 1) {\n            completeFn();\n          }\n        },\n\n        // error is expected to be an object with type, code, body\n        function(error) {\n          // cancel updater\n          state.perceivedPerformanceUpdater.clear();\n\n          // update others about this error\n          api.fire(\n            'error',\n            isObject(error)\n              ? error\n              : {\n                  type: 'error',\n                  code: 0,\n                  body: '' + error\n                }\n          );\n        },\n\n        // actual processing progress\n        function(computable, current, total) {\n          // update actual duration\n          state.duration = Date.now() - state.timestamp;\n\n          // update actual progress\n          state.progress = computable ? current / total : null;\n\n          progressFn();\n        },\n\n        // abort does not expect a value\n        function() {\n          // stop updater\n          state.perceivedPerformanceUpdater.clear();\n\n          // fire the abort event so we can switch visuals\n          api.fire('abort', state.response ? state.response.body : null);\n        },\n\n        // register the id for this transfer\n        function(transferId) {\n          api.fire('transfer', transferId);\n        }\n      );\n    };\n\n    var abort = function abort() {\n      // no request running, can't abort\n      if (!state.request) return;\n\n      // stop updater\n      state.perceivedPerformanceUpdater.clear();\n\n      // abort actual request\n      if (state.request.abort) state.request.abort();\n\n      // if has response object, we've completed the request\n      state.complete = true;\n    };\n\n    var reset = function reset() {\n      abort();\n      state.complete = false;\n      state.perceivedProgress = 0;\n      state.progress = 0;\n      state.timestamp = null;\n      state.perceivedDuration = 0;\n      state.duration = 0;\n      state.request = null;\n      state.response = null;\n    };\n\n    var getProgress = function getProgress() {\n      return state.progress\n        ? Math.min(state.progress, state.perceivedProgress)\n        : null;\n    };\n    var getDuration = function getDuration() {\n      return Math.min(state.duration, state.perceivedDuration);\n    };\n\n    var api = Object.assign({}, on(), {\n      process: process, // start processing file\n      abort: abort, // abort active process request\n      getProgress: getProgress,\n      getDuration: getDuration,\n      reset: reset\n    });\n\n    return api;\n  };\n\n  var getFilenameWithoutExtension = function getFilenameWithoutExtension(name) {\n    return name.substr(0, name.lastIndexOf('.')) || name;\n  };\n\n  var createFileStub = function createFileStub(source) {\n    var data = [source.name, source.size, source.type];\n\n    // is blob or base64, then we need to set the name\n    if (source instanceof Blob || isBase64DataURI(source)) {\n      data[0] = source.name || getDateString();\n    } else if (isBase64DataURI(source)) {\n      // if is base64 data uri we need to determine the average size and type\n      data[1] = source.length;\n      data[2] = getMimeTypeFromBase64DataURI(source);\n    } else if (isString(source)) {\n      // url\n      data[0] = getFilenameFromURL(source);\n      data[1] = 0;\n      data[2] = 'application/octet-stream';\n    }\n\n    return {\n      name: data[0],\n      size: data[1],\n      type: data[2]\n    };\n  };\n\n  var isFile = function isFile(value) {\n    return !!(value instanceof File || (value instanceof Blob && value.name));\n  };\n\n  var deepCloneObject = function deepCloneObject(src) {\n    if (!isObject(src)) return src;\n    var target = isArray(src) ? [] : {};\n    for (var key in src) {\n      if (!src.hasOwnProperty(key)) continue;\n      var v = src[key];\n      target[key] = v && isObject(v) ? deepCloneObject(v) : v;\n    }\n    return target;\n  };\n\n  var createItem = function createItem() {\n    var origin =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    var serverFileReference =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    var file =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    // unique id for this item, is used to identify the item across views\n    var id = getUniqueId();\n\n    /**\n     * Internal item state\n     */\n    var state = {\n      // is archived\n      archived: false,\n\n      // if is frozen, no longer fires events\n      frozen: false,\n\n      // removed from view\n      released: false,\n\n      // original source\n      source: null,\n\n      // file model reference\n      file: file,\n\n      // id of file on server\n      serverFileReference: serverFileReference,\n\n      // id of file transfer on server\n      transferId: null,\n\n      // is aborted\n      processingAborted: false,\n\n      // current item status\n      status: serverFileReference\n        ? ItemStatus.PROCESSING_COMPLETE\n        : ItemStatus.INIT,\n\n      // active processes\n      activeLoader: null,\n      activeProcessor: null\n    };\n\n    // callback used when abort processing is called to link back to the resolve method\n    var abortProcessingRequestComplete = null;\n\n    /**\n     * Externally added item metadata\n     */\n    var metadata = {};\n\n    // item data\n    var setStatus = function setStatus(status) {\n      return (state.status = status);\n    };\n\n    // fire event unless the item has been archived\n    var fire = function fire(event) {\n      if (state.released || state.frozen) return;\n      for (\n        var _len = arguments.length,\n          params = new Array(_len > 1 ? _len - 1 : 0),\n          _key = 1;\n        _key < _len;\n        _key++\n      ) {\n        params[_key - 1] = arguments[_key];\n      }\n      api.fire.apply(api, [event].concat(params));\n    };\n\n    // file data\n    var getFileExtension = function getFileExtension() {\n      return getExtensionFromFilename(state.file.name);\n    };\n    var getFileType = function getFileType() {\n      return state.file.type;\n    };\n    var getFileSize = function getFileSize() {\n      return state.file.size;\n    };\n    var getFile = function getFile() {\n      return state.file;\n    };\n\n    //\n    // logic to load a file\n    //\n    var load = function load(source, loader, onload) {\n      // remember the original item source\n      state.source = source;\n\n      // source is known\n      api.fireSync('init');\n\n      // file stub is already there\n      if (state.file) {\n        api.fireSync('load-skip');\n        return;\n      }\n\n      // set a stub file object while loading the actual data\n      state.file = createFileStub(source);\n\n      // starts loading\n      loader.on('init', function() {\n        fire('load-init');\n      });\n\n      // we'eve received a size indication, let's update the stub\n      loader.on('meta', function(meta) {\n        // set size of file stub\n        state.file.size = meta.size;\n\n        // set name of file stub\n        state.file.filename = meta.filename;\n\n        // if has received source, we done\n        if (meta.source) {\n          origin = FileOrigin.LIMBO;\n          state.serverFileReference = meta.source;\n          state.status = ItemStatus.PROCESSING_COMPLETE;\n        }\n\n        // size has been updated\n        fire('load-meta');\n      });\n\n      // the file is now loading we need to update the progress indicators\n      loader.on('progress', function(progress) {\n        setStatus(ItemStatus.LOADING);\n\n        fire('load-progress', progress);\n      });\n\n      // an error was thrown while loading the file, we need to switch to error state\n      loader.on('error', function(error) {\n        setStatus(ItemStatus.LOAD_ERROR);\n\n        fire('load-request-error', error);\n      });\n\n      // user or another process aborted the file load (cannot retry)\n      loader.on('abort', function() {\n        setStatus(ItemStatus.INIT);\n        fire('load-abort');\n      });\n\n      // done loading\n      loader.on('load', function(file) {\n        // as we've now loaded the file the loader is no longer required\n        state.activeLoader = null;\n\n        // called when file has loaded succesfully\n        var success = function success(result) {\n          // set (possibly) transformed file\n          state.file = isFile(result) ? result : state.file;\n\n          // file received\n          if (origin === FileOrigin.LIMBO && state.serverFileReference) {\n            setStatus(ItemStatus.PROCESSING_COMPLETE);\n          } else {\n            setStatus(ItemStatus.IDLE);\n          }\n\n          fire('load');\n        };\n\n        var error = function error(result) {\n          // set original file\n          state.file = file;\n          fire('load-meta');\n\n          setStatus(ItemStatus.LOAD_ERROR);\n          fire('load-file-error', result);\n        };\n\n        // if we already have a server file reference, we don't need to call the onload method\n        if (state.serverFileReference) {\n          success(file);\n          return;\n        }\n\n        // no server id, let's give this file the full treatment\n        onload(file, success, error);\n      });\n\n      // set loader source data\n      loader.setSource(source);\n\n      // set as active loader\n      state.activeLoader = loader;\n\n      // load the source data\n      loader.load();\n    };\n\n    var retryLoad = function retryLoad() {\n      if (!state.activeLoader) {\n        return;\n      }\n      state.activeLoader.load();\n    };\n\n    var abortLoad = function abortLoad() {\n      if (state.activeLoader) {\n        state.activeLoader.abort();\n        return;\n      }\n      setStatus(ItemStatus.INIT);\n      fire('load-abort');\n    };\n\n    //\n    // logic to process a file\n    //\n    var process = function process(processor, onprocess) {\n      // processing was aborted\n      if (state.processingAborted) {\n        state.processingAborted = false;\n        return;\n      }\n\n      // now processing\n      setStatus(ItemStatus.PROCESSING);\n\n      // reset abort callback\n      abortProcessingRequestComplete = null;\n\n      // if no file loaded we'll wait for the load event\n      if (!(state.file instanceof Blob)) {\n        api.on('load', function() {\n          process(processor, onprocess);\n        });\n        return;\n      }\n\n      // setup processor\n      processor.on('load', function(serverFileReference) {\n        // need this id to be able to revert the upload\n        state.transferId = null;\n        state.serverFileReference = serverFileReference;\n      });\n\n      // register transfer id\n      processor.on('transfer', function(transferId) {\n        // need this id to be able to revert the upload\n        state.transferId = transferId;\n      });\n\n      processor.on('load-perceived', function(serverFileReference) {\n        // no longer required\n        state.activeProcessor = null;\n\n        // need this id to be able to rever the upload\n        state.transferId = null;\n        state.serverFileReference = serverFileReference;\n\n        setStatus(ItemStatus.PROCESSING_COMPLETE);\n        fire('process-complete', serverFileReference);\n      });\n\n      processor.on('start', function() {\n        fire('process-start');\n      });\n\n      processor.on('error', function(error) {\n        state.activeProcessor = null;\n        setStatus(ItemStatus.PROCESSING_ERROR);\n        fire('process-error', error);\n      });\n\n      processor.on('abort', function(serverFileReference) {\n        state.activeProcessor = null;\n\n        // if file was uploaded but processing was cancelled during perceived processor time store file reference\n        state.transferId = null;\n        state.serverFileReference = serverFileReference;\n\n        setStatus(ItemStatus.IDLE);\n        fire('process-abort');\n\n        // has timeout so doesn't interfere with remove action\n        if (abortProcessingRequestComplete) {\n          abortProcessingRequestComplete();\n        }\n      });\n\n      processor.on('progress', function(progress) {\n        fire('process-progress', progress);\n      });\n\n      // when successfully transformed\n      var success = function success(file) {\n        // if was archived in the mean time, don't process\n        if (state.archived) return;\n\n        // process file!\n        processor.process(file, Object.assign({}, metadata));\n      };\n\n      // something went wrong during transform phase\n      var error = console.error;\n\n      // start processing the file\n      onprocess(state.file, success, error);\n\n      // set as active processor\n      state.activeProcessor = processor;\n    };\n\n    var requestProcessing = function requestProcessing() {\n      state.processingAborted = false;\n      setStatus(ItemStatus.PROCESSING_QUEUED);\n    };\n\n    var abortProcessing = function abortProcessing() {\n      return new Promise(function(resolve) {\n        if (!state.activeProcessor) {\n          state.processingAborted = true;\n\n          setStatus(ItemStatus.IDLE);\n          fire('process-abort');\n\n          resolve();\n          return;\n        }\n\n        abortProcessingRequestComplete = function abortProcessingRequestComplete() {\n          resolve();\n        };\n\n        state.activeProcessor.abort();\n      });\n    };\n\n    //\n    // logic to revert a processed file\n    //\n    var revert = function revert(revertFileUpload, forceRevert) {\n      return new Promise(function(resolve, reject) {\n        // cannot revert without a server id for this process\n        if (state.serverFileReference === null) {\n          resolve();\n          return;\n        }\n\n        // revert the upload (fire and forget)\n        revertFileUpload(\n          state.serverFileReference,\n          function() {\n            // reset file server id as now it's no available on the server\n            state.serverFileReference = null;\n            resolve();\n          },\n          function(error) {\n            // don't set error state when reverting is optional, it will always resolve\n            if (!forceRevert) {\n              resolve();\n              return;\n            }\n\n            // oh no errors\n            setStatus(ItemStatus.PROCESSING_REVERT_ERROR);\n            fire('process-revert-error');\n            reject(error);\n          }\n        );\n\n        // fire event\n        setStatus(ItemStatus.IDLE);\n        fire('process-revert');\n      });\n    };\n\n    // exposed methods\n    var _setMetadata = function setMetadata(key, value, silent) {\n      var keys = key.split('.');\n      var root = keys[0];\n      var last = keys.pop();\n      var data = metadata;\n      keys.forEach(function(key) {\n        return (data = data[key]);\n      });\n\n      // compare old value against new value, if they're the same, we're not updating\n      if (JSON.stringify(data[last]) === JSON.stringify(value)) return;\n\n      // update value\n      data[last] = value;\n\n      // don't fire update\n      if (silent) return;\n\n      // fire update\n      fire('metadata-update', {\n        key: root,\n        value: metadata[root]\n      });\n    };\n\n    var getMetadata = function getMetadata(key) {\n      return deepCloneObject(key ? metadata[key] : metadata);\n    };\n\n    var api = Object.assign(\n      {\n        id: {\n          get: function get() {\n            return id;\n          }\n        },\n        origin: {\n          get: function get() {\n            return origin;\n          }\n        },\n        serverId: {\n          get: function get() {\n            return state.serverFileReference;\n          }\n        },\n        transferId: {\n          get: function get() {\n            return state.transferId;\n          }\n        },\n        status: {\n          get: function get() {\n            return state.status;\n          }\n        },\n        filename: {\n          get: function get() {\n            return state.file.name;\n          }\n        },\n        filenameWithoutExtension: {\n          get: function get() {\n            return getFilenameWithoutExtension(state.file.name);\n          }\n        },\n        fileExtension: { get: getFileExtension },\n        fileType: { get: getFileType },\n        fileSize: { get: getFileSize },\n        file: { get: getFile },\n        relativePath: {\n          get: function get() {\n            return state.file._relativePath;\n          }\n        },\n\n        source: {\n          get: function get() {\n            return state.source;\n          }\n        },\n\n        getMetadata: getMetadata,\n        setMetadata: function setMetadata(key, value, silent) {\n          if (isObject(key)) {\n            var data = key;\n            Object.keys(data).forEach(function(key) {\n              _setMetadata(key, data[key], value);\n            });\n            return key;\n          }\n          _setMetadata(key, value, silent);\n          return value;\n        },\n\n        extend: function extend(name, handler) {\n          return (itemAPI[name] = handler);\n        },\n\n        abortLoad: abortLoad,\n        retryLoad: retryLoad,\n        requestProcessing: requestProcessing,\n        abortProcessing: abortProcessing,\n\n        load: load,\n        process: process,\n        revert: revert\n      },\n\n      on(),\n      {\n        freeze: function freeze() {\n          return (state.frozen = true);\n        },\n\n        release: function release() {\n          return (state.released = true);\n        },\n        released: {\n          get: function get() {\n            return state.released;\n          }\n        },\n\n        archive: function archive() {\n          return (state.archived = true);\n        },\n        archived: {\n          get: function get() {\n            return state.archived;\n          }\n        }\n      }\n    );\n\n    // create it here instead of returning it instantly so we can extend it later\n    var itemAPI = createObject(api);\n\n    return itemAPI;\n  };\n\n  var getItemIndexByQuery = function getItemIndexByQuery(items, query) {\n    // just return first index\n    if (isEmpty(query)) {\n      return 0;\n    }\n\n    // invalid queries\n    if (!isString(query)) {\n      return -1;\n    }\n\n    // return item by id (or -1 if not found)\n    return items.findIndex(function(item) {\n      return item.id === query;\n    });\n  };\n\n  var getItemById = function getItemById(items, itemId) {\n    var index = getItemIndexByQuery(items, itemId);\n    if (index < 0) {\n      return;\n    }\n    return items[index] || null;\n  };\n\n  var fetchBlob = function fetchBlob(\n    url,\n    load,\n    error,\n    progress,\n    abort,\n    headers\n  ) {\n    var request = sendRequest(null, url, {\n      method: 'GET',\n      responseType: 'blob'\n    });\n\n    request.onload = function(xhr) {\n      // get headers\n      var headers = xhr.getAllResponseHeaders();\n\n      // get filename\n      var filename =\n        getFileInfoFromHeaders(headers).name || getFilenameFromURL(url);\n\n      // create response\n      load(\n        createResponse(\n          'load',\n          xhr.status,\n          getFileFromBlob(xhr.response, filename),\n          headers\n        )\n      );\n    };\n\n    request.onerror = function(xhr) {\n      error(\n        createResponse(\n          'error',\n          xhr.status,\n          xhr.statusText,\n          xhr.getAllResponseHeaders()\n        )\n      );\n    };\n\n    request.onheaders = function(xhr) {\n      headers(\n        createResponse('headers', xhr.status, null, xhr.getAllResponseHeaders())\n      );\n    };\n\n    request.ontimeout = createTimeoutResponse(error);\n    request.onprogress = progress;\n    request.onabort = abort;\n\n    // should return request\n    return request;\n  };\n\n  var getDomainFromURL = function getDomainFromURL(url) {\n    if (url.indexOf('//') === 0) {\n      url = location.protocol + url;\n    }\n    return url\n      .toLowerCase()\n      .replace('blob:', '')\n      .replace(/([a-z])?:\\/\\//, '$1')\n      .split('/')[0];\n  };\n\n  var isExternalURL = function isExternalURL(url) {\n    return (\n      (url.indexOf(':') > -1 || url.indexOf('//') > -1) &&\n      getDomainFromURL(location.href) !== getDomainFromURL(url)\n    );\n  };\n\n  var dynamicLabel = function dynamicLabel(label) {\n    return function() {\n      return isFunction(label) ? label.apply(void 0, arguments) : label;\n    };\n  };\n\n  var isMockItem = function isMockItem(item) {\n    return !isFile(item.file);\n  };\n\n  var listUpdated = function listUpdated(dispatch, state) {\n    clearTimeout(state.listUpdateTimeout);\n    state.listUpdateTimeout = setTimeout(function() {\n      dispatch('DID_UPDATE_ITEMS', { items: getActiveItems(state.items) });\n    }, 0);\n  };\n\n  var optionalPromise = function optionalPromise(fn) {\n    for (\n      var _len = arguments.length,\n        params = new Array(_len > 1 ? _len - 1 : 0),\n        _key = 1;\n      _key < _len;\n      _key++\n    ) {\n      params[_key - 1] = arguments[_key];\n    }\n    return new Promise(function(resolve) {\n      if (!fn) {\n        return resolve(true);\n      }\n\n      var result = fn.apply(void 0, params);\n\n      if (result == null) {\n        return resolve(true);\n      }\n\n      if (typeof result === 'boolean') {\n        return resolve(result);\n      }\n\n      if (typeof result.then === 'function') {\n        result.then(resolve);\n      }\n    });\n  };\n\n  var sortItems = function sortItems(state, compare) {\n    state.items.sort(function(a, b) {\n      return compare(createItemAPI(a), createItemAPI(b));\n    });\n  };\n\n  // returns item based on state\n  var getItemByQueryFromState = function getItemByQueryFromState(\n    state,\n    itemHandler\n  ) {\n    return function() {\n      var _ref =\n        arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var query = _ref.query,\n        _ref$success = _ref.success,\n        success = _ref$success === void 0 ? function() {} : _ref$success,\n        _ref$failure = _ref.failure,\n        failure = _ref$failure === void 0 ? function() {} : _ref$failure,\n        options = _objectWithoutProperties(_ref, [\n          'query',\n          'success',\n          'failure'\n        ]);\n      var item = getItemByQuery(state.items, query);\n      if (!item) {\n        failure({\n          error: createResponse('error', 0, 'Item not found'),\n\n          file: null\n        });\n\n        return;\n      }\n      itemHandler(item, success, failure, options || {});\n    };\n  };\n\n  var actions = function actions(dispatch, query, state) {\n    return {\n      /**\n       * Aborts all ongoing processes\n       */\n      ABORT_ALL: function ABORT_ALL() {\n        getActiveItems(state.items).forEach(function(item) {\n          item.freeze();\n          item.abortLoad();\n          item.abortProcessing();\n        });\n      },\n\n      /**\n       * Sets initial files\n       */\n      DID_SET_FILES: function DID_SET_FILES(_ref2) {\n        var _ref2$value = _ref2.value,\n          value = _ref2$value === void 0 ? [] : _ref2$value;\n\n        // map values to file objects\n        var files = value.map(function(file) {\n          return {\n            source: file.source ? file.source : file,\n            options: file.options\n          };\n        });\n\n        // loop over files, if file is in list, leave it be, if not, remove\n        // test if items should be moved\n        var activeItems = getActiveItems(state.items);\n\n        activeItems.forEach(function(item) {\n          // if item not is in new value, remove\n          if (\n            !files.find(function(file) {\n              return file.source === item.source || file.source === item.file;\n            })\n          ) {\n            dispatch('REMOVE_ITEM', { query: item, remove: false });\n          }\n        });\n\n        // add new files\n        activeItems = getActiveItems(state.items);\n        files.forEach(function(file, index) {\n          // if file is already in list\n          if (\n            activeItems.find(function(item) {\n              return item.source === file.source || item.file === file.source;\n            })\n          )\n            return;\n\n          // not in list, add\n          dispatch(\n            'ADD_ITEM',\n            Object.assign({}, file, {\n              interactionMethod: InteractionMethod.NONE,\n              index: index\n            })\n          );\n        });\n      },\n\n      DID_UPDATE_ITEM_METADATA: function DID_UPDATE_ITEM_METADATA(_ref3) {\n        var id = _ref3.id;\n\n        // if is called multiple times in close succession we combined all calls together to save resources\n        clearTimeout(state.itemUpdateTimeout);\n        state.itemUpdateTimeout = setTimeout(function() {\n          var item = getItemById(state.items, id);\n\n          // only revert and attempt to upload when we're uploading to a server\n          if (!query('IS_ASYNC')) {\n            // should we update the output data\n            applyFilterChain('SHOULD_PREPARE_OUTPUT', false, {\n              item: item,\n              query: query\n            }).then(function(shouldPrepareOutput) {\n              if (!shouldPrepareOutput) {\n                return;\n              }\n              dispatch(\n                'REQUEST_PREPARE_OUTPUT',\n                {\n                  query: id,\n                  item: item,\n                  success: function success(file) {\n                    dispatch('DID_PREPARE_OUTPUT', { id: id, file: file });\n                  }\n                },\n                true\n              );\n            });\n\n            return;\n          }\n\n          // for async scenarios\n          var upload = function upload() {\n            // we push this forward a bit so the interface is updated correctly\n            setTimeout(function() {\n              dispatch('REQUEST_ITEM_PROCESSING', { query: id });\n            }, 32);\n          };\n\n          var revert = function revert(doUpload) {\n            item\n              .revert(\n                createRevertFunction(\n                  state.options.server.url,\n                  state.options.server.revert\n                ),\n                query('GET_FORCE_REVERT')\n              )\n              .then(doUpload ? upload : function() {})\n              .catch(function() {});\n          };\n\n          var abort = function abort(doUpload) {\n            item.abortProcessing().then(doUpload ? upload : function() {});\n          };\n\n          // if we should re-upload the file immidiately\n          if (item.status === ItemStatus.PROCESSING_COMPLETE) {\n            return revert(state.options.instantUpload);\n          }\n\n          // if currently uploading, cancel upload\n          if (item.status === ItemStatus.PROCESSING) {\n            return abort(state.options.instantUpload);\n          }\n\n          if (state.options.instantUpload) {\n            upload();\n          }\n        }, 0);\n      },\n\n      MOVE_ITEM: function MOVE_ITEM(_ref4) {\n        var query = _ref4.query,\n          index = _ref4.index;\n        var item = getItemByQuery(state.items, query);\n        if (!item) return;\n        var currentIndex = state.items.indexOf(item);\n        index = limit(index, 0, state.items.length - 1);\n        if (currentIndex === index) return;\n        state.items.splice(index, 0, state.items.splice(currentIndex, 1)[0]);\n      },\n\n      SORT: function SORT(_ref5) {\n        var compare = _ref5.compare;\n        sortItems(state, compare);\n        dispatch('DID_SORT_ITEMS', {\n          items: query('GET_ACTIVE_ITEMS')\n        });\n      },\n\n      ADD_ITEMS: function ADD_ITEMS(_ref6) {\n        var items = _ref6.items,\n          index = _ref6.index,\n          interactionMethod = _ref6.interactionMethod,\n          _ref6$success = _ref6.success,\n          success = _ref6$success === void 0 ? function() {} : _ref6$success,\n          _ref6$failure = _ref6.failure,\n          failure = _ref6$failure === void 0 ? function() {} : _ref6$failure;\n\n        var currentIndex = index;\n\n        if (index === -1 || typeof index === 'undefined') {\n          var insertLocation = query('GET_ITEM_INSERT_LOCATION');\n          var totalItems = query('GET_TOTAL_ITEMS');\n          currentIndex = insertLocation === 'before' ? 0 : totalItems;\n        }\n\n        var ignoredFiles = query('GET_IGNORED_FILES');\n        var isValidFile = function isValidFile(source) {\n          return isFile(source)\n            ? !ignoredFiles.includes(source.name.toLowerCase())\n            : !isEmpty(source);\n        };\n        var validItems = items.filter(isValidFile);\n\n        var promises = validItems.map(function(source) {\n          return new Promise(function(resolve, reject) {\n            dispatch('ADD_ITEM', {\n              interactionMethod: interactionMethod,\n              source: source.source || source,\n              success: resolve,\n              failure: reject,\n              index: currentIndex++,\n              options: source.options || {}\n            });\n          });\n        });\n\n        Promise.all(promises)\n          .then(success)\n          .catch(failure);\n      },\n\n      /**\n       * @param source\n       * @param index\n       * @param interactionMethod\n       */\n      ADD_ITEM: function ADD_ITEM(_ref7) {\n        var source = _ref7.source,\n          _ref7$index = _ref7.index,\n          index = _ref7$index === void 0 ? -1 : _ref7$index,\n          interactionMethod = _ref7.interactionMethod,\n          _ref7$success = _ref7.success,\n          success = _ref7$success === void 0 ? function() {} : _ref7$success,\n          _ref7$failure = _ref7.failure,\n          failure = _ref7$failure === void 0 ? function() {} : _ref7$failure,\n          _ref7$options = _ref7.options,\n          options = _ref7$options === void 0 ? {} : _ref7$options;\n\n        // if no source supplied\n        if (isEmpty(source)) {\n          failure({\n            error: createResponse('error', 0, 'No source'),\n\n            file: null\n          });\n\n          return;\n        }\n\n        // filter out invalid file items, used to filter dropped directory contents\n        if (\n          isFile(source) &&\n          state.options.ignoredFiles.includes(source.name.toLowerCase())\n        ) {\n          // fail silently\n          return;\n        }\n\n        // test if there's still room in the list of files\n        if (!hasRoomForItem(state)) {\n          // if multiple allowed, we can't replace\n          // or if only a single item is allowed but we're not allowed to replace it we exit\n          if (\n            state.options.allowMultiple ||\n            (!state.options.allowMultiple && !state.options.allowReplace)\n          ) {\n            var error = createResponse('warning', 0, 'Max files');\n\n            dispatch('DID_THROW_MAX_FILES', {\n              source: source,\n              error: error\n            });\n\n            failure({ error: error, file: null });\n\n            return;\n          }\n\n          // let's replace the item\n          // id of first item we're about to remove\n          var _item = getActiveItems(state.items)[0];\n\n          // if has been processed remove it from the server as well\n          if (\n            _item.status === ItemStatus.PROCESSING_COMPLETE ||\n            _item.status === ItemStatus.PROCESSING_REVERT_ERROR\n          ) {\n            var forceRevert = query('GET_FORCE_REVERT');\n            _item\n              .revert(\n                createRevertFunction(\n                  state.options.server.url,\n                  state.options.server.revert\n                ),\n                forceRevert\n              )\n              .then(function() {\n                if (!forceRevert) return;\n\n                // try to add now\n                dispatch('ADD_ITEM', {\n                  source: source,\n                  index: index,\n                  interactionMethod: interactionMethod,\n                  success: success,\n                  failure: failure,\n                  options: options\n                });\n              })\n              .catch(function() {}); // no need to handle this catch state for now\n\n            if (forceRevert) return;\n          }\n\n          // remove first item as it will be replaced by this item\n          dispatch('REMOVE_ITEM', { query: _item.id });\n        }\n\n        // where did the file originate\n        var origin =\n          options.type === 'local'\n            ? FileOrigin.LOCAL\n            : options.type === 'limbo'\n            ? FileOrigin.LIMBO\n            : FileOrigin.INPUT;\n\n        // create a new blank item\n        var item = createItem(\n          // where did this file come from\n          origin,\n\n          // an input file never has a server file reference\n          origin === FileOrigin.INPUT ? null : source,\n\n          // file mock data, if defined\n          options.file\n        );\n\n        // set initial meta data\n        Object.keys(options.metadata || {}).forEach(function(key) {\n          item.setMetadata(key, options.metadata[key]);\n        });\n\n        // created the item, let plugins add methods\n        applyFilters('DID_CREATE_ITEM', item, {\n          query: query,\n          dispatch: dispatch\n        });\n\n        // where to insert new items\n        var itemInsertLocation = query('GET_ITEM_INSERT_LOCATION');\n\n        // adjust index if is not allowed to pick location\n        if (!state.options.itemInsertLocationFreedom) {\n          index = itemInsertLocation === 'before' ? -1 : state.items.length;\n        }\n\n        // add item to list\n        insertItem(state.items, item, index);\n\n        // sort items in list\n        if (isFunction(itemInsertLocation) && source) {\n          sortItems(state, itemInsertLocation);\n        }\n\n        // get a quick reference to the item id\n        var id = item.id;\n\n        // observe item events\n        item.on('init', function() {\n          dispatch('DID_INIT_ITEM', { id: id });\n        });\n\n        item.on('load-init', function() {\n          dispatch('DID_START_ITEM_LOAD', { id: id });\n        });\n\n        item.on('load-meta', function() {\n          dispatch('DID_UPDATE_ITEM_META', { id: id });\n        });\n\n        item.on('load-progress', function(progress) {\n          dispatch('DID_UPDATE_ITEM_LOAD_PROGRESS', {\n            id: id,\n            progress: progress\n          });\n        });\n\n        item.on('load-request-error', function(error) {\n          var mainStatus = dynamicLabel(state.options.labelFileLoadError)(\n            error\n          );\n\n          // is client error, no way to recover\n          if (error.code >= 400 && error.code < 500) {\n            dispatch('DID_THROW_ITEM_INVALID', {\n              id: id,\n              error: error,\n              status: {\n                main: mainStatus,\n                sub: error.code + ' (' + error.body + ')'\n              }\n            });\n\n            // reject the file so can be dealt with through API\n            failure({ error: error, file: createItemAPI(item) });\n            return;\n          }\n\n          // is possible server error, so might be possible to retry\n          dispatch('DID_THROW_ITEM_LOAD_ERROR', {\n            id: id,\n            error: error,\n            status: {\n              main: mainStatus,\n              sub: state.options.labelTapToRetry\n            }\n          });\n        });\n\n        item.on('load-file-error', function(error) {\n          dispatch('DID_THROW_ITEM_INVALID', {\n            id: id,\n            error: error.status,\n            status: error.status\n          });\n\n          failure({ error: error.status, file: createItemAPI(item) });\n        });\n\n        item.on('load-abort', function() {\n          dispatch('REMOVE_ITEM', { query: id });\n        });\n\n        item.on('load-skip', function() {\n          dispatch('COMPLETE_LOAD_ITEM', {\n            query: id,\n            item: item,\n            data: {\n              source: source,\n              success: success\n            }\n          });\n        });\n\n        item.on('load', function() {\n          var handleAdd = function handleAdd(shouldAdd) {\n            // no should not add this file\n            if (!shouldAdd) {\n              dispatch('REMOVE_ITEM', {\n                query: id\n              });\n\n              return;\n            }\n\n            // now interested in metadata updates\n            item.on('metadata-update', function(change) {\n              dispatch('DID_UPDATE_ITEM_METADATA', { id: id, change: change });\n            });\n\n            // let plugins decide if the output data should be prepared at this point\n            // means we'll do this and wait for idle state\n            applyFilterChain('SHOULD_PREPARE_OUTPUT', false, {\n              item: item,\n              query: query\n            }).then(function(shouldPrepareOutput) {\n              var loadComplete = function loadComplete() {\n                dispatch('COMPLETE_LOAD_ITEM', {\n                  query: id,\n                  item: item,\n                  data: {\n                    source: source,\n                    success: success\n                  }\n                });\n\n                listUpdated(dispatch, state);\n              };\n\n              // exit\n              if (shouldPrepareOutput) {\n                // wait for idle state and then run PREPARE_OUTPUT\n                dispatch(\n                  'REQUEST_PREPARE_OUTPUT',\n                  {\n                    query: id,\n                    item: item,\n                    success: function success(file) {\n                      dispatch('DID_PREPARE_OUTPUT', { id: id, file: file });\n                      loadComplete();\n                    }\n                  },\n                  true\n                );\n\n                return;\n              }\n\n              loadComplete();\n            });\n          };\n\n          // item loaded, allow plugins to\n          // - read data (quickly)\n          // - add metadata\n          applyFilterChain('DID_LOAD_ITEM', item, {\n            query: query,\n            dispatch: dispatch\n          })\n            .then(function() {\n              optionalPromise(\n                query('GET_BEFORE_ADD_FILE'),\n                createItemAPI(item)\n              ).then(handleAdd);\n            })\n            .catch(function() {\n              handleAdd(false);\n            });\n        });\n\n        item.on('process-start', function() {\n          dispatch('DID_START_ITEM_PROCESSING', { id: id });\n        });\n\n        item.on('process-progress', function(progress) {\n          dispatch('DID_UPDATE_ITEM_PROCESS_PROGRESS', {\n            id: id,\n            progress: progress\n          });\n        });\n\n        item.on('process-error', function(error) {\n          dispatch('DID_THROW_ITEM_PROCESSING_ERROR', {\n            id: id,\n            error: error,\n            status: {\n              main: dynamicLabel(state.options.labelFileProcessingError)(error),\n              sub: state.options.labelTapToRetry\n            }\n          });\n        });\n\n        item.on('process-revert-error', function(error) {\n          dispatch('DID_THROW_ITEM_PROCESSING_REVERT_ERROR', {\n            id: id,\n            error: error,\n            status: {\n              main: dynamicLabel(state.options.labelFileProcessingRevertError)(\n                error\n              ),\n              sub: state.options.labelTapToRetry\n            }\n          });\n        });\n\n        item.on('process-complete', function(serverFileReference) {\n          dispatch('DID_COMPLETE_ITEM_PROCESSING', {\n            id: id,\n            error: null,\n            serverFileReference: serverFileReference\n          });\n\n          dispatch('DID_DEFINE_VALUE', { id: id, value: serverFileReference });\n        });\n\n        item.on('process-abort', function() {\n          dispatch('DID_ABORT_ITEM_PROCESSING', { id: id });\n        });\n\n        item.on('process-revert', function() {\n          dispatch('DID_REVERT_ITEM_PROCESSING', { id: id });\n          dispatch('DID_DEFINE_VALUE', { id: id, value: null });\n        });\n\n        // let view know the item has been inserted\n        dispatch('DID_ADD_ITEM', {\n          id: id,\n          index: index,\n          interactionMethod: interactionMethod\n        });\n\n        listUpdated(dispatch, state);\n\n        // start loading the source\n        var _ref8 = state.options.server || {},\n          url = _ref8.url,\n          load = _ref8.load,\n          restore = _ref8.restore,\n          fetch = _ref8.fetch;\n\n        item.load(\n          source,\n\n          // this creates a function that loads the file based on the type of file (string, base64, blob, file) and location of file (local, remote, limbo)\n          createFileLoader(\n            origin === FileOrigin.INPUT\n              ? // input, if is remote, see if should use custom fetch, else use default fetchBlob\n                isString(source) && isExternalURL(source)\n                ? fetch\n                  ? createFetchFunction(url, fetch)\n                  : fetchBlob // remote url\n                : fetchBlob // try to fetch url\n              : // limbo or local\n              origin === FileOrigin.LIMBO\n              ? createFetchFunction(url, restore) // limbo\n              : createFetchFunction(url, load) // local\n          ),\n\n          // called when the file is loaded so it can be piped through the filters\n          function(file, success, error) {\n            // let's process the file\n            applyFilterChain('LOAD_FILE', file, { query: query })\n              .then(success)\n              .catch(error);\n          }\n        );\n      },\n\n      REQUEST_PREPARE_OUTPUT: function REQUEST_PREPARE_OUTPUT(_ref9) {\n        var item = _ref9.item,\n          success = _ref9.success,\n          _ref9$failure = _ref9.failure,\n          failure = _ref9$failure === void 0 ? function() {} : _ref9$failure;\n\n        // error response if item archived\n        var err = {\n          error: createResponse('error', 0, 'Item not found'),\n\n          file: null\n        };\n\n        // don't handle archived items, an item could have been archived (load aborted) while waiting to be prepared\n        if (item.archived) return failure(err);\n\n        // allow plugins to alter the file data\n        applyFilterChain('PREPARE_OUTPUT', item.file, {\n          query: query,\n          item: item\n        }).then(function(result) {\n          applyFilterChain('COMPLETE_PREPARE_OUTPUT', result, {\n            query: query,\n            item: item\n          }).then(function(result) {\n            // don't handle archived items, an item could have been archived (load aborted) while being prepared\n            if (item.archived) return failure(err);\n\n            // we done!\n            success(result);\n          });\n        });\n      },\n\n      COMPLETE_LOAD_ITEM: function COMPLETE_LOAD_ITEM(_ref10) {\n        var item = _ref10.item,\n          data = _ref10.data;\n        var success = data.success,\n          source = data.source;\n\n        // sort items in list\n        var itemInsertLocation = query('GET_ITEM_INSERT_LOCATION');\n        if (isFunction(itemInsertLocation) && source) {\n          sortItems(state, itemInsertLocation);\n        }\n\n        // let interface know the item has loaded\n        dispatch('DID_LOAD_ITEM', {\n          id: item.id,\n          error: null,\n          serverFileReference: item.origin === FileOrigin.INPUT ? null : source\n        });\n\n        // item has been successfully loaded and added to the\n        // list of items so can now be safely returned for use\n        success(createItemAPI(item));\n\n        // if this is a local server file we need to show a different state\n        if (item.origin === FileOrigin.LOCAL) {\n          dispatch('DID_LOAD_LOCAL_ITEM', { id: item.id });\n          return;\n        }\n\n        // if is a temp server file we prevent async upload call here (as the file is already on the server)\n        if (item.origin === FileOrigin.LIMBO) {\n          dispatch('DID_COMPLETE_ITEM_PROCESSING', {\n            id: item.id,\n            error: null,\n            serverFileReference: source\n          });\n\n          dispatch('DID_DEFINE_VALUE', {\n            id: item.id,\n            value: source\n          });\n\n          return;\n        }\n\n        // id we are allowed to upload the file immidiately, lets do it\n        if (query('IS_ASYNC') && state.options.instantUpload) {\n          dispatch('REQUEST_ITEM_PROCESSING', { query: item.id });\n        }\n      },\n\n      RETRY_ITEM_LOAD: getItemByQueryFromState(state, function(item) {\n        // try loading the source one more time\n        item.retryLoad();\n      }),\n\n      REQUEST_ITEM_PREPARE: getItemByQueryFromState(state, function(\n        item,\n        _success,\n        failure\n      ) {\n        dispatch(\n          'REQUEST_PREPARE_OUTPUT',\n          {\n            query: item.id,\n            item: item,\n            success: function success(file) {\n              dispatch('DID_PREPARE_OUTPUT', { id: item.id, file: file });\n              _success({\n                file: item,\n                output: file\n              });\n            },\n            failure: failure\n          },\n          true\n        );\n      }),\n\n      REQUEST_ITEM_PROCESSING: getItemByQueryFromState(state, function(\n        item,\n        success,\n        failure\n      ) {\n        // cannot be queued (or is already queued)\n        var itemCanBeQueuedForProcessing =\n          // waiting for something\n          item.status === ItemStatus.IDLE ||\n          // processing went wrong earlier\n          item.status === ItemStatus.PROCESSING_ERROR;\n\n        // not ready to be processed\n        if (!itemCanBeQueuedForProcessing) {\n          var processNow = function processNow() {\n            return dispatch('REQUEST_ITEM_PROCESSING', {\n              query: item,\n              success: success,\n              failure: failure\n            });\n          };\n\n          var process = function process() {\n            return document.hidden ? processNow() : setTimeout(processNow, 32);\n          };\n\n          // if already done processing or tried to revert but didn't work, try again\n          if (\n            item.status === ItemStatus.PROCESSING_COMPLETE ||\n            item.status === ItemStatus.PROCESSING_REVERT_ERROR\n          ) {\n            item\n              .revert(\n                createRevertFunction(\n                  state.options.server.url,\n                  state.options.server.revert\n                ),\n                query('GET_FORCE_REVERT')\n              )\n              .then(process)\n              .catch(function() {}); // don't continue with processing if something went wrong\n          } else if (item.status === ItemStatus.PROCESSING) {\n            item.abortProcessing().then(process);\n          }\n\n          return;\n        }\n\n        // already queued for processing\n        if (item.status === ItemStatus.PROCESSING_QUEUED) return;\n\n        item.requestProcessing();\n\n        dispatch('DID_REQUEST_ITEM_PROCESSING', { id: item.id });\n\n        dispatch(\n          'PROCESS_ITEM',\n          { query: item, success: success, failure: failure },\n          true\n        );\n      }),\n\n      PROCESS_ITEM: getItemByQueryFromState(state, function(\n        item,\n        success,\n        failure\n      ) {\n        var maxParallelUploads = query('GET_MAX_PARALLEL_UPLOADS');\n        var totalCurrentUploads = query(\n          'GET_ITEMS_BY_STATUS',\n          ItemStatus.PROCESSING\n        ).length;\n\n        // queue and wait till queue is freed up\n        if (totalCurrentUploads === maxParallelUploads) {\n          // queue for later processing\n          state.processingQueue.push({\n            id: item.id,\n            success: success,\n            failure: failure\n          });\n\n          // stop it!\n          return;\n        }\n\n        // if was not queued or is already processing exit here\n        if (item.status === ItemStatus.PROCESSING) return;\n\n        var processNext = function processNext() {\n          // process queueud items\n          var queueEntry = state.processingQueue.shift();\n\n          // no items left\n          if (!queueEntry) return;\n\n          // get item reference\n          var id = queueEntry.id,\n            success = queueEntry.success,\n            failure = queueEntry.failure;\n          var itemReference = getItemByQuery(state.items, id);\n\n          // if item was archived while in queue, jump to next\n          if (!itemReference || itemReference.archived) {\n            processNext();\n            return;\n          }\n\n          // process queued item\n          dispatch(\n            'PROCESS_ITEM',\n            { query: id, success: success, failure: failure },\n            true\n          );\n        };\n\n        // we done function\n        item.onOnce('process-complete', function() {\n          success(createItemAPI(item));\n          processNext();\n\n          // All items processed? No errors?\n          var allItemsProcessed =\n            query('GET_ITEMS_BY_STATUS', ItemStatus.PROCESSING_COMPLETE)\n              .length === state.items.length;\n          if (allItemsProcessed) {\n            dispatch('DID_COMPLETE_ITEM_PROCESSING_ALL');\n          }\n        });\n\n        // we error function\n        item.onOnce('process-error', function(error) {\n          failure({ error: error, file: createItemAPI(item) });\n          processNext();\n        });\n\n        // start file processing\n        var options = state.options;\n        item.process(\n          createFileProcessor(\n            createProcessorFunction(\n              options.server.url,\n              options.server.process,\n              options.name,\n              {\n                chunkTransferId: item.transferId,\n                chunkServer: options.server.patch,\n                chunkUploads: options.chunkUploads,\n                chunkForce: options.chunkForce,\n                chunkSize: options.chunkSize,\n                chunkRetryDelays: options.chunkRetryDelays\n              }\n            )\n          ),\n\n          // called when the file is about to be processed so it can be piped through the transform filters\n          function(file, success, error) {\n            // allow plugins to alter the file data\n            applyFilterChain('PREPARE_OUTPUT', file, {\n              query: query,\n              item: item\n            })\n              .then(function(file) {\n                dispatch('DID_PREPARE_OUTPUT', { id: item.id, file: file });\n\n                success(file);\n              })\n              .catch(error);\n          }\n        );\n      }),\n\n      RETRY_ITEM_PROCESSING: getItemByQueryFromState(state, function(item) {\n        dispatch('REQUEST_ITEM_PROCESSING', { query: item });\n      }),\n\n      REQUEST_REMOVE_ITEM: getItemByQueryFromState(state, function(item) {\n        optionalPromise(\n          query('GET_BEFORE_REMOVE_FILE'),\n          createItemAPI(item)\n        ).then(function(shouldRemove) {\n          if (!shouldRemove) {\n            return;\n          }\n          dispatch('REMOVE_ITEM', { query: item });\n        });\n      }),\n\n      RELEASE_ITEM: getItemByQueryFromState(state, function(item) {\n        item.release();\n      }),\n\n      REMOVE_ITEM: getItemByQueryFromState(state, function(\n        item,\n        success,\n        failure,\n        options\n      ) {\n        var removeFromView = function removeFromView() {\n          // get id reference\n          var id = item.id;\n\n          // archive the item, this does not remove it from the list\n          getItemById(state.items, id).archive();\n\n          // tell the view the item has been removed\n          dispatch('DID_REMOVE_ITEM', { error: null, id: id, item: item });\n\n          // now the list has been modified\n          listUpdated(dispatch, state);\n\n          // correctly removed\n          success(createItemAPI(item));\n        };\n\n        // if this is a local file and the server.remove function has been configured, send source there so dev can remove file from server\n        var server = state.options.server;\n        if (\n          item.origin === FileOrigin.LOCAL &&\n          server &&\n          isFunction(server.remove) &&\n          options.remove !== false\n        ) {\n          dispatch('DID_START_ITEM_REMOVE', { id: item.id });\n\n          server.remove(\n            item.source,\n            function() {\n              return removeFromView();\n            },\n            function(status) {\n              dispatch('DID_THROW_ITEM_REMOVE_ERROR', {\n                id: item.id,\n                error: createResponse('error', 0, status, null),\n                status: {\n                  main: dynamicLabel(state.options.labelFileRemoveError)(\n                    status\n                  ),\n                  sub: state.options.labelTapToRetry\n                }\n              });\n            }\n          );\n        } else {\n          // if is requesting revert and can revert need to call revert handler (not calling request_ because that would also trigger beforeRemoveHook)\n          if (\n            options.revert &&\n            item.origin !== FileOrigin.LOCAL &&\n            item.serverId !== null\n          ) {\n            item.revert(\n              createRevertFunction(\n                state.options.server.url,\n                state.options.server.revert\n              ),\n              query('GET_FORCE_REVERT')\n            );\n          }\n\n          // can now safely remove from view\n          removeFromView();\n        }\n      }),\n\n      ABORT_ITEM_LOAD: getItemByQueryFromState(state, function(item) {\n        item.abortLoad();\n      }),\n\n      ABORT_ITEM_PROCESSING: getItemByQueryFromState(state, function(item) {\n        // test if is already processed\n        if (item.serverId) {\n          dispatch('REVERT_ITEM_PROCESSING', { id: item.id });\n          return;\n        }\n\n        // abort\n        item.abortProcessing().then(function() {\n          var shouldRemove = state.options.instantUpload;\n          if (shouldRemove) {\n            dispatch('REMOVE_ITEM', { query: item.id });\n          }\n        });\n      }),\n\n      REQUEST_REVERT_ITEM_PROCESSING: getItemByQueryFromState(state, function(\n        item\n      ) {\n        // not instant uploading, revert immidiately\n        if (!state.options.instantUpload) {\n          dispatch('REVERT_ITEM_PROCESSING', { query: item });\n          return;\n        }\n\n        // if we're instant uploading the file will also be removed if we revert,\n        // so if a before remove file hook is defined we need to run it now\n        var handleRevert = function handleRevert(shouldRevert) {\n          if (!shouldRevert) return;\n          dispatch('REVERT_ITEM_PROCESSING', { query: item });\n        };\n\n        var fn = query('GET_BEFORE_REMOVE_FILE');\n        if (!fn) {\n          return handleRevert(true);\n        }\n\n        var requestRemoveResult = fn(createItemAPI(item));\n        if (requestRemoveResult == null) {\n          // undefined or null\n          return handleRevert(true);\n        }\n\n        if (typeof requestRemoveResult === 'boolean') {\n          return handleRevert(requestRemoveResult);\n        }\n\n        if (typeof requestRemoveResult.then === 'function') {\n          requestRemoveResult.then(handleRevert);\n        }\n      }),\n\n      REVERT_ITEM_PROCESSING: getItemByQueryFromState(state, function(item) {\n        item\n          .revert(\n            createRevertFunction(\n              state.options.server.url,\n              state.options.server.revert\n            ),\n            query('GET_FORCE_REVERT')\n          )\n          .then(function() {\n            var shouldRemove = state.options.instantUpload || isMockItem(item);\n            if (shouldRemove) {\n              dispatch('REMOVE_ITEM', { query: item.id });\n            }\n          })\n          .catch(function() {});\n      }),\n\n      SET_OPTIONS: function SET_OPTIONS(_ref11) {\n        var options = _ref11.options;\n        forin(options, function(key, value) {\n          dispatch('SET_' + fromCamels(key, '_').toUpperCase(), {\n            value: value\n          });\n        });\n      }\n    };\n  };\n\n  var formatFilename = function formatFilename(name) {\n    return name;\n  };\n\n  var createElement$1 = function createElement(tagName) {\n    return document.createElement(tagName);\n  };\n\n  var text = function text(node, value) {\n    var textNode = node.childNodes[0];\n    if (!textNode) {\n      textNode = document.createTextNode(value);\n      node.appendChild(textNode);\n    } else if (value !== textNode.nodeValue) {\n      textNode.nodeValue = value;\n    }\n  };\n\n  var polarToCartesian = function polarToCartesian(\n    centerX,\n    centerY,\n    radius,\n    angleInDegrees\n  ) {\n    var angleInRadians = (((angleInDegrees % 360) - 90) * Math.PI) / 180.0;\n    return {\n      x: centerX + radius * Math.cos(angleInRadians),\n      y: centerY + radius * Math.sin(angleInRadians)\n    };\n  };\n\n  var describeArc = function describeArc(\n    x,\n    y,\n    radius,\n    startAngle,\n    endAngle,\n    arcSweep\n  ) {\n    var start = polarToCartesian(x, y, radius, endAngle);\n    var end = polarToCartesian(x, y, radius, startAngle);\n    return [\n      'M',\n      start.x,\n      start.y,\n      'A',\n      radius,\n      radius,\n      0,\n      arcSweep,\n      0,\n      end.x,\n      end.y\n    ].join(' ');\n  };\n\n  var percentageArc = function percentageArc(x, y, radius, from, to) {\n    var arcSweep = 1;\n    if (to > from && to - from <= 0.5) {\n      arcSweep = 0;\n    }\n    if (from > to && from - to >= 0.5) {\n      arcSweep = 0;\n    }\n    return describeArc(\n      x,\n      y,\n      radius,\n      Math.min(0.9999, from) * 360,\n      Math.min(0.9999, to) * 360,\n      arcSweep\n    );\n  };\n\n  var create = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n    // start at 0\n    props.spin = false;\n    props.progress = 0;\n    props.opacity = 0;\n\n    // svg\n    var svg = createElement('svg');\n    root.ref.path = createElement('path', {\n      'stroke-width': 2,\n      'stroke-linecap': 'round'\n    });\n\n    svg.appendChild(root.ref.path);\n\n    root.ref.svg = svg;\n\n    root.appendChild(svg);\n  };\n\n  var write = function write(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props;\n\n    if (props.opacity === 0) {\n      return;\n    }\n\n    if (props.align) {\n      root.element.dataset.align = props.align;\n    }\n\n    // get width of stroke\n    var ringStrokeWidth = parseInt(attr(root.ref.path, 'stroke-width'), 10);\n\n    // calculate size of ring\n    var size = root.rect.element.width * 0.5;\n\n    // ring state\n    var ringFrom = 0;\n    var ringTo = 0;\n\n    // now in busy mode\n    if (props.spin) {\n      ringFrom = 0;\n      ringTo = 0.5;\n    } else {\n      ringFrom = 0;\n      ringTo = props.progress;\n    }\n\n    // get arc path\n    var coordinates = percentageArc(\n      size,\n      size,\n      size - ringStrokeWidth,\n      ringFrom,\n      ringTo\n    );\n\n    // update progress bar\n    attr(root.ref.path, 'd', coordinates);\n\n    // hide while contains 0 value\n    attr(\n      root.ref.path,\n      'stroke-opacity',\n      props.spin || props.progress > 0 ? 1 : 0\n    );\n  };\n\n  var progressIndicator = createView({\n    tag: 'div',\n    name: 'progress-indicator',\n    ignoreRectUpdate: true,\n    ignoreRect: true,\n    create: create,\n    write: write,\n    mixins: {\n      apis: ['progress', 'spin', 'align'],\n      styles: ['opacity'],\n      animations: {\n        opacity: { type: 'tween', duration: 500 },\n        progress: {\n          type: 'spring',\n          stiffness: 0.95,\n          damping: 0.65,\n          mass: 10\n        }\n      }\n    }\n  });\n\n  var create$1 = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n    root.element.innerHTML =\n      (props.icon || '') + ('<span>' + props.label + '</span>');\n\n    props.isDisabled = false;\n  };\n\n  var write$1 = function write(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props;\n    var isDisabled = props.isDisabled;\n    var shouldDisable = root.query('GET_DISABLED') || props.opacity === 0;\n\n    if (shouldDisable && !isDisabled) {\n      props.isDisabled = true;\n      attr(root.element, 'disabled', 'disabled');\n    } else if (!shouldDisable && isDisabled) {\n      props.isDisabled = false;\n      root.element.removeAttribute('disabled');\n    }\n  };\n\n  var fileActionButton = createView({\n    tag: 'button',\n    attributes: {\n      type: 'button'\n    },\n\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    name: 'file-action-button',\n    mixins: {\n      apis: ['label'],\n      styles: ['translateX', 'translateY', 'scaleX', 'scaleY', 'opacity'],\n      animations: {\n        scaleX: 'spring',\n        scaleY: 'spring',\n        translateX: 'spring',\n        translateY: 'spring',\n        opacity: { type: 'tween', duration: 250 }\n      },\n\n      listeners: true\n    },\n\n    create: create$1,\n    write: write$1\n  });\n\n  var toNaturalFileSize = function toNaturalFileSize(bytes) {\n    var decimalSeparator =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '.';\n    // nope, no negative byte sizes\n    bytes = Math.round(Math.abs(bytes));\n\n    // just bytes\n    if (bytes < 1000) {\n      return bytes + ' bytes';\n    }\n\n    // kilobytes\n    if (bytes < MB) {\n      return Math.floor(bytes / KB) + ' KB';\n    }\n\n    // megabytes\n    if (bytes < GB) {\n      return removeDecimalsWhenZero(bytes / MB, 1, decimalSeparator) + ' MB';\n    }\n\n    // gigabytes\n    return removeDecimalsWhenZero(bytes / GB, 2, decimalSeparator) + ' GB';\n  };\n\n  var KB = 1000;\n  var MB = 1000000;\n  var GB = 1000000000;\n\n  var removeDecimalsWhenZero = function removeDecimalsWhenZero(\n    value,\n    decimalCount,\n    separator\n  ) {\n    return value\n      .toFixed(decimalCount)\n      .split('.')\n      .filter(function(part) {\n        return part !== '0';\n      })\n      .join(separator);\n  };\n\n  var create$2 = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n    // filename\n    var fileName = createElement$1('span');\n    fileName.className = 'filepond--file-info-main';\n    // hide for screenreaders\n    // the file is contained in a fieldset with legend that contains the filename\n    // no need to read it twice\n    attr(fileName, 'aria-hidden', 'true');\n    root.appendChild(fileName);\n    root.ref.fileName = fileName;\n\n    // filesize\n    var fileSize = createElement$1('span');\n    fileSize.className = 'filepond--file-info-sub';\n    root.appendChild(fileSize);\n    root.ref.fileSize = fileSize;\n\n    // set initial values\n    text(fileSize, root.query('GET_LABEL_FILE_WAITING_FOR_SIZE'));\n    text(fileName, formatFilename(root.query('GET_ITEM_NAME', props.id)));\n  };\n\n  var updateFile = function updateFile(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props;\n    text(\n      root.ref.fileSize,\n      toNaturalFileSize(root.query('GET_ITEM_SIZE', props.id))\n    );\n\n    text(\n      root.ref.fileName,\n      formatFilename(root.query('GET_ITEM_NAME', props.id))\n    );\n  };\n\n  var updateFileSizeOnError = function updateFileSizeOnError(_ref3) {\n    var root = _ref3.root,\n      props = _ref3.props;\n    // if size is available don't fallback to unknown size message\n    if (isInt(root.query('GET_ITEM_SIZE', props.id))) {\n      return;\n    }\n\n    text(root.ref.fileSize, root.query('GET_LABEL_FILE_SIZE_NOT_AVAILABLE'));\n  };\n\n  var fileInfo = createView({\n    name: 'file-info',\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    write: createRoute({\n      DID_LOAD_ITEM: updateFile,\n      DID_UPDATE_ITEM_META: updateFile,\n      DID_THROW_ITEM_LOAD_ERROR: updateFileSizeOnError,\n      DID_THROW_ITEM_INVALID: updateFileSizeOnError\n    }),\n\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, { view: root }));\n    },\n    create: create$2,\n    mixins: {\n      styles: ['translateX', 'translateY'],\n      animations: {\n        translateX: 'spring',\n        translateY: 'spring'\n      }\n    }\n  });\n\n  var toPercentage = function toPercentage(value) {\n    return Math.round(value * 100);\n  };\n\n  var create$3 = function create(_ref) {\n    var root = _ref.root;\n\n    // main status\n    var main = createElement$1('span');\n    main.className = 'filepond--file-status-main';\n    root.appendChild(main);\n    root.ref.main = main;\n\n    // sub status\n    var sub = createElement$1('span');\n    sub.className = 'filepond--file-status-sub';\n    root.appendChild(sub);\n    root.ref.sub = sub;\n\n    didSetItemLoadProgress({ root: root, action: { progress: null } });\n  };\n\n  var didSetItemLoadProgress = function didSetItemLoadProgress(_ref2) {\n    var root = _ref2.root,\n      action = _ref2.action;\n    var title =\n      action.progress === null\n        ? root.query('GET_LABEL_FILE_LOADING')\n        : root.query('GET_LABEL_FILE_LOADING') +\n          ' ' +\n          toPercentage(action.progress) +\n          '%';\n\n    text(root.ref.main, title);\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));\n  };\n\n  var didSetItemProcessProgress = function didSetItemProcessProgress(_ref3) {\n    var root = _ref3.root,\n      action = _ref3.action;\n    var title =\n      action.progress === null\n        ? root.query('GET_LABEL_FILE_PROCESSING')\n        : root.query('GET_LABEL_FILE_PROCESSING') +\n          ' ' +\n          toPercentage(action.progress) +\n          '%';\n\n    text(root.ref.main, title);\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));\n  };\n\n  var didRequestItemProcessing = function didRequestItemProcessing(_ref4) {\n    var root = _ref4.root;\n    text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING'));\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));\n  };\n\n  var didAbortItemProcessing = function didAbortItemProcessing(_ref5) {\n    var root = _ref5.root;\n    text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING_ABORTED'));\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_RETRY'));\n  };\n\n  var didCompleteItemProcessing = function didCompleteItemProcessing(_ref6) {\n    var root = _ref6.root;\n    text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING_COMPLETE'));\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_UNDO'));\n  };\n\n  var clear = function clear(_ref7) {\n    var root = _ref7.root;\n    text(root.ref.main, '');\n    text(root.ref.sub, '');\n  };\n\n  var error = function error(_ref8) {\n    var root = _ref8.root,\n      action = _ref8.action;\n    text(root.ref.main, action.status.main);\n    text(root.ref.sub, action.status.sub);\n  };\n\n  var fileStatus = createView({\n    name: 'file-status',\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    write: createRoute({\n      DID_LOAD_ITEM: clear,\n      DID_REVERT_ITEM_PROCESSING: clear,\n      DID_REQUEST_ITEM_PROCESSING: didRequestItemProcessing,\n      DID_ABORT_ITEM_PROCESSING: didAbortItemProcessing,\n      DID_COMPLETE_ITEM_PROCESSING: didCompleteItemProcessing,\n      DID_UPDATE_ITEM_PROCESS_PROGRESS: didSetItemProcessProgress,\n      DID_UPDATE_ITEM_LOAD_PROGRESS: didSetItemLoadProgress,\n      DID_THROW_ITEM_LOAD_ERROR: error,\n      DID_THROW_ITEM_INVALID: error,\n      DID_THROW_ITEM_PROCESSING_ERROR: error,\n      DID_THROW_ITEM_PROCESSING_REVERT_ERROR: error,\n      DID_THROW_ITEM_REMOVE_ERROR: error\n    }),\n\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, { view: root }));\n    },\n    create: create$3,\n    mixins: {\n      styles: ['translateX', 'translateY', 'opacity'],\n      animations: {\n        opacity: { type: 'tween', duration: 250 },\n        translateX: 'spring',\n        translateY: 'spring'\n      }\n    }\n  });\n\n  /**\n   * Button definitions for the file view\n   */\n\n  var Buttons = {\n    AbortItemLoad: {\n      label: 'GET_LABEL_BUTTON_ABORT_ITEM_LOAD',\n      action: 'ABORT_ITEM_LOAD',\n      className: 'filepond--action-abort-item-load',\n      align: 'LOAD_INDICATOR_POSITION' // right\n    },\n    RetryItemLoad: {\n      label: 'GET_LABEL_BUTTON_RETRY_ITEM_LOAD',\n      action: 'RETRY_ITEM_LOAD',\n      icon: 'GET_ICON_RETRY',\n      className: 'filepond--action-retry-item-load',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n    },\n    RemoveItem: {\n      label: 'GET_LABEL_BUTTON_REMOVE_ITEM',\n      action: 'REQUEST_REMOVE_ITEM',\n      icon: 'GET_ICON_REMOVE',\n      className: 'filepond--action-remove-item',\n      align: 'BUTTON_REMOVE_ITEM_POSITION' // left\n    },\n    ProcessItem: {\n      label: 'GET_LABEL_BUTTON_PROCESS_ITEM',\n      action: 'REQUEST_ITEM_PROCESSING',\n      icon: 'GET_ICON_PROCESS',\n      className: 'filepond--action-process-item',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n    },\n    AbortItemProcessing: {\n      label: 'GET_LABEL_BUTTON_ABORT_ITEM_PROCESSING',\n      action: 'ABORT_ITEM_PROCESSING',\n      className: 'filepond--action-abort-item-processing',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n    },\n    RetryItemProcessing: {\n      label: 'GET_LABEL_BUTTON_RETRY_ITEM_PROCESSING',\n      action: 'RETRY_ITEM_PROCESSING',\n      icon: 'GET_ICON_RETRY',\n      className: 'filepond--action-retry-item-processing',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n    },\n    RevertItemProcessing: {\n      label: 'GET_LABEL_BUTTON_UNDO_ITEM_PROCESSING',\n      action: 'REQUEST_REVERT_ITEM_PROCESSING',\n      icon: 'GET_ICON_UNDO',\n      className: 'filepond--action-revert-item-processing',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n    }\n  };\n\n  // make a list of buttons, we can then remove buttons from this list if they're disabled\n  var ButtonKeys = [];\n  forin(Buttons, function(key) {\n    ButtonKeys.push(key);\n  });\n\n  var calculateFileInfoOffset = function calculateFileInfoOffset(root) {\n    var buttonRect = root.ref.buttonRemoveItem.rect.element;\n    return buttonRect.hidden ? null : buttonRect.width + buttonRect.left;\n  };\n\n  var calculateButtonWidth = function calculateButtonWidth(root) {\n    var buttonRect = root.ref.buttonAbortItemLoad.rect.element;\n    return buttonRect.width;\n  };\n\n  // Force on full pixels so text stays crips\n  var calculateFileVerticalCenterOffset = function calculateFileVerticalCenterOffset(\n    root\n  ) {\n    return Math.floor(root.ref.buttonRemoveItem.rect.element.height / 4);\n  };\n  var calculateFileHorizontalCenterOffset = function calculateFileHorizontalCenterOffset(\n    root\n  ) {\n    return Math.floor(root.ref.buttonRemoveItem.rect.element.left / 2);\n  };\n\n  var getLoadIndicatorAlignment = function getLoadIndicatorAlignment(root) {\n    return root.query('GET_STYLE_LOAD_INDICATOR_POSITION');\n  };\n  var getProcessIndicatorAlignment = function getProcessIndicatorAlignment(\n    root\n  ) {\n    return root.query('GET_STYLE_PROGRESS_INDICATOR_POSITION');\n  };\n  var getRemoveIndicatorAligment = function getRemoveIndicatorAligment(root) {\n    return root.query('GET_STYLE_BUTTON_REMOVE_ITEM_POSITION');\n  };\n\n  var DefaultStyle = {\n    buttonAbortItemLoad: { opacity: 0 },\n    buttonRetryItemLoad: { opacity: 0 },\n    buttonRemoveItem: { opacity: 0 },\n    buttonProcessItem: { opacity: 0 },\n    buttonAbortItemProcessing: { opacity: 0 },\n    buttonRetryItemProcessing: { opacity: 0 },\n    buttonRevertItemProcessing: { opacity: 0 },\n    loadProgressIndicator: { opacity: 0, align: getLoadIndicatorAlignment },\n    processProgressIndicator: {\n      opacity: 0,\n      align: getProcessIndicatorAlignment\n    },\n    processingCompleteIndicator: { opacity: 0, scaleX: 0.75, scaleY: 0.75 },\n    info: { translateX: 0, translateY: 0, opacity: 0 },\n    status: { translateX: 0, translateY: 0, opacity: 0 }\n  };\n\n  var IdleStyle = {\n    buttonRemoveItem: { opacity: 1 },\n    buttonProcessItem: { opacity: 1 },\n    info: { translateX: calculateFileInfoOffset },\n    status: { translateX: calculateFileInfoOffset }\n  };\n\n  var ProcessingStyle = {\n    buttonAbortItemProcessing: { opacity: 1 },\n    processProgressIndicator: { opacity: 1 },\n    status: { opacity: 1 }\n  };\n\n  var StyleMap = {\n    DID_THROW_ITEM_INVALID: {\n      buttonRemoveItem: { opacity: 1 },\n      info: { translateX: calculateFileInfoOffset },\n      status: { translateX: calculateFileInfoOffset, opacity: 1 }\n    },\n\n    DID_START_ITEM_LOAD: {\n      buttonAbortItemLoad: { opacity: 1 },\n      loadProgressIndicator: { opacity: 1 },\n      status: { opacity: 1 }\n    },\n\n    DID_THROW_ITEM_LOAD_ERROR: {\n      buttonRetryItemLoad: { opacity: 1 },\n      buttonRemoveItem: { opacity: 1 },\n      info: { translateX: calculateFileInfoOffset },\n      status: { opacity: 1 }\n    },\n\n    DID_START_ITEM_REMOVE: {\n      processProgressIndicator: {\n        opacity: 1,\n        align: getRemoveIndicatorAligment\n      },\n      info: { translateX: calculateFileInfoOffset },\n      status: { opacity: 0 }\n    },\n\n    DID_THROW_ITEM_REMOVE_ERROR: {\n      processProgressIndicator: {\n        opacity: 0,\n        align: getRemoveIndicatorAligment\n      },\n      buttonRemoveItem: { opacity: 1 },\n      info: { translateX: calculateFileInfoOffset },\n      status: { opacity: 1, translateX: calculateFileInfoOffset }\n    },\n\n    DID_LOAD_ITEM: IdleStyle,\n    DID_LOAD_LOCAL_ITEM: {\n      buttonRemoveItem: { opacity: 1 },\n      info: { translateX: calculateFileInfoOffset },\n      status: { translateX: calculateFileInfoOffset }\n    },\n\n    DID_START_ITEM_PROCESSING: ProcessingStyle,\n    DID_REQUEST_ITEM_PROCESSING: ProcessingStyle,\n    DID_UPDATE_ITEM_PROCESS_PROGRESS: ProcessingStyle,\n    DID_COMPLETE_ITEM_PROCESSING: {\n      buttonRevertItemProcessing: { opacity: 1 },\n      info: { opacity: 1 },\n      status: { opacity: 1 }\n    },\n\n    DID_THROW_ITEM_PROCESSING_ERROR: {\n      buttonRemoveItem: { opacity: 1 },\n      buttonRetryItemProcessing: { opacity: 1 },\n      status: { opacity: 1 },\n      info: { translateX: calculateFileInfoOffset }\n    },\n\n    DID_THROW_ITEM_PROCESSING_REVERT_ERROR: {\n      buttonRevertItemProcessing: { opacity: 1 },\n      status: { opacity: 1 },\n      info: { opacity: 1 }\n    },\n\n    DID_ABORT_ITEM_PROCESSING: {\n      buttonRemoveItem: { opacity: 1 },\n      buttonProcessItem: { opacity: 1 },\n      info: { translateX: calculateFileInfoOffset },\n      status: { opacity: 1 }\n    },\n\n    DID_REVERT_ITEM_PROCESSING: IdleStyle\n  };\n\n  // complete indicator view\n  var processingCompleteIndicatorView = createView({\n    create: function create(_ref) {\n      var root = _ref.root;\n      root.element.innerHTML = root.query('GET_ICON_DONE');\n    },\n    name: 'processing-complete-indicator',\n    ignoreRect: true,\n    mixins: {\n      styles: ['scaleX', 'scaleY', 'opacity'],\n      animations: {\n        scaleX: 'spring',\n        scaleY: 'spring',\n        opacity: { type: 'tween', duration: 250 }\n      }\n    }\n  });\n\n  /**\n   * Creates the file view\n   */\n  var create$4 = function create(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props;\n    var id = props.id;\n\n    // allow reverting upload\n    var allowRevert = root.query('GET_ALLOW_REVERT');\n\n    // allow remove file\n    var allowRemove = root.query('GET_ALLOW_REMOVE');\n\n    // allow processing upload\n    var allowProcess = root.query('GET_ALLOW_PROCESS');\n\n    // is instant uploading, need this to determine the icon of the undo button\n    var instantUpload = root.query('GET_INSTANT_UPLOAD');\n\n    // is async set up\n    var isAsync = root.query('IS_ASYNC');\n\n    // should align remove item buttons\n    var alignRemoveItemButton = root.query(\n      'GET_STYLE_BUTTON_REMOVE_ITEM_ALIGN'\n    );\n\n    // enabled buttons array\n    var buttonFilter;\n    if (isAsync) {\n      if (allowProcess && !allowRevert) {\n        // only remove revert button\n        buttonFilter = function buttonFilter(key) {\n          return !/RevertItemProcessing/.test(key);\n        };\n      } else if (!allowProcess && allowRevert) {\n        // only remove process button\n        buttonFilter = function buttonFilter(key) {\n          return !/ProcessItem|RetryItemProcessing|AbortItemProcessing/.test(\n            key\n          );\n        };\n      } else if (!allowProcess && !allowRevert) {\n        // remove all process buttons\n        buttonFilter = function buttonFilter(key) {\n          return !/Process/.test(key);\n        };\n      }\n    } else {\n      // no process controls available\n      buttonFilter = function buttonFilter(key) {\n        return !/Process/.test(key);\n      };\n    }\n\n    var enabledButtons = buttonFilter\n      ? ButtonKeys.filter(buttonFilter)\n      : ButtonKeys.concat();\n\n    // update icon and label for revert button when instant uploading\n    if (instantUpload && allowRevert) {\n      Buttons['RevertItemProcessing'].label = 'GET_LABEL_BUTTON_REMOVE_ITEM';\n      Buttons['RevertItemProcessing'].icon = 'GET_ICON_REMOVE';\n    }\n\n    // remove last button (revert) if not allowed\n    if (isAsync && !allowRevert) {\n      var map = StyleMap['DID_COMPLETE_ITEM_PROCESSING'];\n      map.info.translateX = calculateFileHorizontalCenterOffset;\n      map.info.translateY = calculateFileVerticalCenterOffset;\n      map.status.translateY = calculateFileVerticalCenterOffset;\n      map.processingCompleteIndicator = { opacity: 1, scaleX: 1, scaleY: 1 };\n    }\n\n    // should align center\n    if (isAsync && !allowProcess) {\n      [\n        'DID_START_ITEM_PROCESSING',\n        'DID_REQUEST_ITEM_PROCESSING',\n        'DID_UPDATE_ITEM_PROCESS_PROGRESS',\n        'DID_THROW_ITEM_PROCESSING_ERROR'\n      ].forEach(function(key) {\n        StyleMap[key].status.translateY = calculateFileVerticalCenterOffset;\n      });\n      StyleMap[\n        'DID_THROW_ITEM_PROCESSING_ERROR'\n      ].status.translateX = calculateButtonWidth;\n    }\n\n    // move remove button to right\n    if (alignRemoveItemButton && allowRevert) {\n      Buttons['RevertItemProcessing'].align = 'BUTTON_REMOVE_ITEM_POSITION';\n      var _map = StyleMap['DID_COMPLETE_ITEM_PROCESSING'];\n      _map.info.translateX = calculateFileInfoOffset;\n      _map.status.translateY = calculateFileVerticalCenterOffset;\n      _map.processingCompleteIndicator = { opacity: 1, scaleX: 1, scaleY: 1 };\n    }\n\n    if (!allowRemove) {\n      Buttons['RemoveItem'].disabled = true;\n    }\n\n    // create the button views\n    forin(Buttons, function(key, definition) {\n      // create button\n      var buttonView = root.createChildView(fileActionButton, {\n        label: root.query(definition.label),\n        icon: root.query(definition.icon),\n        opacity: 0\n      });\n\n      // should be appended?\n      if (enabledButtons.includes(key)) {\n        root.appendChildView(buttonView);\n      }\n\n      // toggle\n      if (definition.disabled) {\n        buttonView.element.setAttribute('disabled', 'disabled');\n        buttonView.element.setAttribute('hidden', 'hidden');\n      }\n\n      // add position attribute\n      buttonView.element.dataset.align = root.query(\n        'GET_STYLE_' + definition.align\n      );\n\n      // add class\n      buttonView.element.classList.add(definition.className);\n\n      // handle interactions\n      buttonView.on('click', function(e) {\n        e.stopPropagation();\n        if (definition.disabled) return;\n        root.dispatch(definition.action, { query: id });\n      });\n\n      // set reference\n      root.ref['button' + key] = buttonView;\n    });\n\n    // checkmark\n    root.ref.processingCompleteIndicator = root.appendChildView(\n      root.createChildView(processingCompleteIndicatorView)\n    );\n    root.ref.processingCompleteIndicator.element.dataset.align = root.query(\n      'GET_STYLE_BUTTON_PROCESS_ITEM_POSITION'\n    );\n\n    // create file info view\n    root.ref.info = root.appendChildView(\n      root.createChildView(fileInfo, { id: id })\n    );\n\n    // create file status view\n    root.ref.status = root.appendChildView(\n      root.createChildView(fileStatus, { id: id })\n    );\n\n    // add progress indicators\n    var loadIndicatorView = root.appendChildView(\n      root.createChildView(progressIndicator, {\n        opacity: 0,\n        align: root.query('GET_STYLE_LOAD_INDICATOR_POSITION')\n      })\n    );\n\n    loadIndicatorView.element.classList.add('filepond--load-indicator');\n    root.ref.loadProgressIndicator = loadIndicatorView;\n\n    var progressIndicatorView = root.appendChildView(\n      root.createChildView(progressIndicator, {\n        opacity: 0,\n        align: root.query('GET_STYLE_PROGRESS_INDICATOR_POSITION')\n      })\n    );\n\n    progressIndicatorView.element.classList.add('filepond--process-indicator');\n    root.ref.processProgressIndicator = progressIndicatorView;\n\n    // current active styles\n    root.ref.activeStyles = [];\n  };\n\n  var write$2 = function write(_ref3) {\n    var root = _ref3.root,\n      actions = _ref3.actions,\n      props = _ref3.props;\n\n    // route actions\n    route({ root: root, actions: actions, props: props });\n\n    // select last state change action\n    var action = actions\n      .concat()\n      .filter(function(action) {\n        return /^DID_/.test(action.type);\n      })\n      .reverse()\n      .find(function(action) {\n        return StyleMap[action.type];\n      });\n\n    // a new action happened, let's get the matching styles\n    if (action) {\n      // define new active styles\n      root.ref.activeStyles = [];\n\n      var stylesToApply = StyleMap[action.type];\n      forin(DefaultStyle, function(name, defaultStyles) {\n        // get reference to control\n        var control = root.ref[name];\n\n        // loop over all styles for this control\n        forin(defaultStyles, function(key, defaultValue) {\n          var value =\n            stylesToApply[name] &&\n            typeof stylesToApply[name][key] !== 'undefined'\n              ? stylesToApply[name][key]\n              : defaultValue;\n          root.ref.activeStyles.push({\n            control: control,\n            key: key,\n            value: value\n          });\n        });\n      });\n    }\n\n    // apply active styles to element\n    root.ref.activeStyles.forEach(function(_ref4) {\n      var control = _ref4.control,\n        key = _ref4.key,\n        value = _ref4.value;\n      control[key] = typeof value === 'function' ? value(root) : value;\n    });\n  };\n\n  var route = createRoute({\n    DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING: function DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING(\n      _ref5\n    ) {\n      var root = _ref5.root,\n        action = _ref5.action;\n      root.ref.buttonAbortItemProcessing.label = action.value;\n    },\n    DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD: function DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD(\n      _ref6\n    ) {\n      var root = _ref6.root,\n        action = _ref6.action;\n      root.ref.buttonAbortItemLoad.label = action.value;\n    },\n    DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL: function DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL(\n      _ref7\n    ) {\n      var root = _ref7.root,\n        action = _ref7.action;\n      root.ref.buttonAbortItemRemoval.label = action.value;\n    },\n    DID_REQUEST_ITEM_PROCESSING: function DID_REQUEST_ITEM_PROCESSING(_ref8) {\n      var root = _ref8.root;\n      root.ref.processProgressIndicator.spin = true;\n      root.ref.processProgressIndicator.progress = 0;\n    },\n    DID_START_ITEM_LOAD: function DID_START_ITEM_LOAD(_ref9) {\n      var root = _ref9.root;\n      root.ref.loadProgressIndicator.spin = true;\n      root.ref.loadProgressIndicator.progress = 0;\n    },\n    DID_START_ITEM_REMOVE: function DID_START_ITEM_REMOVE(_ref10) {\n      var root = _ref10.root;\n      root.ref.processProgressIndicator.spin = true;\n      root.ref.processProgressIndicator.progress = 0;\n    },\n    DID_UPDATE_ITEM_LOAD_PROGRESS: function DID_UPDATE_ITEM_LOAD_PROGRESS(\n      _ref11\n    ) {\n      var root = _ref11.root,\n        action = _ref11.action;\n      root.ref.loadProgressIndicator.spin = false;\n      root.ref.loadProgressIndicator.progress = action.progress;\n    },\n    DID_UPDATE_ITEM_PROCESS_PROGRESS: function DID_UPDATE_ITEM_PROCESS_PROGRESS(\n      _ref12\n    ) {\n      var root = _ref12.root,\n        action = _ref12.action;\n      root.ref.processProgressIndicator.spin = false;\n      root.ref.processProgressIndicator.progress = action.progress;\n    }\n  });\n\n  var file = createView({\n    create: create$4,\n    write: write$2,\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, { view: root }));\n    },\n    name: 'file'\n  });\n\n  /**\n   * Creates the file view\n   */\n  var create$5 = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n\n    // filename\n    root.ref.fileName = createElement$1('legend');\n    root.appendChild(root.ref.fileName);\n\n    // file appended\n    root.ref.file = root.appendChildView(\n      root.createChildView(file, { id: props.id })\n    );\n\n    // data has moved to data.js\n    root.ref.data = false;\n  };\n\n  /**\n   * Data storage\n   */\n  var didLoadItem = function didLoadItem(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props;\n    // updates the legend of the fieldset so screenreaders can better group buttons\n    text(\n      root.ref.fileName,\n      formatFilename(root.query('GET_ITEM_NAME', props.id))\n    );\n  };\n\n  var fileWrapper = createView({\n    create: create$5,\n    ignoreRect: true,\n    write: createRoute({\n      DID_LOAD_ITEM: didLoadItem\n    }),\n\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, { view: root }));\n    },\n    tag: 'fieldset',\n    name: 'file-wrapper'\n  });\n\n  var PANEL_SPRING_PROPS = { type: 'spring', damping: 0.6, mass: 7 };\n\n  var create$6 = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n    [\n      {\n        name: 'top'\n      },\n\n      {\n        name: 'center',\n        props: {\n          translateY: null,\n          scaleY: null\n        },\n\n        mixins: {\n          animations: {\n            scaleY: PANEL_SPRING_PROPS\n          },\n\n          styles: ['translateY', 'scaleY']\n        }\n      },\n\n      {\n        name: 'bottom',\n        props: {\n          translateY: null\n        },\n\n        mixins: {\n          animations: {\n            translateY: PANEL_SPRING_PROPS\n          },\n\n          styles: ['translateY']\n        }\n      }\n    ].forEach(function(section) {\n      createSection(root, section, props.name);\n    });\n\n    root.element.classList.add('filepond--' + props.name);\n\n    root.ref.scalable = null;\n  };\n\n  var createSection = function createSection(root, section, className) {\n    var viewConstructor = createView({\n      name: 'panel-' + section.name + ' filepond--' + className,\n      mixins: section.mixins,\n      ignoreRectUpdate: true\n    });\n\n    var view = root.createChildView(viewConstructor, section.props);\n\n    root.ref[section.name] = root.appendChildView(view);\n  };\n\n  var write$3 = function write(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props;\n\n    // update scalable state\n    if (root.ref.scalable === null || props.scalable !== root.ref.scalable) {\n      root.ref.scalable = isBoolean(props.scalable) ? props.scalable : true;\n      root.element.dataset.scalable = root.ref.scalable;\n    }\n\n    // no height, can't set\n    if (!props.height) return;\n\n    // get child rects\n    var topRect = root.ref.top.rect.element;\n    var bottomRect = root.ref.bottom.rect.element;\n\n    // make sure height never is smaller than bottom and top seciton heights combined (will probably never happen, but who knows)\n    var height = Math.max(topRect.height + bottomRect.height, props.height);\n\n    // offset center part\n    root.ref.center.translateY = topRect.height;\n\n    // scale center part\n    // use math ceil to prevent transparent lines because of rounding errors\n    root.ref.center.scaleY =\n      (height - topRect.height - bottomRect.height) / 100;\n\n    // offset bottom part\n    root.ref.bottom.translateY = height - bottomRect.height;\n  };\n\n  var panel = createView({\n    name: 'panel',\n    write: write$3,\n    create: create$6,\n    ignoreRect: true,\n    mixins: {\n      apis: ['height', 'scalable']\n    }\n  });\n\n  var createDragHelper = function createDragHelper(items) {\n    var itemIds = items.map(function(item) {\n      return item.id;\n    });\n    var prevIndex = undefined;\n    return {\n      setIndex: function setIndex(index) {\n        prevIndex = index;\n      },\n      getIndex: function getIndex() {\n        return prevIndex;\n      },\n      getItemIndex: function getItemIndex(item) {\n        return itemIds.indexOf(item.id);\n      }\n    };\n  };\n\n  var ITEM_TRANSLATE_SPRING = {\n    type: 'spring',\n    stiffness: 0.75,\n    damping: 0.45,\n    mass: 10\n  };\n\n  var ITEM_SCALE_SPRING = 'spring';\n\n  var StateMap = {\n    DID_START_ITEM_LOAD: 'busy',\n    DID_UPDATE_ITEM_LOAD_PROGRESS: 'loading',\n    DID_THROW_ITEM_INVALID: 'load-invalid',\n    DID_THROW_ITEM_LOAD_ERROR: 'load-error',\n    DID_LOAD_ITEM: 'idle',\n    DID_THROW_ITEM_REMOVE_ERROR: 'remove-error',\n    DID_START_ITEM_REMOVE: 'busy',\n    DID_START_ITEM_PROCESSING: 'busy processing',\n    DID_REQUEST_ITEM_PROCESSING: 'busy processing',\n    DID_UPDATE_ITEM_PROCESS_PROGRESS: 'processing',\n    DID_COMPLETE_ITEM_PROCESSING: 'processing-complete',\n    DID_THROW_ITEM_PROCESSING_ERROR: 'processing-error',\n    DID_THROW_ITEM_PROCESSING_REVERT_ERROR: 'processing-revert-error',\n    DID_ABORT_ITEM_PROCESSING: 'cancelled',\n    DID_REVERT_ITEM_PROCESSING: 'idle'\n  };\n\n  /**\n   * Creates the file view\n   */\n  var create$7 = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n\n    // select\n    root.ref.handleClick = function(e) {\n      return root.dispatch('DID_ACTIVATE_ITEM', { id: props.id });\n    };\n\n    // set id\n    root.element.id = 'filepond--item-' + props.id;\n    root.element.addEventListener('click', root.ref.handleClick);\n\n    // file view\n    root.ref.container = root.appendChildView(\n      root.createChildView(fileWrapper, { id: props.id })\n    );\n\n    // file panel\n    root.ref.panel = root.appendChildView(\n      root.createChildView(panel, { name: 'item-panel' })\n    );\n\n    // default start height\n    root.ref.panel.height = null;\n\n    // by default not marked for removal\n    props.markedForRemoval = false;\n\n    // if not allowed to reorder file items, exit here\n    if (!root.query('GET_ALLOW_REORDER')) return;\n\n    // set to idle so shows grab cursor\n    root.element.dataset.dragState = 'idle';\n\n    var grab = function grab(e) {\n      if (!e.isPrimary) return;\n\n      var removedActivateListener = false;\n\n      var origin = {\n        x: e.pageX,\n        y: e.pageY\n      };\n\n      props.dragOrigin = {\n        x: root.translateX,\n        y: root.translateY\n      };\n\n      props.dragCenter = {\n        x: e.offsetX,\n        y: e.offsetY\n      };\n\n      var dragState = createDragHelper(root.query('GET_ACTIVE_ITEMS'));\n\n      root.dispatch('DID_GRAB_ITEM', { id: props.id, dragState: dragState });\n\n      var drag = function drag(e) {\n        if (!e.isPrimary) return;\n\n        e.stopPropagation();\n        e.preventDefault();\n\n        props.dragOffset = {\n          x: e.pageX - origin.x,\n          y: e.pageY - origin.y\n        };\n\n        // if dragged stop listening to clicks, will re-add when done dragging\n        var dist =\n          props.dragOffset.x * props.dragOffset.x +\n          props.dragOffset.y * props.dragOffset.y;\n        if (dist > 16 && !removedActivateListener) {\n          removedActivateListener = true;\n          root.element.removeEventListener('click', root.ref.handleClick);\n        }\n\n        root.dispatch('DID_DRAG_ITEM', { id: props.id, dragState: dragState });\n      };\n\n      var drop = function drop(e) {\n        if (!e.isPrimary) return;\n\n        document.removeEventListener('pointermove', drag);\n        document.removeEventListener('pointerup', drop);\n\n        props.dragOffset = {\n          x: e.pageX - origin.x,\n          y: e.pageY - origin.y\n        };\n\n        root.dispatch('DID_DROP_ITEM', { id: props.id, dragState: dragState });\n\n        // start listening to clicks again\n        if (removedActivateListener) {\n          setTimeout(function() {\n            return root.element.addEventListener('click', root.ref.handleClick);\n          }, 0);\n        }\n      };\n\n      document.addEventListener('pointermove', drag);\n      document.addEventListener('pointerup', drop);\n    };\n\n    root.element.addEventListener('pointerdown', grab);\n  };\n\n  var route$1 = createRoute({\n    DID_UPDATE_PANEL_HEIGHT: function DID_UPDATE_PANEL_HEIGHT(_ref2) {\n      var root = _ref2.root,\n        action = _ref2.action;\n      root.height = action.height;\n    }\n  });\n\n  var write$4 = createRoute(\n    {\n      DID_GRAB_ITEM: function DID_GRAB_ITEM(_ref3) {\n        var root = _ref3.root,\n          props = _ref3.props;\n        props.dragOrigin = {\n          x: root.translateX,\n          y: root.translateY\n        };\n      },\n      DID_DRAG_ITEM: function DID_DRAG_ITEM(_ref4) {\n        var root = _ref4.root;\n        root.element.dataset.dragState = 'drag';\n      },\n      DID_DROP_ITEM: function DID_DROP_ITEM(_ref5) {\n        var root = _ref5.root,\n          props = _ref5.props;\n        props.dragOffset = null;\n        props.dragOrigin = null;\n        root.element.dataset.dragState = 'drop';\n      }\n    },\n    function(_ref6) {\n      var root = _ref6.root,\n        actions = _ref6.actions,\n        props = _ref6.props,\n        shouldOptimize = _ref6.shouldOptimize;\n\n      if (root.element.dataset.dragState === 'drop') {\n        if (root.scaleX <= 1) {\n          root.element.dataset.dragState = 'idle';\n        }\n      }\n\n      // select last state change action\n      var action = actions\n        .concat()\n        .filter(function(action) {\n          return /^DID_/.test(action.type);\n        })\n        .reverse()\n        .find(function(action) {\n          return StateMap[action.type];\n        });\n\n      // no need to set same state twice\n      if (action && action.type !== props.currentState) {\n        // set current state\n        props.currentState = action.type;\n\n        // set state\n        root.element.dataset.filepondItemState =\n          StateMap[props.currentState] || '';\n      }\n\n      // route actions\n      var aspectRatio =\n        root.query('GET_ITEM_PANEL_ASPECT_RATIO') ||\n        root.query('GET_PANEL_ASPECT_RATIO');\n      if (!aspectRatio) {\n        route$1({ root: root, actions: actions, props: props });\n        if (!root.height && root.ref.container.rect.element.height > 0) {\n          root.height = root.ref.container.rect.element.height;\n        }\n      } else if (!shouldOptimize) {\n        root.height = root.rect.element.width * aspectRatio;\n      }\n\n      // sync panel height with item height\n      if (shouldOptimize) {\n        root.ref.panel.height = null;\n      }\n\n      root.ref.panel.height = root.height;\n    }\n  );\n\n  var item = createView({\n    create: create$7,\n    write: write$4,\n    destroy: function destroy(_ref7) {\n      var root = _ref7.root,\n        props = _ref7.props;\n      root.element.removeEventListener('click', root.ref.handleClick);\n      root.dispatch('RELEASE_ITEM', { query: props.id });\n    },\n    tag: 'li',\n    name: 'item',\n    mixins: {\n      apis: [\n        'id',\n        'interactionMethod',\n        'markedForRemoval',\n        'spawnDate',\n        'dragCenter',\n        'dragOrigin',\n        'dragOffset'\n      ],\n      styles: [\n        'translateX',\n        'translateY',\n        'scaleX',\n        'scaleY',\n        'opacity',\n        'height'\n      ],\n\n      animations: {\n        scaleX: ITEM_SCALE_SPRING,\n        scaleY: ITEM_SCALE_SPRING,\n        translateX: ITEM_TRANSLATE_SPRING,\n        translateY: ITEM_TRANSLATE_SPRING,\n        opacity: { type: 'tween', duration: 150 }\n      }\n    }\n  });\n\n  var getItemIndexByPosition = function getItemIndexByPosition(\n    view,\n    children,\n    positionInView\n  ) {\n    if (!positionInView) return;\n\n    var horizontalSpace = view.rect.element.width;\n    // const children = view.childViews;\n    var l = children.length;\n    var last = null;\n\n    // -1, don't move items to accomodate (either add to top or bottom)\n    if (l === 0 || positionInView.top < children[0].rect.element.top) return -1;\n\n    // let's get the item width\n    var item = children[0];\n    var itemRect = item.rect.element;\n    var itemHorizontalMargin = itemRect.marginLeft + itemRect.marginRight;\n    var itemWidth = itemRect.width + itemHorizontalMargin;\n    var itemsPerRow = Math.round(horizontalSpace / itemWidth);\n\n    // stack\n    if (itemsPerRow === 1) {\n      for (var index = 0; index < l; index++) {\n        var child = children[index];\n        var childMid = child.rect.outer.top + child.rect.element.height * 0.5;\n        if (positionInView.top < childMid) {\n          return index;\n        }\n      }\n      return l;\n    }\n\n    // grid\n    var itemVerticalMargin = itemRect.marginTop + itemRect.marginBottom;\n    var itemHeight = itemRect.height + itemVerticalMargin;\n    for (var _index = 0; _index < l; _index++) {\n      var indexX = _index % itemsPerRow;\n      var indexY = Math.floor(_index / itemsPerRow);\n\n      var offsetX = indexX * itemWidth;\n      var offsetY = indexY * itemHeight;\n\n      var itemTop = offsetY - itemRect.marginTop;\n      var itemRight = offsetX + itemWidth;\n      var itemBottom = offsetY + itemHeight + itemRect.marginBottom;\n\n      if (positionInView.top < itemBottom && positionInView.top > itemTop) {\n        if (positionInView.left < itemRight) {\n          return _index;\n        } else if (_index !== l - 1) {\n          last = _index;\n        } else {\n          last = null;\n        }\n      }\n    }\n\n    if (last !== null) {\n      return last;\n    }\n\n    return l;\n  };\n\n  var dropAreaDimensions = {\n    height: 0,\n    width: 0,\n    get getHeight() {\n      return this.height;\n    },\n    set setHeight(val) {\n      if (this.height === 0 || val === 0) this.height = val;\n    },\n    get getWidth() {\n      return this.width;\n    },\n    set setWidth(val) {\n      if (this.width === 0 || val === 0) this.width = val;\n    },\n    setDimensions: function setDimensions(height, width) {\n      if (this.height === 0 || height === 0) this.height = height;\n      if (this.width === 0 || width === 0) this.width = width;\n    }\n  };\n\n  var create$8 = function create(_ref) {\n    var root = _ref.root;\n    // need to set role to list as otherwise it won't be read as a list by VoiceOver\n    attr(root.element, 'role', 'list');\n\n    root.ref.lastItemSpanwDate = Date.now();\n  };\n\n  /**\n   * Inserts a new item\n   * @param root\n   * @param action\n   */\n  var addItemView = function addItemView(_ref2) {\n    var root = _ref2.root,\n      action = _ref2.action;\n    var id = action.id,\n      index = action.index,\n      interactionMethod = action.interactionMethod;\n\n    root.ref.addIndex = index;\n\n    var now = Date.now();\n    var spawnDate = now;\n    var opacity = 1;\n\n    if (interactionMethod !== InteractionMethod.NONE) {\n      opacity = 0;\n      var cooldown = root.query('GET_ITEM_INSERT_INTERVAL');\n      var dist = now - root.ref.lastItemSpanwDate;\n      spawnDate = dist < cooldown ? now + (cooldown - dist) : now;\n    }\n\n    root.ref.lastItemSpanwDate = spawnDate;\n\n    root.appendChildView(\n      root.createChildView(\n        // view type\n        item,\n\n        // props\n        {\n          spawnDate: spawnDate,\n          id: id,\n          opacity: opacity,\n          interactionMethod: interactionMethod\n        }\n      ),\n\n      index\n    );\n  };\n\n  var moveItem = function moveItem(item, x, y) {\n    var vx =\n      arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n    var vy =\n      arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 1;\n\n    // set to null to remove animation while dragging\n    if (item.dragOffset) {\n      item.translateX = null;\n      item.translateY = null;\n      item.translateX = item.dragOrigin.x + item.dragOffset.x;\n      item.translateY = item.dragOrigin.y + item.dragOffset.y;\n      item.scaleX = 1.025;\n      item.scaleY = 1.025;\n    } else {\n      item.translateX = x;\n      item.translateY = y;\n\n      if (Date.now() > item.spawnDate) {\n        // reveal element\n        if (item.opacity === 0) {\n          introItemView(item, x, y, vx, vy);\n        }\n\n        // make sure is default scale every frame\n        item.scaleX = 1;\n        item.scaleY = 1;\n        item.opacity = 1;\n      }\n    }\n  };\n\n  var introItemView = function introItemView(item, x, y, vx, vy) {\n    if (item.interactionMethod === InteractionMethod.NONE) {\n      item.translateX = null;\n      item.translateX = x;\n      item.translateY = null;\n      item.translateY = y;\n    } else if (item.interactionMethod === InteractionMethod.DROP) {\n      item.translateX = null;\n      item.translateX = x - vx * 20;\n\n      item.translateY = null;\n      item.translateY = y - vy * 10;\n\n      item.scaleX = 0.8;\n      item.scaleY = 0.8;\n    } else if (item.interactionMethod === InteractionMethod.BROWSE) {\n      item.translateY = null;\n      item.translateY = y - 30;\n    } else if (item.interactionMethod === InteractionMethod.API) {\n      item.translateX = null;\n      item.translateX = x - 30;\n      item.translateY = null;\n    }\n  };\n\n  /**\n   * Removes an existing item\n   * @param root\n   * @param action\n   */\n  var removeItemView = function removeItemView(_ref3) {\n    var root = _ref3.root,\n      action = _ref3.action;\n    var id = action.id;\n\n    // get the view matching the given id\n    var view = root.childViews.find(function(child) {\n      return child.id === id;\n    });\n\n    // if no view found, exit\n    if (!view) {\n      return;\n    }\n\n    // animate view out of view\n    view.scaleX = 0.9;\n    view.scaleY = 0.9;\n    view.opacity = 0;\n\n    // mark for removal\n    view.markedForRemoval = true;\n  };\n\n  var getItemHeight = function getItemHeight(child) {\n    return (\n      child.rect.element.height +\n      child.rect.element.marginBottom * 0.5 +\n      child.rect.element.marginTop * 0.5\n    );\n  };\n  var getItemWidth = function getItemWidth(child) {\n    return (\n      child.rect.element.width +\n      child.rect.element.marginLeft * 0.5 +\n      child.rect.element.marginRight * 0.5\n    );\n  };\n\n  var dragItem = function dragItem(_ref4) {\n    var root = _ref4.root,\n      action = _ref4.action;\n    var id = action.id,\n      dragState = action.dragState;\n\n    // reference to item\n    var item = root.query('GET_ITEM', { id: id });\n\n    // get the view matching the given id\n    var view = root.childViews.find(function(child) {\n      return child.id === id;\n    });\n\n    var numItems = root.childViews.length;\n    var oldIndex = dragState.getItemIndex(item);\n\n    // if no view found, exit\n    if (!view) return;\n\n    var dragPosition = {\n      x: view.dragOrigin.x + view.dragOffset.x + view.dragCenter.x,\n      y: view.dragOrigin.y + view.dragOffset.y + view.dragCenter.y\n\n      // get drag area dimensions\n    };\n    var dragHeight = getItemHeight(view);\n    var dragWidth = getItemWidth(view);\n\n    // get rows and columns (There will always be at least one row and one column if a file is present)\n    var cols = Math.floor(root.rect.outer.width / dragWidth);\n    if (cols > numItems) cols = numItems;\n\n    // rows are used to find when we have left the preview area bounding box\n    var rows = Math.floor(numItems / cols + 1);\n\n    dropAreaDimensions.setHeight = dragHeight * rows;\n    dropAreaDimensions.setWidth = dragWidth * cols;\n\n    // get new index of dragged item\n    var location = {\n      y: Math.floor(dragPosition.y / dragHeight),\n      x: Math.floor(dragPosition.x / dragWidth),\n      getGridIndex: function getGridIndex() {\n        if (\n          dragPosition.y > dropAreaDimensions.getHeight ||\n          dragPosition.y < 0 ||\n          dragPosition.x > dropAreaDimensions.getWidth ||\n          dragPosition.x < 0\n        )\n          return oldIndex;\n        return this.y * cols + this.x;\n      },\n      getColIndex: function getColIndex() {\n        var items = root.query('GET_ACTIVE_ITEMS');\n        var visibleChildren = root.childViews.filter(function(child) {\n          return child.rect.element.height;\n        });\n        var children = items.map(function(item) {\n          return visibleChildren.find(function(childView) {\n            return childView.id === item.id;\n          });\n        });\n        var currentIndex = children.findIndex(function(child) {\n          return child === view;\n        });\n        var dragHeight = getItemHeight(view);\n        var l = children.length;\n        var idx = l;\n        var childHeight = 0;\n        var childBottom = 0;\n        var childTop = 0;\n        for (var i = 0; i < l; i++) {\n          childHeight = getItemHeight(children[i]);\n          childTop = childBottom;\n          childBottom = childTop + childHeight;\n          if (dragPosition.y < childBottom) {\n            if (currentIndex > i) {\n              if (dragPosition.y < childTop + dragHeight) {\n                idx = i;\n                break;\n              }\n              continue;\n            }\n            idx = i;\n            break;\n          }\n        }\n        return idx;\n      }\n\n      // get new index\n    };\n    var index = cols > 1 ? location.getGridIndex() : location.getColIndex();\n    root.dispatch('MOVE_ITEM', { query: view, index: index });\n\n    // if the index of the item changed, dispatch reorder action\n    var currentIndex = dragState.getIndex();\n\n    if (currentIndex === undefined || currentIndex !== index) {\n      dragState.setIndex(index);\n\n      if (currentIndex === undefined) return;\n\n      root.dispatch('DID_REORDER_ITEMS', {\n        items: root.query('GET_ACTIVE_ITEMS'),\n        origin: oldIndex,\n        target: index\n      });\n    }\n  };\n\n  /**\n   * Setup action routes\n   */\n  var route$2 = createRoute({\n    DID_ADD_ITEM: addItemView,\n    DID_REMOVE_ITEM: removeItemView,\n    DID_DRAG_ITEM: dragItem\n  });\n\n  /**\n   * Write to view\n   * @param root\n   * @param actions\n   * @param props\n   */\n  var write$5 = function write(_ref5) {\n    var root = _ref5.root,\n      props = _ref5.props,\n      actions = _ref5.actions,\n      shouldOptimize = _ref5.shouldOptimize;\n\n    // route actions\n    route$2({ root: root, props: props, actions: actions });\n    var dragCoordinates = props.dragCoordinates;\n\n    // available space on horizontal axis\n    var horizontalSpace = root.rect.element.width;\n\n    // only draw children that have dimensions\n    var visibleChildren = root.childViews.filter(function(child) {\n      return child.rect.element.height;\n    });\n\n    // sort based on current active items\n    var children = root\n      .query('GET_ACTIVE_ITEMS')\n      .map(function(item) {\n        return visibleChildren.find(function(child) {\n          return child.id === item.id;\n        });\n      })\n      .filter(function(item) {\n        return item;\n      });\n\n    // get index\n    var dragIndex = dragCoordinates\n      ? getItemIndexByPosition(root, children, dragCoordinates)\n      : null;\n\n    // add index is used to reserve the dropped/added item index till the actual item is rendered\n    var addIndex = root.ref.addIndex || null;\n\n    // add index no longer needed till possibly next draw\n    root.ref.addIndex = null;\n\n    var dragIndexOffset = 0;\n    var removeIndexOffset = 0;\n    var addIndexOffset = 0;\n\n    if (children.length === 0) return;\n\n    var childRect = children[0].rect.element;\n    var itemVerticalMargin = childRect.marginTop + childRect.marginBottom;\n    var itemHorizontalMargin = childRect.marginLeft + childRect.marginRight;\n    var itemWidth = childRect.width + itemHorizontalMargin;\n    var itemHeight = childRect.height + itemVerticalMargin;\n    var itemsPerRow = Math.round(horizontalSpace / itemWidth);\n\n    // stack\n    if (itemsPerRow === 1) {\n      var offsetY = 0;\n      var dragOffset = 0;\n\n      children.forEach(function(child, index) {\n        if (dragIndex) {\n          var dist = index - dragIndex;\n          if (dist === -2) {\n            dragOffset = -itemVerticalMargin * 0.25;\n          } else if (dist === -1) {\n            dragOffset = -itemVerticalMargin * 0.75;\n          } else if (dist === 0) {\n            dragOffset = itemVerticalMargin * 0.75;\n          } else if (dist === 1) {\n            dragOffset = itemVerticalMargin * 0.25;\n          } else {\n            dragOffset = 0;\n          }\n        }\n\n        if (shouldOptimize) {\n          child.translateX = null;\n          child.translateY = null;\n        }\n\n        if (!child.markedForRemoval) {\n          moveItem(child, 0, offsetY + dragOffset);\n        }\n\n        var itemHeight = child.rect.element.height + itemVerticalMargin;\n\n        var visualHeight =\n          itemHeight * (child.markedForRemoval ? child.opacity : 1);\n\n        offsetY += visualHeight;\n      });\n    }\n    // grid\n    else {\n      var prevX = 0;\n      var prevY = 0;\n\n      children.forEach(function(child, index) {\n        if (index === dragIndex) {\n          dragIndexOffset = 1;\n        }\n\n        if (index === addIndex) {\n          addIndexOffset += 1;\n        }\n\n        if (child.markedForRemoval && child.opacity < 0.5) {\n          removeIndexOffset -= 1;\n        }\n\n        var visualIndex =\n          index + addIndexOffset + dragIndexOffset + removeIndexOffset;\n\n        var indexX = visualIndex % itemsPerRow;\n        var indexY = Math.floor(visualIndex / itemsPerRow);\n\n        var offsetX = indexX * itemWidth;\n        var offsetY = indexY * itemHeight;\n\n        var vectorX = Math.sign(offsetX - prevX);\n        var vectorY = Math.sign(offsetY - prevY);\n\n        prevX = offsetX;\n        prevY = offsetY;\n\n        if (child.markedForRemoval) return;\n\n        if (shouldOptimize) {\n          child.translateX = null;\n          child.translateY = null;\n        }\n\n        moveItem(child, offsetX, offsetY, vectorX, vectorY);\n      });\n    }\n  };\n\n  /**\n   * Filters actions that are meant specifically for a certain child of the list\n   * @param child\n   * @param actions\n   */\n  var filterSetItemActions = function filterSetItemActions(child, actions) {\n    return actions.filter(function(action) {\n      // if action has an id, filter out actions that don't have this child id\n      if (action.data && action.data.id) {\n        return child.id === action.data.id;\n      }\n\n      // allow all other actions\n      return true;\n    });\n  };\n\n  var list = createView({\n    create: create$8,\n    write: write$5,\n    tag: 'ul',\n    name: 'list',\n    didWriteView: function didWriteView(_ref6) {\n      var root = _ref6.root;\n      root.childViews\n        .filter(function(view) {\n          return view.markedForRemoval && view.opacity === 0 && view.resting;\n        })\n        .forEach(function(view) {\n          view._destroy();\n          root.removeChildView(view);\n        });\n    },\n    filterFrameActionsForChild: filterSetItemActions,\n    mixins: {\n      apis: ['dragCoordinates']\n    }\n  });\n\n  var create$9 = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n    root.ref.list = root.appendChildView(root.createChildView(list));\n    props.dragCoordinates = null;\n    props.overflowing = false;\n  };\n\n  var storeDragCoordinates = function storeDragCoordinates(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props,\n      action = _ref2.action;\n    if (!root.query('GET_ITEM_INSERT_LOCATION_FREEDOM')) return;\n    props.dragCoordinates = {\n      left: action.position.scopeLeft - root.ref.list.rect.element.left,\n      top:\n        action.position.scopeTop -\n        (root.rect.outer.top +\n          root.rect.element.marginTop +\n          root.rect.element.scrollTop)\n    };\n  };\n\n  var clearDragCoordinates = function clearDragCoordinates(_ref3) {\n    var props = _ref3.props;\n    props.dragCoordinates = null;\n  };\n\n  var route$3 = createRoute({\n    DID_DRAG: storeDragCoordinates,\n    DID_END_DRAG: clearDragCoordinates\n  });\n\n  var write$6 = function write(_ref4) {\n    var root = _ref4.root,\n      props = _ref4.props,\n      actions = _ref4.actions;\n\n    // route actions\n    route$3({ root: root, props: props, actions: actions });\n\n    // current drag position\n    root.ref.list.dragCoordinates = props.dragCoordinates;\n\n    // if currently overflowing but no longer received overflow\n    if (props.overflowing && !props.overflow) {\n      props.overflowing = false;\n\n      // reset overflow state\n      root.element.dataset.state = '';\n      root.height = null;\n    }\n\n    // if is not overflowing currently but does receive overflow value\n    if (props.overflow) {\n      var newHeight = Math.round(props.overflow);\n      if (newHeight !== root.height) {\n        props.overflowing = true;\n        root.element.dataset.state = 'overflow';\n        root.height = newHeight;\n      }\n    }\n  };\n\n  var listScroller = createView({\n    create: create$9,\n    write: write$6,\n    name: 'list-scroller',\n    mixins: {\n      apis: ['overflow', 'dragCoordinates'],\n      styles: ['height', 'translateY'],\n      animations: {\n        translateY: 'spring'\n      }\n    }\n  });\n\n  var attrToggle = function attrToggle(element, name, state) {\n    var enabledValue =\n      arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '';\n    if (state) {\n      attr(element, name, enabledValue);\n    } else {\n      element.removeAttribute(name);\n    }\n  };\n\n  var resetFileInput = function resetFileInput(input) {\n    // no value, no need to reset\n    if (!input || input.value === '') {\n      return;\n    }\n\n    try {\n      // for modern browsers\n      input.value = '';\n    } catch (err) {}\n\n    // for IE10\n    if (input.value) {\n      // quickly append input to temp form and reset form\n      var form = createElement$1('form');\n      var parentNode = input.parentNode;\n      var ref = input.nextSibling;\n      form.appendChild(input);\n      form.reset();\n\n      // re-inject input where it originally was\n      if (ref) {\n        parentNode.insertBefore(input, ref);\n      } else {\n        parentNode.appendChild(input);\n      }\n    }\n  };\n\n  var create$a = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n\n    // set id so can be referenced from outside labels\n    root.element.id = 'filepond--browser-' + props.id;\n\n    // set name of element (is removed when a value is set)\n    attr(root.element, 'name', root.query('GET_NAME'));\n\n    // we have to link this element to the status element\n    attr(root.element, 'aria-controls', 'filepond--assistant-' + props.id);\n\n    // set label, we use labelled by as otherwise the screenreader does not read the \"browse\" text in the label (as it has tabindex: 0)\n    attr(root.element, 'aria-labelledby', 'filepond--drop-label-' + props.id);\n\n    // set configurable props\n    setAcceptedFileTypes({\n      root: root,\n      action: { value: root.query('GET_ACCEPTED_FILE_TYPES') }\n    });\n    toggleAllowMultiple({\n      root: root,\n      action: { value: root.query('GET_ALLOW_MULTIPLE') }\n    });\n    toggleDirectoryFilter({\n      root: root,\n      action: { value: root.query('GET_ALLOW_DIRECTORIES_ONLY') }\n    });\n    toggleDisabled({ root: root });\n    toggleRequired({\n      root: root,\n      action: { value: root.query('GET_REQUIRED') }\n    });\n    setCaptureMethod({\n      root: root,\n      action: { value: root.query('GET_CAPTURE_METHOD') }\n    });\n\n    // handle changes to the input field\n    root.ref.handleChange = function(e) {\n      if (!root.element.value) {\n        return;\n      }\n\n      // extract files and move value of webkitRelativePath path to _relativePath\n      var files = Array.from(root.element.files).map(function(file) {\n        file._relativePath = file.webkitRelativePath;\n        return file;\n      });\n\n      // we add a little delay so the OS file select window can move out of the way before we add our file\n      setTimeout(function() {\n        // load files\n        props.onload(files);\n\n        // reset input, it's just for exposing a method to drop files, should not retain any state\n        resetFileInput(root.element);\n      }, 250);\n    };\n\n    root.element.addEventListener('change', root.ref.handleChange);\n  };\n\n  var setAcceptedFileTypes = function setAcceptedFileTypes(_ref2) {\n    var root = _ref2.root,\n      action = _ref2.action;\n    if (!root.query('GET_ALLOW_SYNC_ACCEPT_ATTRIBUTE')) return;\n    attrToggle(\n      root.element,\n      'accept',\n      !!action.value,\n      action.value ? action.value.join(',') : ''\n    );\n  };\n\n  var toggleAllowMultiple = function toggleAllowMultiple(_ref3) {\n    var root = _ref3.root,\n      action = _ref3.action;\n    attrToggle(root.element, 'multiple', action.value);\n  };\n\n  var toggleDirectoryFilter = function toggleDirectoryFilter(_ref4) {\n    var root = _ref4.root,\n      action = _ref4.action;\n    attrToggle(root.element, 'webkitdirectory', action.value);\n  };\n\n  var toggleDisabled = function toggleDisabled(_ref5) {\n    var root = _ref5.root;\n    var isDisabled = root.query('GET_DISABLED');\n    var doesAllowBrowse = root.query('GET_ALLOW_BROWSE');\n    var disableField = isDisabled || !doesAllowBrowse;\n    attrToggle(root.element, 'disabled', disableField);\n  };\n\n  var toggleRequired = function toggleRequired(_ref6) {\n    var root = _ref6.root,\n      action = _ref6.action;\n    // want to remove required, always possible\n    if (!action.value) {\n      attrToggle(root.element, 'required', false);\n    }\n    // if want to make required, only possible when zero items\n    else if (root.query('GET_TOTAL_ITEMS') === 0) {\n      attrToggle(root.element, 'required', true);\n    }\n  };\n\n  var setCaptureMethod = function setCaptureMethod(_ref7) {\n    var root = _ref7.root,\n      action = _ref7.action;\n    attrToggle(\n      root.element,\n      'capture',\n      !!action.value,\n      action.value === true ? '' : action.value\n    );\n  };\n\n  var updateRequiredStatus = function updateRequiredStatus(_ref8) {\n    var root = _ref8.root;\n    var element = root.element;\n    // always remove the required attribute when more than zero items\n    if (root.query('GET_TOTAL_ITEMS') > 0) {\n      attrToggle(element, 'required', false);\n      attrToggle(element, 'name', false);\n    } else {\n      // add name attribute\n      attrToggle(element, 'name', true, root.query('GET_NAME'));\n\n      // remove any validation messages\n      var shouldCheckValidity = root.query('GET_CHECK_VALIDITY');\n      if (shouldCheckValidity) {\n        element.setCustomValidity('');\n      }\n\n      // we only add required if the field has been deemed required\n      if (root.query('GET_REQUIRED')) {\n        attrToggle(element, 'required', true);\n      }\n    }\n  };\n\n  var updateFieldValidityStatus = function updateFieldValidityStatus(_ref9) {\n    var root = _ref9.root;\n    var shouldCheckValidity = root.query('GET_CHECK_VALIDITY');\n    if (!shouldCheckValidity) return;\n    root.element.setCustomValidity(root.query('GET_LABEL_INVALID_FIELD'));\n  };\n\n  var browser = createView({\n    tag: 'input',\n    name: 'browser',\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    attributes: {\n      type: 'file'\n    },\n\n    create: create$a,\n    destroy: function destroy(_ref10) {\n      var root = _ref10.root;\n      root.element.removeEventListener('change', root.ref.handleChange);\n    },\n    write: createRoute({\n      DID_LOAD_ITEM: updateRequiredStatus,\n      DID_REMOVE_ITEM: updateRequiredStatus,\n      DID_THROW_ITEM_INVALID: updateFieldValidityStatus,\n\n      DID_SET_DISABLED: toggleDisabled,\n      DID_SET_ALLOW_BROWSE: toggleDisabled,\n      DID_SET_ALLOW_DIRECTORIES_ONLY: toggleDirectoryFilter,\n      DID_SET_ALLOW_MULTIPLE: toggleAllowMultiple,\n      DID_SET_ACCEPTED_FILE_TYPES: setAcceptedFileTypes,\n      DID_SET_CAPTURE_METHOD: setCaptureMethod,\n      DID_SET_REQUIRED: toggleRequired\n    })\n  });\n\n  var Key = {\n    ENTER: 13,\n    SPACE: 32\n  };\n\n  var create$b = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n\n    // create the label and link it to the file browser\n    var label = createElement$1('label');\n    attr(label, 'for', 'filepond--browser-' + props.id);\n\n    // use for labeling file input (aria-labelledby on file input)\n    attr(label, 'id', 'filepond--drop-label-' + props.id);\n\n    // hide the label for screenreaders, the input element will read the contents of the label when it's focussed. If we don't set aria-hidden the screenreader will also navigate the contents of the label separately from the input.\n    attr(label, 'aria-hidden', 'true');\n\n    // handle keys\n    root.ref.handleKeyDown = function(e) {\n      var isActivationKey = e.keyCode === Key.ENTER || e.keyCode === Key.SPACE;\n      if (!isActivationKey) return;\n      // stops from triggering the element a second time\n      e.preventDefault();\n\n      // click link (will then in turn activate file input)\n      root.ref.label.click();\n    };\n\n    root.ref.handleClick = function(e) {\n      var isLabelClick = e.target === label || label.contains(e.target);\n\n      // don't want to click twice\n      if (isLabelClick) return;\n\n      // click link (will then in turn activate file input)\n      root.ref.label.click();\n    };\n\n    // attach events\n    label.addEventListener('keydown', root.ref.handleKeyDown);\n    root.element.addEventListener('click', root.ref.handleClick);\n\n    // update\n    updateLabelValue(label, props.caption);\n\n    // add!\n    root.appendChild(label);\n    root.ref.label = label;\n  };\n\n  var updateLabelValue = function updateLabelValue(label, value) {\n    label.innerHTML = value;\n    var clickable = label.querySelector('.filepond--label-action');\n    if (clickable) {\n      attr(clickable, 'tabindex', '0');\n    }\n    return value;\n  };\n\n  var dropLabel = createView({\n    name: 'drop-label',\n    ignoreRect: true,\n    create: create$b,\n    destroy: function destroy(_ref2) {\n      var root = _ref2.root;\n      root.ref.label.addEventListener('keydown', root.ref.handleKeyDown);\n      root.element.removeEventListener('click', root.ref.handleClick);\n    },\n    write: createRoute({\n      DID_SET_LABEL_IDLE: function DID_SET_LABEL_IDLE(_ref3) {\n        var root = _ref3.root,\n          action = _ref3.action;\n        updateLabelValue(root.ref.label, action.value);\n      }\n    }),\n\n    mixins: {\n      styles: ['opacity', 'translateX', 'translateY'],\n      animations: {\n        opacity: { type: 'tween', duration: 150 },\n        translateX: 'spring',\n        translateY: 'spring'\n      }\n    }\n  });\n\n  var blob = createView({\n    name: 'drip-blob',\n    ignoreRect: true,\n    mixins: {\n      styles: ['translateX', 'translateY', 'scaleX', 'scaleY', 'opacity'],\n      animations: {\n        scaleX: 'spring',\n        scaleY: 'spring',\n        translateX: 'spring',\n        translateY: 'spring',\n        opacity: { type: 'tween', duration: 250 }\n      }\n    }\n  });\n\n  var addBlob = function addBlob(_ref) {\n    var root = _ref.root;\n    var centerX = root.rect.element.width * 0.5;\n    var centerY = root.rect.element.height * 0.5;\n\n    root.ref.blob = root.appendChildView(\n      root.createChildView(blob, {\n        opacity: 0,\n        scaleX: 2.5,\n        scaleY: 2.5,\n        translateX: centerX,\n        translateY: centerY\n      })\n    );\n  };\n\n  var moveBlob = function moveBlob(_ref2) {\n    var root = _ref2.root,\n      action = _ref2.action;\n    if (!root.ref.blob) {\n      addBlob({ root: root });\n      return;\n    }\n\n    root.ref.blob.translateX = action.position.scopeLeft;\n    root.ref.blob.translateY = action.position.scopeTop;\n    root.ref.blob.scaleX = 1;\n    root.ref.blob.scaleY = 1;\n    root.ref.blob.opacity = 1;\n  };\n\n  var hideBlob = function hideBlob(_ref3) {\n    var root = _ref3.root;\n    if (!root.ref.blob) {\n      return;\n    }\n    root.ref.blob.opacity = 0;\n  };\n\n  var explodeBlob = function explodeBlob(_ref4) {\n    var root = _ref4.root;\n    if (!root.ref.blob) {\n      return;\n    }\n    root.ref.blob.scaleX = 2.5;\n    root.ref.blob.scaleY = 2.5;\n    root.ref.blob.opacity = 0;\n  };\n\n  var write$7 = function write(_ref5) {\n    var root = _ref5.root,\n      props = _ref5.props,\n      actions = _ref5.actions;\n    route$4({ root: root, props: props, actions: actions });\n    var blob = root.ref.blob;\n\n    if (actions.length === 0 && blob && blob.opacity === 0) {\n      root.removeChildView(blob);\n      root.ref.blob = null;\n    }\n  };\n\n  var route$4 = createRoute({\n    DID_DRAG: moveBlob,\n    DID_DROP: explodeBlob,\n    DID_END_DRAG: hideBlob\n  });\n\n  var drip = createView({\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    name: 'drip',\n    write: write$7\n  });\n\n  var create$c = function create(_ref) {\n    var root = _ref.root;\n    return (root.ref.fields = {});\n  };\n\n  var getField = function getField(root, id) {\n    return root.ref.fields[id];\n  };\n\n  var syncFieldPositionsWithItems = function syncFieldPositionsWithItems(root) {\n    root.query('GET_ACTIVE_ITEMS').forEach(function(item) {\n      if (!root.ref.fields[item.id]) return;\n      root.element.appendChild(root.ref.fields[item.id]);\n    });\n  };\n\n  var didReorderItems = function didReorderItems(_ref2) {\n    var root = _ref2.root;\n    return syncFieldPositionsWithItems(root);\n  };\n\n  var didAddItem = function didAddItem(_ref3) {\n    var root = _ref3.root,\n      action = _ref3.action;\n    var dataContainer = createElement$1('input');\n    dataContainer.type = 'hidden';\n    dataContainer.name = root.query('GET_NAME');\n    dataContainer.disabled = root.query('GET_DISABLED');\n    root.ref.fields[action.id] = dataContainer;\n    syncFieldPositionsWithItems(root);\n  };\n\n  var didLoadItem$1 = function didLoadItem(_ref4) {\n    var root = _ref4.root,\n      action = _ref4.action;\n    var field = getField(root, action.id);\n    if (!field || action.serverFileReference === null) return;\n    field.value = action.serverFileReference;\n  };\n\n  var didSetDisabled = function didSetDisabled(_ref5) {\n    var root = _ref5.root;\n    root.element.disabled = root.query('GET_DISABLED');\n  };\n\n  var didRemoveItem = function didRemoveItem(_ref6) {\n    var root = _ref6.root,\n      action = _ref6.action;\n    var field = getField(root, action.id);\n    if (!field) return;\n    field.parentNode.removeChild(field);\n    delete root.ref.fields[action.id];\n  };\n\n  var didDefineValue = function didDefineValue(_ref7) {\n    var root = _ref7.root,\n      action = _ref7.action;\n    var field = getField(root, action.id);\n    if (!field) return;\n    if (action.value === null) {\n      field.removeAttribute('value');\n    } else {\n      field.value = action.value;\n    }\n    syncFieldPositionsWithItems(root);\n  };\n\n  var write$8 = createRoute({\n    DID_SET_DISABLED: didSetDisabled,\n    DID_ADD_ITEM: didAddItem,\n    DID_LOAD_ITEM: didLoadItem$1,\n    DID_REMOVE_ITEM: didRemoveItem,\n    DID_DEFINE_VALUE: didDefineValue,\n    DID_REORDER_ITEMS: didReorderItems,\n    DID_SORT_ITEMS: didReorderItems\n  });\n\n  var data = createView({\n    tag: 'fieldset',\n    name: 'data',\n    create: create$c,\n    write: write$8,\n    ignoreRect: true\n  });\n\n  var getRootNode = function getRootNode(element) {\n    return 'getRootNode' in element ? element.getRootNode() : document;\n  };\n\n  var images = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg', 'tiff'];\n  var text$1 = ['css', 'csv', 'html', 'txt'];\n  var map = {\n    zip: 'zip|compressed',\n    epub: 'application/epub+zip'\n  };\n\n  var guesstimateMimeType = function guesstimateMimeType() {\n    var extension =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    extension = extension.toLowerCase();\n    if (images.includes(extension)) {\n      return (\n        'image/' +\n        (extension === 'jpg'\n          ? 'jpeg'\n          : extension === 'svg'\n          ? 'svg+xml'\n          : extension)\n      );\n    }\n    if (text$1.includes(extension)) {\n      return 'text/' + extension;\n    }\n\n    return map[extension] || '';\n  };\n\n  var requestDataTransferItems = function requestDataTransferItems(\n    dataTransfer\n  ) {\n    return new Promise(function(resolve, reject) {\n      // try to get links from transfer, if found we'll exit immidiately (unless a file is in the dataTransfer as well, this is because Firefox could represent the file as a URL and a file object at the same time)\n      var links = getLinks(dataTransfer);\n      if (links.length && !hasFiles(dataTransfer)) {\n        return resolve(links);\n      }\n      // try to get files from the transfer\n      getFiles(dataTransfer).then(resolve);\n    });\n  };\n\n  /**\n   * Test if datatransfer has files\n   */\n  var hasFiles = function hasFiles(dataTransfer) {\n    if (dataTransfer.files) return dataTransfer.files.length > 0;\n    return false;\n  };\n\n  /**\n   * Extracts files from a DataTransfer object\n   */\n  var getFiles = function getFiles(dataTransfer) {\n    return new Promise(function(resolve, reject) {\n      // get the transfer items as promises\n      var promisedFiles = (dataTransfer.items\n        ? Array.from(dataTransfer.items)\n        : []\n      )\n        // only keep file system items (files and directories)\n        .filter(function(item) {\n          return isFileSystemItem(item);\n        })\n\n        // map each item to promise\n        .map(function(item) {\n          return getFilesFromItem(item);\n        });\n\n      // if is empty, see if we can extract some info from the files property as a fallback\n      if (!promisedFiles.length) {\n        // TODO: test for directories (should not be allowed)\n        // Use FileReader, problem is that the files property gets lost in the process\n        resolve(dataTransfer.files ? Array.from(dataTransfer.files) : []);\n        return;\n      }\n\n      // done!\n      Promise.all(promisedFiles)\n        .then(function(returnedFileGroups) {\n          // flatten groups\n          var files = [];\n          returnedFileGroups.forEach(function(group) {\n            files.push.apply(files, group);\n          });\n\n          // done (filter out empty files)!\n          resolve(\n            files\n              .filter(function(file) {\n                return file;\n              })\n              .map(function(file) {\n                if (!file._relativePath)\n                  file._relativePath = file.webkitRelativePath;\n                return file;\n              })\n          );\n        })\n        .catch(console.error);\n    });\n  };\n\n  var isFileSystemItem = function isFileSystemItem(item) {\n    if (isEntry(item)) {\n      var entry = getAsEntry(item);\n      if (entry) {\n        return entry.isFile || entry.isDirectory;\n      }\n    }\n    return item.kind === 'file';\n  };\n\n  var getFilesFromItem = function getFilesFromItem(item) {\n    return new Promise(function(resolve, reject) {\n      if (isDirectoryEntry(item)) {\n        getFilesInDirectory(getAsEntry(item))\n          .then(resolve)\n          .catch(reject);\n        return;\n      }\n\n      resolve([item.getAsFile()]);\n    });\n  };\n\n  var getFilesInDirectory = function getFilesInDirectory(entry) {\n    return new Promise(function(resolve, reject) {\n      var files = [];\n\n      // the total entries to read\n      var dirCounter = 0;\n      var fileCounter = 0;\n\n      var resolveIfDone = function resolveIfDone() {\n        if (fileCounter === 0 && dirCounter === 0) {\n          resolve(files);\n        }\n      };\n\n      // the recursive function\n      var readEntries = function readEntries(dirEntry) {\n        dirCounter++;\n\n        var directoryReader = dirEntry.createReader();\n\n        // directories are returned in batches, we need to process all batches before we're done\n        var readBatch = function readBatch() {\n          directoryReader.readEntries(function(entries) {\n            if (entries.length === 0) {\n              dirCounter--;\n              resolveIfDone();\n              return;\n            }\n\n            entries.forEach(function(entry) {\n              // recursively read more directories\n              if (entry.isDirectory) {\n                readEntries(entry);\n              } else {\n                // read as file\n                fileCounter++;\n\n                entry.file(function(file) {\n                  var correctedFile = correctMissingFileType(file);\n                  if (entry.fullPath)\n                    correctedFile._relativePath = entry.fullPath;\n                  files.push(correctedFile);\n                  fileCounter--;\n                  resolveIfDone();\n                });\n              }\n            });\n\n            // try to get next batch of files\n            readBatch();\n          }, reject);\n        };\n\n        // read first batch of files\n        readBatch();\n      };\n\n      // go!\n      readEntries(entry);\n    });\n  };\n\n  var correctMissingFileType = function correctMissingFileType(file) {\n    if (file.type.length) return file;\n    var date = file.lastModifiedDate;\n    var name = file.name;\n    file = file.slice(\n      0,\n      file.size,\n      guesstimateMimeType(getExtensionFromFilename(file.name))\n    );\n    file.name = name;\n    file.lastModifiedDate = date;\n    return file;\n  };\n\n  var isDirectoryEntry = function isDirectoryEntry(item) {\n    return isEntry(item) && (getAsEntry(item) || {}).isDirectory;\n  };\n\n  var isEntry = function isEntry(item) {\n    return 'webkitGetAsEntry' in item;\n  };\n\n  var getAsEntry = function getAsEntry(item) {\n    return item.webkitGetAsEntry();\n  };\n\n  /**\n   * Extracts links from a DataTransfer object\n   */\n  var getLinks = function getLinks(dataTransfer) {\n    var links = [];\n    try {\n      // look in meta data property\n      links = getLinksFromTransferMetaData(dataTransfer);\n      if (links.length) {\n        return links;\n      }\n      links = getLinksFromTransferURLData(dataTransfer);\n    } catch (e) {\n      // nope nope nope (probably IE trouble)\n    }\n    return links;\n  };\n\n  var getLinksFromTransferURLData = function getLinksFromTransferURLData(\n    dataTransfer\n  ) {\n    var data = dataTransfer.getData('url');\n    if (typeof data === 'string' && data.length) {\n      return [data];\n    }\n    return [];\n  };\n\n  var getLinksFromTransferMetaData = function getLinksFromTransferMetaData(\n    dataTransfer\n  ) {\n    var data = dataTransfer.getData('text/html');\n    if (typeof data === 'string' && data.length) {\n      var matches = data.match(/src\\s*=\\s*\"(.+?)\"/);\n      if (matches) {\n        return [matches[1]];\n      }\n    }\n    return [];\n  };\n\n  var dragNDropObservers = [];\n\n  var eventPosition = function eventPosition(e) {\n    return {\n      pageLeft: e.pageX,\n      pageTop: e.pageY,\n      scopeLeft: e.offsetX || e.layerX,\n      scopeTop: e.offsetY || e.layerY\n    };\n  };\n\n  var createDragNDropClient = function createDragNDropClient(\n    element,\n    scopeToObserve,\n    filterElement\n  ) {\n    var observer = getDragNDropObserver(scopeToObserve);\n\n    var client = {\n      element: element,\n      filterElement: filterElement,\n      state: null,\n      ondrop: function ondrop() {},\n      onenter: function onenter() {},\n      ondrag: function ondrag() {},\n      onexit: function onexit() {},\n      onload: function onload() {},\n      allowdrop: function allowdrop() {}\n    };\n\n    client.destroy = observer.addListener(client);\n\n    return client;\n  };\n\n  var getDragNDropObserver = function getDragNDropObserver(element) {\n    // see if already exists, if so, return\n    var observer = dragNDropObservers.find(function(item) {\n      return item.element === element;\n    });\n    if (observer) {\n      return observer;\n    }\n\n    // create new observer, does not yet exist for this element\n    var newObserver = createDragNDropObserver(element);\n    dragNDropObservers.push(newObserver);\n    return newObserver;\n  };\n\n  var createDragNDropObserver = function createDragNDropObserver(element) {\n    var clients = [];\n\n    var routes = {\n      dragenter: dragenter,\n      dragover: dragover,\n      dragleave: dragleave,\n      drop: drop\n    };\n\n    var handlers = {};\n\n    forin(routes, function(event, createHandler) {\n      handlers[event] = createHandler(element, clients);\n      element.addEventListener(event, handlers[event], false);\n    });\n\n    var observer = {\n      element: element,\n      addListener: function addListener(client) {\n        // add as client\n        clients.push(client);\n\n        // return removeListener function\n        return function() {\n          // remove client\n          clients.splice(clients.indexOf(client), 1);\n\n          // if no more clients, clean up observer\n          if (clients.length === 0) {\n            dragNDropObservers.splice(dragNDropObservers.indexOf(observer), 1);\n\n            forin(routes, function(event) {\n              element.removeEventListener(event, handlers[event], false);\n            });\n          }\n        };\n      }\n    };\n\n    return observer;\n  };\n\n  var elementFromPoint = function elementFromPoint(root, point) {\n    if (!('elementFromPoint' in root)) {\n      root = document;\n    }\n    return root.elementFromPoint(point.x, point.y);\n  };\n\n  var isEventTarget = function isEventTarget(e, target) {\n    // get root\n    var root = getRootNode(target);\n\n    // get element at position\n    // if root is not actual shadow DOM and does not have elementFromPoint method, use the one on document\n    var elementAtPosition = elementFromPoint(root, {\n      x: e.pageX - window.pageXOffset,\n      y: e.pageY - window.pageYOffset\n    });\n\n    // test if target is the element or if one of its children is\n    return elementAtPosition === target || target.contains(elementAtPosition);\n  };\n\n  var initialTarget = null;\n\n  var setDropEffect = function setDropEffect(dataTransfer, effect) {\n    // is in try catch as IE11 will throw error if not\n    try {\n      dataTransfer.dropEffect = effect;\n    } catch (e) {}\n  };\n\n  var dragenter = function dragenter(root, clients) {\n    return function(e) {\n      e.preventDefault();\n\n      initialTarget = e.target;\n\n      clients.forEach(function(client) {\n        var element = client.element,\n          onenter = client.onenter;\n\n        if (isEventTarget(e, element)) {\n          client.state = 'enter';\n\n          // fire enter event\n          onenter(eventPosition(e));\n        }\n      });\n    };\n  };\n\n  var dragover = function dragover(root, clients) {\n    return function(e) {\n      e.preventDefault();\n\n      var dataTransfer = e.dataTransfer;\n\n      requestDataTransferItems(dataTransfer).then(function(items) {\n        var overDropTarget = false;\n\n        clients.some(function(client) {\n          var filterElement = client.filterElement,\n            element = client.element,\n            onenter = client.onenter,\n            onexit = client.onexit,\n            ondrag = client.ondrag,\n            allowdrop = client.allowdrop;\n\n          // by default we can drop\n          setDropEffect(dataTransfer, 'copy');\n\n          // allow transfer of these items\n          var allowsTransfer = allowdrop(items);\n\n          // only used when can be dropped on page\n          if (!allowsTransfer) {\n            setDropEffect(dataTransfer, 'none');\n            return;\n          }\n\n          // targetting this client\n          if (isEventTarget(e, element)) {\n            overDropTarget = true;\n\n            // had no previous state, means we are entering this client\n            if (client.state === null) {\n              client.state = 'enter';\n              onenter(eventPosition(e));\n              return;\n            }\n\n            // now over element (no matter if it allows the drop or not)\n            client.state = 'over';\n\n            // needs to allow transfer\n            if (filterElement && !allowsTransfer) {\n              setDropEffect(dataTransfer, 'none');\n              return;\n            }\n\n            // dragging\n            ondrag(eventPosition(e));\n          } else {\n            // should be over an element to drop\n            if (filterElement && !overDropTarget) {\n              setDropEffect(dataTransfer, 'none');\n            }\n\n            // might have just left this client?\n            if (client.state) {\n              client.state = null;\n              onexit(eventPosition(e));\n            }\n          }\n        });\n      });\n    };\n  };\n\n  var drop = function drop(root, clients) {\n    return function(e) {\n      e.preventDefault();\n\n      var dataTransfer = e.dataTransfer;\n\n      requestDataTransferItems(dataTransfer).then(function(items) {\n        clients.forEach(function(client) {\n          var filterElement = client.filterElement,\n            element = client.element,\n            ondrop = client.ondrop,\n            onexit = client.onexit,\n            allowdrop = client.allowdrop;\n\n          client.state = null;\n\n          // if we're filtering on element we need to be over the element to drop\n          if (filterElement && !isEventTarget(e, element)) return;\n\n          // no transfer for this client\n          if (!allowdrop(items)) return onexit(eventPosition(e));\n\n          // we can drop these items on this client\n          ondrop(eventPosition(e), items);\n        });\n      });\n    };\n  };\n\n  var dragleave = function dragleave(root, clients) {\n    return function(e) {\n      if (initialTarget !== e.target) {\n        return;\n      }\n\n      clients.forEach(function(client) {\n        var onexit = client.onexit;\n\n        client.state = null;\n\n        onexit(eventPosition(e));\n      });\n    };\n  };\n\n  var createHopper = function createHopper(scope, validateItems, options) {\n    // is now hopper scope\n    scope.classList.add('filepond--hopper');\n\n    // shortcuts\n    var catchesDropsOnPage = options.catchesDropsOnPage,\n      requiresDropOnElement = options.requiresDropOnElement,\n      _options$filterItems = options.filterItems,\n      filterItems =\n        _options$filterItems === void 0\n          ? function(items) {\n              return items;\n            }\n          : _options$filterItems;\n\n    // create a dnd client\n    var client = createDragNDropClient(\n      scope,\n      catchesDropsOnPage ? document.documentElement : scope,\n      requiresDropOnElement\n    );\n\n    // current client state\n    var lastState = '';\n    var currentState = '';\n\n    // determines if a file may be dropped\n    client.allowdrop = function(items) {\n      // TODO: if we can, throw error to indicate the items cannot by dropped\n\n      return validateItems(filterItems(items));\n    };\n\n    client.ondrop = function(position, items) {\n      var filteredItems = filterItems(items);\n\n      if (!validateItems(filteredItems)) {\n        api.ondragend(position);\n        return;\n      }\n\n      currentState = 'drag-drop';\n\n      api.onload(filteredItems, position);\n    };\n\n    client.ondrag = function(position) {\n      api.ondrag(position);\n    };\n\n    client.onenter = function(position) {\n      currentState = 'drag-over';\n\n      api.ondragstart(position);\n    };\n\n    client.onexit = function(position) {\n      currentState = 'drag-exit';\n\n      api.ondragend(position);\n    };\n\n    var api = {\n      updateHopperState: function updateHopperState() {\n        if (lastState !== currentState) {\n          scope.dataset.hopperState = currentState;\n          lastState = currentState;\n        }\n      },\n      onload: function onload() {},\n      ondragstart: function ondragstart() {},\n      ondrag: function ondrag() {},\n      ondragend: function ondragend() {},\n      destroy: function destroy() {\n        // destroy client\n        client.destroy();\n      }\n    };\n\n    return api;\n  };\n\n  var listening = false;\n  var listeners$1 = [];\n\n  var handlePaste = function handlePaste(e) {\n    // if is pasting in input or textarea and the target is outside of a filepond scope, ignore\n    var activeEl = document.activeElement;\n    if (activeEl && /textarea|input/i.test(activeEl.nodeName)) {\n      // test textarea or input is contained in filepond root\n      var inScope = false;\n      var element = activeEl;\n      while (element !== document.body) {\n        if (element.classList.contains('filepond--root')) {\n          inScope = true;\n          break;\n        }\n        element = element.parentNode;\n      }\n\n      if (!inScope) return;\n    }\n\n    requestDataTransferItems(e.clipboardData).then(function(files) {\n      // no files received\n      if (!files.length) {\n        return;\n      }\n\n      // notify listeners of received files\n      listeners$1.forEach(function(listener) {\n        return listener(files);\n      });\n    });\n  };\n\n  var listen = function listen(cb) {\n    // can't add twice\n    if (listeners$1.includes(cb)) {\n      return;\n    }\n\n    // add initial listener\n    listeners$1.push(cb);\n\n    // setup paste listener for entire page\n    if (listening) {\n      return;\n    }\n\n    listening = true;\n    document.addEventListener('paste', handlePaste);\n  };\n\n  var unlisten = function unlisten(listener) {\n    arrayRemove(listeners$1, listeners$1.indexOf(listener));\n\n    // clean up\n    if (listeners$1.length === 0) {\n      document.removeEventListener('paste', handlePaste);\n      listening = false;\n    }\n  };\n\n  var createPaster = function createPaster() {\n    var cb = function cb(files) {\n      api.onload(files);\n    };\n\n    var api = {\n      destroy: function destroy() {\n        unlisten(cb);\n      },\n      onload: function onload() {}\n    };\n\n    listen(cb);\n\n    return api;\n  };\n\n  /**\n   * Creates the file view\n   */\n  var create$d = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n    root.element.id = 'filepond--assistant-' + props.id;\n    attr(root.element, 'role', 'status');\n    attr(root.element, 'aria-live', 'polite');\n    attr(root.element, 'aria-relevant', 'additions');\n  };\n\n  var addFilesNotificationTimeout = null;\n  var notificationClearTimeout = null;\n\n  var filenames = [];\n\n  var assist = function assist(root, message) {\n    root.element.textContent = message;\n  };\n\n  var clear$1 = function clear(root) {\n    root.element.textContent = '';\n  };\n\n  var listModified = function listModified(root, filename, label) {\n    var total = root.query('GET_TOTAL_ITEMS');\n    assist(\n      root,\n      label +\n        ' ' +\n        filename +\n        ', ' +\n        total +\n        ' ' +\n        (total === 1\n          ? root.query('GET_LABEL_FILE_COUNT_SINGULAR')\n          : root.query('GET_LABEL_FILE_COUNT_PLURAL'))\n    );\n\n    // clear group after set amount of time so the status is not read twice\n    clearTimeout(notificationClearTimeout);\n    notificationClearTimeout = setTimeout(function() {\n      clear$1(root);\n    }, 1500);\n  };\n\n  var isUsingFilePond = function isUsingFilePond(root) {\n    return root.element.parentNode.contains(document.activeElement);\n  };\n\n  var itemAdded = function itemAdded(_ref2) {\n    var root = _ref2.root,\n      action = _ref2.action;\n    if (!isUsingFilePond(root)) {\n      return;\n    }\n\n    root.element.textContent = '';\n    var item = root.query('GET_ITEM', action.id);\n    filenames.push(item.filename);\n\n    clearTimeout(addFilesNotificationTimeout);\n    addFilesNotificationTimeout = setTimeout(function() {\n      listModified(\n        root,\n        filenames.join(', '),\n        root.query('GET_LABEL_FILE_ADDED')\n      );\n\n      filenames.length = 0;\n    }, 750);\n  };\n\n  var itemRemoved = function itemRemoved(_ref3) {\n    var root = _ref3.root,\n      action = _ref3.action;\n    if (!isUsingFilePond(root)) {\n      return;\n    }\n\n    var item = action.item;\n    listModified(root, item.filename, root.query('GET_LABEL_FILE_REMOVED'));\n  };\n\n  var itemProcessed = function itemProcessed(_ref4) {\n    var root = _ref4.root,\n      action = _ref4.action;\n    // will also notify the user when FilePond is not being used, as the user might be occupied with other activities while uploading a file\n\n    var item = root.query('GET_ITEM', action.id);\n    var filename = item.filename;\n    var label = root.query('GET_LABEL_FILE_PROCESSING_COMPLETE');\n\n    assist(root, filename + ' ' + label);\n  };\n\n  var itemProcessedUndo = function itemProcessedUndo(_ref5) {\n    var root = _ref5.root,\n      action = _ref5.action;\n    var item = root.query('GET_ITEM', action.id);\n    var filename = item.filename;\n    var label = root.query('GET_LABEL_FILE_PROCESSING_ABORTED');\n\n    assist(root, filename + ' ' + label);\n  };\n\n  var itemError = function itemError(_ref6) {\n    var root = _ref6.root,\n      action = _ref6.action;\n    var item = root.query('GET_ITEM', action.id);\n    var filename = item.filename;\n\n    // will also notify the user when FilePond is not being used, as the user might be occupied with other activities while uploading a file\n\n    assist(root, action.status.main + ' ' + filename + ' ' + action.status.sub);\n  };\n\n  var assistant = createView({\n    create: create$d,\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    write: createRoute({\n      DID_LOAD_ITEM: itemAdded,\n      DID_REMOVE_ITEM: itemRemoved,\n      DID_COMPLETE_ITEM_PROCESSING: itemProcessed,\n\n      DID_ABORT_ITEM_PROCESSING: itemProcessedUndo,\n      DID_REVERT_ITEM_PROCESSING: itemProcessedUndo,\n\n      DID_THROW_ITEM_REMOVE_ERROR: itemError,\n      DID_THROW_ITEM_LOAD_ERROR: itemError,\n      DID_THROW_ITEM_INVALID: itemError,\n      DID_THROW_ITEM_PROCESSING_ERROR: itemError\n    }),\n\n    tag: 'span',\n    name: 'assistant'\n  });\n\n  var toCamels = function toCamels(string) {\n    var separator =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '-';\n    return string.replace(new RegExp(separator + '.', 'g'), function(sub) {\n      return sub.charAt(1).toUpperCase();\n    });\n  };\n\n  var debounce = function debounce(func) {\n    var interval =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 16;\n    var immidiateOnly =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    var last = Date.now();\n    var timeout = null;\n\n    return function() {\n      for (\n        var _len = arguments.length, args = new Array(_len), _key = 0;\n        _key < _len;\n        _key++\n      ) {\n        args[_key] = arguments[_key];\n      }\n      clearTimeout(timeout);\n\n      var dist = Date.now() - last;\n\n      var fn = function fn() {\n        last = Date.now();\n        func.apply(void 0, args);\n      };\n\n      if (dist < interval) {\n        // we need to delay by the difference between interval and dist\n        // for example: if distance is 10 ms and interval is 16 ms,\n        // we need to wait an additional 6ms before calling the function)\n        if (!immidiateOnly) {\n          timeout = setTimeout(fn, interval - dist);\n        }\n      } else {\n        // go!\n        fn();\n      }\n    };\n  };\n\n  var MAX_FILES_LIMIT = 1000000;\n\n  var prevent = function prevent(e) {\n    return e.preventDefault();\n  };\n\n  var create$e = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n\n    // Add id\n    var id = root.query('GET_ID');\n    if (id) {\n      root.element.id = id;\n    }\n\n    // Add className\n    var className = root.query('GET_CLASS_NAME');\n    if (className) {\n      className\n        .split(' ')\n        .filter(function(name) {\n          return name.length;\n        })\n        .forEach(function(name) {\n          root.element.classList.add(name);\n        });\n    }\n\n    // Field label\n    root.ref.label = root.appendChildView(\n      root.createChildView(\n        dropLabel,\n        Object.assign({}, props, {\n          translateY: null,\n          caption: root.query('GET_LABEL_IDLE')\n        })\n      )\n    );\n\n    // List of items\n    root.ref.list = root.appendChildView(\n      root.createChildView(listScroller, { translateY: null })\n    );\n\n    // Background panel\n    root.ref.panel = root.appendChildView(\n      root.createChildView(panel, { name: 'panel-root' })\n    );\n\n    // Assistant notifies assistive tech when content changes\n    root.ref.assistant = root.appendChildView(\n      root.createChildView(assistant, Object.assign({}, props))\n    );\n\n    // Data\n    root.ref.data = root.appendChildView(\n      root.createChildView(data, Object.assign({}, props))\n    );\n\n    // Measure (tests if fixed height was set)\n    // DOCTYPE needs to be set for this to work\n    root.ref.measure = createElement$1('div');\n    root.ref.measure.style.height = '100%';\n    root.element.appendChild(root.ref.measure);\n\n    // information on the root height or fixed height status\n    root.ref.bounds = null;\n\n    // apply initial style properties\n    root\n      .query('GET_STYLES')\n      .filter(function(style) {\n        return !isEmpty(style.value);\n      })\n      .map(function(_ref2) {\n        var name = _ref2.name,\n          value = _ref2.value;\n        root.element.dataset[name] = value;\n      });\n\n    // determine if width changed\n    root.ref.widthPrevious = null;\n    root.ref.widthUpdated = debounce(function() {\n      root.ref.updateHistory = [];\n      root.dispatch('DID_RESIZE_ROOT');\n    }, 250);\n\n    // history of updates\n    root.ref.previousAspectRatio = null;\n    root.ref.updateHistory = [];\n\n    // prevent scrolling and zooming on iOS (only if supports pointer events, for then we can enable reorder)\n    var canHover = window.matchMedia('(pointer: fine) and (hover: hover)')\n      .matches;\n    var hasPointerEvents = 'PointerEvent' in window;\n    if (root.query('GET_ALLOW_REORDER') && hasPointerEvents && !canHover) {\n      root.element.addEventListener('touchmove', prevent, { passive: false });\n      root.element.addEventListener('gesturestart', prevent);\n    }\n  };\n\n  var write$9 = function write(_ref3) {\n    var root = _ref3.root,\n      props = _ref3.props,\n      actions = _ref3.actions;\n\n    // route actions\n    route$5({ root: root, props: props, actions: actions });\n\n    // apply style properties\n    actions\n      .filter(function(action) {\n        return /^DID_SET_STYLE_/.test(action.type);\n      })\n      .filter(function(action) {\n        return !isEmpty(action.data.value);\n      })\n      .map(function(_ref4) {\n        var type = _ref4.type,\n          data = _ref4.data;\n        var name = toCamels(type.substr(8).toLowerCase(), '_');\n        root.element.dataset[name] = data.value;\n        root.invalidateLayout();\n      });\n\n    if (root.rect.element.hidden) return;\n\n    if (root.rect.element.width !== root.ref.widthPrevious) {\n      root.ref.widthPrevious = root.rect.element.width;\n      root.ref.widthUpdated();\n    }\n\n    // get box bounds, we do this only once\n    var bounds = root.ref.bounds;\n    if (!bounds) {\n      bounds = root.ref.bounds = calculateRootBoundingBoxHeight(root);\n\n      // destroy measure element\n      root.element.removeChild(root.ref.measure);\n      root.ref.measure = null;\n    }\n\n    // get quick references to various high level parts of the upload tool\n    var _root$ref = root.ref,\n      hopper = _root$ref.hopper,\n      label = _root$ref.label,\n      list = _root$ref.list,\n      panel = _root$ref.panel;\n\n    // sets correct state to hopper scope\n    if (hopper) {\n      hopper.updateHopperState();\n    }\n\n    // bool to indicate if we're full or not\n    var aspectRatio = root.query('GET_PANEL_ASPECT_RATIO');\n    var isMultiItem = root.query('GET_ALLOW_MULTIPLE');\n    var totalItems = root.query('GET_TOTAL_ITEMS');\n    var maxItems = isMultiItem\n      ? root.query('GET_MAX_FILES') || MAX_FILES_LIMIT\n      : 1;\n    var atMaxCapacity = totalItems === maxItems;\n\n    // action used to add item\n    var addAction = actions.find(function(action) {\n      return action.type === 'DID_ADD_ITEM';\n    });\n\n    // if reached max capacity and we've just reached it\n    if (atMaxCapacity && addAction) {\n      // get interaction type\n      var interactionMethod = addAction.data.interactionMethod;\n\n      // hide label\n      label.opacity = 0;\n\n      if (isMultiItem) {\n        label.translateY = -40;\n      } else {\n        if (interactionMethod === InteractionMethod.API) {\n          label.translateX = 40;\n        } else if (interactionMethod === InteractionMethod.BROWSE) {\n          label.translateY = 40;\n        } else {\n          label.translateY = 30;\n        }\n      }\n    } else if (!atMaxCapacity) {\n      label.opacity = 1;\n      label.translateX = 0;\n      label.translateY = 0;\n    }\n\n    var listItemMargin = calculateListItemMargin(root);\n\n    var listHeight = calculateListHeight(root);\n\n    var labelHeight = label.rect.element.height;\n    var currentLabelHeight = !isMultiItem || atMaxCapacity ? 0 : labelHeight;\n\n    var listMarginTop = atMaxCapacity ? list.rect.element.marginTop : 0;\n    var listMarginBottom =\n      totalItems === 0 ? 0 : list.rect.element.marginBottom;\n\n    var visualHeight =\n      currentLabelHeight + listMarginTop + listHeight.visual + listMarginBottom;\n    var boundsHeight =\n      currentLabelHeight + listMarginTop + listHeight.bounds + listMarginBottom;\n\n    // link list to label bottom position\n    list.translateY =\n      Math.max(0, currentLabelHeight - list.rect.element.marginTop) -\n      listItemMargin.top;\n\n    if (aspectRatio) {\n      // fixed aspect ratio\n\n      // calculate height based on width\n      var width = root.rect.element.width;\n      var height = width * aspectRatio;\n\n      // clear history if aspect ratio has changed\n      if (aspectRatio !== root.ref.previousAspectRatio) {\n        root.ref.previousAspectRatio = aspectRatio;\n        root.ref.updateHistory = [];\n      }\n\n      // remember this width\n      var history = root.ref.updateHistory;\n      history.push(width);\n\n      var MAX_BOUNCES = 2;\n      if (history.length > MAX_BOUNCES * 2) {\n        var l = history.length;\n        var bottom = l - 10;\n        var bounces = 0;\n        for (var i = l; i >= bottom; i--) {\n          if (history[i] === history[i - 2]) {\n            bounces++;\n          }\n\n          if (bounces >= MAX_BOUNCES) {\n            // dont adjust height\n            return;\n          }\n        }\n      }\n\n      // fix height of panel so it adheres to aspect ratio\n      panel.scalable = false;\n      panel.height = height;\n\n      // available height for list\n      var listAvailableHeight =\n        // the height of the panel minus the label height\n        height -\n        currentLabelHeight -\n        // the room we leave open between the end of the list and the panel bottom\n        (listMarginBottom - listItemMargin.bottom) -\n        // if we're full we need to leave some room between the top of the panel and the list\n        (atMaxCapacity ? listMarginTop : 0);\n\n      if (listHeight.visual > listAvailableHeight) {\n        list.overflow = listAvailableHeight;\n      } else {\n        list.overflow = null;\n      }\n\n      // set container bounds (so pushes siblings downwards)\n      root.height = height;\n    } else if (bounds.fixedHeight) {\n      // fixed height\n\n      // fix height of panel\n      panel.scalable = false;\n\n      // available height for list\n      var _listAvailableHeight =\n        // the height of the panel minus the label height\n        bounds.fixedHeight -\n        currentLabelHeight -\n        // the room we leave open between the end of the list and the panel bottom\n        (listMarginBottom - listItemMargin.bottom) -\n        // if we're full we need to leave some room between the top of the panel and the list\n        (atMaxCapacity ? listMarginTop : 0);\n\n      // set list height\n      if (listHeight.visual > _listAvailableHeight) {\n        list.overflow = _listAvailableHeight;\n      } else {\n        list.overflow = null;\n      }\n\n      // no need to set container bounds as these are handles by CSS fixed height\n    } else if (bounds.cappedHeight) {\n      // max-height\n\n      // not a fixed height panel\n      var isCappedHeight = visualHeight >= bounds.cappedHeight;\n      var panelHeight = Math.min(bounds.cappedHeight, visualHeight);\n      panel.scalable = true;\n      panel.height = isCappedHeight\n        ? panelHeight\n        : panelHeight - listItemMargin.top - listItemMargin.bottom;\n\n      // available height for list\n      var _listAvailableHeight2 =\n        // the height of the panel minus the label height\n        panelHeight -\n        currentLabelHeight -\n        // the room we leave open between the end of the list and the panel bottom\n        (listMarginBottom - listItemMargin.bottom) -\n        // if we're full we need to leave some room between the top of the panel and the list\n        (atMaxCapacity ? listMarginTop : 0);\n\n      // set list height (if is overflowing)\n      if (\n        visualHeight > bounds.cappedHeight &&\n        listHeight.visual > _listAvailableHeight2\n      ) {\n        list.overflow = _listAvailableHeight2;\n      } else {\n        list.overflow = null;\n      }\n\n      // set container bounds (so pushes siblings downwards)\n      root.height = Math.min(\n        bounds.cappedHeight,\n        boundsHeight - listItemMargin.top - listItemMargin.bottom\n      );\n    } else {\n      // flexible height\n\n      // not a fixed height panel\n      var itemMargin =\n        totalItems > 0 ? listItemMargin.top + listItemMargin.bottom : 0;\n      panel.scalable = true;\n      panel.height = Math.max(labelHeight, visualHeight - itemMargin);\n\n      // set container bounds (so pushes siblings downwards)\n      root.height = Math.max(labelHeight, boundsHeight - itemMargin);\n    }\n  };\n\n  var calculateListItemMargin = function calculateListItemMargin(root) {\n    var item = root.ref.list.childViews[0].childViews[0];\n    return item\n      ? {\n          top: item.rect.element.marginTop,\n          bottom: item.rect.element.marginBottom\n        }\n      : {\n          top: 0,\n          bottom: 0\n        };\n  };\n\n  var calculateListHeight = function calculateListHeight(root) {\n    var visual = 0;\n    var bounds = 0;\n\n    // get file list reference\n    var scrollList = root.ref.list;\n    var itemList = scrollList.childViews[0];\n    var visibleChildren = itemList.childViews.filter(function(child) {\n      return child.rect.element.height;\n    });\n    var children = root\n      .query('GET_ACTIVE_ITEMS')\n      .map(function(item) {\n        return visibleChildren.find(function(child) {\n          return child.id === item.id;\n        });\n      })\n      .filter(function(item) {\n        return item;\n      });\n\n    // no children, done!\n    if (children.length === 0) return { visual: visual, bounds: bounds };\n\n    var horizontalSpace = itemList.rect.element.width;\n    var dragIndex = getItemIndexByPosition(\n      itemList,\n      children,\n      scrollList.dragCoordinates\n    );\n\n    var childRect = children[0].rect.element;\n\n    var itemVerticalMargin = childRect.marginTop + childRect.marginBottom;\n    var itemHorizontalMargin = childRect.marginLeft + childRect.marginRight;\n\n    var itemWidth = childRect.width + itemHorizontalMargin;\n    var itemHeight = childRect.height + itemVerticalMargin;\n\n    var newItem = typeof dragIndex !== 'undefined' && dragIndex >= 0 ? 1 : 0;\n    var removedItem = children.find(function(child) {\n      return child.markedForRemoval && child.opacity < 0.45;\n    })\n      ? -1\n      : 0;\n    var verticalItemCount = children.length + newItem + removedItem;\n    var itemsPerRow = Math.round(horizontalSpace / itemWidth);\n\n    // stack\n    if (itemsPerRow === 1) {\n      children.forEach(function(item) {\n        var height = item.rect.element.height + itemVerticalMargin;\n        bounds += height;\n        visual += height * item.opacity;\n      });\n    }\n    // grid\n    else {\n      bounds = Math.ceil(verticalItemCount / itemsPerRow) * itemHeight;\n      visual = bounds;\n    }\n\n    return { visual: visual, bounds: bounds };\n  };\n\n  var calculateRootBoundingBoxHeight = function calculateRootBoundingBoxHeight(\n    root\n  ) {\n    var height = root.ref.measureHeight || null;\n    var cappedHeight = parseInt(root.style.maxHeight, 10) || null;\n    var fixedHeight = height === 0 ? null : height;\n\n    return {\n      cappedHeight: cappedHeight,\n      fixedHeight: fixedHeight\n    };\n  };\n\n  var exceedsMaxFiles = function exceedsMaxFiles(root, items) {\n    var allowReplace = root.query('GET_ALLOW_REPLACE');\n    var allowMultiple = root.query('GET_ALLOW_MULTIPLE');\n    var totalItems = root.query('GET_TOTAL_ITEMS');\n    var maxItems = root.query('GET_MAX_FILES');\n\n    // total amount of items being dragged\n    var totalBrowseItems = items.length;\n\n    // if does not allow multiple items and dragging more than one item\n    if (!allowMultiple && totalBrowseItems > 1) {\n      return true;\n    }\n\n    // limit max items to one if not allowed to drop multiple items\n    maxItems = allowMultiple ? maxItems : allowReplace ? maxItems : 1;\n\n    // no more room?\n    var hasMaxItems = isInt(maxItems);\n    if (hasMaxItems && totalItems + totalBrowseItems > maxItems) {\n      root.dispatch('DID_THROW_MAX_FILES', {\n        source: items,\n        error: createResponse('warning', 0, 'Max files')\n      });\n\n      return true;\n    }\n\n    return false;\n  };\n\n  var getDragIndex = function getDragIndex(list, children, position) {\n    var itemList = list.childViews[0];\n    return getItemIndexByPosition(itemList, children, {\n      left: position.scopeLeft - itemList.rect.element.left,\n      top:\n        position.scopeTop -\n        (list.rect.outer.top +\n          list.rect.element.marginTop +\n          list.rect.element.scrollTop)\n    });\n  };\n\n  /**\n   * Enable or disable file drop functionality\n   */\n  var toggleDrop = function toggleDrop(root) {\n    var isAllowed = root.query('GET_ALLOW_DROP');\n    var isDisabled = root.query('GET_DISABLED');\n    var enabled = isAllowed && !isDisabled;\n    if (enabled && !root.ref.hopper) {\n      var hopper = createHopper(\n        root.element,\n        function(items) {\n          // these files don't fit so stop here\n          if (exceedsMaxFiles(root, items)) return false;\n\n          // allow quick validation of dropped items\n          var beforeDropFile =\n            root.query('GET_BEFORE_DROP_FILE') ||\n            function() {\n              return true;\n            };\n\n          // all items should be validated by all filters as valid\n          var dropValidation = root.query('GET_DROP_VALIDATION');\n          return dropValidation\n            ? items.every(function(item) {\n                return (\n                  applyFilters('ALLOW_HOPPER_ITEM', item, {\n                    query: root.query\n                  }).every(function(result) {\n                    return result === true;\n                  }) && beforeDropFile(item)\n                );\n              })\n            : true;\n        },\n        {\n          filterItems: function filterItems(items) {\n            var ignoredFiles = root.query('GET_IGNORED_FILES');\n            return items.filter(function(item) {\n              if (isFile(item)) {\n                return !ignoredFiles.includes(item.name.toLowerCase());\n              }\n              return true;\n            });\n          },\n          catchesDropsOnPage: root.query('GET_DROP_ON_PAGE'),\n          requiresDropOnElement: root.query('GET_DROP_ON_ELEMENT')\n        }\n      );\n\n      hopper.onload = function(items, position) {\n        // get item children elements and sort based on list sort\n        var list = root.ref.list.childViews[0];\n        var visibleChildren = list.childViews.filter(function(child) {\n          return child.rect.element.height;\n        });\n        var children = root\n          .query('GET_ACTIVE_ITEMS')\n          .map(function(item) {\n            return visibleChildren.find(function(child) {\n              return child.id === item.id;\n            });\n          })\n          .filter(function(item) {\n            return item;\n          });\n\n        // go\n        root.dispatch('ADD_ITEMS', {\n          items: items,\n          index: getDragIndex(root.ref.list, children, position),\n          interactionMethod: InteractionMethod.DROP\n        });\n\n        root.dispatch('DID_DROP', { position: position });\n\n        root.dispatch('DID_END_DRAG', { position: position });\n      };\n\n      hopper.ondragstart = function(position) {\n        root.dispatch('DID_START_DRAG', { position: position });\n      };\n\n      hopper.ondrag = debounce(function(position) {\n        root.dispatch('DID_DRAG', { position: position });\n      });\n\n      hopper.ondragend = function(position) {\n        root.dispatch('DID_END_DRAG', { position: position });\n      };\n\n      root.ref.hopper = hopper;\n\n      root.ref.drip = root.appendChildView(root.createChildView(drip));\n    } else if (!enabled && root.ref.hopper) {\n      root.ref.hopper.destroy();\n      root.ref.hopper = null;\n      root.removeChildView(root.ref.drip);\n    }\n  };\n\n  /**\n   * Enable or disable browse functionality\n   */\n  var toggleBrowse = function toggleBrowse(root, props) {\n    var isAllowed = root.query('GET_ALLOW_BROWSE');\n    var isDisabled = root.query('GET_DISABLED');\n    var enabled = isAllowed && !isDisabled;\n    if (enabled && !root.ref.browser) {\n      root.ref.browser = root.appendChildView(\n        root.createChildView(\n          browser,\n          Object.assign({}, props, {\n            onload: function onload(items) {\n              // these files don't fit so stop here\n              if (exceedsMaxFiles(root, items)) return false;\n\n              // add items!\n              root.dispatch('ADD_ITEMS', {\n                items: items,\n                index: -1,\n                interactionMethod: InteractionMethod.BROWSE\n              });\n            }\n          })\n        ),\n\n        0\n      );\n    } else if (!enabled && root.ref.browser) {\n      root.removeChildView(root.ref.browser);\n      root.ref.browser = null;\n    }\n  };\n\n  /**\n   * Enable or disable paste functionality\n   */\n  var togglePaste = function togglePaste(root) {\n    var isAllowed = root.query('GET_ALLOW_PASTE');\n    var isDisabled = root.query('GET_DISABLED');\n    var enabled = isAllowed && !isDisabled;\n    if (enabled && !root.ref.paster) {\n      root.ref.paster = createPaster();\n      root.ref.paster.onload = function(items) {\n        root.dispatch('ADD_ITEMS', {\n          items: items,\n          index: -1,\n          interactionMethod: InteractionMethod.PASTE\n        });\n      };\n    } else if (!enabled && root.ref.paster) {\n      root.ref.paster.destroy();\n      root.ref.paster = null;\n    }\n  };\n\n  /**\n   * Route actions\n   */\n  var route$5 = createRoute({\n    DID_SET_ALLOW_BROWSE: function DID_SET_ALLOW_BROWSE(_ref5) {\n      var root = _ref5.root,\n        props = _ref5.props;\n      toggleBrowse(root, props);\n    },\n    DID_SET_ALLOW_DROP: function DID_SET_ALLOW_DROP(_ref6) {\n      var root = _ref6.root;\n      toggleDrop(root);\n    },\n    DID_SET_ALLOW_PASTE: function DID_SET_ALLOW_PASTE(_ref7) {\n      var root = _ref7.root;\n      togglePaste(root);\n    },\n    DID_SET_DISABLED: function DID_SET_DISABLED(_ref8) {\n      var root = _ref8.root,\n        props = _ref8.props;\n      toggleDrop(root);\n      togglePaste(root);\n      toggleBrowse(root, props);\n      var isDisabled = root.query('GET_DISABLED');\n      if (isDisabled) {\n        root.element.dataset.disabled = 'disabled';\n      } else {\n        // delete root.element.dataset.disabled; <= this does not work on iOS 10\n        root.element.removeAttribute('data-disabled');\n      }\n    }\n  });\n\n  var root = createView({\n    name: 'root',\n    read: function read(_ref9) {\n      var root = _ref9.root;\n      if (root.ref.measure) {\n        root.ref.measureHeight = root.ref.measure.offsetHeight;\n      }\n    },\n    create: create$e,\n    write: write$9,\n    destroy: function destroy(_ref10) {\n      var root = _ref10.root;\n      if (root.ref.paster) {\n        root.ref.paster.destroy();\n      }\n      if (root.ref.hopper) {\n        root.ref.hopper.destroy();\n      }\n      root.element.removeEventListener('touchmove', prevent);\n      root.element.removeEventListener('gesturestart', prevent);\n    },\n    mixins: {\n      styles: ['height']\n    }\n  });\n\n  // creates the app\n  var createApp = function createApp() {\n    var initialOptions =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    // let element\n    var originalElement = null;\n\n    // get default options\n    var defaultOptions = getOptions();\n\n    // create the data store, this will contain all our app info\n    var store = createStore(\n      // initial state (should be serializable)\n      createInitialState(defaultOptions),\n\n      // queries\n      [queries, createOptionQueries(defaultOptions)],\n\n      // action handlers\n      [actions, createOptionActions(defaultOptions)]\n    );\n\n    // set initial options\n    store.dispatch('SET_OPTIONS', { options: initialOptions });\n\n    // kick thread if visibility changes\n    var visibilityHandler = function visibilityHandler() {\n      if (document.hidden) return;\n      store.dispatch('KICK');\n    };\n    document.addEventListener('visibilitychange', visibilityHandler);\n\n    // re-render on window resize start and finish\n    var resizeDoneTimer = null;\n    var isResizing = false;\n    var isResizingHorizontally = false;\n    var initialWindowWidth = null;\n    var currentWindowWidth = null;\n    var resizeHandler = function resizeHandler() {\n      if (!isResizing) {\n        isResizing = true;\n      }\n      clearTimeout(resizeDoneTimer);\n      resizeDoneTimer = setTimeout(function() {\n        isResizing = false;\n        initialWindowWidth = null;\n        currentWindowWidth = null;\n        if (isResizingHorizontally) {\n          isResizingHorizontally = false;\n          store.dispatch('DID_STOP_RESIZE');\n        }\n      }, 500);\n    };\n    window.addEventListener('resize', resizeHandler);\n\n    // render initial view\n    var view = root(store, { id: getUniqueId() });\n\n    //\n    // PRIVATE API -------------------------------------------------------------------------------------\n    //\n    var isResting = false;\n    var isHidden = false;\n\n    var readWriteApi = {\n      // necessary for update loop\n\n      /**\n       * Reads from dom (never call manually)\n       * @private\n       */\n      _read: function _read() {\n        // test if we're resizing horizontally\n        // TODO: see if we can optimize this by measuring root rect\n        if (isResizing) {\n          currentWindowWidth = window.innerWidth;\n          if (!initialWindowWidth) {\n            initialWindowWidth = currentWindowWidth;\n          }\n\n          if (\n            !isResizingHorizontally &&\n            currentWindowWidth !== initialWindowWidth\n          ) {\n            store.dispatch('DID_START_RESIZE');\n            isResizingHorizontally = true;\n          }\n        }\n\n        if (isHidden && isResting) {\n          // test if is no longer hidden\n          isResting = view.element.offsetParent === null;\n        }\n\n        // if resting, no need to read as numbers will still all be correct\n        if (isResting) return;\n\n        // read view data\n        view._read();\n\n        // if is hidden we need to know so we exit rest mode when revealed\n        isHidden = view.rect.element.hidden;\n      },\n\n      /**\n       * Writes to dom (never call manually)\n       * @private\n       */\n      _write: function _write(ts) {\n        // get all actions from store\n        var actions = store\n          .processActionQueue()\n\n          // filter out set actions (these will automatically trigger DID_SET)\n          .filter(function(action) {\n            return !/^SET_/.test(action.type);\n          });\n\n        // if was idling and no actions stop here\n        if (isResting && !actions.length) return;\n\n        // some actions might trigger events\n        routeActionsToEvents(actions);\n\n        // update the view\n        isResting = view._write(ts, actions, isResizingHorizontally);\n\n        // will clean up all archived items\n        removeReleasedItems(store.query('GET_ITEMS'));\n\n        // now idling\n        if (isResting) {\n          store.processDispatchQueue();\n        }\n      }\n    };\n\n    //\n    // EXPOSE EVENTS -------------------------------------------------------------------------------------\n    //\n    var createEvent = function createEvent(name) {\n      return function(data) {\n        // create default event\n        var event = {\n          type: name\n        };\n\n        // no data to add\n        if (!data) {\n          return event;\n        }\n\n        // copy relevant props\n        if (data.hasOwnProperty('error')) {\n          event.error = data.error ? Object.assign({}, data.error) : null;\n        }\n\n        if (data.status) {\n          event.status = Object.assign({}, data.status);\n        }\n\n        if (data.file) {\n          event.output = data.file;\n        }\n\n        // only source is available, else add item if possible\n        if (data.source) {\n          event.file = data.source;\n        } else if (data.item || data.id) {\n          var item = data.item ? data.item : store.query('GET_ITEM', data.id);\n          event.file = item ? createItemAPI(item) : null;\n        }\n\n        // map all items in a possible items array\n        if (data.items) {\n          event.items = data.items.map(createItemAPI);\n        }\n\n        // if this is a progress event add the progress amount\n        if (/progress/.test(name)) {\n          event.progress = data.progress;\n        }\n\n        // copy relevant props\n        if (data.hasOwnProperty('origin') && data.hasOwnProperty('target')) {\n          event.origin = data.origin;\n          event.target = data.target;\n        }\n\n        return event;\n      };\n    };\n\n    var eventRoutes = {\n      DID_DESTROY: createEvent('destroy'),\n\n      DID_INIT: createEvent('init'),\n\n      DID_THROW_MAX_FILES: createEvent('warning'),\n\n      DID_INIT_ITEM: createEvent('initfile'),\n      DID_START_ITEM_LOAD: createEvent('addfilestart'),\n      DID_UPDATE_ITEM_LOAD_PROGRESS: createEvent('addfileprogress'),\n      DID_LOAD_ITEM: createEvent('addfile'),\n\n      DID_THROW_ITEM_INVALID: [createEvent('error'), createEvent('addfile')],\n\n      DID_THROW_ITEM_LOAD_ERROR: [createEvent('error'), createEvent('addfile')],\n\n      DID_THROW_ITEM_REMOVE_ERROR: [\n        createEvent('error'),\n        createEvent('removefile')\n      ],\n\n      DID_PREPARE_OUTPUT: createEvent('preparefile'),\n\n      DID_START_ITEM_PROCESSING: createEvent('processfilestart'),\n      DID_UPDATE_ITEM_PROCESS_PROGRESS: createEvent('processfileprogress'),\n      DID_ABORT_ITEM_PROCESSING: createEvent('processfileabort'),\n      DID_COMPLETE_ITEM_PROCESSING: createEvent('processfile'),\n      DID_COMPLETE_ITEM_PROCESSING_ALL: createEvent('processfiles'),\n      DID_REVERT_ITEM_PROCESSING: createEvent('processfilerevert'),\n\n      DID_THROW_ITEM_PROCESSING_ERROR: [\n        createEvent('error'),\n        createEvent('processfile')\n      ],\n\n      DID_REMOVE_ITEM: createEvent('removefile'),\n\n      DID_UPDATE_ITEMS: createEvent('updatefiles'),\n\n      DID_ACTIVATE_ITEM: createEvent('activatefile'),\n\n      DID_REORDER_ITEMS: createEvent('reorderfiles')\n    };\n\n    var exposeEvent = function exposeEvent(event) {\n      // create event object to be dispatched\n      var detail = Object.assign({ pond: exports }, event);\n      delete detail.type;\n      view.element.dispatchEvent(\n        new CustomEvent('FilePond:' + event.type, {\n          // event info\n          detail: detail,\n\n          // event behaviour\n          bubbles: true,\n          cancelable: true,\n          composed: true // triggers listeners outside of shadow root\n        })\n      );\n\n      // event object to params used for `on()` event handlers and callbacks `oninit()`\n      var params = [];\n\n      // if is possible error event, make it the first param\n      if (event.hasOwnProperty('error')) {\n        params.push(event.error);\n      }\n\n      // file is always section\n      if (event.hasOwnProperty('file')) {\n        params.push(event.file);\n      }\n\n      // append other props\n      var filtered = ['type', 'error', 'file'];\n      Object.keys(event)\n        .filter(function(key) {\n          return !filtered.includes(key);\n        })\n        .forEach(function(key) {\n          return params.push(event[key]);\n        });\n\n      // on(type, () => { })\n      exports.fire.apply(exports, [event.type].concat(params));\n\n      // oninit = () => {}\n      var handler = store.query('GET_ON' + event.type.toUpperCase());\n      if (handler) {\n        handler.apply(void 0, params);\n      }\n    };\n\n    var routeActionsToEvents = function routeActionsToEvents(actions) {\n      if (!actions.length) return;\n      actions\n        .filter(function(action) {\n          return eventRoutes[action.type];\n        })\n        .forEach(function(action) {\n          var routes = eventRoutes[action.type];\n          (Array.isArray(routes) ? routes : [routes]).forEach(function(route) {\n            // this isn't fantastic, but because of the stacking of settimeouts plugins can handle the did_load before the did_init\n            if (action.type === 'DID_INIT_ITEM') {\n              exposeEvent(route(action.data));\n            } else {\n              setTimeout(function() {\n                exposeEvent(route(action.data));\n              }, 0);\n            }\n          });\n        });\n    };\n\n    //\n    // PUBLIC API -------------------------------------------------------------------------------------\n    //\n    var setOptions = function setOptions(options) {\n      return store.dispatch('SET_OPTIONS', { options: options });\n    };\n\n    var getFile = function getFile(query) {\n      return store.query('GET_ACTIVE_ITEM', query);\n    };\n\n    var prepareFile = function prepareFile(query) {\n      return new Promise(function(resolve, reject) {\n        store.dispatch('REQUEST_ITEM_PREPARE', {\n          query: query,\n          success: function success(item) {\n            resolve(item);\n          },\n          failure: function failure(error) {\n            reject(error);\n          }\n        });\n      });\n    };\n\n    var addFile = function addFile(source) {\n      var options =\n        arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return new Promise(function(resolve, reject) {\n        addFiles([{ source: source, options: options }], {\n          index: options.index\n        })\n          .then(function(items) {\n            return resolve(items && items[0]);\n          })\n          .catch(reject);\n      });\n    };\n\n    var isFilePondFile = function isFilePondFile(obj) {\n      return obj.file && obj.id;\n    };\n\n    var removeFile = function removeFile(query, options) {\n      // if only passed options\n      if (typeof query === 'object' && !isFilePondFile(query) && !options) {\n        options = query;\n        query = undefined;\n      }\n\n      // request item removal\n      store.dispatch(\n        'REMOVE_ITEM',\n        Object.assign({}, options, { query: query })\n      );\n\n      // see if item has been removed\n      return store.query('GET_ACTIVE_ITEM', query) === null;\n    };\n\n    var addFiles = function addFiles() {\n      for (\n        var _len = arguments.length, args = new Array(_len), _key = 0;\n        _key < _len;\n        _key++\n      ) {\n        args[_key] = arguments[_key];\n      }\n      return new Promise(function(resolve, reject) {\n        var sources = [];\n        var options = {};\n\n        // user passed a sources array\n        if (isArray(args[0])) {\n          sources.push.apply(sources, args[0]);\n          Object.assign(options, args[1] || {});\n        } else {\n          // user passed sources as arguments, last one might be options object\n          var lastArgument = args[args.length - 1];\n          if (\n            typeof lastArgument === 'object' &&\n            !(lastArgument instanceof Blob)\n          ) {\n            Object.assign(options, args.pop());\n          }\n\n          // add rest to sources\n          sources.push.apply(sources, args);\n        }\n\n        store.dispatch('ADD_ITEMS', {\n          items: sources,\n          index: options.index,\n          interactionMethod: InteractionMethod.API,\n          success: resolve,\n          failure: reject\n        });\n      });\n    };\n\n    var getFiles = function getFiles() {\n      return store.query('GET_ACTIVE_ITEMS');\n    };\n\n    var processFile = function processFile(query) {\n      return new Promise(function(resolve, reject) {\n        store.dispatch('REQUEST_ITEM_PROCESSING', {\n          query: query,\n          success: function success(item) {\n            resolve(item);\n          },\n          failure: function failure(error) {\n            reject(error);\n          }\n        });\n      });\n    };\n\n    var prepareFiles = function prepareFiles() {\n      for (\n        var _len2 = arguments.length, args = new Array(_len2), _key2 = 0;\n        _key2 < _len2;\n        _key2++\n      ) {\n        args[_key2] = arguments[_key2];\n      }\n      var queries = Array.isArray(args[0]) ? args[0] : args;\n      var items = queries.length ? queries : getFiles();\n      return Promise.all(items.map(prepareFile));\n    };\n\n    var processFiles = function processFiles() {\n      for (\n        var _len3 = arguments.length, args = new Array(_len3), _key3 = 0;\n        _key3 < _len3;\n        _key3++\n      ) {\n        args[_key3] = arguments[_key3];\n      }\n      var queries = Array.isArray(args[0]) ? args[0] : args;\n      if (!queries.length) {\n        var files = getFiles().filter(function(item) {\n          return (\n            !(\n              item.status === ItemStatus.IDLE &&\n              item.origin === FileOrigin.LOCAL\n            ) &&\n            item.status !== ItemStatus.PROCESSING &&\n            item.status !== ItemStatus.PROCESSING_COMPLETE &&\n            item.status !== ItemStatus.PROCESSING_REVERT_ERROR\n          );\n        });\n\n        return Promise.all(files.map(processFile));\n      }\n      return Promise.all(queries.map(processFile));\n    };\n\n    var removeFiles = function removeFiles() {\n      for (\n        var _len4 = arguments.length, args = new Array(_len4), _key4 = 0;\n        _key4 < _len4;\n        _key4++\n      ) {\n        args[_key4] = arguments[_key4];\n      }\n\n      var queries = Array.isArray(args[0]) ? args[0] : args;\n\n      var options;\n      if (typeof queries[queries.length - 1] === 'object') {\n        options = queries.pop();\n      } else if (Array.isArray(args[0])) {\n        options = args[1];\n      }\n\n      var files = getFiles();\n\n      if (!queries.length)\n        return Promise.all(\n          files.map(function(file) {\n            return removeFile(file, options);\n          })\n        );\n\n      // when removing by index the indexes shift after each file removal so we need to convert indexes to ids\n      var mappedQueries = queries\n        .map(function(query) {\n          return isNumber(query)\n            ? files[query]\n              ? files[query].id\n              : null\n            : query;\n        })\n        .filter(function(query) {\n          return query;\n        });\n\n      return mappedQueries.map(function(q) {\n        return removeFile(q, options);\n      });\n    };\n\n    var exports = Object.assign(\n      {},\n\n      on(),\n      {},\n\n      readWriteApi,\n      {},\n\n      createOptionAPI(store, defaultOptions),\n      {\n        /**\n         * Override options defined in options object\n         * @param options\n         */\n        setOptions: setOptions,\n\n        /**\n         * Load the given file\n         * @param source - the source of the file (either a File, base64 data uri or url)\n         * @param options - object, { index: 0 }\n         */\n        addFile: addFile,\n\n        /**\n         * Load the given files\n         * @param sources - the sources of the files to load\n         * @param options - object, { index: 0 }\n         */\n        addFiles: addFiles,\n\n        /**\n         * Returns the file objects matching the given query\n         * @param query { string, number, null }\n         */\n        getFile: getFile,\n\n        /**\n         * Upload file with given name\n         * @param query { string, number, null  }\n         */\n        processFile: processFile,\n\n        /**\n         * Request prepare output for file with given name\n         * @param query { string, number, null  }\n         */\n        prepareFile: prepareFile,\n\n        /**\n         * Removes a file by its name\n         * @param query { string, number, null  }\n         */\n        removeFile: removeFile,\n\n        /**\n         * Moves a file to a new location in the files list\n         */\n        moveFile: function moveFile(query, index) {\n          return store.dispatch('MOVE_ITEM', { query: query, index: index });\n        },\n\n        /**\n         * Returns all files (wrapped in public api)\n         */\n        getFiles: getFiles,\n\n        /**\n         * Starts uploading all files\n         */\n        processFiles: processFiles,\n\n        /**\n         * Clears all files from the files list\n         */\n        removeFiles: removeFiles,\n\n        /**\n         * Starts preparing output of all files\n         */\n        prepareFiles: prepareFiles,\n\n        /**\n         * Sort list of files\n         */\n        sort: function sort(compare) {\n          return store.dispatch('SORT', { compare: compare });\n        },\n\n        /**\n         * Browse the file system for a file\n         */\n        browse: function browse() {\n          // needs to be trigger directly as user action needs to be traceable (is not traceable in requestAnimationFrame)\n          var input = view.element.querySelector('input[type=file]');\n          if (input) {\n            input.click();\n          }\n        },\n\n        /**\n         * Destroys the app\n         */\n        destroy: function destroy() {\n          // request destruction\n          exports.fire('destroy', view.element);\n\n          // stop active processes (file uploads, fetches, stuff like that)\n          // loop over items and depending on states call abort for ongoing processes\n          store.dispatch('ABORT_ALL');\n\n          // destroy view\n          view._destroy();\n\n          // stop listening to resize\n          window.removeEventListener('resize', resizeHandler);\n\n          // stop listening to the visiblitychange event\n          document.removeEventListener('visibilitychange', visibilityHandler);\n\n          // dispatch destroy\n          store.dispatch('DID_DESTROY');\n        },\n\n        /**\n         * Inserts the plugin before the target element\n         */\n        insertBefore: function insertBefore$1(element) {\n          return insertBefore(view.element, element);\n        },\n\n        /**\n         * Inserts the plugin after the target element\n         */\n        insertAfter: function insertAfter$1(element) {\n          return insertAfter(view.element, element);\n        },\n\n        /**\n         * Appends the plugin to the target element\n         */\n        appendTo: function appendTo(element) {\n          return element.appendChild(view.element);\n        },\n\n        /**\n         * Replaces an element with the app\n         */\n        replaceElement: function replaceElement(element) {\n          // insert the app before the element\n          insertBefore(view.element, element);\n\n          // remove the original element\n          element.parentNode.removeChild(element);\n\n          // remember original element\n          originalElement = element;\n        },\n\n        /**\n         * Restores the original element\n         */\n        restoreElement: function restoreElement() {\n          if (!originalElement) {\n            return; // no element to restore\n          }\n\n          // restore original element\n          insertAfter(originalElement, view.element);\n\n          // remove our element\n          view.element.parentNode.removeChild(view.element);\n\n          // remove reference\n          originalElement = null;\n        },\n\n        /**\n         * Returns true if the app root is attached to given element\n         * @param element\n         */\n        isAttachedTo: function isAttachedTo(element) {\n          return view.element === element || originalElement === element;\n        },\n\n        /**\n         * Returns the root element\n         */\n        element: {\n          get: function get() {\n            return view.element;\n          }\n        },\n\n        /**\n         * Returns the current pond status\n         */\n        status: {\n          get: function get() {\n            return store.query('GET_STATUS');\n          }\n        }\n      }\n    );\n\n    // Done!\n    store.dispatch('DID_INIT');\n\n    // create actual api object\n    return createObject(exports);\n  };\n\n  var createAppObject = function createAppObject() {\n    var customOptions =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    // default options\n    var defaultOptions = {};\n    forin(getOptions(), function(key, value) {\n      defaultOptions[key] = value[0];\n    });\n\n    // set app options\n    var app = createApp(\n      Object.assign(\n        {},\n\n        defaultOptions,\n        {},\n\n        customOptions\n      )\n    );\n\n    // return the plugin instance\n    return app;\n  };\n\n  var lowerCaseFirstLetter = function lowerCaseFirstLetter(string) {\n    return string.charAt(0).toLowerCase() + string.slice(1);\n  };\n\n  var attributeNameToPropertyName = function attributeNameToPropertyName(\n    attributeName\n  ) {\n    return toCamels(attributeName.replace(/^data-/, ''));\n  };\n\n  var mapObject = function mapObject(object, propertyMap) {\n    // remove unwanted\n    forin(propertyMap, function(selector, mapping) {\n      forin(object, function(property, value) {\n        // create regexp shortcut\n        var selectorRegExp = new RegExp(selector);\n\n        // tests if\n        var matches = selectorRegExp.test(property);\n\n        // no match, skip\n        if (!matches) {\n          return;\n        }\n\n        // if there's a mapping, the original property is always removed\n        delete object[property];\n\n        // should only remove, we done!\n        if (mapping === false) {\n          return;\n        }\n\n        // move value to new property\n        if (isString(mapping)) {\n          object[mapping] = value;\n          return;\n        }\n\n        // move to group\n        var group = mapping.group;\n        if (isObject(mapping) && !object[group]) {\n          object[group] = {};\n        }\n\n        object[group][\n          lowerCaseFirstLetter(property.replace(selectorRegExp, ''))\n        ] = value;\n      });\n\n      // do submapping\n      if (mapping.mapping) {\n        mapObject(object[mapping.group], mapping.mapping);\n      }\n    });\n  };\n\n  var getAttributesAsObject = function getAttributesAsObject(node) {\n    var attributeMapping =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    // turn attributes into object\n    var attributes = [];\n    forin(node.attributes, function(index) {\n      attributes.push(node.attributes[index]);\n    });\n\n    var output = attributes\n      .filter(function(attribute) {\n        return attribute.name;\n      })\n      .reduce(function(obj, attribute) {\n        var value = attr(node, attribute.name);\n\n        obj[attributeNameToPropertyName(attribute.name)] =\n          value === attribute.name ? true : value;\n        return obj;\n      }, {});\n\n    // do mapping of object properties\n    mapObject(output, attributeMapping);\n\n    return output;\n  };\n\n  var createAppAtElement = function createAppAtElement(element) {\n    var options =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    // how attributes of the input element are mapped to the options for the plugin\n    var attributeMapping = {\n      // translate to other name\n      '^class$': 'className',\n      '^multiple$': 'allowMultiple',\n      '^capture$': 'captureMethod',\n      '^webkitdirectory$': 'allowDirectoriesOnly',\n\n      // group under single property\n      '^server': {\n        group: 'server',\n        mapping: {\n          '^process': {\n            group: 'process'\n          },\n\n          '^revert': {\n            group: 'revert'\n          },\n\n          '^fetch': {\n            group: 'fetch'\n          },\n\n          '^restore': {\n            group: 'restore'\n          },\n\n          '^load': {\n            group: 'load'\n          }\n        }\n      },\n\n      // don't include in object\n      '^type$': false,\n      '^files$': false\n    };\n\n    // add additional option translators\n    applyFilters('SET_ATTRIBUTE_TO_OPTION_MAP', attributeMapping);\n\n    // create final options object by setting options object and then overriding options supplied on element\n    var mergedOptions = Object.assign({}, options);\n\n    var attributeOptions = getAttributesAsObject(\n      element.nodeName === 'FIELDSET'\n        ? element.querySelector('input[type=file]')\n        : element,\n      attributeMapping\n    );\n\n    // merge with options object\n    Object.keys(attributeOptions).forEach(function(key) {\n      if (isObject(attributeOptions[key])) {\n        if (!isObject(mergedOptions[key])) {\n          mergedOptions[key] = {};\n        }\n        Object.assign(mergedOptions[key], attributeOptions[key]);\n      } else {\n        mergedOptions[key] = attributeOptions[key];\n      }\n    });\n\n    // if parent is a fieldset, get files from parent by selecting all input fields that are not file upload fields\n    // these will then be automatically set to the initial files\n    mergedOptions.files = (options.files || []).concat(\n      Array.from(element.querySelectorAll('input:not([type=file])')).map(\n        function(input) {\n          return {\n            source: input.value,\n            options: {\n              type: input.dataset.type\n            }\n          };\n        }\n      )\n    );\n\n    // build plugin\n    var app = createAppObject(mergedOptions);\n\n    // add already selected files\n    if (element.files) {\n      Array.from(element.files).forEach(function(file) {\n        app.addFile(file);\n      });\n    }\n\n    // replace the target element\n    app.replaceElement(element);\n\n    // expose\n    return app;\n  };\n\n  // if an element is passed, we create the instance at that element, if not, we just create an up object\n  var createApp$1 = function createApp() {\n    return isNode(arguments.length <= 0 ? undefined : arguments[0])\n      ? createAppAtElement.apply(void 0, arguments)\n      : createAppObject.apply(void 0, arguments);\n  };\n\n  var PRIVATE_METHODS = ['fire', '_read', '_write'];\n\n  var createAppAPI = function createAppAPI(app) {\n    var api = {};\n\n    copyObjectPropertiesToObject(app, api, PRIVATE_METHODS);\n\n    return api;\n  };\n\n  /**\n   * Replaces placeholders in given string with replacements\n   * @param string - \"Foo {bar}\"\"\n   * @param replacements - { \"bar\": 10 }\n   */\n  var replaceInString = function replaceInString(string, replacements) {\n    return string.replace(/(?:{([a-zA-Z]+)})/g, function(match, group) {\n      return replacements[group];\n    });\n  };\n\n  var createWorker = function createWorker(fn) {\n    var workerBlob = new Blob(['(', fn.toString(), ')()'], {\n      type: 'application/javascript'\n    });\n\n    var workerURL = URL.createObjectURL(workerBlob);\n    var worker = new Worker(workerURL);\n\n    return {\n      transfer: function transfer(message, cb) {},\n      post: function post(message, cb, transferList) {\n        var id = getUniqueId();\n\n        worker.onmessage = function(e) {\n          if (e.data.id === id) {\n            cb(e.data.message);\n          }\n        };\n\n        worker.postMessage(\n          {\n            id: id,\n            message: message\n          },\n\n          transferList\n        );\n      },\n      terminate: function terminate() {\n        worker.terminate();\n        URL.revokeObjectURL(workerURL);\n      }\n    };\n  };\n\n  var loadImage = function loadImage(url) {\n    return new Promise(function(resolve, reject) {\n      var img = new Image();\n      img.onload = function() {\n        resolve(img);\n      };\n      img.onerror = function(e) {\n        reject(e);\n      };\n      img.src = url;\n    });\n  };\n\n  var renameFile = function renameFile(file, name) {\n    var renamedFile = file.slice(0, file.size, file.type);\n    renamedFile.lastModifiedDate = file.lastModifiedDate;\n    renamedFile.name = name;\n    return renamedFile;\n  };\n\n  var copyFile = function copyFile(file) {\n    return renameFile(file, file.name);\n  };\n\n  // already registered plugins (can't register twice)\n  var registeredPlugins = [];\n\n  // pass utils to plugin\n  var createAppPlugin = function createAppPlugin(plugin) {\n    // already registered\n    if (registeredPlugins.includes(plugin)) {\n      return;\n    }\n\n    // remember this plugin\n    registeredPlugins.push(plugin);\n\n    // setup!\n    var pluginOutline = plugin({\n      addFilter: addFilter,\n      utils: {\n        Type: Type,\n        forin: forin,\n        isString: isString,\n        isFile: isFile,\n        toNaturalFileSize: toNaturalFileSize,\n        replaceInString: replaceInString,\n        getExtensionFromFilename: getExtensionFromFilename,\n        getFilenameWithoutExtension: getFilenameWithoutExtension,\n        guesstimateMimeType: guesstimateMimeType,\n        getFileFromBlob: getFileFromBlob,\n        getFilenameFromURL: getFilenameFromURL,\n        createRoute: createRoute,\n        createWorker: createWorker,\n        createView: createView,\n        createItemAPI: createItemAPI,\n        loadImage: loadImage,\n        copyFile: copyFile,\n        renameFile: renameFile,\n        createBlob: createBlob,\n        applyFilterChain: applyFilterChain,\n        text: text,\n        getNumericAspectRatioFromString: getNumericAspectRatioFromString\n      },\n\n      views: {\n        fileActionButton: fileActionButton\n      }\n    });\n\n    // add plugin options to default options\n    extendDefaultOptions(pluginOutline.options);\n  };\n\n  // feature detection used by supported() method\n  var isOperaMini = function isOperaMini() {\n    return (\n      Object.prototype.toString.call(window.operamini) === '[object OperaMini]'\n    );\n  };\n  var hasPromises = function hasPromises() {\n    return 'Promise' in window;\n  };\n  var hasBlobSlice = function hasBlobSlice() {\n    return 'slice' in Blob.prototype;\n  };\n  var hasCreateObjectURL = function hasCreateObjectURL() {\n    return 'URL' in window && 'createObjectURL' in window.URL;\n  };\n  var hasVisibility = function hasVisibility() {\n    return 'visibilityState' in document;\n  };\n  var hasTiming = function hasTiming() {\n    return 'performance' in window;\n  }; // iOS 8.x\n  var hasCSSSupports = function hasCSSSupports() {\n    return 'supports' in (window.CSS || {});\n  }; // use to detect Safari 9+\n  var isIE11 = function isIE11() {\n    return /MSIE|Trident/.test(window.navigator.userAgent);\n  };\n\n  var supported = (function() {\n    // Runs immidiately and then remembers result for subsequent calls\n    var isSupported =\n      // Has to be a browser\n      isBrowser() &&\n      // Can't run on Opera Mini due to lack of everything\n      !isOperaMini() &&\n      // Require these APIs to feature detect a modern browser\n      hasVisibility() &&\n      hasPromises() &&\n      hasBlobSlice() &&\n      hasCreateObjectURL() &&\n      hasTiming() &&\n      // doesn't need CSSSupports but is a good way to detect Safari 9+ (we do want to support IE11 though)\n      (hasCSSSupports() || isIE11());\n\n    return function() {\n      return isSupported;\n    };\n  })();\n\n  /**\n   * Plugin internal state (over all instances)\n   */\n  var state = {\n    // active app instances, used to redraw the apps and to find the later\n    apps: []\n  };\n\n  // plugin name\n  var name = 'filepond';\n\n  /**\n   * Public Plugin methods\n   */\n  var fn = function fn() {};\n  exports.Status = {};\n  exports.FileStatus = {};\n  exports.FileOrigin = {};\n  exports.OptionTypes = {};\n  exports.create = fn;\n  exports.destroy = fn;\n  exports.parse = fn;\n  exports.find = fn;\n  exports.registerPlugin = fn;\n  exports.getOptions = fn;\n  exports.setOptions = fn;\n\n  // if not supported, no API\n  if (supported()) {\n    // start painter and fire load event\n    createPainter(\n      function() {\n        state.apps.forEach(function(app) {\n          return app._read();\n        });\n      },\n      function(ts) {\n        state.apps.forEach(function(app) {\n          return app._write(ts);\n        });\n      }\n    );\n\n    // fire loaded event so we know when FilePond is available\n    var dispatch = function dispatch() {\n      // let others know we have area ready\n      document.dispatchEvent(\n        new CustomEvent('FilePond:loaded', {\n          detail: {\n            supported: supported,\n            create: exports.create,\n            destroy: exports.destroy,\n            parse: exports.parse,\n            find: exports.find,\n            registerPlugin: exports.registerPlugin,\n            setOptions: exports.setOptions\n          }\n        })\n      );\n\n      // clean up event\n      document.removeEventListener('DOMContentLoaded', dispatch);\n    };\n\n    if (document.readyState !== 'loading') {\n      // move to back of execution queue, FilePond should have been exported by then\n      setTimeout(function() {\n        return dispatch();\n      }, 0);\n    } else {\n      document.addEventListener('DOMContentLoaded', dispatch);\n    }\n\n    // updates the OptionTypes object based on the current options\n    var updateOptionTypes = function updateOptionTypes() {\n      return forin(getOptions(), function(key, value) {\n        exports.OptionTypes[key] = value[1];\n      });\n    };\n\n    exports.Status = Object.assign({}, Status);\n    exports.FileOrigin = Object.assign({}, FileOrigin);\n    exports.FileStatus = Object.assign({}, ItemStatus);\n\n    exports.OptionTypes = {};\n    updateOptionTypes();\n\n    // create method, creates apps and adds them to the app array\n    exports.create = function create() {\n      var app = createApp$1.apply(void 0, arguments);\n      app.on('destroy', exports.destroy);\n      state.apps.push(app);\n      return createAppAPI(app);\n    };\n\n    // destroys apps and removes them from the app array\n    exports.destroy = function destroy(hook) {\n      // returns true if the app was destroyed successfully\n      var indexToRemove = state.apps.findIndex(function(app) {\n        return app.isAttachedTo(hook);\n      });\n      if (indexToRemove >= 0) {\n        // remove from apps\n        var app = state.apps.splice(indexToRemove, 1)[0];\n\n        // restore original dom element\n        app.restoreElement();\n\n        return true;\n      }\n\n      return false;\n    };\n\n    // parses the given context for plugins (does not include the context element itself)\n    exports.parse = function parse(context) {\n      // get all possible hooks\n      var matchedHooks = Array.from(context.querySelectorAll('.' + name));\n\n      // filter out already active hooks\n      var newHooks = matchedHooks.filter(function(newHook) {\n        return !state.apps.find(function(app) {\n          return app.isAttachedTo(newHook);\n        });\n      });\n\n      // create new instance for each hook\n      return newHooks.map(function(hook) {\n        return exports.create(hook);\n      });\n    };\n\n    // returns an app based on the given element hook\n    exports.find = function find(hook) {\n      var app = state.apps.find(function(app) {\n        return app.isAttachedTo(hook);\n      });\n      if (!app) {\n        return null;\n      }\n      return createAppAPI(app);\n    };\n\n    // adds a plugin extension\n    exports.registerPlugin = function registerPlugin() {\n      for (\n        var _len = arguments.length, plugins = new Array(_len), _key = 0;\n        _key < _len;\n        _key++\n      ) {\n        plugins[_key] = arguments[_key];\n      }\n\n      // register plugins\n      plugins.forEach(createAppPlugin);\n\n      // update OptionTypes, each plugin might have extended the default options\n      updateOptionTypes();\n    };\n\n    exports.getOptions = function getOptions$1() {\n      var opts = {};\n      forin(getOptions(), function(key, value) {\n        opts[key] = value[0];\n      });\n      return opts;\n    };\n\n    exports.setOptions = function setOptions$1(opts) {\n      if (isObject(opts)) {\n        // update existing plugins\n        state.apps.forEach(function(app) {\n          app.setOptions(opts);\n        });\n\n        // override defaults\n        setOptions(opts);\n      }\n\n      // return new options\n      return exports.getOptions();\n    };\n  }\n\n  exports.supported = supported;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n});\n"]},"metadata":{},"sourceType":"script"}